{
  "hash": "8baa6ce10ac91236c899ed76889bf7a0",
  "result": {
    "markdown": "---\ntitle: \"Spatial Hedonic Model\"\nsubtitle: \"Subset (n=3000) of Lucas County housing data\"\nauthor: \"Arnstein Gjestland\"\ninstitute: \"HVL\"\ndate: \"Spring 2021 (revised autumn 2022)\"\nformat:\n  revealjs:\n        theme: simple\n        footer: '[MSB205](/index.html)'\n        reveal_options:\n        code-fold: show\n        incremental: true\n        smaller: true\n        scrollable: true\n        slide-number: c/t\neditor: visual\neditor_options:\n  markdown:\n    wrap: sentence\n    canonical: true\n    chunk_output_type: console\necho: true\neval: true\nbibliography: [references.bib, LucasCounty-packages.bib]\nnocite: '@*'\n---\n\n\n## Loading packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# To install urbnmapr from github\ndevtools::install_github(\"UrbanInstitute/urbnmapr\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# for demean\nsuppressPackageStartupMessages({\nlibrary(Jmisc)\nlibrary(sf)\nlibrary(urbnmapr)\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(sp)\nlibrary(spdep)\nlibrary(spatialreg)\nlibrary(spData)\nlibrary(huxtable)\nlibrary(knitr)\n})\n# Options\noptions(scipen = 7)\n```\n:::\n\n\n\n\n## Read in data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(house)\n#head(house, n=10)\nhouse_sf <- st_as_sf(house)\n#head(house_sf, n=10)\ndim(house_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 25357    25\n```\n:::\n\n```{.r .cell-code}\nset.seed(42)# What else could it be?\nred_house_sf <- house_sf[sample(1:dim(house_sf)[1], size = 3000), ]\n```\n:::\n\n\n## Quick check of data\n\n\n::: {.cell hash='index_cache/revealjs/unnamed-chunk-5_f17229dd1707c266c7a18063b723c9c5'}\n\n```{.r .cell-code}\nplot(house_sf[\"price\"], cex = 0.01, pch = 20)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(red_house_sf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3000   25\n```\n:::\n:::\n\n\n## Dataset info (R help)\n\nData on 25,357 single family homes sold in Lucas County, Ohio, 1993-1998 from the county auditor.\n\nFormal class 'SpatialPointsDataFrame' \\[package \"sp\"\\] with 5 slots.\nThe data slot is a data frame with 25357 observations on the following 24 variables.\n\nprice\n\n:   a numeric vector\n\nyrbuilt\n\n:   a numeric vector\n\nstories\n\n:   a factor with levels one bilevel multilvl one+half two two+half three\n\nTLA\n\n:   a numeric vector\n\n## Dataset info (R help)\n\nwall\n\n:   a factor with levels stucdrvt ccbtile metlvnyl brick stone wood partbrk\n\nbeds\n\n:   a numeric vector\n\nbaths\n\n:   a numeric vector\n\nhalfbaths\n\n:   a numeric vector\n\nfrontage\n\n:   a numeric vector\n\ndepth\n\n:   a numeric vector\n\n## Dataset info (R help)\n\ngarage\n\n:   a factor with levels no garage basement attached detached carport\n\ngaragesqft\n\n:   a numeric vector\n\nrooms\n\n:   a numeric vector\n\nlotsize\n\n:   a numeric vector\n\nsdate\n\n:   a numeric vector\n\navalue\n\n:   a numeric vector\n\n## Dataset info (R help)\n\ns1993 to s1998\n\n:   a numeric vector\n\nsyear\n\n:   a factor with levels 1993 1994 1995 1996 1997 1998\n\nage\n\n:   a numeric vector\n\n## Dataset info (R help)\n\nIts projection is CRS(+init=epsg:2834), the Ohio North State Plane.\n\n## From SpatialPointsDataFrame to sf\n\nWe convert from SpatialPointsDataFrame to sf (simple feature, point).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(100*house_sf$age, breaks = 30)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n## From SpatialPointsDataFrame to sf cont.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(100*house_sf$age)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   1.00   35.00   49.00   53.66   75.00  164.00 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_age <- as.numeric(levels(house_sf$syear))[as.integer(house_sf$syear)] - house_sf$yrbuilt\nmy_age <- my_age + 3\nmy_age1 <- 1999 - house_sf$yrbuilt\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(100*house_sf$age - my_age)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n-2.0000 -1.0000  0.0000  0.2981  2.0000  3.0000 \n```\n:::\n:::\n\n\n## From SpatialPointsDataFrame to sf cont.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(my_age1, breaks = 30)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n## From SpatialPointsDataFrame to sf cont.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(my_age1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   1.00   35.00   49.00   53.66   75.00  164.00 \n```\n:::\n\n```{.r .cell-code}\ntable(round(my_age1, 3) == round(100*house_sf$age, 3))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n TRUE \n25357 \n```\n:::\n:::\n\n\n## Changing the age variable\n\nOk, the age variable is the age of the house 1999 (not when sold), divided by 100.\nThe age of the house when sold seems to be a more reasonable variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Trying to follow Bivand 2011, NHH Discussion Paper\n# age seems to include strange values. Turns out to be age in 1999 divided by 100\n# We calculate age at time of sale as age_sold = syear - yrbuilt\n# syear is factor, convert to numeric\nred_house_sf$age_sold <- as.numeric(levels(red_house_sf$syear))[as.integer(red_house_sf$syear)] - red_house_sf$yrbuilt\n# Scale age_sold by dividing by 100\nred_house_sf$age_sold <- red_house_sf$age_sold/100\n```\n:::\n\n\n## Running the first model\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# define the model\nhmod1 <- \"I(log(price)) ~ I(age_sold) + I(age_sold^2) + \nI(age_sold^3) + I(log(TLA)) + I(log(lotsize)) + rooms + beds + syear\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# put result in lm1\nlm1 <- lm(hmod1, data = red_house_sf)\n```\n:::\n\n\n## Running the first model cont.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(lm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = hmod1, data = red_house_sf)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.28253 -0.17076  0.04916  0.23925  2.19288 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)      3.18294    0.24525  12.979  < 2e-16 ***\nI(age_sold)      1.36458    0.18896   7.222 6.49e-13 ***\nI(age_sold^2)   -3.07357    0.35572  -8.640  < 2e-16 ***\nI(age_sold^3)    0.69686    0.19888   3.504 0.000465 ***\nI(log(TLA))      0.87255    0.03930  22.203  < 2e-16 ***\nI(log(lotsize))  0.17240    0.01170  14.736  < 2e-16 ***\nrooms            0.02096    0.01216   1.723 0.084952 .  \nbeds            -0.03325    0.01771  -1.877 0.060574 .  \nsyear1994        0.06870    0.02856   2.406 0.016201 *  \nsyear1995        0.09797    0.02789   3.513 0.000450 ***\nsyear1996        0.14211    0.02746   5.176 2.42e-07 ***\nsyear1997        0.16377    0.02710   6.043 1.70e-09 ***\nsyear1998        0.26449    0.02802   9.439  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4175 on 2987 degrees of freedom\nMultiple R-squared:  0.6897,\tAdjusted R-squared:  0.6884 \nF-statistic: 553.2 on 12 and 2987 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## Generate neighbour structure\n\n**Find 5 nearest,** make neighbour list and finally convert the neighbour list to a row standardised weight matrix.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nred_house_sf_mat_nb <- knearneigh(red_house_sf, k = 5)\nred_house_sf_nb <- knn2nb(red_house_sf_mat_nb)\nred_house_sf_w <- nb2listw(red_house_sf_nb, style = \"W\")\n```\n:::\n\n\nPlot the price of a house against the mean price of its (5 nearest) neighbours.\nThere seems to be a positive spatial association\n\n## Moran Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmoran.plot(log(red_house_sf$price), listw = red_house_sf_w, labels = FALSE, pch = 20, cex=0.3)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-18-1.png){width=960}\n:::\n:::\n\n\n## Approximate profile-likelihood estimator (APLE)\n\nApproximate profile-likelihood estimator (APLE), see [@OnestepEstimationSpatial]\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate APLE for the variables\nred_house_sf %>% \n  select(price, age_sold, TLA, lotsize, rooms, beds) %>% \n  st_set_geometry(., NULL) %>% \n  demean() %>% \n  as_tibble() %>% \n  map(aple,listw = red_house_sf_w)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$price\n[1] 0.7672068\n\n$age_sold\n[1] 0.7658228\n\n$TLA\n[1] 0.7120571\n\n$lotsize\n[1] 0.5974422\n\n$rooms\n[1] 0.5652239\n\n$beds\n[1] 0.4316318\n```\n:::\n:::\n\n\n## Conclusion APLE\n\nWe see that the strength of positive spatial dependence is greatest for `price`, `TLA` and `lotsize` and lowest for number of bedrooms (`beds`) in the dwellings.\n\n> \\[APLE\\], which may be viewed somewhat like a correlation coefficient between the values observed for each state and the average values for neighbouring states.[@bivandReviewSoftwareSpatial2021]\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# If we want to see which obs. are the most influential we can \n# change labels to TRUE\n# The row number for each influential obs. will then be plotted in the figure.\nmoran.plot(red_house_sf$age_sold, listw = red_house_sf_w, \n           labels = FALSE, pch = 20, cex = 0.3)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-20-1.png){width=960}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Remember that age_sold is scaled by 1/100, so the max age 1.59 is in fact 159 years\nsummary(red_house_sf$age_sold)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n-0.0200  0.3000  0.4600  0.5014  0.7200  1.5500 \n```\n:::\n:::\n\n\n## Spatial models\n\n-   Local: SDEM, SEM, SLX, lm\n\n-   Global: SDM, SAR, SLX, SEM, lm\n\n## Local, start with SDEM\n\n\n::: {.cell hash='index_cache/revealjs/SDEM_1e7ed788013db93aca688bd39df3613a'}\n\n```{.r .cell-code}\n#\n# Some of these models are quite expensive to compute, so we cache the results\n# It should automagically be recomputed if something change, but caching is complex\n# so we should check that the models really are recomputed if we change the data or model\n# Note the use of the option Durbin to choose the kind of model. Used to be done by the options\n# type and etype until recently.\nSDEM <- errorsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = TRUE)\n```\n:::\n\n\n## Local, start with SDEM cont.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(impacts(SDEM), zstats = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nImpact measures (SDEM, estimable, n):\n                     Direct     Indirect       Total\nI(age_sold)      0.54354495  1.724313763  2.26785872\nI(age_sold^2)   -1.21151106 -3.154619724 -4.36613078\nI(age_sold^3)    0.11989915  0.858429426  0.97832858\nI(log(TLA))      0.72161017  0.325829444  1.04743962\nI(log(lotsize))  0.12000068  0.002125825  0.12212651\nrooms            0.02297956  0.022089512  0.04506907\nbeds            -0.02377263 -0.044374996 -0.06814763\nsyear1994        0.05822351  0.014444954  0.07266846\nsyear1995        0.08315349 -0.081602445  0.00155105\nsyear1996        0.11349889 -0.004495018  0.10900387\nsyear1997        0.15008363 -0.051995070  0.09808856\nsyear1998        0.25156113  0.082365747  0.33392688\n========================================================\nStandard errors:\n                    Direct   Indirect      Total\nI(age_sold)     0.18923927 0.38948601 0.43443469\nI(age_sold^2)   0.34201530 0.75080528 0.85762746\nI(age_sold^3)   0.18247954 0.42982524 0.49956776\nI(log(TLA))     0.03385523 0.08982915 0.10418040\nI(log(lotsize)) 0.01291015 0.02403307 0.02544146\nrooms           0.01026090 0.02939071 0.03485904\nbeds            0.01499544 0.04409250 0.05258579\nsyear1994       0.02411830 0.07143272 0.08526701\nsyear1995       0.02367407 0.06854508 0.08227209\nsyear1996       0.02326275 0.06749020 0.08095887\nsyear1997       0.02276712 0.06575233 0.07821040\nsyear1998       0.02378814 0.06937785 0.08321369\n========================================================\nZ-values:\n                    Direct    Indirect       Total\nI(age_sold)      2.8722631  4.42715202  5.22025240\nI(age_sold^2)   -3.5422715 -4.20164829 -5.09094101\nI(age_sold^3)    0.6570553  1.99715921  1.95835012\nI(log(TLA))     21.3145857  3.62721279 10.05409494\nI(log(lotsize))  9.2950616  0.08845415  4.80029465\nrooms            2.2395272  0.75158132  1.29289471\nbeds            -1.5853238 -1.00640696 -1.29593239\nsyear1994        2.4140802  0.20221761  0.85224590\nsyear1995        3.5124295 -1.19049312  0.01885269\nsyear1996        4.8789969 -0.06660253  1.34641049\nsyear1997        6.5921205 -0.79077157  1.25416262\nsyear1998       10.5750638  1.18720529  4.01288416\n\np-values:\n                Direct            Indirect     Total        \nI(age_sold)     0.00407544        0.0000095485 0.00000017868\nI(age_sold^2)   0.00039670        0.0000264979 0.00000035629\nI(age_sold^3)   0.51114534        0.0458079    0.050189     \nI(log(TLA))     < 2.22e-16        0.0002865    < 2.22e-16   \nI(log(lotsize)) < 2.22e-16        0.9295157    0.00000158432\nrooms           0.02512163        0.4523029    0.196047     \nbeds            0.11289279        0.3142198    0.194999     \nsyear1994       0.01577499        0.8397466    0.394078     \nsyear1995       0.00044403        0.2338526    0.984959     \nsyear1996       0.000001066267611 0.9468981    0.178170     \nsyear1997       0.000000000043359 0.4290773    0.209783     \nsyear1998       < 2.22e-16        0.2351467    0.00005998135\n```\n:::\n:::\n\n\n## Local, SEM\n\n\n::: {.cell hash='index_cache/revealjs/SEM_79394048e7b84391f7aa463f32e3cc3a'}\n\n```{.r .cell-code}\n#\n# No spatial effects in the explanatory variables\nSEM <- errorsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = FALSE)\n```\n:::\n\n\n## Local, SEM cont.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# normal summary, no impacts\nsummary(SEM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:errorsarlm(formula = hmod1, data = red_house_sf, listw = red_house_sf_w, \n    Durbin = FALSE)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-2.247145 -0.123725  0.048252  0.183358  1.409720 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                  Estimate Std. Error z value  Pr(>|z|)\n(Intercept)      4.5722371  0.2218972 20.6052 < 2.2e-16\nI(age_sold)      0.4324416  0.1929360  2.2414 0.0250019\nI(age_sold^2)   -1.2513269  0.3432463 -3.6456 0.0002668\nI(age_sold^3)    0.2529478  0.1798265  1.4066 0.1595397\nI(log(TLA))      0.6881769  0.0328172 20.9700 < 2.2e-16\nI(log(lotsize))  0.1547907  0.0129766 11.9285 < 2.2e-16\nrooms            0.0203277  0.0094133  2.1595 0.0308137\nbeds            -0.0154644  0.0134197 -1.1524 0.2491686\nsyear1994        0.0591256  0.0214624  2.7549 0.0058719\nsyear1995        0.1019680  0.0209649  4.8638 1.152e-06\nsyear1996        0.1156346  0.0206226  5.6072 2.057e-08\nsyear1997        0.1581283  0.0206646  7.6521 1.976e-14\nsyear1998        0.2419856  0.0210379 11.5024 < 2.2e-16\n\nLambda: 0.71779, LR test value: 1068.1, p-value: < 2.22e-16\nAsymptotic standard error: 0.012617\n    z-value: 56.889, p-value: < 2.22e-16\nWald statistic: 3236.4, p-value: < 2.22e-16\n\nLog likelihood: -1095.658 for error model\nML residual variance (sigma squared): 0.10709, (sigma: 0.32725)\nNumber of observations: 3000 \nNumber of parameters estimated: 15 \nAIC: 2221.3, (AIC for lm: 3287.4)\n```\n:::\n:::\n\n\n## Local, SLX\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# SLX is not costly to compute, so no caching\nSLX <- lmSLX(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = TRUE)\n```\n:::\n\n\n## Local, SLX cont.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# NEW\nsummary(SLX)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.14787 -0.16031  0.03406  0.21892  1.74104 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)          1.38667    0.39699   3.493 0.000485 ***\nI.age_sold.          0.38157    0.22873   1.668 0.095382 .  \nI.age_sold.2.       -0.85171    0.40573  -2.099 0.035883 *  \nI.age_sold.3.       -0.09377    0.21181  -0.443 0.658017    \nI.log.TLA..          0.73652    0.03866  19.052  < 2e-16 ***\nI.log.lotsize..      0.12926    0.01603   8.065 1.05e-15 ***\nrooms                0.01628    0.01124   1.449 0.147501    \nbeds                -0.02206    0.01622  -1.360 0.173951    \nsyear1994            0.05145    0.02611   1.970 0.048899 *  \nsyear1995            0.07881    0.02553   3.086 0.002045 ** \nsyear1996            0.11734    0.02513   4.670 3.15e-06 ***\nsyear1997            0.14640    0.02488   5.885 4.41e-09 ***\nsyear1998            0.23996    0.02566   9.351  < 2e-16 ***\nlag.I.age_sold.      1.15103    0.30450   3.780 0.000160 ***\nlag.I.age_sold.2.   -1.64942    0.57575  -2.865 0.004202 ** \nlag.I.age_sold.3.   -0.19096    0.32339  -0.591 0.554896    \nlag.I.log.TLA..      0.53352    0.07137   7.475 1.01e-13 ***\nlag.I.log.lotsize.. -0.03657    0.02014  -1.815 0.069590 .  \nlag.rooms           -0.02126    0.02312  -0.920 0.357889    \nlag.beds            -0.07522    0.03587  -2.097 0.036045 *  \nlag.syear1994        0.00707    0.05885   0.120 0.904383    \nlag.syear1995       -0.11414    0.05515  -2.070 0.038566 *  \nlag.syear1996        0.04710    0.05467   0.862 0.389028    \nlag.syear1997       -0.04288    0.05345  -0.802 0.422461    \nlag.syear1998        0.01115    0.05630   0.198 0.843002    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.3806 on 2975 degrees of freedom\nMultiple R-squared:  0.7432,\tAdjusted R-squared:  0.7411 \nF-statistic: 358.7 on 24 and 2975 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## Local, SLX cont.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(impacts(SLX))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nImpact measures (SlX, estimable, n-k):\n                     Direct    Indirect        Total\nI(age_sold)      0.38156590  1.15103005  1.532595952\nI(age_sold^2)   -0.85170575 -1.64942197 -2.501127726\nI(age_sold^3)   -0.09376923 -0.19096402 -0.284733249\nI(log(TLA))      0.73652194  0.53352169  1.270043628\nI(log(lotsize))  0.12925829 -0.03656680  0.092691491\nrooms            0.01628444 -0.02125872 -0.004974276\nbeds            -0.02206352 -0.07522198 -0.097285494\nsyear1994        0.05145317  0.00707043  0.058523597\nsyear1995        0.07880749 -0.11414540 -0.035337908\nsyear1996        0.11733890  0.04710113  0.164440031\nsyear1997        0.14640447 -0.04288481  0.103519660\nsyear1998        0.23996283  0.01115155  0.251114383\n========================================================\nStandard errors:\n                    Direct   Indirect      Total\nI(age_sold)     0.22872967 0.30449602 0.24918360\nI(age_sold^2)   0.40572698 0.57575170 0.50525662\nI(age_sold^3)   0.21181383 0.32339030 0.30064908\nI(log(TLA))     0.03865767 0.07137542 0.07111016\nI(log(lotsize)) 0.01602681 0.02014448 0.01484568\nrooms           0.01124002 0.02311892 0.02442589\nbeds            0.01622385 0.03586492 0.03868248\nsyear1994       0.02611467 0.05885307 0.06406798\nsyear1995       0.02553422 0.05515050 0.06017843\nsyear1996       0.02512742 0.05467291 0.05970609\nsyear1997       0.02487559 0.05345438 0.05731268\nsyear1998       0.02566200 0.05630042 0.06152147\n========================================================\nZ-values:\n                    Direct   Indirect      Total\nI(age_sold)      1.6681959  3.7801153  6.1504688\nI(age_sold^2)   -2.0992091 -2.8648148 -4.9502127\nI(age_sold^3)   -0.4426965 -0.5905063 -0.9470618\nI(log(TLA))     19.0524144  7.4748656 17.8602283\nI(log(lotsize))  8.0651294 -1.8152268  6.2436693\nrooms            1.4487917 -0.9195379 -0.2036477\nbeds            -1.3599432 -2.0973689 -2.5149753\nsyear1994        1.9702784  0.1201370  0.9134610\nsyear1995        3.0863483 -2.0697075 -0.5872189\nsyear1996        4.6697557  0.8615077  2.7541587\nsyear1997        5.8854663 -0.8022693  1.8062261\nsyear1998        9.3509031  0.1980722  4.0817360\n\np-values:\n                Direct     Indirect   Total           \nI(age_sold)     0.0952768  0.00015676 0.00000000077254\nI(age_sold^2)   0.0357985  0.00417253 0.00000074132419\nI(age_sold^3)   0.6579853  0.55485125 0.3436073       \nI(log(TLA))     < 2.22e-16 7.7272e-14 < 2.22e-16      \nI(log(lotsize)) 6.6613e-16 0.06948906 0.00000000042742\nrooms           0.1473958  0.35781429 0.8386288       \nbeds            0.1738479  0.03596093 0.0119041       \nsyear1994       0.0488065  0.90437463 0.3610001       \nsyear1995       0.0020263  0.03847974 0.5570567       \nsyear1996       3.0156e-06 0.38895846 0.0058843       \nsyear1997       3.9693e-09 0.42239720 0.0708830       \nsyear1998       < 2.22e-16 0.84298854 0.00004470055406\n```\n:::\n:::\n\n\n## Choosing a local model\n\n-   Since the models are nested we can test the models against each other with a likelihood ratio test\n\n## SEM versus SDEM\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLR.Sarlm(SEM, SDEM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tLikelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = -266.63, df = 12, p-value < 2.2e-16\nsample estimates:\n Log likelihood of SEM Log likelihood of SDEM \n            -1095.6575              -962.3424 \n```\n:::\n:::\n\n\nDiscard H0, do not restrict to SEM.\nWe keep $\\theta > 0$.\n\n## SDEM versus SLX\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLR.Sarlm(SDEM, SLX)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tLikelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 767.28, df = 1, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDEM  Log likelihood of SLX \n             -962.3424             -1345.9840 \n```\n:::\n:::\n\n\nWe discard H0 and will not restrict to SLX, continue with SDEM.\n\n## SDEM versus lm1\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLR.Sarlm(SDEM, lm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tLikelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 1334.7, df = 13, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDEM  Log likelihood of lm1 \n             -962.3424             -1629.6987 \n```\n:::\n:::\n\n\nDiscard H0, we will not restrict to OLS.\n\n## Conclusion\n\n-   We end up with SDEM as the best local model.\n\n    -   No endogeniety in the price variable.\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# residuals are with attributes, hence as.vector()\nmoran.plot(SDEM$residuals, listw = red_house_sf_w)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-29-1.png){width=960}\n:::\n:::\n\n\n## Results\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Do not use \"SDEM\" = SDEM, report coeffisent estimates not impacts\nhuxreg(\"OLS\" = lm1, \"SEM\" = SEM, \n       error_format = \"({statistic})\",\n       note = \"{stars}. T-values reported.\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<table class=\"huxtable\" style=\"border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  \" id=\"tab:unnamed-chunk-30\">\n<col><col><col><tr>\n<th style=\"vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><th style=\"vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">OLS</th><th style=\"vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">SEM</th></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(Intercept)</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">3.183 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">4.572 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(12.979)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(20.605)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">I(age_sold)</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">1.365 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.432 *&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(7.222)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(2.241)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">I(age_sold^2)</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">-3.074 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">-1.251 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(-8.640)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(-3.646)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">I(age_sold^3)</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.697 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.253&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(3.504)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(1.407)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">I(log(TLA))</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.873 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.688 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(22.203)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(20.970)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">I(log(lotsize))</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.172 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.155 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(14.736)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(11.928)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">rooms</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.021&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.020 *&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(1.723)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(2.159)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">beds</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">-0.033&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">-0.015&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(-1.877)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(-1.152)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">syear1994</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.069 *&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.059 **&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(2.406)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(2.755)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">syear1995</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.098 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.102 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(3.513)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(4.864)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">syear1996</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.142 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.116 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(5.176)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(5.607)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">syear1997</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.164 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.158 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(6.043)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(7.652)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">syear1998</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.264 ***</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.242 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(9.439)&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(11.502)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">lambda</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.718 ***</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"></th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">(56.889)&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">N</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">3000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">3000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">R2</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.690&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">0.815&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">logLik</th><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">-1629.699&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">-1095.658&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">AIC</th><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">3287.397&nbsp;&nbsp;&nbsp;&nbsp;</td><td style=\"vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\">2221.315&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>\n<tr>\n<th colspan=\"3\" style=\"vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;\"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05. T-values reported.</th></tr>\n</table>\n\n```\n:::\n:::\n\n\n### Compare impacts from SDEM and SLX model\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# tidy(SDEM) or tidy(SLX) reports regression coefficients\n# make our own table for easy comparison of impacts\ni_SDEM <- impacts(SDEM)$impacts %>% \n  as_tibble() %>% \n  mutate(\n    variable = names(impacts(SDEM)$impacts$direct)\n  ) %>% \n  select(variable, everything())\n\ni_SLX <- impacts(SLX)$impacts %>% \n  as_tibble()\n\nnames(i_SDEM)[2:4] <- paste(\"SDEM\", names(i_SDEM)[2:4], sep = \"_\")\nnames(i_SLX) <- paste(\"SLX\", names(i_SLX), sep = \"_\")\ni_SDEM_SLX <- cbind(i_SDEM, i_SLX)\ni_SDEM_SLX <- cbind(variable = i_SDEM_SLX[, \"variable\"], \n                    round(i_SDEM_SLX[, -1], 6))\n```\n:::\n\n\n### Compare impacts from SDEM and SLX model cont.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(i_SDEM_SLX[, c(1:2,5,3,6,4,7)])\n```\n\n::: {.cell-output-display}\n|variable        | SDEM_direct| SLX_direct| SDEM_indirect| SLX_indirect| SDEM_total| SLX_total|\n|:---------------|-----------:|----------:|-------------:|------------:|----------:|---------:|\n|I(age_sold)     |    0.543545|   0.381566|      1.724314|     1.151030|   2.267859|  1.532596|\n|I(age_sold^2)   |   -1.211511|  -0.851706|     -3.154620|    -1.649422|  -4.366131| -2.501128|\n|I(age_sold^3)   |    0.119899|  -0.093769|      0.858429|    -0.190964|   0.978329| -0.284733|\n|I(log(TLA))     |    0.721610|   0.736522|      0.325829|     0.533522|   1.047440|  1.270044|\n|I(log(lotsize)) |    0.120001|   0.129258|      0.002126|    -0.036567|   0.122127|  0.092691|\n|rooms           |    0.022980|   0.016284|      0.022090|    -0.021259|   0.045069| -0.004974|\n|beds            |   -0.023773|  -0.022064|     -0.044375|    -0.075222|  -0.068148| -0.097285|\n|syear1994       |    0.058224|   0.051453|      0.014445|     0.007070|   0.072668|  0.058524|\n|syear1995       |    0.083153|   0.078807|     -0.081602|    -0.114145|   0.001551| -0.035338|\n|syear1996       |    0.113499|   0.117339|     -0.004495|     0.047101|   0.109004|  0.164440|\n|syear1997       |    0.150084|   0.146404|     -0.051995|    -0.042885|   0.098089|  0.103520|\n|syear1998       |    0.251561|   0.239963|      0.082366|     0.011152|   0.333927|  0.251114|\n:::\n:::\n\n\n## Global\n\n-   Now spatial lag in **y** and **X**.\n\n## Global; SDM\n\n\n::: {.cell hash='index_cache/revealjs/SDM_32e5879eefae32a23a143e14486b3001'}\n\n```{.r .cell-code}\n#\n# expensive to compute\nSDM <- lagsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = TRUE)\n```\n:::\n\n\n## Global; SDM impacts\n\n\n::: {.cell hash='index_cache/revealjs/SDMimpacts_e4f3c20d41448f37dd39b258eaa4530b'}\n\n```{.r .cell-code}\n#\n# Computing the impacts is expensive too\nimpacts(SDM, listw = red_house_sf_w)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nImpact measures (mixed, exact):\n                     Direct     Indirect        Total\nI(age_sold)      0.44458343  1.998987232  2.443570658\nI(age_sold^2)   -1.00533917 -3.230813468 -4.236152639\nI(age_sold^3)    0.03747523  0.571379837  0.608855065\nI(log(TLA))      0.73179133  0.538408810  1.270200141\nI(log(lotsize))  0.11643717 -0.031417681  0.085019488\nrooms            0.01892389 -0.009570688  0.009353204\nbeds            -0.02425261 -0.074563783 -0.098816393\nsyear1994        0.05338215  0.010866667  0.064248814\nsyear1995        0.08036644 -0.127280373 -0.046913936\nsyear1996        0.11360203  0.019036422  0.132638448\nsyear1997        0.14408151 -0.083271804  0.060809708\nsyear1998        0.24456200  0.065133136  0.309695135\n```\n:::\n:::\n\n\n## Global; SDM impacts cont.\n\n\n::: {.cell hash='index_cache/revealjs/SDMimpactsZ_e2cb9d4d3e1f0cd755b47b7804e9d2df'}\n\n```{.r .cell-code}\n#\n# Simulated, varies somewhat with each sample (note that seed is set above). Results might \n# differ with another seed\nsummary(impacts(SDM, listw = red_house_sf_w, R = 500), zstats = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nImpact measures (mixed, exact):\n                     Direct     Indirect        Total\nI(age_sold)      0.44458343  1.998987232  2.443570658\nI(age_sold^2)   -1.00533917 -3.230813468 -4.236152639\nI(age_sold^3)    0.03747523  0.571379837  0.608855065\nI(log(TLA))      0.73179133  0.538408810  1.270200141\nI(log(lotsize))  0.11643717 -0.031417681  0.085019488\nrooms            0.01892389 -0.009570688  0.009353204\nbeds            -0.02425261 -0.074563783 -0.098816393\nsyear1994        0.05338215  0.010866667  0.064248814\nsyear1995        0.08036644 -0.127280373 -0.046913936\nsyear1996        0.11360203  0.019036422  0.132638448\nsyear1997        0.14408151 -0.083271804  0.060809708\nsyear1998        0.24456200  0.065133136  0.309695135\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      0.43570 0.19042 0.0085158      0.0085158\nI(age_sold^2)   -0.99295 0.34738 0.0155351      0.0155351\nI(age_sold^3)    0.03269 0.18442 0.0082475      0.0082475\nI(log(TLA))      0.73000 0.03447 0.0015415      0.0015415\nI(log(lotsize))  0.11661 0.01307 0.0005846      0.0005846\nrooms            0.01909 0.01092 0.0004882      0.0004882\nbeds            -0.02397 0.01598 0.0007145      0.0007145\nsyear1994        0.05506 0.02482 0.0011101      0.0012457\nsyear1995        0.08085 0.02429 0.0010863      0.0011869\nsyear1996        0.11416 0.02495 0.0011160      0.0011160\nsyear1997        0.14598 0.02399 0.0010726      0.0010726\nsyear1998        0.24526 0.02551 0.0011409      0.0010602\n\n2. Quantiles for each variable:\n\n                     2.5%      25%      50%      75%     97.5%\nI(age_sold)      0.095565  0.30503  0.44227  0.54876  0.809285\nI(age_sold^2)   -1.724104 -1.20116 -0.96789 -0.76943 -0.334029\nI(age_sold^3)   -0.315551 -0.09222  0.02300  0.15148  0.416582\nI(log(TLA))      0.665457  0.70655  0.72949  0.75204  0.799164\nI(log(lotsize))  0.090251  0.10840  0.11656  0.12512  0.142325\nrooms           -0.001500  0.01174  0.01959  0.02626  0.038572\nbeds            -0.055530 -0.03359 -0.02394 -0.01279  0.007231\nsyear1994        0.005699  0.03975  0.05516  0.07112  0.101494\nsyear1995        0.036205  0.06447  0.07939  0.09711  0.129766\nsyear1996        0.067438  0.09793  0.11354  0.13034  0.165083\nsyear1997        0.099891  0.12911  0.14580  0.16159  0.194748\nsyear1998        0.197348  0.22780  0.24600  0.26312  0.292044\n\n========================================================\nIndirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD Naive SE Time-series SE\nI(age_sold)      2.025320 0.46676 0.020874       0.019017\nI(age_sold^2)   -3.266763 0.92210 0.041238       0.037790\nI(age_sold^3)    0.584661 0.54236 0.024255       0.022181\nI(log(TLA))      0.535366 0.12898 0.005768       0.005357\nI(log(lotsize)) -0.030654 0.02804 0.001254       0.001254\nrooms           -0.009554 0.04452 0.001991       0.001991\nbeds            -0.073332 0.06929 0.003099       0.003349\nsyear1994        0.021722 0.11005 0.004922       0.004992\nsyear1995       -0.126917 0.10376 0.004640       0.004640\nsyear1996        0.019737 0.10825 0.004841       0.004841\nsyear1997       -0.076148 0.10519 0.004704       0.004704\nsyear1998        0.072323 0.10853 0.004854       0.004854\n\n2. Quantiles for each variable:\n\n                    2.5%      25%       50%       75%    97.5%\nI(age_sold)      1.15398  1.70131  2.008675  2.331730  3.00100\nI(age_sold^2)   -5.03359 -3.91820 -3.271442 -2.690050 -1.43346\nI(age_sold^3)   -0.50260  0.22930  0.598291  0.958270  1.61196\nI(log(TLA))      0.30486  0.44808  0.530356  0.622814  0.79635\nI(log(lotsize)) -0.08743 -0.04791 -0.032662 -0.012741  0.02549\nrooms           -0.09241 -0.03704 -0.008471  0.018965  0.07568\nbeds            -0.20182 -0.12365 -0.069357 -0.025177  0.05546\nsyear1994       -0.18232 -0.05392  0.016279  0.093570  0.23186\nsyear1995       -0.32440 -0.19655 -0.125605 -0.060039  0.08411\nsyear1996       -0.18293 -0.05864  0.020883  0.096351  0.22812\nsyear1997       -0.27454 -0.14934 -0.071229 -0.004911  0.12856\nsyear1998       -0.13039 -0.00286  0.070220  0.149466  0.27953\n\n========================================================\nTotal:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD Naive SE Time-series SE\nI(age_sold)      2.461016 0.50719 0.022682       0.019115\nI(age_sold^2)   -4.259714 1.01230 0.045271       0.041124\nI(age_sold^3)    0.617346 0.59918 0.026796       0.024313\nI(log(TLA))      1.265368 0.14348 0.006417       0.006417\nI(log(lotsize))  0.085955 0.02923 0.001307       0.001307\nrooms            0.009539 0.05049 0.002258       0.002258\nbeds            -0.097298 0.07854 0.003512       0.003798\nsyear1994        0.076780 0.12487 0.005584       0.005802\nsyear1995       -0.046069 0.11801 0.005278       0.005278\nsyear1996        0.133893 0.12292 0.005497       0.005497\nsyear1997        0.069828 0.11893 0.005319       0.004983\nsyear1998        0.317586 0.12483 0.005583       0.005583\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%      75%    97.5%\nI(age_sold)      1.45427  2.111280  2.49526  2.76011  3.48662\nI(age_sold^2)   -6.32389 -4.889165 -4.28008 -3.56764 -2.32134\nI(age_sold^3)   -0.57794  0.205209  0.62019  1.03076  1.84534\nI(log(TLA))      1.00436  1.167136  1.25655  1.36218  1.56029\nI(log(lotsize))  0.03000  0.066597  0.08467  0.10659  0.14223\nrooms           -0.08354 -0.024711  0.01104  0.04254  0.10627\nbeds            -0.24361 -0.154012 -0.09187 -0.04515  0.05514\nsyear1994       -0.14955 -0.009261  0.06750  0.16067  0.32880\nsyear1995       -0.26477 -0.122388 -0.04623  0.02764  0.18902\nsyear1996       -0.09288  0.047321  0.14036  0.21944  0.38363\nsyear1997       -0.15751 -0.017669  0.07465  0.14384  0.30954\nsyear1998        0.07058  0.235313  0.31418  0.40323  0.55379\n\n========================================================\nSimulated standard errors\n                    Direct   Indirect      Total\nI(age_sold)     0.19041885 0.46676400 0.50719217\nI(age_sold^2)   0.34737516 0.92209917 1.01229557\nI(age_sold^3)   0.18442029 0.54235807 0.59917636\nI(log(TLA))     0.03446933 0.12897668 0.14347930\nI(log(lotsize)) 0.01307219 0.02803738 0.02922747\nrooms           0.01091571 0.04451850 0.05049288\nbeds            0.01597671 0.06929074 0.07854027\nsyear1994       0.02482295 0.11005341 0.12486755\nsyear1995       0.02429102 0.10376346 0.11801248\nsyear1996       0.02495361 0.10825326 0.12291700\nsyear1997       0.02398517 0.10519073 0.11893279\nsyear1998       0.02551176 0.10853417 0.12483401\n\nSimulated z-values:\n                    Direct   Indirect      Total\nI(age_sold)      2.2880916  4.3390667  4.8522356\nI(age_sold^2)   -2.8584393 -3.5427457 -4.2079742\nI(age_sold^3)    0.1772314  1.0779973  1.0303237\nI(log(TLA))     21.1783112  4.1508715  8.8191672\nI(log(lotsize))  8.9203562 -1.0933185  2.9408911\nrooms            1.7491371 -0.2146006  0.1889252\nbeds            -1.5000821 -1.0583224 -1.2388335\nsyear1994        2.2180426  0.1973775  0.6148950\nsyear1995        3.3283225 -1.2231399 -0.3903728\nsyear1996        4.5747137  0.1823254  1.0892957\nsyear1997        6.0860982 -0.7239017  0.5871244\nsyear1998        9.6137168  0.6663654  2.5440680\n\nSimulated p-values:\n                Direct         Indirect    Total       \nI(age_sold)     0.02213218     0.000014309 0.0000012208\nI(age_sold^2)   0.00425731     0.00039598  0.0000257670\nI(age_sold^3)   0.85932663     0.28103497  0.3028581   \nI(log(TLA))     < 2.22e-16     0.000033121 < 2.22e-16  \nI(log(lotsize)) < 2.22e-16     0.27425396  0.0032727   \nrooms           0.08026732     0.83007876  0.8501515   \nbeds            0.13359315     0.28990849  0.2154072   \nsyear1994       0.02655193     0.84353210  0.5386240   \nsyear1995       0.00087371     0.22127688  0.6962609   \nsyear1996       0.000004768716 0.85532733  0.2760235   \nsyear1997       0.000000001157 0.46912608  0.5571201   \nsyear1998       < 2.22e-16     0.50517759  0.0109570   \n```\n:::\n:::\n\n\n## Global SAR\n\n\n::: {.cell hash='index_cache/revealjs/SAR_502792c916ce872dfd9ef9c4bf6e67a2'}\n\n```{.r .cell-code}\n#\nSAR <- lagsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = FALSE)\n```\n:::\n\n\n## Global SAR cont.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# NEW\nsummary(SAR)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:lagsarlm(formula = hmod1, data = red_house_sf, listw = red_house_sf_w, \n    Durbin = FALSE)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-2.107445 -0.138104  0.035175  0.189967  1.226065 \n\nType: lag \nCoefficients: (asymptotic standard errors) \n                  Estimate Std. Error z value  Pr(>|z|)\n(Intercept)     -0.2514883  0.2074699 -1.2122 0.2254484\nI(age_sold)      1.1792030  0.1497421  7.8749 3.331e-15\nI(age_sold^2)   -2.1020853  0.2832284 -7.4219 1.155e-13\nI(age_sold^3)    0.4826410  0.1578425  3.0577 0.0022301\nI(log(TLA))      0.6415673  0.0317194 20.2263 < 2.2e-16\nI(log(lotsize))  0.0632934  0.0097473  6.4935 8.389e-11\nrooms            0.0098137  0.0096416  1.0178 0.3087538\nbeds            -0.0103466  0.0140334 -0.7373 0.4609509\nsyear1994        0.0530507  0.0226122  2.3461 0.0189707\nsyear1995        0.0831306  0.0220890  3.7634 0.0001676\nsyear1996        0.1124883  0.0217470  5.1726 2.309e-07\nsyear1997        0.1434820  0.0214686  6.6834 2.335e-11\nsyear1998        0.2302061  0.0222179 10.3613 < 2.2e-16\n\nRho: 0.53679, LR test value: 1211, p-value: < 2.22e-16\nAsymptotic standard error: 0.013019\n    z-value: 41.23, p-value: < 2.22e-16\nWald statistic: 1699.9, p-value: < 2.22e-16\n\nLog likelihood: -1024.179 for lag model\nML residual variance (sigma squared): 0.10922, (sigma: 0.33048)\nNumber of observations: 3000 \nNumber of parameters estimated: 15 \nAIC: 2078.4, (AIC for lm: 3287.4)\nLM test for residual autocorrelation\ntest value: 16.821, p-value: 0.000041075\n```\n:::\n:::\n\n\n## Global SAR impacts\n\n\n::: {.cell hash='index_cache/revealjs/SARimpactsZ_b33fba4823699378994a810d6e22911d'}\n\n```{.r .cell-code}\n#\nsummary(impacts(SAR, listw = red_house_sf_w, R = 500), zstats = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nImpact measures (lag, exact):\n                     Direct    Indirect       Total\nI(age_sold)      1.26420440  1.28149989  2.54570429\nI(age_sold^2)   -2.25361156 -2.28444307 -4.53805462\nI(age_sold^3)    0.51743158  0.52451052  1.04194210\nI(log(TLA))      0.68781390  0.69722384  1.38503774\nI(log(lotsize))  0.06785580  0.06878413  0.13663994\nrooms            0.01052106  0.01066500  0.02118606\nbeds            -0.01109238 -0.01124413 -0.02233651\nsyear1994        0.05687482  0.05765292  0.11452773\nsyear1995        0.08912299  0.09034227  0.17946526\nsyear1996        0.12059686  0.12224674  0.24284360\nsyear1997        0.15382468  0.15592915  0.30975383\nsyear1998        0.24680025  0.25017671  0.49697696\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      1.26025 0.15977 0.0071450      0.0071450\nI(age_sold^2)   -2.24439 0.30058 0.0134423      0.0134423\nI(age_sold^3)    0.51261 0.16883 0.0075505      0.0075505\nI(log(TLA))      0.68739 0.03446 0.0015409      0.0015409\nI(log(lotsize))  0.06759 0.01040 0.0004651      0.0004651\nrooms            0.01021 0.01044 0.0004669      0.0004669\nbeds            -0.01100 0.01487 0.0006649      0.0006952\nsyear1994        0.05764 0.02449 0.0010951      0.0010951\nsyear1995        0.08795 0.02304 0.0010303      0.0009506\nsyear1996        0.12164 0.02300 0.0010284      0.0010284\nsyear1997        0.15275 0.02228 0.0009964      0.0009964\nsyear1998        0.24797 0.02337 0.0010451      0.0010451\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%       75%    97.5%\nI(age_sold)      0.95193  1.146580  1.26169  1.369476  1.56285\nI(age_sold^2)   -2.86083 -2.449798 -2.24210 -2.019410 -1.69138\nI(age_sold^3)    0.20056  0.386196  0.51102  0.626061  0.85781\nI(log(TLA))      0.61733  0.664741  0.68938  0.710671  0.75385\nI(log(lotsize))  0.04816  0.060242  0.06767  0.074200  0.08775\nrooms           -0.01036  0.003069  0.01005  0.016863  0.03122\nbeds            -0.03873 -0.021511 -0.01093 -0.001402  0.01758\nsyear1994        0.01349  0.040084  0.05661  0.073386  0.10991\nsyear1995        0.04036  0.072303  0.08829  0.103800  0.13469\nsyear1996        0.07525  0.105768  0.12192  0.136018  0.16755\nsyear1997        0.11034  0.137457  0.15303  0.169033  0.19775\nsyear1998        0.20171  0.231964  0.24718  0.263191  0.29284\n\n========================================================\nIndirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      1.28535 0.17304 0.0077384      0.0077384\nI(age_sold^2)   -2.28791 0.31545 0.0141071      0.0141071\nI(age_sold^3)    0.52215 0.17191 0.0076880      0.0076880\nI(log(TLA))      0.70101 0.04624 0.0020680      0.0020680\nI(log(lotsize))  0.06881 0.01027 0.0004592      0.0004592\nrooms            0.01040 0.01063 0.0004753      0.0004753\nbeds            -0.01122 0.01520 0.0006798      0.0007161\nsyear1994        0.05876 0.02501 0.0011183      0.0011183\nsyear1995        0.08967 0.02371 0.0010604      0.0009817\nsyear1996        0.12411 0.02436 0.0010896      0.0010896\nsyear1997        0.15576 0.02364 0.0010573      0.0010573\nsyear1998        0.25289 0.02626 0.0011743      0.0010732\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%       75%    97.5%\nI(age_sold)      0.98056  1.159990  1.28737  1.401580  1.60832\nI(age_sold^2)   -2.89437 -2.515919 -2.28766 -2.038621 -1.73314\nI(age_sold^3)    0.20727  0.396610  0.52308  0.640856  0.85633\nI(log(TLA))      0.61581  0.668739  0.69880  0.731618  0.78762\nI(log(lotsize))  0.04977  0.061999  0.06859  0.075324  0.08888\nrooms           -0.01058  0.003169  0.01018  0.017436  0.03188\nbeds            -0.03854 -0.021630 -0.01124 -0.001413  0.01811\nsyear1994        0.01366  0.041261  0.05775  0.075834  0.11084\nsyear1995        0.04134  0.074005  0.09025  0.104628  0.13693\nsyear1996        0.07679  0.109271  0.12332  0.139899  0.17421\nsyear1997        0.10973  0.138764  0.15444  0.172310  0.20128\nsyear1998        0.20578  0.234911  0.25280  0.269421  0.30551\n\n========================================================\nTotal:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      2.54560 0.32720 0.0146329      0.0146329\nI(age_sold^2)   -4.53229 0.60627 0.0271132      0.0271132\nI(age_sold^3)    1.03476 0.33978 0.0151952      0.0151952\nI(log(TLA))      1.38840 0.07422 0.0033194      0.0033194\nI(log(lotsize))  0.13640 0.02041 0.0009125      0.0009125\nrooms            0.02060 0.02106 0.0009416      0.0009416\nbeds            -0.02221 0.03005 0.0013441      0.0014106\nsyear1994        0.11641 0.04940 0.0022092      0.0022092\nsyear1995        0.17762 0.04654 0.0020815      0.0019233\nsyear1996        0.24575 0.04698 0.0021008      0.0021008\nsyear1997        0.30851 0.04530 0.0020259      0.0020259\nsyear1998        0.50085 0.04819 0.0021550      0.0020016\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%       75%    97.5%\nI(age_sold)      1.93314  2.302860  2.54386  2.773892  3.18479\nI(age_sold^2)   -5.73807 -4.955812 -4.53804 -4.069087 -3.46982\nI(age_sold^3)    0.40600  0.779277  1.03778  1.266064  1.70556\nI(log(TLA))      1.24824  1.340392  1.38644  1.441256  1.53225\nI(log(lotsize))  0.09875  0.122579  0.13666  0.149246  0.17677\nrooms           -0.02104  0.006228  0.02030  0.034402  0.06266\nbeds            -0.07717 -0.042681 -0.02233 -0.002814  0.03584\nsyear1994        0.02714  0.081830  0.11438  0.149401  0.21800\nsyear1995        0.08231  0.146453  0.17925  0.208317  0.26745\nsyear1996        0.15390  0.216484  0.24499  0.275720  0.34104\nsyear1997        0.21935  0.276633  0.30762  0.341804  0.39632\nsyear1998        0.41329  0.465082  0.50072  0.531943  0.59766\n\n========================================================\nSimulated standard errors\n                    Direct   Indirect      Total\nI(age_sold)     0.15976723 0.17303609 0.32720114\nI(age_sold^2)   0.30057961 0.31544513 0.60626867\nI(age_sold^3)   0.16883390 0.17190919 0.33977541\nI(log(TLA))     0.03445540 0.04624199 0.07422347\nI(log(lotsize)) 0.01039887 0.01026724 0.02040508\nrooms           0.01044088 0.01062763 0.02105534\nbeds            0.01486771 0.01520147 0.03005495\nsyear1994       0.02448819 0.02500572 0.04939863\nsyear1995       0.02303752 0.02371105 0.04654484\nsyear1996       0.02299602 0.02436439 0.04697513\nsyear1997       0.02228025 0.02364143 0.04530111\nsyear1998       0.02336821 0.02625869 0.04818774\n\nSimulated z-values:\n                    Direct   Indirect      Total\nI(age_sold)      7.8880583  7.4281924  7.7799196\nI(age_sold^2)   -7.4668589 -7.2529490 -7.4757169\nI(age_sold^3)    3.0361977  3.0373582  3.0454320\nI(log(TLA))     19.9501148 15.1596347 18.7056837\nI(log(lotsize))  6.4997999  6.7022049  6.6847881\nrooms            0.9774854  0.9782034  0.9784588\nbeds            -0.7396518 -0.7379508 -0.7391418\nsyear1994        2.3539528  2.3500092  2.3564971\nsyear1995        3.8178655  3.7815947  3.8160992\nsyear1996        5.2896726  5.0940188  5.2315784\nsyear1997        6.8558430  6.5884934  6.8102374\nsyear1998       10.6112557  9.6306610 10.3938194\n\nSimulated p-values:\n                Direct     Indirect   Total     \nI(age_sold)     3.1086e-15 1.1013e-13 7.3275e-15\nI(age_sold^2)   8.2157e-14 4.0790e-13 7.6827e-14\nI(age_sold^3)   0.00239582 0.00238662 0.00232346\nI(log(TLA))     < 2.22e-16 < 2.22e-16 < 2.22e-16\nI(log(lotsize)) 8.0427e-11 2.0530e-11 2.3126e-11\nrooms           0.32832888 0.32797373 0.32784747\nbeds            0.45951133 0.46054434 0.45982088\nsyear1994       0.01857497 0.01877295 0.01844821\nsyear1995       0.00013461 0.00015583 0.00013558\nsyear1996       1.2254e-07 3.5055e-07 1.6807e-07\nsyear1997       7.0892e-12 4.4431e-11 9.7438e-12\nsyear1998       < 2.22e-16 < 2.22e-16 < 2.22e-16\n```\n:::\n:::\n\n\n## Choosing a global model\n\n-   Some of the models are estimated above so no reason to repeat a costly calculation.\n\n## SDM versus SAR\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLR.Sarlm(SDM, SAR)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tLikelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 160.38, df = 12, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of SAR \n            -943.9908            -1024.1791 \n```\n:::\n:::\n\n\nWe reject H0 and do not restrict to SAR.\nKeep SDM.\n\n## SDM versus SLX\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# SLX estimated above\nLR.Sarlm(SDM, SLX)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tLikelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 803.99, df = 1, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of SLX \n            -943.9908            -1345.9840 \n```\n:::\n:::\n\n\nWe reject H0 and do not restrict to SLX.\nKeep SDM.\n\n## SDM versus SEM\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Common factor?\nLR.Sarlm(SDM, SEM)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tLikelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 303.33, df = 12, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of SEM \n            -943.9908            -1095.6575 \n```\n:::\n:::\n\n\nWe reject H0 and do not restrict to SEM.\nKeep SDM.\n\n## SDM versus lm1\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLR.Sarlm(SDM, lm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tLikelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 1371.4, df = 13, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of lm1 \n            -943.9908            -1629.6987 \n```\n:::\n:::\n\n\nWe reject H0 and do not restrict to OLS.\nSDM seems to be the best global model.\nWe have spatial effects both in price and the explanatory variables.\nThere is a strong negative indirect effect regarding number of rooms that might be regarded as counter intuitive and should perhaps be looked further into.\n\n## Impacts SDM\n\n\n::: {.cell hash='index_cache/revealjs/unnamed-chunk-38_f875ef0b66e3f1558048f663bf736f9b'}\n\n```{.r .cell-code}\nsummary(impacts(SDM, listw = red_house_sf_w, R = 1000), zstats = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nImpact measures (mixed, exact):\n                     Direct     Indirect        Total\nI(age_sold)      0.44458343  1.998987232  2.443570658\nI(age_sold^2)   -1.00533917 -3.230813468 -4.236152639\nI(age_sold^3)    0.03747523  0.571379837  0.608855065\nI(log(TLA))      0.73179133  0.538408810  1.270200141\nI(log(lotsize))  0.11643717 -0.031417681  0.085019488\nrooms            0.01892389 -0.009570688  0.009353204\nbeds            -0.02425261 -0.074563783 -0.098816393\nsyear1994        0.05338215  0.010866667  0.064248814\nsyear1995        0.08036644 -0.127280373 -0.046913936\nsyear1996        0.11360203  0.019036422  0.132638448\nsyear1997        0.14408151 -0.083271804  0.060809708\nsyear1998        0.24456200  0.065133136  0.309695135\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      0.44163 0.19377 0.0061276      0.0061276\nI(age_sold^2)   -0.99382 0.35057 0.0110860      0.0102378\nI(age_sold^3)    0.02969 0.18626 0.0058901      0.0051524\nI(log(TLA))      0.73078 0.03257 0.0010299      0.0010863\nI(log(lotsize))  0.11679 0.01215 0.0003843      0.0003843\nrooms            0.01923 0.01035 0.0003274      0.0003274\nbeds            -0.02409 0.01587 0.0005018      0.0004713\nsyear1994        0.05342 0.02498 0.0007900      0.0007900\nsyear1995        0.08006 0.02421 0.0007657      0.0007657\nsyear1996        0.11402 0.02340 0.0007401      0.0007401\nsyear1997        0.14407 0.02386 0.0007545      0.0007545\nsyear1998        0.24365 0.02383 0.0007537      0.0007181\n\n2. Quantiles for each variable:\n\n                     2.5%      25%      50%      75%     97.5%\nI(age_sold)      0.074639  0.31072  0.44131  0.57788  0.823934\nI(age_sold^2)   -1.654443 -1.23954 -0.98375 -0.74901 -0.312213\nI(age_sold^3)   -0.331864 -0.09906  0.02408  0.16328  0.384121\nI(log(TLA))      0.662652  0.70997  0.73028  0.75257  0.794955\nI(log(lotsize))  0.093972  0.10851  0.11640  0.12506  0.141285\nrooms           -0.000960  0.01248  0.01921  0.02617  0.039231\nbeds            -0.056780 -0.03526 -0.02444 -0.01286  0.007228\nsyear1994        0.005384  0.03728  0.05332  0.06965  0.103500\nsyear1995        0.032870  0.06292  0.07937  0.09665  0.126562\nsyear1996        0.071023  0.09945  0.11395  0.12923  0.159480\nsyear1997        0.096356  0.12847  0.14491  0.16070  0.188601\nsyear1998        0.197509  0.22849  0.24247  0.25867  0.291718\n\n========================================================\nIndirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD  Naive SE Time-series SE\nI(age_sold)      1.994437 0.48431 0.0153152      0.0144140\nI(age_sold^2)   -3.229999 0.95731 0.0302729      0.0283359\nI(age_sold^3)    0.575901 0.55609 0.0175853      0.0151665\nI(log(TLA))      0.539949 0.12916 0.0040846      0.0040846\nI(log(lotsize)) -0.031352 0.02798 0.0008847      0.0008847\nrooms           -0.009271 0.04387 0.0013873      0.0013228\nbeds            -0.075175 0.07048 0.0022288      0.0022288\nsyear1994        0.007199 0.11337 0.0035849      0.0035849\nsyear1995       -0.126615 0.11073 0.0035017      0.0029545\nsyear1996        0.015906 0.10680 0.0033774      0.0033774\nsyear1997       -0.086813 0.10132 0.0032040      0.0032040\nsyear1998        0.063025 0.10730 0.0033932      0.0033932\n\n2. Quantiles for each variable:\n\n                    2.5%      25%       50%      75%    97.5%\nI(age_sold)      1.01684  1.66122  1.978365  2.32081  2.94284\nI(age_sold^2)   -5.11638 -3.84502 -3.221522 -2.61815 -1.35199\nI(age_sold^3)   -0.54360  0.21805  0.569439  0.93971  1.65820\nI(log(TLA))      0.27728  0.45640  0.542007  0.62837  0.78507\nI(log(lotsize)) -0.08540 -0.05012 -0.031308 -0.01405  0.02491\nrooms           -0.09071 -0.03874 -0.010332  0.02283  0.07262\nbeds            -0.21370 -0.12136 -0.075312 -0.02773  0.05845\nsyear1994       -0.20521 -0.06970  0.006784  0.08441  0.22773\nsyear1995       -0.34029 -0.19814 -0.127557 -0.05271  0.09324\nsyear1996       -0.19977 -0.05091  0.013166  0.09140  0.21724\nsyear1997       -0.29699 -0.15556 -0.083571 -0.01477  0.09978\nsyear1998       -0.14518 -0.01269  0.062252  0.13750  0.26969\n\n========================================================\nTotal:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD  Naive SE Time-series SE\nI(age_sold)      2.436063 0.51093 0.0161569      0.0151156\nI(age_sold^2)   -4.223821 1.03839 0.0328367      0.0306742\nI(age_sold^3)    0.605587 0.61494 0.0194460      0.0147596\nI(log(TLA))      1.270729 0.14184 0.0044854      0.0044854\nI(log(lotsize))  0.085441 0.02879 0.0009106      0.0009106\nrooms            0.009956 0.04928 0.0015584      0.0014839\nbeds            -0.099269 0.07971 0.0025206      0.0025206\nsyear1994        0.060621 0.12829 0.0040570      0.0040570\nsyear1995       -0.046555 0.12591 0.0039817      0.0033623\nsyear1996        0.129926 0.12085 0.0038217      0.0038217\nsyear1997        0.057257 0.11588 0.0036643      0.0036643\nsyear1998        0.306675 0.12106 0.0038283      0.0038283\n\n2. Quantiles for each variable:\n\n                    2.5%      25%      50%      75%   97.5%\nI(age_sold)      1.43744  2.10139  2.43041  2.75368  3.4702\nI(age_sold^2)   -6.31630 -4.89596 -4.20326 -3.56986 -2.2270\nI(age_sold^3)   -0.63654  0.20606  0.60551  1.00928  1.8235\nI(log(TLA))      0.98215  1.17960  1.27291  1.37072  1.5434\nI(log(lotsize))  0.02875  0.06531  0.08558  0.10425  0.1428\nrooms           -0.08065 -0.02585  0.01045  0.04540  0.1035\nbeds            -0.25372 -0.15241 -0.10144 -0.04542  0.0566\nsyear1994       -0.18865 -0.02399  0.06155  0.14613  0.3073\nsyear1995       -0.29434 -0.12999 -0.04696  0.03934  0.1981\nsyear1996       -0.12225  0.05450  0.12698  0.21204  0.3625\nsyear1997       -0.18161 -0.01896  0.05603  0.14139  0.2682\nsyear1998        0.07651  0.22255  0.30815  0.38914  0.5382\n\n========================================================\nSimulated standard errors\n                    Direct   Indirect      Total\nI(age_sold)     0.19377043 0.48430840 0.51092743\nI(age_sold^2)   0.35056995 0.95731289 1.03838680\nI(age_sold^3)   0.18626069 0.55609460 0.61493681\nI(log(TLA))     0.03256839 0.12916484 0.14184154\nI(log(lotsize)) 0.01215369 0.02797698 0.02879443\nrooms           0.01035366 0.04387138 0.04927992\nbeds            0.01586979 0.07047965 0.07970720\nsyear1994       0.02498084 0.11336570 0.12829442\nsyear1995       0.02421323 0.11073355 0.12591184\nsyear1996       0.02340386 0.10680158 0.12085180\nsyear1997       0.02385899 0.10131951 0.11587633\nsyear1998       0.02383429 0.10730107 0.12106130\n\nSimulated z-values:\n                    Direct    Indirect      Total\nI(age_sold)      2.2791192  4.11811449  4.7679244\nI(age_sold^2)   -2.8348746 -3.37402650 -4.0676758\nI(age_sold^3)    0.1593776  1.03561785  0.9847959\nI(log(TLA))     22.4383057  4.18031245  8.9587916\nI(log(lotsize))  9.6096536 -1.12062046  2.9672808\nrooms            1.8570362 -0.21132079  0.2020332\nbeds            -1.5182149 -1.06662051 -1.2454182\nsyear1994        2.1385335  0.06349941  0.4725149\nsyear1995        3.3064592 -1.14341815 -0.3697403\nsyear1996        4.8718380  0.14893491  1.0750879\nsyear1997        6.0383741 -0.85682032  0.4941207\nsyear1998       10.2226717  0.58736331  2.5332198\n\nSimulated p-values:\n                Direct          Indirect    Total       \nI(age_sold)     0.02265998      0.000038198 0.0000018613\nI(age_sold^2)   0.00458437      0.00074077  0.0000474844\nI(age_sold^3)   0.87337138      0.30038046  0.3247243   \nI(log(TLA))     < 2.22e-16      0.000029111 < 2.22e-16  \nI(log(lotsize)) < 2.22e-16      0.26244945  0.0030045   \nrooms           0.06330600      0.83263696  0.8398908   \nbeds            0.12896023      0.28614323  0.2129781   \nsyear1994       0.03247347      0.94936883  0.6365593   \nsyear1995       0.00094483      0.25286502  0.7115760   \nsyear1996       0.0000011056480 0.88160500  0.2823354   \nsyear1997       0.0000000015567 0.39154419  0.6212209   \nsyear1998       < 2.22e-16      0.55695973  0.0113020   \n```\n:::\n:::\n\n\n## Spatial autocorrelation left in SDM \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# residuals are with attributes, hence as.vector()\nmoran.plot(as.vector(SDM$residuals), listw = red_house_sf_w)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-revealjs/unnamed-chunk-39-1.png){width=960}\n:::\n:::\n\n\n## Some tests\n\n## Are our residuals normal?\n\nSDEM\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DescTools)\n# H0: residuals normal\nJarqueBeraTest(residuals(SDEM), robust = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tRobust Jarque Bera Test\n\ndata:  residuals(SDEM)\nX-squared = 10280, df = 2, p-value < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n# Conclusion: not normal\n```\n:::\n\n\nFar from normal.\n\nSDM\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# H0: residuals normal\nJarqueBeraTest(residuals(SDM), robust = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tRobust Jarque Bera Test\n\ndata:  residuals(SDM)\nX-squared = 10921, df = 2, p-value < 2.2e-16\n```\n:::\n\n```{.r .cell-code}\n# Conclusion: not normal\n```\n:::\n\n\nFar from normal.\n\n## Heteroskedasticity?\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# test for Heteroskedasticity\nbptest.Sarlm(SDEM, studentize = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tstudentized Breusch-Pagan test\n\ndata:  \nBP = 531.81, df = 24, p-value < 2.2e-16\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# test for Heteroskedasticity\nbptest.Sarlm(SDM, studentize = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tstudentized Breusch-Pagan test\n\ndata:  \nBP = 550.1, df = 24, p-value < 2.2e-16\n```\n:::\n:::\n\n\n## MAPS\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#  Start of code to draw a map of Lucas County\n#\n#\n# counties %>% \n#   filter(county_name == \"Lucas County\")\n# \n# \n# tmp <- countydata %>% \n#   left_join(counties, by = \"county_fips\") %>% \n#   filter(state_name ==\"Ohio\") %>% \n#   filter(county_name == \"Lucas County\") %>% \n#   ggplot(mapping = aes(long, lat, group = group, fill = horate)) +\n#   geom_polygon(color = \"#ffffff\", size = .25)\n# \n# class(countydata)\n# names(countydata)\n# class(counties)\n# names(counties)\n# \n# tmp_sf <- st_as_sf(counties, coords = c(\"long\", \"lat\"), \n#     crs = 2834)\n# \n# names(tmp_sf)\n# \n# tmp_sf %>% \n#   filter(state_name == \"Ohio\") %>% \n#   filter(county_name == \"Lucas County\") \n# \n# test <- st_cast(tmp_sf, \"MULTIPOINT\")\n# test1 <- st_cast(test, \"POLYGON\")\n# \n# names(tmp_sf)\n# \n# tmp <- st_transform(tmp, 2834)\n# tmp\n# head(countydata)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#siste\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    function fireSlideChanged(previousSlide, currentSlide) {\n\n      // dispatch for htmlwidgets\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for reveal\n    if (window.Reveal) {\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\n        fireSlideChanged(event.previousSlide, event.currentSlide);\n      });\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}