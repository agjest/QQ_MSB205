[
  {
    "objectID": "maps/EDA/index.html#we-will-do-eda-in-geoda",
    "href": "maps/EDA/index.html#we-will-do-eda-in-geoda",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "We will do EDA in GeoDa",
    "text": "We will do EDA in GeoDa\n\n\n\nMain Menu\n\n\n\n\n\nSee “GeoDa on Github” (n.d.), or use this link, for GeoDa Documentation\nWe collect what we do in a project\nWe start with a new empty project\nWe can also open a previously saved project\n\n\n\n\n\nNew Project"
  },
  {
    "objectID": "maps/EDA/index.html#add-our-map",
    "href": "maps/EDA/index.html#add-our-map",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Add our map",
    "text": "Add our map\n\n\n\n\n\nAdd Our Map\n\n\n\n\n\n\nMap of Norway (423 municipalities)"
  },
  {
    "objectID": "maps/EDA/index.html#generate-weights-matrix",
    "href": "maps/EDA/index.html#generate-weights-matrix",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Generate weights matrix",
    "text": "Generate weights matrix\n\n\n\nwe have to find our neighbours\nWe have our weights\nMake symmetric\nImportant that min neighbours > 0, else problems\n\n\n\n\n\nNew Weight Matrix"
  },
  {
    "objectID": "maps/EDA/index.html#weights-manager-cont.",
    "href": "maps/EDA/index.html#weights-manager-cont.",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Weights manager cont.",
    "text": "Weights manager cont.\n\n\n\nDo we have spatial autocorrelation in our data?\n\n\n\nUnivariate Moran's I\n\n\n\n\n\nSelect Variable and Weights\n\n\n\n\n\nSelect variable and weights\n\nDocumentation is to be found at geodacenter.github.io. Most of the following is taken from this source,\nWe select log_pm2 as variable and the queen based contiguity weights\n\nMoran’s I"
  },
  {
    "objectID": "maps/EDA/index.html#options-for-global-morans-i",
    "href": "maps/EDA/index.html#options-for-global-morans-i",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Options for Global Morans I",
    "text": "Options for Global Morans I\n\n\n\n\n\nMoran’s I\n\n\n\n\nRight click/ctrl click on plot\nClick Randomisation\nChoose 999 Permutations"
  },
  {
    "objectID": "maps/EDA/index.html#other-options",
    "href": "maps/EDA/index.html#other-options",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Other options",
    "text": "Other options\n\n\n\n\n\nPlot Moran’s I\n\n\n\n\nLOWESS smoother\nRegimes regression + Morans I for selected/not selected"
  },
  {
    "objectID": "maps/EDA/index.html#the-killer-feature-in-geoda-linked-plots",
    "href": "maps/EDA/index.html#the-killer-feature-in-geoda-linked-plots",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "The “killer” feature in GeoDa; linked plots",
    "text": "The “killer” feature in GeoDa; linked plots"
  },
  {
    "objectID": "maps/EDA/index.html#spatial-correlogram",
    "href": "maps/EDA/index.html#spatial-correlogram",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Spatial Correlogram",
    "text": "Spatial Correlogram\n\n\n\n\n\nSpatial Correlogram\n\n\n\n\nStandardised variables (\\(\\mu = 0, \\sigma = 1\\))\n\\(z_i · z_j = f(d_{ij}) + u\\) - \\(d_{ij}\\), distance between “center” of \\(i\\) polygon and \\(j\\) polygon\nThe smoothed line on the top shows how auto-correlation depends upon distance between to places.\nThe bar shows how many obs. we have for each distance\nDistance in meter, so max. dist. in figure is 70 km (ca. 1,5 hours of commute time)"
  },
  {
    "objectID": "maps/EDA/index.html#local-spatial-autocorrelation",
    "href": "maps/EDA/index.html#local-spatial-autocorrelation",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Local Spatial Autocorrelation",
    "text": "Local Spatial Autocorrelation\n\n\nLets hunt clusters\n\nLISA, Local Indicator of Spatial Association (Anselin 1995)\nLocal Morans I\nGlobal analysis: “Do we have spatial autocorrelation?”\nLocal analysis: “Where is the spatial autocorrelation located?”\nWhere should we expect clusters in our data?"
  },
  {
    "objectID": "maps/EDA/index.html#lisa-cluster-map",
    "href": "maps/EDA/index.html#lisa-cluster-map",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "LISA Cluster Map",
    "text": "LISA Cluster Map\n\n\n\n\n\nLISA cluster map\n\n\n\nLISA\n\nHigh-High: this muni is high and its neighbouring munis are high\nLow-Low: this muni is low and its neighbouring munis are low\nLow-High; this muni is low, but its neighbours are high\nHigh-Low; this muni is high, but its munis are low\nCan this be connected with infrastructure?\nNote when High-High is clicked in the top map. The High-High munis are selected in both figures"
  },
  {
    "objectID": "maps/EDA/index.html#significance",
    "href": "maps/EDA/index.html#significance",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Significance",
    "text": "Significance\n\n\n\n\n\nSignificance\n\n\n\n\nGlobal Morans I:\n\n\\(I = \\frac{\\sum_i\\sum_j w_{ij}·z_i·z_j}{\\sum_i z_i^2}\\)\n\nLocal Morans I:\n\n\\(I_i = \\frac{\\sum_j w_{ij}·z_i·z_j}{\\sum_i z_i^2}\\)\n\nThe global Morans I corresponds with the average of the local Morans I (details Anselin 1995)\nSignificance: analytic or conditional permutations\n\nAnalytical not very reliable in practice (Anselin 1995)\nConditional permutations: For each obs. (here muni) the local value is kept constant (log_pm2 for this muni) while the remaining n-1"
  },
  {
    "objectID": "maps/EDA/index.html#significance-cont.",
    "href": "maps/EDA/index.html#significance-cont.",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Significance cont.",
    "text": "Significance cont.\n\n\n\n\n\nSignificance\n\n\n\n\nvalues are randomly permuted.\nIn this way we build a reference distribution\nThe real value is then compared to this distribution\nGenerate a “pseudo p-value” that can be used to assess significance"
  },
  {
    "objectID": "maps/EDA/index.html#references",
    "href": "maps/EDA/index.html#references",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "References",
    "text": "References\n\n\nMSB205\n\n\n\nAppelhans, Tim, Florian Detsch, Christoph Reudenbach, and Stefan Woellauer. 2022. Mapview: Interactive Viewing of Spatial Data in r. https://github.com/r-spatial/mapview.\n\n\nBivand, Edzer Pebesma, Roger. n.d. Spatial Data Science. Accessed May 12, 2021. https://keen-swartz-3146c4.netlify.app/index.html.\n\n\nBivand, Roger. 2011a. “After ’Raising the Bar’: Applied Maximum Likelihood Estimation of Families of Models in Spatial Econometrics.” SSRN Electronic Journal. https://doi.org/10.2139/ssrn.1972278.\n\n\n———. 2011b. “After ’Raising the Bar’: Applied Maximum Likelihood Estimation of Families of Models in Spatial Econometrics.” SSRN Electronic Journal. https://doi.org/10.2139/ssrn.1972278.\n\n\nBivand, Roger S. 2021. “Progress in the R Ecosystem for Representing and Handling Spatial Data.” Journal of Geographical Systems 23 (4): 515–46. https://doi.org/10.1007/s10109-020-00336-0.\n\n\nBivand, Roger, Tim Keitt, and Barry Rowlingson. 2022. Rgdal: Bindings for the Geospatial Data Abstraction Library. https://CRAN.R-project.org/package=rgdal.\n\n\nBivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. “A Review of Software for Spatial Econometrics in R.” Mathematics 9 (11, 11): 1276. https://doi.org/10.3390/math9111276.\n\n\nBivand, Roger, Jakub Nowosad, and Robin Lovelace. 2021. spData: Datasets for Spatial Analysis. https://nowosad.github.io/spData/.\n\n\nBivand, Roger, and Colin Rundel. 2021. Rgeos: Interface to Geometry Engine - Open Source (GEOS). https://CRAN.R-project.org/package=rgeos.\n\n\nBrownrigg, Ray. 2021. Maps: Draw Geographical Maps. https://CRAN.R-project.org/package=maps.\n\n\n“GeoDa on Github.” n.d. Accessed August 30, 2022. http://geodacenter.github.io/.\n\n\nHalleck Vega, Solmaria, and J. Paul Elhorst. 2015. “THE SLX MODEL.” Journal of Regional Science 55 (3): 339–63. https://doi.org/10.1111/jors.12188.\n\n\nHealy, Kieran. 2019. Data Visualization (A Practical Introduction). 1. ed. Princeton University Press. https://socviz.co/index.html.\n\n\nJuhl, Sebastian. 2021. “The Wald Test of Common Factors in Spatial Model Specification Search Strategies.” Political Analysis 29 (2): 193–211. https://doi.org/10.1017/pan.2020.23.\n\n\nKnuth, Donald E. 1992. Literate Programming. 1st edition. Stanford, Calif.: Center for the Study of Language and Inf.\n\n\nLacombe, Donald J., and James P. LeSage. 2015a. “Using Bayesian posterior model probabilities to identify omitted variables in spatial regression models.” Papers in Regional Science 94 (2): 365–83. https://doi.org/10.1111/pirs.12070.\n\n\n———. 2015b. “Using Bayesian posterior model probabilities to identify omitted variables in spatial regression models.” Papers in Regional Science 94 (2): 365–83. https://doi.org/10.1111/pirs.12070.\n\n\nLeSage, James P. 2014. “What Regional Scientists Need to Know About Spatial Econometrics.” SSRN scholarly paper ID 2420725. Rochester, NY: Social Science Research Network. https://doi.org/10.2139/ssrn.2420725.\n\n\n“Map Projections and Distortion.” n.d. Accessed April 5, 2021. http://www.geography.hunter.cuny.edu/~jochen/GTECH361/lectures/lecture04/concepts/Map%20coordinate%20systems/Map%20projections%20and%20distortion.htm.\n\n\nMcIlroy, Doug, Ray Brownrigg, Thomas P Minka, and Roger Bivand. 2022. Mapproj: Map Projections. https://CRAN.R-project.org/package=mapproj.\n\n\nMcLean, Mathew W. 2020. RefManageR: Straightforward BibTeX and BibLaTeX Bibliography Management. https://github.com/ropensci/RefManageR/.\n\n\nMcLean, Mathew William. 2014. Straightforward Bibliography Management in r Using the RefManager Package. https://arxiv.org/abs/1403.2036.\n\n\n———. 2017. “RefManageR: Import and Manage BibTeX and BibLaTeX References in r.” The Journal of Open Source Software. https://doi.org/10.21105/joss.00338.\n\n\nMuenchow, Jannes, Jakub Nowosad. n.d. Geocomputation with R. Accessed May 12, 2021. https://geocompr.robinlovelace.net/.\n\n\nNowosad, Jakub, and Robin Lovelace. 2022. spDataLarge: Large Datasets for Spatial Analysis. https://github.com/Nowosad/spData.\n\n\nOetiker, Tobias, Hubert Partl, Irene Hyna, and Elisabeth Schlegl. n.d. “The Not So Short Introduction to LATEX 2ε,” 153.\n\n\n“One-Step Estimation of Spatial Dependence Parameters: Properties and Extensions of the APLE Statistic | Elsevier Enhanced Reader.” n.d. Accessed June 25, 2021. https://doi.org/10.1016/j.jmva.2011.08.006.\n\n\nOsland, Liv. 2010. “An Application of Spatial Econometrics in Relation to Hedonic House Price Modeling.” Journal of Real Estate Research 32 (July): 289–320.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022a. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\n———. 2022b. Stars: Spatiotemporal Arrays, Raster and Vector Data Cubes. https://CRAN.R-project.org/package=stars.\n\n\n———. n.d. “2. Reading, Writing and Converting Simple Features.” Sf documentasjon. 2. Reading, Writing and Converting Simple Features. Accessed March 30, 2021. https://r-spatial.github.io/sf/articles/sf2.html.\n\n\n“Shapefile Must Die!” n.d. Accessed August 29, 2022. http://switchfromshapefile.org/.\n\n\nSievert, Carson. 2020. Interactive Web-Based Data Visualization with r, Plotly, and Shiny. Chapman; Hall/CRC. https://plotly-r.com.\n\n\nSievert, Carson, Chris Parmer, Toby Hocking, Scott Chamberlain, Karthik Ram, Marianne Corvellec, and Pedro Despouy. 2021. Plotly: Create Interactive Web Graphics via Plotly.js. https://CRAN.R-project.org/package=plotly.\n\n\nSouth, Andy. 2017. Rnaturalearth: World Map Data from Natural Earth. https://github.com/ropenscilabs/rnaturalearth.\n\n\n———. 2022. Rnaturalearthhires: High Resolution World Vector Map Data from Natural Earth Used in Rnaturalearth.\n\n\nTennekes, Martijn. 2018. “tmap: Thematic Maps in R.” Journal of Statistical Software 84 (6): 1–39. https://doi.org/10.18637/jss.v084.i06.\n\n\n———. 2022. Tmap: Thematic Maps. https://github.com/r-tmap/tmap.\n\n\nTeucher, Andy, and Kenton Russell. 2022. Rmapshaper: Client for Mapshaper for Geospatial Operations. https://github.com/ateucher/rmapshaper.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\n———. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2022. Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics. https://CRAN.R-project.org/package=ggplot2.\n\n\nWilke, Claus O. n.d. Fundamentals of Data Visualization. Accessed May 12, 2021. https://clauswilke.com/dataviz/."
  },
  {
    "objectID": "maps/index.html",
    "href": "maps/index.html",
    "title": "Maps",
    "section": "",
    "text": "The Process\nEDA\nProjections 1\nProjections 2"
  },
  {
    "objectID": "maps/projections/proj2/index.html#standard-projections-for-norway",
    "href": "maps/projections/proj2/index.html#standard-projections-for-norway",
    "title": "Maps and Projections 2",
    "section": "Standard projections for Norway",
    "text": "Standard projections for Norway\nStandard projections for Norway\nhttps://epsg.io/\n\nEUREF89 UTM (Universal Transversal Mercator-projeksjon) er i løpet av 1. halvår 2009 innført som offisielt datum og projeksjon i alle landets kommuner. Innføringen av EUREF89 har gitt oss et moderne, homogent og nøyaktig geodetisk grunnlag som for de fleste praktiske formål kan ansees som feilfritt. (Kilde: https://www.kartverket.no/globalassets/til-lands/euref89_ntm_beskrivelse.pdf)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#standard-projections-for-norway-cont.",
    "href": "maps/projections/proj2/index.html#standard-projections-for-norway-cont.",
    "title": "Maps and Projections 2",
    "section": "Standard projections for Norway cont.",
    "text": "Standard projections for Norway cont.\n\nEPSG:5972 ETRS89 / UTM zone 32 + NN2000 height (Sør Norge, Norway - onshore - between 6°E and 12°E.)\nEPSG:5973 ETRS89 / UTM zone 33 + NN2000 height (East Hedemark, Trøndelag-Troms, Norway - onshore - between 12°E and 18°E.)\nEPSG:5975 ETRS89 / UTM zone 35 + NN2000 height (Finnmark, Norway - onshore - between 24°E and 30°E.)\nEUREF89 er det offisielle geodetiske datumet i Norge. Internasjonalt brukes navnet European Terrestrial Reference System 1989 (ETRS89) om samme datum. (Kilde: https://no.wikipedia.org/wiki/EUREF89)\nED50: ED50 er ei regional referanseramme (geodetisk datum) som dekker Europa. ED50 har vore tilgjengeleg sidan 1950, og Noregs hovudkartserie i målestokk 1 : 50000, N50 (tidlegare M711) brukte tidlegare denne referanseramma. No blir N50-serien gjeven ut med referanseramme EUREF89. (Kilde: https://www.kartverket.no/til-lands/posisjon/referanserammer-for-noreg)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#standard-projections-for-norway-cont.-1",
    "href": "maps/projections/proj2/index.html#standard-projections-for-norway-cont.-1",
    "title": "Maps and Projections 2",
    "section": "Standard projections for Norway cont.",
    "text": "Standard projections for Norway cont.\n\nNN2000, vertikalt datum, offisielt høydesystem for Norge, Sverige og Finland. I nyere kart og publikasjoner er høyde over havet oppgitt i NN2000.Også kjent som normalnull 2000. (Kilde:https://snl.no/NN2000)\nGeoide er det teoretiske nivået havoverflaten ville ligget på hvis vi trekker fra effekter av tidevann, havstrømmer og bølger. Geoiden påvirkes av jordas gravitasjonsfelt, og dette er ikke det samme over alt. Geoiden er et viktig utgangspunkt for høydemålinger. (Kilde: https://snl.no/geoide)\nEt horisontalt datum inneholder parametre (størrelse og flattrykning) for en jordellipsoide og dens plassering i forhold til jordkroppen. Det punktet som forankrer koordinatsystemet til jordkroppen kalles fundamentalpunktet. (Kilde:https://snl.no/geodetisk_datum)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#previous-norwegian-standards",
    "href": "maps/projections/proj2/index.html#previous-norwegian-standards",
    "title": "Maps and Projections 2",
    "section": "Previous Norwegian “standards”",
    "text": "Previous Norwegian “standards”\nAsk rgdal.\n\n\nCode\n# rgdal knows datums\nngo48 <- make_EPSG() %>% \n  filter(str_detect(note, 'NGO 1948'))\n\n\n\n\nCode\nngo48 %>% \n  select(code, note)\n\nngo48 %>% \n  select(prj4)\n\nngo48 %>% \n  select(code, prj_method)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#previous-norwegian-standards-cont.",
    "href": "maps/projections/proj2/index.html#previous-norwegian-standards-cont.",
    "title": "Maps and Projections 2",
    "section": "Previous Norwegian “standards” cont.",
    "text": "Previous Norwegian “standards” cont.\n\n\n    code                            note\n1   4273                        NGO 1948\n2   4817                 NGO 1948 (Oslo)\n3  27391    NGO 1948 (Oslo) / NGO zone I\n4  27392   NGO 1948 (Oslo) / NGO zone II\n5  27393  NGO 1948 (Oslo) / NGO zone III\n6  27394   NGO 1948 (Oslo) / NGO zone IV\n7  27395    NGO 1948 (Oslo) / NGO zone V\n8  27396   NGO 1948 (Oslo) / NGO zone VI\n9  27397  NGO 1948 (Oslo) / NGO zone VII\n10 27398 NGO 1948 (Oslo) / NGO zone VIII"
  },
  {
    "objectID": "maps/projections/proj2/index.html#previous-norwegian-standards-cont.-1",
    "href": "maps/projections/proj2/index.html#previous-norwegian-standards-cont.-1",
    "title": "Maps and Projections 2",
    "section": "Previous Norwegian “standards” cont.",
    "text": "Previous Norwegian “standards” cont.\n\n\n                                                                                                                                    prj4\n1                                                                        +proj=longlat +a=6377492.018 +rf=299.1528128 +no_defs +type=crs\n2                                                               +proj=longlat +a=6377492.018 +rf=299.1528128 +pm=oslo +no_defs +type=crs\n3  +proj=tmerc +lat_0=58 +lon_0=-4.66666666666667 +k=1 +x_0=0 +y_0=0 +a=6377492.018 +rf=299.1528128 +pm=oslo +units=m +no_defs +type=crs\n4  +proj=tmerc +lat_0=58 +lon_0=-2.33333333333333 +k=1 +x_0=0 +y_0=0 +a=6377492.018 +rf=299.1528128 +pm=oslo +units=m +no_defs +type=crs\n5                  +proj=tmerc +lat_0=58 +lon_0=0 +k=1 +x_0=0 +y_0=0 +a=6377492.018 +rf=299.1528128 +pm=oslo +units=m +no_defs +type=crs\n6                +proj=tmerc +lat_0=58 +lon_0=2.5 +k=1 +x_0=0 +y_0=0 +a=6377492.018 +rf=299.1528128 +pm=oslo +units=m +no_defs +type=crs\n7   +proj=tmerc +lat_0=58 +lon_0=6.16666666666667 +k=1 +x_0=0 +y_0=0 +a=6377492.018 +rf=299.1528128 +pm=oslo +units=m +no_defs +type=crs\n8   +proj=tmerc +lat_0=58 +lon_0=10.1666666666667 +k=1 +x_0=0 +y_0=0 +a=6377492.018 +rf=299.1528128 +pm=oslo +units=m +no_defs +type=crs\n9   +proj=tmerc +lat_0=58 +lon_0=14.1666666666667 +k=1 +x_0=0 +y_0=0 +a=6377492.018 +rf=299.1528128 +pm=oslo +units=m +no_defs +type=crs\n10  +proj=tmerc +lat_0=58 +lon_0=18.3333333333333 +k=1 +x_0=0 +y_0=0 +a=6377492.018 +rf=299.1528128 +pm=oslo +units=m +no_defs +type=crs"
  },
  {
    "objectID": "maps/projections/proj2/index.html#previous-norwegian-standards-cont.-2",
    "href": "maps/projections/proj2/index.html#previous-norwegian-standards-cont.-2",
    "title": "Maps and Projections 2",
    "section": "Previous Norwegian “standards” cont.",
    "text": "Previous Norwegian “standards” cont.\n\n\n    code          prj_method\n1   4273              (null)\n2   4817              (null)\n3  27391 Transverse Mercator\n4  27392 Transverse Mercator\n5  27393 Transverse Mercator\n6  27394 Transverse Mercator\n7  27395 Transverse Mercator\n8  27396 Transverse Mercator\n9  27397 Transverse Mercator\n10 27398 Transverse Mercator"
  },
  {
    "objectID": "maps/projections/proj2/index.html#previous-norwegian-standards-cont.-3",
    "href": "maps/projections/proj2/index.html#previous-norwegian-standards-cont.-3",
    "title": "Maps and Projections 2",
    "section": "Previous Norwegian “standards” cont.",
    "text": "Previous Norwegian “standards” cont.\n\nNGO1948 er et nasjonalt norsk geodetisk datum og koordinatsystem, som ble brukt fram til 2009.Fundamentalpunktet er i Observatoriet i Oslo.\nFor NGO-48 er det Oslo gamle observatorium som er 0. (http://www.milvang.no/gps/gpsconv/gpsconv.html).\nVirker som det er litt forvirring rundt dette, SNL viser til Oslo solobservatorium som fundamentalpunktet."
  },
  {
    "objectID": "maps/projections/proj2/index.html#simplify",
    "href": "maps/projections/proj2/index.html#simplify",
    "title": "Maps and Projections 2",
    "section": "Simplify",
    "text": "Simplify\n\n\nCode\n# cache: true so that we don't simplify multiple times\nHgsdOgOmegn <- HgsdOgOmegn %>% \n  #simplify it\n  ms_simplify(\n    keep = 0.05, \n    keep_shapes = TRUE\n    )"
  },
  {
    "objectID": "maps/projections/proj2/index.html#projected",
    "href": "maps/projections/proj2/index.html#projected",
    "title": "Maps and Projections 2",
    "section": "Projected",
    "text": "Projected\n\n\n\n\nCode\n# axes order NOT according \n# to authority\nst_axis_order(FALSE)\n\npHgsd <- HgsdOgOmegn %>% \n  select(knavn) %>% \n  st_transform('EPSG:5972') %>% \n  ggplot() + \n  geom_sf(aes(fill = knavn)) +\n  # to get rid of degree on axes\n  coord_sf(datum = NULL) +\n  theme(legend.position=\"bottom\")"
  },
  {
    "objectID": "maps/projections/proj2/index.html#same-map-with-tmap",
    "href": "maps/projections/proj2/index.html#same-map-with-tmap",
    "title": "Maps and Projections 2",
    "section": "Same map with tmap",
    "text": "Same map with tmap\n\nPerhaps easier with tmap\n\n\n\n\n\n\nCode\n# Don't respect authorities\nst_axis_order(FALSE)\n\npHgsd_tm <- HgsdOgOmegn %>% \n  select(knavn) %>% \n  st_transform('EPSG:5972') %>% #<<\n  tm_shape() +\n  tm_polygons(\"knavn\") +\n  tm_grid()"
  },
  {
    "objectID": "maps/projections/proj2/index.html#utm-fra-wikipedia.org",
    "href": "maps/projections/proj2/index.html#utm-fra-wikipedia.org",
    "title": "Maps and Projections 2",
    "section": "UTM (fra wikipedia.org)",
    "text": "UTM (fra wikipedia.org)\n\nUTM zones\nNote! 31V, 32V, 31X, 33C, 35X og 37X\nElse 6° wide, 8° high\nThe scale factor at the central meridian is specified to be 0.9996 of true scale\nThe Mercator projection is conformal, which means it preserves angles and therefore shapes across small regions. However, it distorts distance and area.\nCovers 80°S to 84°N"
  },
  {
    "objectID": "maps/projections/proj2/index.html#utm-fra-wikipedia.org-cont.",
    "href": "maps/projections/proj2/index.html#utm-fra-wikipedia.org-cont.",
    "title": "Maps and Projections 2",
    "section": "UTM (fra wikipedia.org) cont.",
    "text": "UTM (fra wikipedia.org) cont.\n\nLatitude bands not strictly part of UTM\n\nruns from C to X (excluding I and O)\nA, B Antarctica and Y, Z Arctic\n\nVertical axes, meters from equator\nHorizontal axes\n\nMid Meridian of a zone at 500.000\n498.500 means 1.500 meters west of center meridian of zone\n507.036 means 7036 meters east of center meridian of zone\nif both obs. on same latitude the distance between them is 507.036 - 498.500 = 8526 meters\nif not same latitude, use pytagoras\n\nNote! Horizontal axis neither starts at 0 nor ends at 1.000.000"
  },
  {
    "objectID": "maps/projections/proj2/index.html#norske-fylker-longlat-4326-and-projected",
    "href": "maps/projections/proj2/index.html#norske-fylker-longlat-4326-and-projected",
    "title": "Maps and Projections 2",
    "section": "Norske fylker long/lat 4326 and projected",
    "text": "Norske fylker long/lat 4326 and projected\n\n\n\n\nCode\nNorge_fylke <- read_sf(\"Norge_fylke.gpkg\") %>% \n  ms_simplify(\n    keep = 0.001,\n    keep_shapes = TRUE\n    )\n\n\n\n\nCode\np1 <- Norge_fylke %>% \n  select(fnr) %>%\n  tm_shape() +\n  tm_fill() +\n  tm_borders() +\n  tm_graticules() +\n  tm_layout(title = \"EPSG:4326 WGS 84\") +\n  tm_compass(\n    type = \"8star\",\n    position = c(\"left\", \"top\")\n    ) +\n  tm_scale_bar(\n    breaks = c(0, 100, 200), \n    text.size = 1\n    )\n\n\n\n\n\nCode\np2 <- Norge_fylke %>% \n  select(fnr) %>%\n  st_transform(5972) %>% \n  tm_shape() +\n  tm_fill() +\n  tm_grid() +\n  tm_borders() +\n  tm_layout(\n    title = \"EPSG:5972\\n\n    ETRS89 / UTM zone 32 + NN2000 height\",\n    scale = 1\n    ) +\n  tm_compass(\n    type = \"8star\",\n    position = c(\"left\", \"top\")\n    ) +\n  tm_scale_bar(\n    breaks = c(0, 100, 200),\n    text.size = 1\n    )"
  },
  {
    "objectID": "maps/projections/proj2/index.html#norske-fylker-longlat-wgs-84-epsg-4326-cont.",
    "href": "maps/projections/proj2/index.html#norske-fylker-longlat-wgs-84-epsg-4326-cont.",
    "title": "Maps and Projections 2",
    "section": "Norske fylker long/lat WGS 84 EPSG 4326 cont.",
    "text": "Norske fylker long/lat WGS 84 EPSG 4326 cont.\n\n\n\n\nCode\np3 <- Norge_fylke %>% \n  select(fnr) %>%\n  st_transform(5973) %>% \n  tm_shape() +\n  tm_fill() +\n  tm_grid() +\n  tm_borders() +\n  tm_layout(\n    title = \"EPSG:5973\\n\n    ETRS89 / UTM zone 33 + NN2000 height\"\n    ) +\n  tm_compass(\n    type = \"8star\", \n    position = c(\"left\", \"top\")\n    ) +\n  tm_scale_bar(\n    breaks = c(0, 100, 200),\n    text.size = 1\n    )\n\n\n\n\n\nCode\np4 <- Norge_fylke %>% \n  select(fnr) %>%\n  st_transform(5975) %>% \n  tm_shape() +\n  tm_fill() +\n  tm_grid() +\n  tm_borders() +\n  tm_layout(\n    title = \"EPSG:5975\\n \n    ETRS89 / UTM zone 35 + NN2000 height\"\n    ) +\n  tm_compass(\n    type = \"8star\", \n    position = c(\"left\", \"top\")) +\n  tm_scale_bar(\n    breaks = c(0, 100, 200), \n    text.size = 1\n    )"
  },
  {
    "objectID": "maps/projections/proj2/index.html#result",
    "href": "maps/projections/proj2/index.html#result",
    "title": "Maps and Projections 2",
    "section": "Result",
    "text": "Result\n\n\nCode\ntmap_arrange(p1, p2, p3, p4)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#southern-norway",
    "href": "maps/projections/proj2/index.html#southern-norway",
    "title": "Maps and Projections 2",
    "section": "Southern Norway",
    "text": "Southern Norway\n\n\n\n\nCode\n# query=\"SELECT * FROM Norge_fylke WHERE navn \n# IN ('Østfold', 'Akershus', 'Oslo', 'Hedmark', 'Oppland', \n# 'Buskerud', 'Vestfold', 'Telemark', 'Aust-Agder', \n# 'Vest-Agder', 'Rogaland', 'Hordaland', 'Sogn og Fjordane', \n# 'Møre og Romsdal', 'Sør-Trøndelag')\")\n# OR\nNorge_fylke_syd <- read_sf(\n  \"Norge_fylke.gpkg\",\n  query = \"SELECT * FROM Norge_fylke WHERE navn \n  NOT IN ('Nord-Trøndelag', 'Nordland',\n  'Troms', 'Finnmark')\") %>% \n  #check size\n  ms_simplify(\n    keep = 0.01, \n    keep_shapes = TRUE\n    )\n\n\n\n\nCode\np5 <- Norge_fylke_syd %>% \n  select(fnr) %>%\n  tm_shape() +\n  tm_fill() +\n  tm_borders() +\n  tm_graticules() +\n  tm_layout(\n    title = \"EPSG:4326 WGS 84\",\n    scale = 1\n    ) +\n  tm_compass(\n    type = \"8star\", \n    position = c(\"left\", \"top\")\n    ) +\n  tm_scale_bar(\n    breaks = c(0, 100, 200),\n    text.size = 1\n    )\n\n\n\n\n\nCode\np6 <- Norge_fylke_syd %>% \n  select(fnr) %>%\n  st_transform(5972) %>% \n  tm_shape() +\n  tm_fill() +\n  tm_borders() +\n  tm_layout(\n    title = \"EPSG:5972\\n\n    ETRS89 / UTM zone 32 + NN2000 height\",\n    scale = 1\n    ) +\n  tm_grid() +\n  tm_compass(\n    type = \"8star\", \n    position = c(\"left\", \"top\")\n    ) +\n  tm_scale_bar(\n    breaks = c(0, 100, 200), \n    text.size = 1\n    )"
  },
  {
    "objectID": "maps/projections/proj2/index.html#result-1",
    "href": "maps/projections/proj2/index.html#result-1",
    "title": "Maps and Projections 2",
    "section": "Result",
    "text": "Result\n\n\nCode\ntmap_arrange(p5, p6)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#result-cont.",
    "href": "maps/projections/proj2/index.html#result-cont.",
    "title": "Maps and Projections 2",
    "section": "Result cont.",
    "text": "Result cont.\n\nUTM\n\nNorth: Meters from equator\nEast: Offset from the zone central meridian (set at 500000).\n\nWidth is 6° longitude. UTM eastings range from about 167000 meters to 833000 meters at the equator (wikipedia.org).\n\n\nOne exception zone UTM 32V is 9° longitude wide and UTM 31V is 3°."
  },
  {
    "objectID": "maps/projections/proj2/index.html#utm-europe-map",
    "href": "maps/projections/proj2/index.html#utm-europe-map",
    "title": "Maps and Projections 2",
    "section": "UTM Europe map",
    "text": "UTM Europe map\n\nUTM Europe (in Public Domain, taken from wikipedia)."
  },
  {
    "objectID": "maps/projections/proj2/index.html#calculations-rogaland",
    "href": "maps/projections/proj2/index.html#calculations-rogaland",
    "title": "Maps and Projections 2",
    "section": "Calculations Rogaland",
    "text": "Calculations Rogaland\n\nNB! We MUST use projected map for area calculations.\n\n\n\n\nCode\n# Rogaland\nNorge_fylke_syd %>% \n  select(fnr) %>%\n  filter(fnr == '11') %>% \n  st_transform(5972) %>%\n  st_area()\n\n\n9352894903 [m^2]"
  },
  {
    "objectID": "maps/projections/proj2/index.html#calculations-sør-norge",
    "href": "maps/projections/proj2/index.html#calculations-sør-norge",
    "title": "Maps and Projections 2",
    "section": "Calculations Sør-Norge",
    "text": "Calculations Sør-Norge\n\n\nCode\n# Sør-norge\nNorge_fylke_syd <- Norge_fylke_syd %>% \n  select(fnr, navn) %>%\n  st_transform(5972) %>%\n  mutate(area = st_area(.))"
  },
  {
    "objectID": "maps/projections/proj2/index.html#calculations-sør-norge-1",
    "href": "maps/projections/proj2/index.html#calculations-sør-norge-1",
    "title": "Maps and Projections 2",
    "section": "Calculations Sør-Norge",
    "text": "Calculations Sør-Norge\n\n\nCode\nNorge_fylke_syd\n\n\nSimple feature collection with 15 features and 3 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 264035 ymin: 6426820 xmax: 706922.6 ymax: 7145715\nProjected CRS: ETRS89 / UTM zone 32N + NN2000 height\n# A tibble: 15 × 4\n     fnr navn                                                       geom    area\n * <dbl> <chr>                                        <MULTIPOLYGON [m]>   [m^2]\n 1     1 Østfold          (((595487.4 6595761, 596740.2 6595909, 597095… 4.12e 9\n 2     2 Akershus         (((595487.4 6595761, 595029.5 6598461, 593972… 4.92e 9\n 3     3 Oslo             (((589437.3 6649902, 588515.7 6650396, 586785… 4.55e 8\n 4     4 Hedmark          (((659121.9 6637088, 658791.5 6637252, 658790… 2.74e10\n 5     5 Oppland          (((413559.5 6876136, 413808.8 6878535, 413293… 2.52e10\n 6     6 Buskerud         (((574300.1 6617769, 573398.3 6615185, 571043… 1.49e10\n 7     7 Vestfold         (((586629.8 6583984, 587328 6584084, 587442.4… 2.18e 9\n 8     8 Telemark         (((542483.3 6544783, 543936.8 6543814, 543438… 1.53e10\n 9     9 Aust-Agder       (((505409 6510821, 505917.8 6511466, 509148.3… 9.13e 9\n10    10 Vest-Agder       (((439175.4 6437828, 440373 6438453, 440749.6… 7.27e 9\n11    11 Rogaland         (((350155.9 6464135, 347181.1 6463086, 346582… 9.35e 9\n12    12 Hordaland        (((293745.5 6685230, 293180.5 6684306, 291731… 1.54e10\n13    14 Sogn og Fjordane (((278642.1 6838708, 277240 6839339, 277530.6… 1.87e10\n14    15 Møre og Romsdal  (((407878.4 6954314, 409132.4 6954983, 410557… 1.51e10\n15    16 Sør-Trøndelag    (((668566.5 6915299, 667158 6914854, 666246.7… 1.87e10"
  },
  {
    "objectID": "maps/projections/proj2/index.html#calculations-sør-norge-km2",
    "href": "maps/projections/proj2/index.html#calculations-sør-norge-km2",
    "title": "Maps and Projections 2",
    "section": "Calculations Sør-Norge (km^2)",
    "text": "Calculations Sør-Norge (km^2)\n\n\nCode\n# Sør-norge\nNorge_fylke_syd <- Norge_fylke_syd %>% \n  select(fnr, navn) %>%\n  st_transform(5972) %>%\n  # convert to km^2 via units package\n  mutate(area_km2 = set_units(st_area(.), km^2))"
  },
  {
    "objectID": "maps/projections/proj2/index.html#calculations-sør-norge-km2-1",
    "href": "maps/projections/proj2/index.html#calculations-sør-norge-km2-1",
    "title": "Maps and Projections 2",
    "section": "Calculations Sør-Norge (km^2)",
    "text": "Calculations Sør-Norge (km^2)\n\n\nCode\nNorge_fylke_syd\n\n\nSimple feature collection with 15 features and 3 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 264035 ymin: 6426820 xmax: 706922.6 ymax: 7145715\nProjected CRS: ETRS89 / UTM zone 32N + NN2000 height\n# A tibble: 15 × 4\n     fnr navn                                                       geom area_…¹\n * <dbl> <chr>                                        <MULTIPOLYGON [m]>  [km^2]\n 1     1 Østfold          (((595487.4 6595761, 596740.2 6595909, 597095…   4117.\n 2     2 Akershus         (((595487.4 6595761, 595029.5 6598461, 593972…   4915.\n 3     3 Oslo             (((589437.3 6649902, 588515.7 6650396, 586785…    455.\n 4     4 Hedmark          (((659121.9 6637088, 658791.5 6637252, 658790…  27391.\n 5     5 Oppland          (((413559.5 6876136, 413808.8 6878535, 413293…  25170.\n 6     6 Buskerud         (((574300.1 6617769, 573398.3 6615185, 571043…  14898.\n 7     7 Vestfold         (((586629.8 6583984, 587328 6584084, 587442.4…   2181.\n 8     8 Telemark         (((542483.3 6544783, 543936.8 6543814, 543438…  15282.\n 9     9 Aust-Agder       (((505409 6510821, 505917.8 6511466, 509148.3…   9135.\n10    10 Vest-Agder       (((439175.4 6437828, 440373 6438453, 440749.6…   7273.\n11    11 Rogaland         (((350155.9 6464135, 347181.1 6463086, 346582…   9353.\n12    12 Hordaland        (((293745.5 6685230, 293180.5 6684306, 291731…  15429.\n13    14 Sogn og Fjordane (((278642.1 6838708, 277240 6839339, 277530.6…  18665.\n14    15 Møre og Romsdal  (((407878.4 6954314, 409132.4 6954983, 410557…  15117.\n15    16 Sør-Trøndelag    (((668566.5 6915299, 667158 6914854, 666246.7…  18737.\n# … with abbreviated variable name ¹​area_km2"
  },
  {
    "objectID": "maps/projections/proj2/index.html#conclusion",
    "href": "maps/projections/proj2/index.html#conclusion",
    "title": "Maps and Projections 2",
    "section": "Conclusion",
    "text": "Conclusion\nNorway:\n\nUse EPSG:4326 (latitude/longitude or longitude/latitude ) for geographical coordinates.\n\n\nor\n\nEPSG:5973 for projected (whole of Norway)\nEPSG:5972 for Southern Norway\nUnit is meters.\nTo measure distance or area the map HAS to be projected."
  },
  {
    "objectID": "maps/projections/proj2/index.html#different-projections",
    "href": "maps/projections/proj2/index.html#different-projections",
    "title": "Maps and Projections 2",
    "section": "Different projections",
    "text": "Different projections\n\n\nCode\n# read in world map from rnatrualearth\n# The option returnclass = \"sf\" gives us an sf object\nworld_ne <- ne_countries(\n  scale = \"medium\", \n  returnclass = \"sf\"\n  )\n\n\n\n\nCode\nclass(world_ne)\n\n\n[1] \"sf\"         \"data.frame\""
  },
  {
    "objectID": "maps/projections/proj2/index.html#the-longitude-latitude-problem",
    "href": "maps/projections/proj2/index.html#the-longitude-latitude-problem",
    "title": "Maps and Projections 2",
    "section": "The longitude latitude problem",
    "text": "The longitude latitude problem\n\nGeographers prefer latitude first, longitude second\nData scientists and GIS programmer often use longitude first, latitude second\nFor some projections the axis order is not specified\nFor some projections the axis order is specified, but often ignored in software\nThis will give us a lot of problems"
  },
  {
    "objectID": "maps/projections/proj2/index.html#axis-order-epsg4326",
    "href": "maps/projections/proj2/index.html#axis-order-epsg4326",
    "title": "Maps and Projections 2",
    "section": "Axis order EPSG:4326",
    "text": "Axis order EPSG:4326\n\nEPSG:4326\nThe authorities say latitude first, longitude second"
  },
  {
    "objectID": "maps/projections/proj2/index.html#axis-order",
    "href": "maps/projections/proj2/index.html#axis-order",
    "title": "Maps and Projections 2",
    "section": "Axis order",
    "text": "Axis order\n\n\nCode\n# Default is FALSE\nst_axis_order()\n\n\n[1] FALSE\n\n\n\nObey the authorities\n\n\n\n\nCode\nst_axis_order(authority_compliant = TRUE)\n\n\n\nSet it back to default\n\n\n\n\n\nCode\nst_axis_order(authority_compliant = FALSE)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#the-crs-of-world_ne",
    "href": "maps/projections/proj2/index.html#the-crs-of-world_ne",
    "title": "Maps and Projections 2",
    "section": "The crs of world_ne",
    "text": "The crs of world_ne\n\n\nCode\nst_crs(world_ne)\n\n\nCoordinate Reference System:\n  User input: +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 \n  wkt:\nBOUNDCRS[\n    SOURCECRS[\n        GEOGCRS[\"unknown\",\n            DATUM[\"World Geodetic System 1984\",\n                ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                    LENGTHUNIT[\"metre\",1]],\n                ID[\"EPSG\",6326]],\n            PRIMEM[\"Greenwich\",0,\n                ANGLEUNIT[\"degree\",0.0174532925199433],\n                ID[\"EPSG\",8901]],\n            CS[ellipsoidal,2],\n                AXIS[\"longitude\",east,\n                    ORDER[1],\n                    ANGLEUNIT[\"degree\",0.0174532925199433,\n                        ID[\"EPSG\",9122]]],\n                AXIS[\"latitude\",north,\n                    ORDER[2],\n                    ANGLEUNIT[\"degree\",0.0174532925199433,\n                        ID[\"EPSG\",9122]]]]],\n    TARGETCRS[\n        GEOGCRS[\"WGS 84\",\n            DATUM[\"World Geodetic System 1984\",\n                ELLIPSOID[\"WGS 84\",6378137,298.257223563,\n                    LENGTHUNIT[\"metre\",1]]],\n            PRIMEM[\"Greenwich\",0,\n                ANGLEUNIT[\"degree\",0.0174532925199433]],\n            CS[ellipsoidal,2],\n                AXIS[\"latitude\",north,\n                    ORDER[1],\n                    ANGLEUNIT[\"degree\",0.0174532925199433]],\n                AXIS[\"longitude\",east,\n                    ORDER[2],\n                    ANGLEUNIT[\"degree\",0.0174532925199433]],\n            ID[\"EPSG\",4326]]],\n    ABRIDGEDTRANSFORMATION[\"Transformation from unknown to WGS84\",\n        METHOD[\"Geocentric translations (geog2D domain)\",\n            ID[\"EPSG\",9603]],\n        PARAMETER[\"X-axis translation\",0,\n            ID[\"EPSG\",8605]],\n        PARAMETER[\"Y-axis translation\",0,\n            ID[\"EPSG\",8606]],\n        PARAMETER[\"Z-axis translation\",0,\n            ID[\"EPSG\",8607]]]]"
  },
  {
    "objectID": "maps/projections/proj2/index.html#the-crs-of-world_ne-cont.",
    "href": "maps/projections/proj2/index.html#the-crs-of-world_ne-cont.",
    "title": "Maps and Projections 2",
    "section": "The crs of world_ne cont.",
    "text": "The crs of world_ne cont.\n\nIn output from st_crs(world_ne)we see that world_ne is in EPSG”,4326\nTARGETRCRS\n\nAXIS[“latitude”,north, ORDER[1],\nAXIS[“longitude”,east, ORDER[2]"
  },
  {
    "objectID": "maps/projections/proj2/index.html#plot-our-world-map-with-plot.sf-geographical-coordinates",
    "href": "maps/projections/proj2/index.html#plot-our-world-map-with-plot.sf-geographical-coordinates",
    "title": "Maps and Projections 2",
    "section": "Plot our world map with plot.sf, geographical coordinates",
    "text": "Plot our world map with plot.sf, geographical coordinates\n\n\n\n\nCode\n# Get axis order\nst_axis_order()\n\n\n[1] FALSE\n\n\n\n\nCode\n# Follow authorities\nst_axis_order(\n  authority_compliant = TRUE\n  )\n\nworld_ne %>% \n  # Select one of the \n  # features (variables)\n  select(gu_a3) %>%\n  # plot with plot.sf\n  plot()"
  },
  {
    "objectID": "maps/projections/proj2/index.html#plot-our-world-map-with-ggplot-geographical-coordinates",
    "href": "maps/projections/proj2/index.html#plot-our-world-map-with-ggplot-geographical-coordinates",
    "title": "Maps and Projections 2",
    "section": "Plot our world map with ggplot, geographical coordinates",
    "text": "Plot our world map with ggplot, geographical coordinates\n\n\n\n\nCode\n# Get axis order\nst_axis_order()\n\n\n[1] TRUE\n\n\n\n\nCode\n# plot with ggplot\nworld_ne %>% \n  select(sovereignt) %>% \n  ggplot() +\n  geom_sf() +\n  coord_sf(expand = FALSE)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#epsg3395-mecator",
    "href": "maps/projections/proj2/index.html#epsg3395-mecator",
    "title": "Maps and Projections 2",
    "section": "EPSG:3395 mecator",
    "text": "EPSG:3395 mecator\n\nEPSG:3395 mecator\nLongitude first, latitude second"
  },
  {
    "objectID": "maps/projections/proj2/index.html#world-behrmann-esri54017-ggplot",
    "href": "maps/projections/proj2/index.html#world-behrmann-esri54017-ggplot",
    "title": "Maps and Projections 2",
    "section": "World Behrmann ESRI:54017 ggplot",
    "text": "World Behrmann ESRI:54017 ggplot\n\n\n\n\nCode\n# Get axis order\nst_axis_order()\n\n\n[1] TRUE\n\n\n\n\nCode\nworld_ne %>% \n  st_transform(\"ESRI:54017\") %>% \n  ggplot() +\n  geom_sf() +\n  coord_sf(\n    datum = st_crs(\"ESRI:54017\"),\n    expand = FALSE\n    )"
  },
  {
    "objectID": "maps/projections/proj2/index.html#wgs-84-pseudo-mercator-spherical-mercator-google-maps-openstreetmap-bing-arcgis-esri",
    "href": "maps/projections/proj2/index.html#wgs-84-pseudo-mercator-spherical-mercator-google-maps-openstreetmap-bing-arcgis-esri",
    "title": "Maps and Projections 2",
    "section": "WGS 84 / Pseudo-Mercator – Spherical Mercator, Google Maps, OpenStreetMap, Bing, ArcGIS, ESRI",
    "text": "WGS 84 / Pseudo-Mercator – Spherical Mercator, Google Maps, OpenStreetMap, Bing, ArcGIS, ESRI\n\n\n\n\nCode\n# Get axis order\nst_axis_order()\n\n\n[1] TRUE\n\n\n\n\nCode\nworld_ne %>% \n  st_transform(\"EPSG:3857\") %>% \n  ggplot() +\n  geom_sf() +\n  coord_sf(\n    ylim = c(-1.3e+07, 2e+07), \n    datum = st_crs(\"EPSG:3857\"), \n    expand = FALSE\n    )"
  },
  {
    "objectID": "maps/projections/proj2/index.html#world-mollweide-esri-54009",
    "href": "maps/projections/proj2/index.html#world-mollweide-esri-54009",
    "title": "Maps and Projections 2",
    "section": "World Mollweide ESRI 54009",
    "text": "World Mollweide ESRI 54009\n\n\n\n\nCode\n# Get axis order\nst_axis_order()\n\n\n[1] TRUE\n\n\n\n\nCode\nworld_ne %>% \n  st_transform(\"ESRI:54009\") %>% \n  ggplot() +\n  geom_sf() +\n  coord_sf(\n    datum = st_crs(\"ESRI:54009\"),\n    expand = FALSE\n    ) +\n  labs(title = \"World Mollweide ESRI 54009\")"
  },
  {
    "objectID": "maps/projections/proj2/index.html#section",
    "href": "maps/projections/proj2/index.html#section",
    "title": "Maps and Projections 2",
    "section": "3035",
    "text": "3035\n\nEPSG:3035\nETRS89-extended / LAEA Europe\nScope: Statistical mapping at all scales and other purposes where true area representation is required.\nCoordinate system: Cartesian 2D CS. Axes: northing, easting (Y,X). Orientations: north, east. UoM: m."
  },
  {
    "objectID": "maps/projections/proj2/index.html#section-1",
    "href": "maps/projections/proj2/index.html#section-1",
    "title": "Maps and Projections 2",
    "section": "3035",
    "text": "3035\n\n\n\n\nCode\n# Get axis order\nst_axis_order()\n\n\n[1] TRUE\n\n\n\n\nCode\nworld_ne %>%\n  select(continent) %>% \n  st_transform(3035) %>% \n  ggplot() +\n  geom_sf(aes(fill = continent)) +\n  coord_sf(crs = 3035)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#is-longitude-latitude",
    "href": "maps/projections/proj2/index.html#is-longitude-latitude",
    "title": "Maps and Projections 2",
    "section": "3035 is longitude latitude",
    "text": "3035 is longitude latitude\n\nWGS 84 / Pseudo-Mercator\nThe importance of authority_compliant\n3035 is (latitude, longitude)\nour map is (longitude, latitude)\nif we insist to be authority_compliant, we will use longitude value for latitude\nand latitude value for longitude\nunless we swap axis order"
  },
  {
    "objectID": "maps/projections/proj2/index.html#is-longitude-latitude-1",
    "href": "maps/projections/proj2/index.html#is-longitude-latitude-1",
    "title": "Maps and Projections 2",
    "section": "3035 is longitude latitude",
    "text": "3035 is longitude latitude\n\nauthority_compliant = TRUE gives an untraditional map\n\n\n\n\n\n\nCode\nst_axis_order()\n\n\n[1] TRUE\n\n\n\n\nCode\n# Untraditional map\nst_axis_order(\n  authority_compliant = TRUE\n  )\nworld_ne %>%\n  st_transform(3035) %>%\n  ggplot() +\n  geom_sf(aes(fill = continent)) +\n  coord_sf(crs = 3035)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#is-longitude-latitude-solution-axisswap",
    "href": "maps/projections/proj2/index.html#is-longitude-latitude-solution-axisswap",
    "title": "Maps and Projections 2",
    "section": "3035 is longitude, latitude (solution: axisswap)",
    "text": "3035 is longitude, latitude (solution: axisswap)\n\nSwap axis by st_transform and pipeline argument.\n\n\n\n\n\n\nCode\n# First coordinate interprated as latitude, second as longitude\n# as specified by authorities. But in reality world_ne has longitude\n# as first coordinate and latitude as second (as normal for GIS software)\nst_axis_order(authority_compliant = TRUE)\nworld_ne %>%\n  st_transform(3035) %>%\n    st_transform(\n      # have to swap the axis, gives a warning\n    pipeline = \"+proj=pipeline +step +proj=axisswap +order=2,1\"\n    ) %>%\n  ggplot() +\n  geom_sf(aes(fill = continent)) +\n  coord_sf(crs = 3035)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#is-longitude-latitude-solution-ignore-authorities",
    "href": "maps/projections/proj2/index.html#is-longitude-latitude-solution-ignore-authorities",
    "title": "Maps and Projections 2",
    "section": "3035 is longitude, latitude (solution: ignore authorities)",
    "text": "3035 is longitude, latitude (solution: ignore authorities)\n\nIgnore authorities temporarily by setting authority_compliant = FALSE in st_axis_order().\nThen set it back to TRUE after generating map\n\n\n\n\n\n\nCode\n# First coordinate interprated as latitude, second as longitude\n# as specified by authorities. But in reality world_ne has longitude\n# as first coordinate and latitude as second (as normal for GIS software)\nst_axis_order(authority_compliant = FALSE)\nworld_ne_3035 <- world_ne %>%\n  st_transform(3035) %>%\n  ggplot() +\n  geom_sf(aes(fill = continent)) +\n  coord_sf(crs = 3035)\n\nst_axis_order(authority_compliant = TRUE)\n\n\n\n\n\n\n\n\nCode\n st_axis_order(authority_compliant = TRUE)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#conclusion-ggplot",
    "href": "maps/projections/proj2/index.html#conclusion-ggplot",
    "title": "Maps and Projections 2",
    "section": "Conclusion ggplot",
    "text": "Conclusion ggplot\n\nggplot() does not seem to respect authorities\nWhat about tmap , tm_shape, tm_fill etc.?"
  },
  {
    "objectID": "maps/projections/proj2/index.html#with-tmap",
    "href": "maps/projections/proj2/index.html#with-tmap",
    "title": "Maps and Projections 2",
    "section": "3035 with tmap",
    "text": "3035 with tmap\n\nAgain an untraditional map\n\n\n\n\n\n\nCode\nst_axis_order(\n  authority_compliant = TRUE\n  )\n\nworld_ne %>%\n  st_transform(3035) %>%\n  tm_shape() +\n  tm_fill()"
  },
  {
    "objectID": "maps/projections/proj2/index.html#with-tmap-swap-axis",
    "href": "maps/projections/proj2/index.html#with-tmap-swap-axis",
    "title": "Maps and Projections 2",
    "section": "3035 with tmap (swap axis)",
    "text": "3035 with tmap (swap axis)\n\nauthority_compliant = TRUE\nst_transform(pipeline = \"+proj=pipeline +step +proj=axisswap +order=2,1\")\n\n\n\n\n\n\nCode\nst_axis_order(authority_compliant = TRUE)\nworld_ne %>%\n  st_transform(3035) %>%\n  st_transform(\n    pipeline = \"+proj=pipeline +step +proj=axisswap +order=2,1\"\n    ) %>%\n  tm_shape() +\n  tm_fill()"
  },
  {
    "objectID": "maps/projections/proj2/index.html#with-tmap-ignore-authorities",
    "href": "maps/projections/proj2/index.html#with-tmap-ignore-authorities",
    "title": "Maps and Projections 2",
    "section": "3035 with tmap (ignore authorities)",
    "text": "3035 with tmap (ignore authorities)\n\nTemporarily ignore authorities\n\n\n\n\n\n\nCode\nst_axis_order(authority_compliant = FALSE)\nworld_ne %>%\n  st_transform(3035) %>%\n  tm_shape() +\n  tm_fill()\n\nst_axis_order(authority_compliant = TRUE)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#conclusion-1",
    "href": "maps/projections/proj2/index.html#conclusion-1",
    "title": "Maps and Projections 2",
    "section": "Conclusion",
    "text": "Conclusion\n\nplot() (i.e. plot.sf()) respects authorities\nWith tmap and ggplot we have to do\n\nst_transform(pipeline = \"+proj=pipeline +step +proj=axisswap +order=2,1\")\nor\nset st_axis_order(authority_compliant = FALSE) temporarily.\n\nNote that this might change when tmap and ggplot get updated."
  },
  {
    "objectID": "maps/projections/proj2/index.html#a-gardian-world-view--",
    "href": "maps/projections/proj2/index.html#a-gardian-world-view--",
    "title": "Maps and Projections 2",
    "section": "A Gardian world view ;-)",
    "text": "A Gardian world view ;-)\n\n\nCode\nworld_ne %>%\n  select(continent) %>%\n  # centre of map is Gard Haugesund\n  st_transform(\n    crs = \"+proj=laea +x_0=0 +y_0=0 +lon_0=5.265393 +lat_0=59.425333\"\n    ) %>% \n  plot(key.pos = 1)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#a-gardian-world-view---1",
    "href": "maps/projections/proj2/index.html#a-gardian-world-view---1",
    "title": "Maps and Projections 2",
    "section": "A Gardian world view ;-)",
    "text": "A Gardian world view ;-)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#projections-not-supporten-in-st_transpose",
    "href": "maps/projections/proj2/index.html#projections-not-supporten-in-st_transpose",
    "title": "Maps and Projections 2",
    "section": "Projections not supporten in st_transpose",
    "text": "Projections not supporten in st_transpose\n\nst_transform() uses GDAL lib\nlwgeom::st_transform_proj() uses PROJ API directly"
  },
  {
    "objectID": "maps/projections/proj2/index.html#winkel-tripel-with-st_transform_proj",
    "href": "maps/projections/proj2/index.html#winkel-tripel-with-st_transform_proj",
    "title": "Maps and Projections 2",
    "section": "Winkel tripel with st_transform_proj()",
    "text": "Winkel tripel with st_transform_proj()\n\nWinkel triple projection not supported by st_transform()\nWe have to use st_transform_proj() and do a little more work “by hand”\nThe following is inspired by wilkelab\nWe use our map from rnaturalearth. Wilke gets his map with getMap() from the rworldmap package\nWe follow the authorities and have to get the axis correct first"
  },
  {
    "objectID": "maps/projections/proj2/index.html#getting-the-axis-in-the-right-order",
    "href": "maps/projections/proj2/index.html#getting-the-axis-in-the-right-order",
    "title": "Maps and Projections 2",
    "section": "Getting the axis in the right order",
    "text": "Getting the axis in the right order\n\n\nCode\nst_axis_order(authority_compliant = TRUE)\nworld_ne <- ne_countries(scale = \"medium\", returnclass = \"sf\")  %>% \n  select(continent) \n\n\n\nDefine our projection, and transform our map to this projection\nIt seems that ne_countries() get the axis correct when we set authority_compliant = TRUE\naxisswap not required\n\n\n\n\nCode\ncrs_wintri <- \"+proj=wintri +datum=WGS84 +no_defs +over\"\nworld_wintri <- world_ne %>% \n#  st_transform(4326) %>%\n#  st_transform(pipeline =\"+proj=pipeline +step +proj=axisswap +order=2,1\") %>% \n  st_transform_proj(crs = crs_wintri)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#make-graticule",
    "href": "maps/projections/proj2/index.html#make-graticule",
    "title": "Maps and Projections 2",
    "section": "make graticule",
    "text": "make graticule\n\nSince we are using st_transform_proj() we have to make our own graticule and set the right projection on it (Winkel triple)\n\n\n\n\nCode\ngrat_wintri <- \n  st_graticule(lat = c(-89.9, seq(-80, 80, 20), 89.9)) %>%\n  st_transform_proj(crs = crs_wintri)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#plot-graticule",
    "href": "maps/projections/proj2/index.html#plot-graticule",
    "title": "Maps and Projections 2",
    "section": "plot graticule",
    "text": "plot graticule\n\n\n\n\nCode\ngrat_wintri %>% \n  ggplot() + \n  geom_sf(\n    color = \"gray30\", \n    size = 0.25/.pt\n    ) + \n  coord_sf(datum = NULL)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#first-shot-at-a-map",
    "href": "maps/projections/proj2/index.html#first-shot-at-a-map",
    "title": "Maps and Projections 2",
    "section": "First shot at a map",
    "text": "First shot at a map\n\n\n\n\nCode\n  ggplot() + \n  geom_sf(\n    data = grat_wintri, \n    color = \"gray30\", \n    size = 0.25/.pt) + \n  geom_sf(\n    data = world_wintri, \n    color = \"black\", \n    size = 0.5/.pt) +\n  coord_sf(datum = NULL)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#improve-map-with-blue-background",
    "href": "maps/projections/proj2/index.html#improve-map-with-blue-background",
    "title": "Maps and Projections 2",
    "section": "Improve map with blue background",
    "text": "Improve map with blue background\n\n\n\n\nCode\n# vectors of latitudes and longitudes \n# that go once around the \n# globe in 1-degree steps\nlats <- c(90:-90, -90:90, 90)\nlongs <- c(\n  rep(c(180, -180), each = 181), \n  180\n  )\n\n\n\n\nCode\n# turn into correctly projected sf collection\nwintri_outline <- \n  list(cbind(longs, lats)) %>%\n  st_polygon() %>%\n  st_sfc( # create sf geometry list column\n    crs = \"+proj=longlat +ellps=WGS84 \n    +datum=WGS84 +no_defs\"\n  ) %>% \n  st_sf() %>%\n  # transform to Winkel tripel\n  st_transform_proj(crs = crs_wintri) \n\n\n\n\nCode\nggplot() + \n  geom_sf(data = wintri_outline, \n          fill = \"#56B4E950\", \n          color = \"grey30\", \n          size = 0.5/.pt) +\n  coord_sf(datum = NULL)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#the-final-winkel-triple-map.-code",
    "href": "maps/projections/proj2/index.html#the-final-winkel-triple-map.-code",
    "title": "Maps and Projections 2",
    "section": "The final Winkel triple map. CODE",
    "text": "The final Winkel triple map. CODE\n\n\nCode\nggplot() + \n  geom_sf(data = wintri_outline, \n          fill = \"#56B4E950\", \n          color = \"grey30\", \n          size = 0.5/.pt) +\n  geom_sf(data = grat_wintri, color = \"gray30\", size = 0.25/.pt) + \n  geom_sf(data = world_wintri, \n          aes(fill = continent), \n          color = \"black\", \n          size = 0.5/.pt) +\n  coord_sf(datum = NULL)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#the-final-winkel-triple-map.-plot",
    "href": "maps/projections/proj2/index.html#the-final-winkel-triple-map.-plot",
    "title": "Maps and Projections 2",
    "section": "The final Winkel triple map. PLOT",
    "text": "The final Winkel triple map. PLOT"
  },
  {
    "objectID": "maps/projections/proj2/index.html#sp-versus-sf",
    "href": "maps/projections/proj2/index.html#sp-versus-sf",
    "title": "Maps and Projections 2",
    "section": "sp versus sf",
    "text": "sp versus sf\n\n\nsp\n\nLong history (2004-)\nMany packages in the sp* system (ca. 450)\nWorks with rgdal and rgeos\nUses S4 objects with slots\nQuite complex structure\nDoes not integrate very well with the Tidyverse (and other tools)\nDoes not implement Simple Features\n\n\nsf\n\n“The new sp”\nSupport Simple Features\nGeographical information in list column\nIntegrates nicely with the Tidyverse\nThe future for geographical information i R\nWork in progress (autumn 22: v 1.0-8)"
  },
  {
    "objectID": "maps/projections/proj2/index.html#what-is-simple-features",
    "href": "maps/projections/proj2/index.html#what-is-simple-features",
    "title": "Maps and Projections 2",
    "section": "What is Simple features?",
    "text": "What is Simple features?"
  },
  {
    "objectID": "maps/projections/proj2/index.html#references",
    "href": "maps/projections/proj2/index.html#references",
    "title": "Maps and Projections 2",
    "section": "References",
    "text": "References\n\n\nMSB205\n\n\n\nAppelhans, Tim, Florian Detsch, Christoph Reudenbach, and Stefan Woellauer. 2022. Mapview: Interactive Viewing of Spatial Data in r. https://github.com/r-spatial/mapview.\n\n\nBivand, Roger, Tim Keitt, and Barry Rowlingson. 2022. Rgdal: Bindings for the Geospatial Data Abstraction Library. https://CRAN.R-project.org/package=rgdal.\n\n\nBivand, Roger, Jakub Nowosad, and Robin Lovelace. 2021. spData: Datasets for Spatial Analysis. https://nowosad.github.io/spData/.\n\n\nBivand, Roger, and Colin Rundel. 2021. Rgeos: Interface to Geometry Engine - Open Source (GEOS). https://CRAN.R-project.org/package=rgeos.\n\n\nBrownrigg, Ray. 2021. Maps: Draw Geographical Maps. https://CRAN.R-project.org/package=maps.\n\n\nMcIlroy, Doug, Ray Brownrigg, Thomas P Minka, and Roger Bivand. 2022. Mapproj: Map Projections. https://CRAN.R-project.org/package=mapproj.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022a. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\n———. 2022b. Stars: Spatiotemporal Arrays, Raster and Vector Data Cubes. https://CRAN.R-project.org/package=stars.\n\n\nPebesma, Edzer, Thomas Mailund, and James Hiebert. 2016. “Measurement Units in R.” R Journal 8 (2): 486–94. https://doi.org/10.32614/RJ-2016-061.\n\n\nPebesma, Edzer, Thomas Mailund, Tomasz Kalinowski, and Iñaki Ucar. 2022. Units: Measurement Units for r Vectors. https://github.com/r-quantities/units/.\n\n\nSievert, Carson. 2020. Interactive Web-Based Data Visualization with r, Plotly, and Shiny. Chapman; Hall/CRC. https://plotly-r.com.\n\n\nSievert, Carson, Chris Parmer, Toby Hocking, Scott Chamberlain, Karthik Ram, Marianne Corvellec, and Pedro Despouy. 2021. Plotly: Create Interactive Web Graphics via Plotly.js. https://CRAN.R-project.org/package=plotly.\n\n\nSouth, Andy. 2017. Rnaturalearth: World Map Data from Natural Earth. https://github.com/ropenscilabs/rnaturalearth.\n\n\nTennekes, Martijn. 2018. “tmap: Thematic Maps in R.” Journal of Statistical Software 84 (6): 1–39. https://doi.org/10.18637/jss.v084.i06.\n\n\n———. 2022. Tmap: Thematic Maps. https://github.com/r-tmap/tmap.\n\n\nTeucher, Andy, and Kenton Russell. 2022. Rmapshaper: Client for Mapshaper for Geospatial Operations. https://github.com/ateucher/rmapshaper.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\n———. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2022. Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics. https://CRAN.R-project.org/package=ggplot2."
  },
  {
    "objectID": "maps/projections/proj1/index.html#our-first-map",
    "href": "maps/projections/proj1/index.html#our-first-map",
    "title": "Maps and Projections",
    "section": "Our first map",
    "text": "Our first map\n\n\n\n\nCode\nHgsdOgOmegn <- read_sf(\"HgsdOgOmegn.gpkg\")\nHgsdOgOmegn %>% \n  select(knavn) %>% \n  plot(graticule = TRUE, axes = TRUE, key.pos = 1)\n\n\n\n\n\n\n\nWe read in a map with read_sf(), select() the variable knavn and then plot() the map. Notice that plot() knows how to plot a map!\nWhen package sf is loaded there exists a function plot.sf() that knows how to plot maps. See ?plot.sf for details.\nThe generic plot() function calls the right function for the relevant kind of object.\nMapdata originally from geonorge"
  },
  {
    "objectID": "maps/projections/proj1/index.html#our-first-map-whole-slide",
    "href": "maps/projections/proj1/index.html#our-first-map-whole-slide",
    "title": "Maps and Projections",
    "section": "Our first map; whole slide",
    "text": "Our first map; whole slide"
  },
  {
    "objectID": "maps/projections/proj1/index.html#our-first-map-cont.-mapview",
    "href": "maps/projections/proj1/index.html#our-first-map-cont.-mapview",
    "title": "Maps and Projections",
    "section": "Our first map cont. (mapview)",
    "text": "Our first map cont. (mapview)\n\nSame map using mapview() (java script). From the package mapview. Nice for interactive use, perhaps not as well suited for print.\nSee ?mapview and section ## S4 method for signature ‘sf’ for details. Mapview() can also handle other kinds of map objects.\n\n\n\n\n\n\nCode\nHgsdOgOmegn %>% \n  select(knavn) %>% \n  mapview(\n    legend = TRUE,\n    col.regions = sf.colors,\n    alpha.regions = 0.2\n    )"
  },
  {
    "objectID": "maps/projections/proj1/index.html#our-first-map-cont.-mapview-whole-slide",
    "href": "maps/projections/proj1/index.html#our-first-map-cont.-mapview-whole-slide",
    "title": "Maps and Projections",
    "section": "Our first map cont. (mapview whole slide)",
    "text": "Our first map cont. (mapview whole slide)"
  },
  {
    "objectID": "maps/projections/proj1/index.html#vector-to-raster",
    "href": "maps/projections/proj1/index.html#vector-to-raster",
    "title": "Maps and Projections",
    "section": "Vector to raster",
    "text": "Vector to raster\n\n\n\n\nCode\nHgsdOgOmegn %>% \n  select(knavn) %>% \n  st_rasterize(dx = 0.001) %>% \n  plot(col=sf.colors(6), breaks = c(0:6))\n\n\n\n\n\n\n\nWe can easily convert from vector to raster (the reverse is more complicated).\nBitmap, pixels, an image.\nHgsdOgOmegn was in vector format (i.e. a drawing). Points, with lines drawn between the points, and a fill inside a closed polygon"
  },
  {
    "objectID": "maps/projections/proj1/index.html#vector-to-raster-cont.",
    "href": "maps/projections/proj1/index.html#vector-to-raster-cont.",
    "title": "Maps and Projections",
    "section": "Vector to raster cont.",
    "text": "Vector to raster cont."
  },
  {
    "objectID": "maps/projections/proj1/index.html#mapping-with-ggplot",
    "href": "maps/projections/proj1/index.html#mapping-with-ggplot",
    "title": "Maps and Projections",
    "section": "Mapping with ggplot",
    "text": "Mapping with ggplot\nWe know ggplot from before and it produces nice maps (although perhaps a bit slowly). Later we will also use the package. tmap\n\n\n\n\n\nCode\nHgsdOgOmegn %>% \n  ggplot() + \n  geom_sf(aes(fill = knavn))"
  },
  {
    "objectID": "maps/projections/proj1/index.html#mapping-with-ggplot-whole-slide",
    "href": "maps/projections/proj1/index.html#mapping-with-ggplot-whole-slide",
    "title": "Maps and Projections",
    "section": "Mapping with ggplot; whole slide",
    "text": "Mapping with ggplot; whole slide\n\n\nCode\nHgsdOgOmegn_ggplot"
  },
  {
    "objectID": "maps/projections/proj1/index.html#perhaps-to-much-detail",
    "href": "maps/projections/proj1/index.html#perhaps-to-much-detail",
    "title": "Maps and Projections",
    "section": "Perhaps to much detail?",
    "text": "Perhaps to much detail?\n\nWe can find the size of the object HgsdOgOmegn with round(object.size(HgsdOgOmegn) / 1024): 1028\nsf has st_simplify() with option preserveTopology = TRUE, HgsdOgOmegnSimp <- st_simplify(HgsdOgOmegn, preserveTopology = TRUE, dTolerance = 1000)\nst_simplify() preserves topology for each feature (polygon), but not between features (polygons).\nms_simplyfy() from the rmapshaper package preserves topology between features and is a better alternative."
  },
  {
    "objectID": "maps/projections/proj1/index.html#simplified-map",
    "href": "maps/projections/proj1/index.html#simplified-map",
    "title": "Maps and Projections",
    "section": "Simplified map",
    "text": "Simplified map\n\n\n\n\nCode\nHgsdOgOmegnSimp <- HgsdOgOmegn %>% \n  select(knavn) %>% \n  # keep_shapes = TRUE else we \n  # risk to loose islands\n  # keep 5% of the points\n  ms_simplify(\n    keep = 0.05, \n    keep_shapes = TRUE) \n\nHgsdOgOmegnSimp %>% \n  ggplot() + # Note + for ggplot\n  geom_sf(aes(fill = knavn))\n \nround(object.size(HgsdOgOmegn) / 1024)\nround(\n  object.size(HgsdOgOmegnSimp) / 1024\n  )\n\nHgsdOgOmegnSimp\n\n\n\n\n\n\n\n\n\nLooking better and much smaller\nSize HgsdOgOmegn: 1028\nSize HgsdOgOmegnSimp: 65"
  },
  {
    "objectID": "maps/projections/proj1/index.html#hgsdogomegnsimp-simplified-map-whole-slide",
    "href": "maps/projections/proj1/index.html#hgsdogomegnsimp-simplified-map-whole-slide",
    "title": "Maps and Projections",
    "section": "HgsdOgOmegnSimp; simplified map whole slide",
    "text": "HgsdOgOmegnSimp; simplified map whole slide"
  },
  {
    "objectID": "maps/projections/proj1/index.html#hgsdogomegn-not-simplified-whole-slide",
    "href": "maps/projections/proj1/index.html#hgsdogomegn-not-simplified-whole-slide",
    "title": "Maps and Projections",
    "section": "HgsdOgOmegn, not simplified whole slide",
    "text": "HgsdOgOmegn, not simplified whole slide"
  },
  {
    "objectID": "maps/projections/proj1/index.html#the-problem-with-projections",
    "href": "maps/projections/proj1/index.html#the-problem-with-projections",
    "title": "Maps and Projections",
    "section": "The problem with projections",
    "text": "The problem with projections\nProjections illustrated"
  },
  {
    "objectID": "maps/projections/proj1/index.html#geographical-coordinates",
    "href": "maps/projections/proj1/index.html#geographical-coordinates",
    "title": "Maps and Projections",
    "section": "Geographical coordinates",
    "text": "Geographical coordinates\n\nHaugesund (wikipedia.org): 59°24′37″N 5°16′32″Ø?\n\nShows the position of Haugesund on the globe, in degrees, minutes and seconds\nNorth of what?\n\nThe first degree is latitude, measured north (N) from equator\n\nEast of what?\n\nThe second degree is longitude, east (E) from the zero meridian (through Greenwich, just east of London).\n\n\nThis is degrees, minutes and seconds. The map uses decimal degrees.\n\nTo get to decimals we have to find the total sum of seconds in minutes and seconds an divide by \\(60 · 60 = 3600\\).\nExample: \\((24 · 60 + 37)/3600 = 0.4103\\), e.s. 24´37´´ is 0.4103 degrees."
  },
  {
    "objectID": "maps/projections/proj1/index.html#geographical-coordinates-cont.",
    "href": "maps/projections/proj1/index.html#geographical-coordinates-cont.",
    "title": "Maps and Projections",
    "section": "Geographical coordinates cont.",
    "text": "Geographical coordinates cont.\n\nOld idea traceable back to Eratosthenes of Cyrene (276 - 194 BC), Hipparchus of Nicaea (190 - 120 BC), Marinus of Tyre (70 - 130 AD) and finally Claudius Ptolemy (100-170 AD) Geographia. Geographia survived in arabic translation and was translated into Latin 1406 (Geographia Claudii Ptolemaei).\nThe position is given in the format geographers prefer, (latitude, longitude)\nProgrammers/data scientist went for (x,y), hence (longitude, latitude)\nStill the source of much confusion\nNote that geographical coordinates on paper or screen are also a kind of projection. (Think of a photo of a globe)\nNote that the axis have coordinates in decimal degrees (not minutes and seconds)"
  },
  {
    "objectID": "maps/projections/proj1/index.html#ptolemy-world-map",
    "href": "maps/projections/proj1/index.html#ptolemy-world-map",
    "title": "Maps and Projections",
    "section": "Ptolemy world map",
    "text": "Ptolemy world map\n\nPtolemy World Map"
  },
  {
    "objectID": "maps/projections/proj1/index.html#maps-in-europe-between-ptolemy-and-the-renaissance",
    "href": "maps/projections/proj1/index.html#maps-in-europe-between-ptolemy-and-the-renaissance",
    "title": "Maps and Projections",
    "section": "Maps in Europe between Ptolemy and the Renaissance?",
    "text": "Maps in Europe between Ptolemy and the Renaissance?\n\n\n\nT and O maps\nJerusalem centre, Asia up, Europe lower left, Africa lower right\nHereford mappa mundi, ca. 1300 (from wikipedi.org)\n\n\n\n\n\nHereford Mappa Mundi"
  },
  {
    "objectID": "maps/projections/proj1/index.html#haugesund",
    "href": "maps/projections/proj1/index.html#haugesund",
    "title": "Maps and Projections",
    "section": "Haugesund",
    "text": "Haugesund\nHaugesund (wikipedia.org): 59°24′37″N 5°16′32″Ø\n\n\n\n\nCode\nHgsdOgOmegn %>% \n  filter(knavn == 'Haugesund') %>% \n  ggplot() + \n  geom_sf(aes(fill = knavn)) +\n  geom_point(aes(x = 5.275, y = 59.410))\n\n\n\n\nCode\n# eastings\n# covert minutes and \n# seconds to decimal degree\n(24*60 + 37)/(60*60)\n\n\n[1] 0.4102778\n\n\n\n\nCode\n# northings\n# covert minutes and \n# seconds to decimal degree\n(16*60 + 32)/(60*60)\n\n\n[1] 0.2755556"
  },
  {
    "objectID": "maps/projections/proj1/index.html#what-is-inside-hgsdogomegnsimp",
    "href": "maps/projections/proj1/index.html#what-is-inside-hgsdogomegnsimp",
    "title": "Maps and Projections",
    "section": "What is “inside” HgsdOgOmegnSimp?",
    "text": "What is “inside” HgsdOgOmegnSimp?\n\n\nCode\nHgsdOgOmegnSimp\n\n\nSimple feature collection with 6 features and 1 field\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 5.027724 ymin: 59.12904 xmax: 6.183812 ymax: 59.73402\nGeodetic CRS:  WGS 84\n# A tibble: 6 × 2\n  knavn                                                                     geom\n* <chr>                                                       <MULTIPOLYGON [°]>\n1 Haugesund  (((5.298076 59.38375, 5.297569 59.38622, 5.293583 59.38909, 5.2852…\n2 Bokn       (((5.550268 59.23159, 5.548568 59.23226, 5.548663 59.23687, 5.5532…\n3 Tysvær     (((5.368987 59.41135, 5.368762 59.41401, 5.366484 59.41615, 5.3636…\n4 Karmøy     (((5.298076 59.38375, 5.302871 59.38411, 5.318012 59.38774, 5.3312…\n5 Vindafjord (((5.703788 59.40877, 5.686429 59.42079, 5.698274 59.43178, 5.6988…\n6 Sveio      (((5.458214 59.49808, 5.453694 59.49768, 5.434089 59.49742, 5.4310…"
  },
  {
    "objectID": "maps/projections/proj1/index.html#what-is-inside-hgsdogomegnsimp-cont.",
    "href": "maps/projections/proj1/index.html#what-is-inside-hgsdogomegnsimp-cont.",
    "title": "Maps and Projections",
    "section": "What is “inside” HgsdOgOmegnSimp? cont.",
    "text": "What is “inside” HgsdOgOmegnSimp? cont.\n\nThat was quite clean\nUtilises the new list-column technique\nThe geographical information is in the last column\nThe geom column is persistent, we have to actively delete it\nWe drop the geometry with st_set_geometyr(NULL) or st_drop_geometry. Then we will be left with a plain tibble/dataframe."
  },
  {
    "objectID": "maps/projections/proj1/index.html#what-is-wgs84",
    "href": "maps/projections/proj1/index.html#what-is-wgs84",
    "title": "Maps and Projections",
    "section": "What is WGS84?",
    "text": "What is WGS84?\n\nEPSG:4326 WGS 84 – WGS84 - World Geodetic System 1984\nModel of the whole planet, used with GPS\ngeographical coordinates (eastings, northings etc.)\n\n“71° Nord” TV-program\n\n\n\nFrom wikipidia.org:\n\nThe World Geodetic System (WGS) is a standard for use in cartography, geodesy, and satellite navigation including GPS. This standard includes the definition of the coordinate system’s fundamental and derived constants, the ellipsoidal (normal) Earth Gravitational Model (EGM), a description of the associated World Magnetic Model (WMM), and a current list of local datum transformations."
  },
  {
    "objectID": "maps/projections/proj1/index.html#what-is-multipolygon",
    "href": "maps/projections/proj1/index.html#what-is-multipolygon",
    "title": "Maps and Projections",
    "section": "What is MULTIPOLYGON?",
    "text": "What is MULTIPOLYGON?\n\nMULTIPOLYGON is an example of a simple feature\n\n\n\nSimple Features (officially Simple Feature Access) is a set of standards that specify a common storage and access model of geographic feature made of mostly two-dimensional geometries (point, line, polygon, multi-point, multi-line, etc.) used by geographic information systems. It is formalized by both the Open Geospatial Consortium (OGC) and the International Organization for Standardization (ISO). (wikipedia.org)\n\n\nsimple: A 2D geometry is simple if it contains no self-intersection\nSupported by sf, not by sp, postgis (PostgreSQL extension), SpatiaLite (SQLite extension), GDAL etc.\nThe Simple features standard did not exist when sp was designed."
  },
  {
    "objectID": "maps/projections/proj1/index.html#simple-features",
    "href": "maps/projections/proj1/index.html#simple-features",
    "title": "Maps and Projections",
    "section": "Simple Features",
    "text": "Simple Features\n\nSimple feature (fig. 2.2 Lovelace et. al.)"
  },
  {
    "objectID": "maps/projections/proj1/index.html#hgsdogomegnsimp-as-spatialpolygonsdataframe",
    "href": "maps/projections/proj1/index.html#hgsdogomegnsimp-as-spatialpolygonsdataframe",
    "title": "Maps and Projections",
    "section": "HgsdOgOmegnSimp as SpatialPolygonsDataframe",
    "text": "HgsdOgOmegnSimp as SpatialPolygonsDataframe\n\n\nCode\nHgsdOgOmegnSimp_sp <- HgsdOgOmegnSimp %>% \n  as_Spatial()"
  },
  {
    "objectID": "maps/projections/proj1/index.html#from-environment-tab",
    "href": "maps/projections/proj1/index.html#from-environment-tab",
    "title": "Maps and Projections",
    "section": "From environment tab",
    "text": "From environment tab\n\nStructure sp-object..\nThis is just the top"
  },
  {
    "objectID": "maps/projections/proj1/index.html#references",
    "href": "maps/projections/proj1/index.html#references",
    "title": "Maps and Projections",
    "section": "References",
    "text": "References\n\n\n\n\n\nMSB205\n\n\n\nAppelhans, Tim, Florian Detsch, Christoph Reudenbach, and Stefan Woellauer. 2022. Mapview: Interactive Viewing of Spatial Data in r. https://github.com/r-spatial/mapview.\n\n\nBivand, Roger, Tim Keitt, and Barry Rowlingson. 2022. Rgdal: Bindings for the Geospatial Data Abstraction Library. https://CRAN.R-project.org/package=rgdal.\n\n\nBivand, Roger, Jakub Nowosad, and Robin Lovelace. 2021. spData: Datasets for Spatial Analysis. https://nowosad.github.io/spData/.\n\n\nBivand, Roger, and Colin Rundel. 2021. Rgeos: Interface to Geometry Engine - Open Source (GEOS). https://CRAN.R-project.org/package=rgeos.\n\n\nBrownrigg, Ray. 2021. Maps: Draw Geographical Maps. https://CRAN.R-project.org/package=maps.\n\n\nMcIlroy, Doug, Ray Brownrigg, Thomas P Minka, and Roger Bivand. 2022. Mapproj: Map Projections. https://CRAN.R-project.org/package=mapproj.\n\n\nMcLean, Mathew W. 2020. RefManageR: Straightforward BibTeX and BibLaTeX Bibliography Management. https://github.com/ropensci/RefManageR/.\n\n\nMcLean, Mathew William. 2014. Straightforward Bibliography Management in r Using the RefManager Package. https://arxiv.org/abs/1403.2036.\n\n\n———. 2017. “RefManageR: Import and Manage BibTeX and BibLaTeX References in r.” The Journal of Open Source Software. https://doi.org/10.21105/joss.00338.\n\n\nNowosad, Jakub, and Robin Lovelace. 2022. spDataLarge: Large Datasets for Spatial Analysis. https://github.com/Nowosad/spData.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022a. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\n———. 2022b. Stars: Spatiotemporal Arrays, Raster and Vector Data Cubes. https://CRAN.R-project.org/package=stars.\n\n\nPebesma, Edzer, Thomas Mailund, and James Hiebert. 2016. “Measurement Units in R.” R Journal 8 (2): 486–94. https://doi.org/10.32614/RJ-2016-061.\n\n\nPebesma, Edzer, Thomas Mailund, Tomasz Kalinowski, and Iñaki Ucar. 2022. Units: Measurement Units for r Vectors. https://github.com/r-quantities/units/.\n\n\nSievert, Carson. 2020. Interactive Web-Based Data Visualization with r, Plotly, and Shiny. Chapman; Hall/CRC. https://plotly-r.com.\n\n\nSievert, Carson, Chris Parmer, Toby Hocking, Scott Chamberlain, Karthik Ram, Marianne Corvellec, and Pedro Despouy. 2021. Plotly: Create Interactive Web Graphics via Plotly.js. https://CRAN.R-project.org/package=plotly.\n\n\nSouth, Andy. 2017. Rnaturalearth: World Map Data from Natural Earth. https://github.com/ropenscilabs/rnaturalearth.\n\n\n———. 2022. Rnaturalearthhires: High Resolution World Vector Map Data from Natural Earth Used in Rnaturalearth.\n\n\nTennekes, Martijn. 2018. “tmap: Thematic Maps in R.” Journal of Statistical Software 84 (6): 1–39. https://doi.org/10.18637/jss.v084.i06.\n\n\n———. 2022. Tmap: Thematic Maps. https://github.com/r-tmap/tmap.\n\n\nTeucher, Andy, and Kenton Russell. 2022. Rmapshaper: Client for Mapshaper for Geospatial Operations. https://github.com/ateucher/rmapshaper.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\n———. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2022. Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics. https://CRAN.R-project.org/package=ggplot2."
  },
  {
    "objectID": "maps/process/index.html#recommended-process",
    "href": "maps/process/index.html#recommended-process",
    "title": "Recommended process",
    "section": "Recommended Process",
    "text": "Recommended Process\n\nDo your data wrangling in R using the Tidyverse\nPrepare your map\n\nIn Qgis\nIn R using sf/sp\n\nAnalysis\n\nWrite a reproducible document in Rmarkdown\n\nRStudio 2022.07.1+554 “Spotted Wakerobin” GUI-like interface\nQuarto Document/Presentation\nZotero 6/Better BibTeX integrated"
  },
  {
    "objectID": "maps/process/index.html#do-your-data-wrangling-in-r-using-the-tidyverse",
    "href": "maps/process/index.html#do-your-data-wrangling-in-r-using-the-tidyverse",
    "title": "Recommended process",
    "section": "Do your data wrangling in R using the Tidyverse",
    "text": "Do your data wrangling in R using the Tidyverse\n\nUse a subdirectory relative to where your main document will reside to contain your data wrangling scripts\nIf you read in raw data from files, use a subdirectory (“raw_data”) of the data directory to house your raw data files.\nIf you read in the data directly via an api there is no need for a “raw_data” subdirectory\nUse a Quarto Document to document the data wrangling and make it reproducible. Place this Quarto Document in your Data directory.\n\nRead in the raw data at the top\nDo your wrangling to Tidy data\nPrepare an id to later link the data to a map (house id, “kommunenummer”, “grunnkretsnummer” etc.)\nSave out your data in .Rdata and .csv (robust against time decay) formats.\n\nImportant to get the dataset finished (as far as possible). Will save us a huge amount of time and work."
  },
  {
    "objectID": "maps/process/index.html#do-your-data-wrangling-in-r-using-the-tidyverse-cont.",
    "href": "maps/process/index.html#do-your-data-wrangling-in-r-using-the-tidyverse-cont.",
    "title": "Recommended process",
    "section": "Do your data wrangling in R using the Tidyverse, cont.",
    "text": "Do your data wrangling in R using the Tidyverse, cont.\n\nCheck that the variables have the intended format, date, factor, character, numeric etc.\nNote the format/class of every variable so that you can read the data correctly back into R (.csv files do not have information about the format of the variables. You have to specify it when you read the data back into R). If you use a .Rdata file R will know the type of each variable.\nIn short: Make your raw data Tidy in a reproducible manner!"
  },
  {
    "objectID": "maps/process/index.html#prepare-your-map-map-wrangling",
    "href": "maps/process/index.html#prepare-your-map-map-wrangling",
    "title": "Recommended process",
    "section": "Prepare your map (map wrangling)",
    "text": "Prepare your map (map wrangling)\n\nUse a new Quarto Document to document the preparations done to your map and the merging of data to the map.\nUse a subdirectory “maps” to do your map wrangling.\nDocument the source of your map, either from file or downloaded from an internet site\nDepending on the map it might be advantageous to load it into a GIS program, i.e. Qgis.\nQgis will give you a multi layer GIS system with a GUI. The advantage is an intuitive and interactive environment. The drawback is a low level of reproducibility (work done in a GUI is notoriously difficult to make reproducible)\nAn alternative is to use Qgis to experiment with the map and then try to do the same reproducibly in R with the tools discussed below"
  },
  {
    "objectID": "maps/process/index.html#prepare-your-map-map-wrangling-cont.",
    "href": "maps/process/index.html#prepare-your-map-map-wrangling-cont.",
    "title": "Recommended process",
    "section": "Prepare your map (map wrangling) cont.",
    "text": "Prepare your map (map wrangling) cont.\n\nStart by filter your map to the wanted area\nFix any topological problems (this can be a real hassle)\nCheck (and double check) that the ids in the map correspond with the ones in your dataset.\nMerge your dataset to the “features” (points, lines or polygons) in your map. In Qgis or preferably in R.\n\nuse sf (not sp) as far as possible\n\n\n“Shifting to new visualization packages like tmap, cartography  and mapview should also be relativel yeasy, and use of  sf and the new visualization packages should certainly become standard for new research and teaching.” (R. S. Bivand 2021)\n\n\n\nCheck, and double check, that the map and data is as intended."
  },
  {
    "objectID": "maps/process/index.html#prepare-your-map-map-wrangling-cont.-1",
    "href": "maps/process/index.html#prepare-your-map-map-wrangling-cont.-1",
    "title": "Recommended process",
    "section": "Prepare your map (map wrangling) cont.",
    "text": "Prepare your map (map wrangling) cont.\n\nSave the map in the format “GeoPackage”, the “shape” format is ancient, inconvenient (3-5 separate files) and have several technical restrictions (10 char variable names, only proj4 support etc.) (“Shapefile Must Die!” n.d.)\n\n\n\n\n\nJust say no to shape files."
  },
  {
    "objectID": "maps/process/index.html#the-analysis",
    "href": "maps/process/index.html#the-analysis",
    "title": "Recommended process",
    "section": "The analysis",
    "text": "The analysis\n\nRead your map with the dataset into your main document\nGenerate the weights matrix in R (then import to GeoDa) or make it in GeoDa\nStart with an Exploratory Data Analysis (EDA) in GeoDa\nDo descriptive statistics in R\nTest for local/global spatial autocorrelation i.e. global/local Morans I in your dependent variable."
  },
  {
    "objectID": "maps/process/index.html#the-analysis-1",
    "href": "maps/process/index.html#the-analysis-1",
    "title": "Recommended process",
    "section": "The analysis",
    "text": "The analysis\n\nIf no spatial autocorrelation, do normal linear regression (or whatever)\nIf spatial autocorrelation present.\n\nEstimate initial linear model\n\nCheck for spatial effects in residuals\nOur linear model might (not likely) be so good that no spatial effects left in the residuals. If this is the case keep the plain linear model.\n\n\nIf there is spatial effects in residuals. We have to account for this.\nUse sf/sp and test models\nDo we have a local or global phenomenon? (James P. LeSage 2014)\n\nLocal: Start with SDEM and test against nested models with likelihood ratio tests\nGlobal: Start with SDM and test against nested models with likelihood ratio tests\n\nThoroughly test your final spatial regression model.\n\nHeteroscedasticity, normality residuals etc."
  },
  {
    "objectID": "maps/process/index.html#maps-for-analysisillustration",
    "href": "maps/process/index.html#maps-for-analysisillustration",
    "title": "Recommended process",
    "section": "Maps for analysis/illustration",
    "text": "Maps for analysis/illustration\n\nMaps for analysis often quite terse and contains little geographical information\nShould make better/more informative maps for illustrations\nMake your illustrative maps with tmap or ggplot2 in R"
  },
  {
    "objectID": "maps/process/index.html#what-we-have-to-learn",
    "href": "maps/process/index.html#what-we-have-to-learn",
    "title": "Recommended process",
    "section": "What we have to learn",
    "text": "What we have to learn\n\nShort refresh Tidyverse\nHow to handle maps\n\nHow to get them\nHow to get them into our software\nHow to edit/manipulate them\nHow to link maps and data\n\nHow to generate neighbour structures"
  },
  {
    "objectID": "maps/process/index.html#what-we-have-to-learn-cont.",
    "href": "maps/process/index.html#what-we-have-to-learn-cont.",
    "title": "Recommended process",
    "section": "What we have to learn cont.",
    "text": "What we have to learn cont.\n\nHow to make weight matrices\nHow to run spatial regressions\nHow to do EDA with spatial data"
  },
  {
    "objectID": "maps/process/index.html#before-all-else",
    "href": "maps/process/index.html#before-all-else",
    "title": "Recommended process",
    "section": "Before all else",
    "text": "Before all else\n\nUpdate R\nUpdate R Studio\nInstall the packages we will need\nInstall GeoDa\nInstall/update Qgis\nUpdate Zotero"
  },
  {
    "objectID": "maps/process/index.html#references",
    "href": "maps/process/index.html#references",
    "title": "Recommended process",
    "section": "References",
    "text": "References\n\n\nMSB205\n\n\n\nAppelhans, Tim, Florian Detsch, Christoph Reudenbach, and Stefan Woellauer. 2022. Mapview: Interactive Viewing of Spatial Data in r. https://github.com/r-spatial/mapview.\n\n\nBivand, Roger S. 2021. “Progress in the R Ecosystem for Representing and Handling Spatial Data.” Journal of Geographical Systems 23 (4): 515–46. https://doi.org/10.1007/s10109-020-00336-0.\n\n\nBivand, Roger, Tim Keitt, and Barry Rowlingson. 2022. Rgdal: Bindings for the Geospatial Data Abstraction Library. https://CRAN.R-project.org/package=rgdal.\n\n\nBivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. “A Review of Software for Spatial Econometrics in R.” Mathematics 9 (11): 1276. https://doi.org/10.3390/math9111276.\n\n\nBivand, Roger, Jakub Nowosad, and Robin Lovelace. 2021. spData: Datasets for Spatial Analysis. https://nowosad.github.io/spData/.\n\n\nBivand, Roger, and Colin Rundel. 2021. Rgeos: Interface to Geometry Engine - Open Source (GEOS). https://CRAN.R-project.org/package=rgeos.\n\n\nBrownrigg, Ray. 2021. Maps: Draw Geographical Maps. https://CRAN.R-project.org/package=maps.\n\n\nLeSage, James P. n.d. “What Regional Scientists Need to Know about Spatial Econometrics,” 31.\n\n\nLeSage, James P. 2014. “What Regional Scientists Need to Know About Spatial Econometrics.” {{SSRN}} Scholarly Paper ID 2420725. Rochester, NY: Social Science Research Network. https://doi.org/10.2139/ssrn.2420725.\n\n\nMcIlroy, Doug, Ray Brownrigg, Thomas P Minka, and Roger Bivand. 2022. Mapproj: Map Projections. https://CRAN.R-project.org/package=mapproj.\n\n\nMcLean, Mathew W. 2020. RefManageR: Straightforward BibTeX and BibLaTeX Bibliography Management. https://github.com/ropensci/RefManageR/.\n\n\nMcLean, Mathew William. 2014. Straightforward Bibliography Management in r Using the RefManager Package. https://arxiv.org/abs/1403.2036.\n\n\n———. 2017. “RefManageR: Import and Manage BibTeX and BibLaTeX References in r.” The Journal of Open Source Software. https://doi.org/10.21105/joss.00338.\n\n\nNowosad, Jakub, and Robin Lovelace. 2022. spDataLarge: Large Datasets for Spatial Analysis. https://github.com/Nowosad/spData.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022a. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\n———. 2022b. Stars: Spatiotemporal Arrays, Raster and Vector Data Cubes. https://CRAN.R-project.org/package=stars.\n\n\n“Shapefile Must Die!” n.d. http://switchfromshapefile.org/.\n\n\nSievert, Carson. 2020. Interactive Web-Based Data Visualization with r, Plotly, and Shiny. Chapman; Hall/CRC. https://plotly-r.com.\n\n\nSievert, Carson, Chris Parmer, Toby Hocking, Scott Chamberlain, Karthik Ram, Marianne Corvellec, and Pedro Despouy. 2021. Plotly: Create Interactive Web Graphics via Plotly.js. https://CRAN.R-project.org/package=plotly.\n\n\nSouth, Andy. 2017. Rnaturalearth: World Map Data from Natural Earth. https://github.com/ropenscilabs/rnaturalearth.\n\n\n———. 2022. Rnaturalearthhires: High Resolution World Vector Map Data from Natural Earth Used in Rnaturalearth.\n\n\nTennekes, Martijn. 2018. “tmap: Thematic Maps in R.” Journal of Statistical Software 84 (6): 1–39. https://doi.org/10.18637/jss.v084.i06.\n\n\n———. 2022. Tmap: Thematic Maps. https://github.com/r-tmap/tmap.\n\n\nTeucher, Andy, and Kenton Russell. 2022. Rmapshaper: Client for Mapshaper for Geospatial Operations. https://github.com/ateucher/rmapshaper.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\n———. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2022. Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics. https://CRAN.R-project.org/package=ggplot2."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#loading-packages",
    "href": "spatmetrics/LucasCounty/index.html#loading-packages",
    "title": "Spatial Hedonic Model",
    "section": "Loading packages",
    "text": "Loading packages\n\n\nCode\n# To install urbnmapr from github\ndevtools::install_github(\"UrbanInstitute/urbnmapr\")\n\n\n\n\nCode\n# for demean\nsuppressPackageStartupMessages({\nlibrary(Jmisc)\nlibrary(sf)\nlibrary(urbnmapr)\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(sp)\nlibrary(spdep)\nlibrary(spatialreg)\nlibrary(spData)\nlibrary(huxtable)\nlibrary(knitr)\n})\n# Options\noptions(scipen = 7)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#read-in-data",
    "href": "spatmetrics/LucasCounty/index.html#read-in-data",
    "title": "Spatial Hedonic Model",
    "section": "Read in data",
    "text": "Read in data\n\n\nCode\ndata(house)\n#head(house, n=10)\nhouse_sf <- st_as_sf(house)\n#head(house_sf, n=10)\ndim(house_sf)\n\n\n[1] 25357    25\n\n\nCode\nset.seed(42)# What else could it be?\nred_house_sf <- house_sf[sample(1:dim(house_sf)[1], size = 3000), ]"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#quick-check-of-data",
    "href": "spatmetrics/LucasCounty/index.html#quick-check-of-data",
    "title": "Spatial Hedonic Model",
    "section": "Quick check of data",
    "text": "Quick check of data\n\n\nCode\nplot(house_sf[\"price\"], cex = 0.01, pch = 20)\n\n\n\n\n\nCode\ndim(red_house_sf)\n\n\n[1] 3000   25"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#dataset-info-r-help",
    "href": "spatmetrics/LucasCounty/index.html#dataset-info-r-help",
    "title": "Spatial Hedonic Model",
    "section": "Dataset info (R help)",
    "text": "Dataset info (R help)\nData on 25,357 single family homes sold in Lucas County, Ohio, 1993-1998 from the county auditor.\nFormal class ‘SpatialPointsDataFrame’ [package “sp”] with 5 slots. The data slot is a data frame with 25357 observations on the following 24 variables.\n\nprice\n\na numeric vector\n\nyrbuilt\n\na numeric vector\n\nstories\n\na factor with levels one bilevel multilvl one+half two two+half three\n\nTLA\n\na numeric vector"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-1",
    "href": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-1",
    "title": "Spatial Hedonic Model",
    "section": "Dataset info (R help)",
    "text": "Dataset info (R help)\n\nwall\n\na factor with levels stucdrvt ccbtile metlvnyl brick stone wood partbrk\n\nbeds\n\na numeric vector\n\nbaths\n\na numeric vector\n\nhalfbaths\n\na numeric vector\n\nfrontage\n\na numeric vector\n\ndepth\n\na numeric vector"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-2",
    "href": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-2",
    "title": "Spatial Hedonic Model",
    "section": "Dataset info (R help)",
    "text": "Dataset info (R help)\n\ngarage\n\na factor with levels no garage basement attached detached carport\n\ngaragesqft\n\na numeric vector\n\nrooms\n\na numeric vector\n\nlotsize\n\na numeric vector\n\nsdate\n\na numeric vector\n\navalue\n\na numeric vector"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-3",
    "href": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-3",
    "title": "Spatial Hedonic Model",
    "section": "Dataset info (R help)",
    "text": "Dataset info (R help)\n\ns1993 to s1998\n\na numeric vector\n\nsyear\n\na factor with levels 1993 1994 1995 1996 1997 1998\n\nage\n\na numeric vector"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#convert-from-spatialpointsdataframe-to-sf",
    "href": "spatmetrics/LucasCounty/index.html#convert-from-spatialpointsdataframe-to-sf",
    "title": "Spatial Hedonic Model",
    "section": "Convert from SpatialPointsDataFrame to sf",
    "text": "Convert from SpatialPointsDataFrame to sf\nWe convert from SpatialPointsDataFrame to sf (simple feature, point).\n\n\nCode\nhist(100*house_sf$age, breaks = 30)\n\n\n\n\n\nCode\nsummary(100*house_sf$age)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   1.00   35.00   49.00   53.66   75.00  164.00 \n\n\n\n\nCode\nmy_age <- as.numeric(levels(house_sf$syear))[as.integer(house_sf$syear)] - house_sf$yrbuilt\nmy_age <- my_age + 3\nmy_age1 <- 1999 - house_sf$yrbuilt\nsummary(100*house_sf$age - my_age)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n-2.0000 -1.0000  0.0000  0.2981  2.0000  3.0000 \n\n\nCode\nhist(my_age1, breaks = 30)\n\n\n\n\n\nCode\nsummary(my_age1)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   1.00   35.00   49.00   53.66   75.00  164.00 \n\n\nCode\ntable(round(my_age1, 3) == round(100*house_sf$age, 3))\n\n\n\n TRUE \n25357"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#changing-the-age-variable",
    "href": "spatmetrics/LucasCounty/index.html#changing-the-age-variable",
    "title": "Spatial Hedonic Model",
    "section": "Changing the age variable",
    "text": "Changing the age variable\nOk, the age variable is the age of the house 1999 (not when sold), divided by 100. The age of the house when sold seems to be a more reasonable variable.\n\n\nCode\n# Trying to follow Bivand 2011, NHH Discussion Paper\n# age seems to include strange values. Turns out to be age in 1999 divided by 100\n# We calculate age at time of sale as age_sold = syear - yrbuilt\n# syear is factor, convert to numeric\nred_house_sf$age_sold <- as.numeric(levels(red_house_sf$syear))[as.integer(red_house_sf$syear)] - red_house_sf$yrbuilt\n# Scale age_sold by dividing by 100\nred_house_sf$age_sold <- red_house_sf$age_sold/100"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#running-the-first-model",
    "href": "spatmetrics/LucasCounty/index.html#running-the-first-model",
    "title": "Spatial Hedonic Model",
    "section": "Running the first model",
    "text": "Running the first model\n\n\nCode\n# define the model\nhmod1 <- \"I(log(price)) ~ I(age_sold) + I(age_sold^2) + \nI(age_sold^3) + I(log(TLA)) + I(log(lotsize)) + rooms + beds + syear\"\n\n\n\n\nCode\n# put result in lm1\nlm1 <- lm(hmod1, data = red_house_sf)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#generate-neighbour-structure",
    "href": "spatmetrics/LucasCounty/index.html#generate-neighbour-structure",
    "title": "Spatial Hedonic Model",
    "section": "Generate neighbour structure",
    "text": "Generate neighbour structure\nFind 5 nearest, make neighbour list and finally convert the neighbour list to a row standardised weight matrix.\n\n\nCode\nred_house_sf_mat_nb <- knearneigh(red_house_sf, k = 5)\nred_house_sf_nb <- knn2nb(red_house_sf_mat_nb)\nred_house_sf_w <- nb2listw(red_house_sf_nb, style = \"W\")\n\n\nPlot the price of a house against the mean price of its (5 nearest) neighbours. There seems to be a positive spatial association"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#moran-plot",
    "href": "spatmetrics/LucasCounty/index.html#moran-plot",
    "title": "Spatial Hedonic Model",
    "section": "Moran Plot",
    "text": "Moran Plot\n\n\nCode\nmoran.plot(log(red_house_sf$price), listw = red_house_sf_w, labels = FALSE, pch = 20, cex=0.3)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#approximate-profile-likelihood-estimator-aple",
    "href": "spatmetrics/LucasCounty/index.html#approximate-profile-likelihood-estimator-aple",
    "title": "Spatial Hedonic Model",
    "section": "Approximate profile-likelihood estimator (APLE)",
    "text": "Approximate profile-likelihood estimator (APLE)\nApproximate profile-likelihood estimator (APLE), see (OnestepEstimationSpatial?)\n\n\nCode\n# Calculate APLE for the variables\nred_house_sf %>% \n  select(price, age_sold, TLA, lotsize, rooms, beds) %>% \n  st_set_geometry(., NULL) %>% \n  demean() %>% \n  as_tibble() %>% \n  map(aple,listw = red_house_sf_w)\n\n\n$price\n[1] 0.7672068\n\n$age_sold\n[1] 0.7658228\n\n$TLA\n[1] 0.7120571\n\n$lotsize\n[1] 0.5974422\n\n$rooms\n[1] 0.5652239\n\n$beds\n[1] 0.4316318"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#conclusion-aple",
    "href": "spatmetrics/LucasCounty/index.html#conclusion-aple",
    "title": "Spatial Hedonic Model",
    "section": "Conclusion APLE",
    "text": "Conclusion APLE\nWe see that the strength of positive spatial dependence is greatest for price, TLA and lotsize and lowest for number of bedrooms (beds) in the dwellings.\n\n[APLE], which may be viewed somewhat like a correlation coefficient between the values observed for each state and the average values for neighbouring states.(bivandReviewSoftwareSpatial2021?)\n\n\n\nCode\n# If we want to see which obs. are the most influential we can \n# change labels to TRUE\n# The row number for each influential obs. will then be plotted in the figure.\nmoran.plot(red_house_sf$age_sold, listw = red_house_sf_w, \n           labels = FALSE, pch = 20, cex = 0.3)\n\n\n\n\n\nCode\n# Remember that age_sold is scaled by 1/100, so the max age 1.59 is in fact 159 years\nsummary(red_house_sf$age_sold)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n-0.0200  0.3000  0.4600  0.5014  0.7200  1.5500"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#spatial-models",
    "href": "spatmetrics/LucasCounty/index.html#spatial-models",
    "title": "Spatial Hedonic Model",
    "section": "Spatial models",
    "text": "Spatial models\n\nLocal: SDEM, SEM, SLX, lm\nGlobal: SDM, SAR, SLX, SEM, lm"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-start-with-sdem",
    "href": "spatmetrics/LucasCounty/index.html#local-start-with-sdem",
    "title": "Spatial Hedonic Model",
    "section": "Local, start with SDEM",
    "text": "Local, start with SDEM\n\n\nCode\n#\n# Some of these models are quite expensive to compute, so we cache the results\n# It should automagically be recomputed if something change, but caching is complex\n# so we should check that the models really are recomputed if we change the data or model\n# Note the use of the option Durbin to choose the kind of model. Used to be done by the options\n# type and etype until recently.\nSDEM <- errorsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = TRUE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-sem",
    "href": "spatmetrics/LucasCounty/index.html#local-sem",
    "title": "Spatial Hedonic Model",
    "section": "Local, SEM",
    "text": "Local, SEM\n\n\nCode\n#\n# No spatial effects in the explanatory variables\nSEM <- errorsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = FALSE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-slx",
    "href": "spatmetrics/LucasCounty/index.html#local-slx",
    "title": "Spatial Hedonic Model",
    "section": "Local, SLX",
    "text": "Local, SLX\n\n\nCode\n# SLX is not costly to compute, so no caching\nSLX <- lmSLX(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = TRUE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#choosing-a-local-model",
    "href": "spatmetrics/LucasCounty/index.html#choosing-a-local-model",
    "title": "Spatial Hedonic Model",
    "section": "Choosing a local model",
    "text": "Choosing a local model\n\nSince the models are nested we can test the models against each other with a likelihood ratio test"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#results",
    "href": "spatmetrics/LucasCounty/index.html#results",
    "title": "Spatial Hedonic Model",
    "section": "Results",
    "text": "Results\n\n\nCode\n# Do not use \"SDEM\" = SDEM, report coeffisent estimates not impacts\nhuxreg(\"OLS\" = lm1, \"SEM\" = SEM, \n       error_format = \"({statistic})\",\n       note = \"{stars}. T-values reported.\")\n\n\n\n\n\nOLSSEM\n\n(Intercept)3.183 ***4.572 ***\n\n(12.979)   (20.605)   \n\nI(age_sold)1.365 ***0.432 *  \n\n(7.222)   (2.241)   \n\nI(age_sold^2)-3.074 ***-1.251 ***\n\n(-8.640)   (-3.646)   \n\nI(age_sold^3)0.697 ***0.253    \n\n(3.504)   (1.407)   \n\nI(log(TLA))0.873 ***0.688 ***\n\n(22.203)   (20.970)   \n\nI(log(lotsize))0.172 ***0.155 ***\n\n(14.736)   (11.928)   \n\nrooms0.021    0.020 *  \n\n(1.723)   (2.159)   \n\nbeds-0.033    -0.015    \n\n(-1.877)   (-1.152)   \n\nsyear19940.069 *  0.059 ** \n\n(2.406)   (2.755)   \n\nsyear19950.098 ***0.102 ***\n\n(3.513)   (4.864)   \n\nsyear19960.142 ***0.116 ***\n\n(5.176)   (5.607)   \n\nsyear19970.164 ***0.158 ***\n\n(6.043)   (7.652)   \n\nsyear19980.264 ***0.242 ***\n\n(9.439)   (11.502)   \n\nlambda        0.718 ***\n\n        (56.889)   \n\nN3000        3000        \n\nR20.690    0.815    \n\nlogLik-1629.699    -1095.658    \n\nAIC3287.397    2221.315    \n\n *** p < 0.001;  ** p < 0.01;  * p < 0.05. T-values reported.\n\n\n\n\nCompare impacts from SDEM and SLX model\n\n\nCode\n# tidy(SDEM) or tidy(SLX) reports regression coefficients\n# make our own table for easy comparison of impacts\ni_SDEM <- impacts(SDEM)$impacts %>% \n  as_tibble() %>% \n  mutate(\n    variable = names(impacts(SDEM)$impacts$direct)\n  ) %>% \n  select(variable, everything())\n\ni_SLX <- impacts(SLX)$impacts %>% \n  as_tibble()\n\nnames(i_SDEM)[2:4] <- paste(\"SDEM\", names(i_SDEM)[2:4], sep = \"_\")\nnames(i_SLX) <- paste(\"SLX\", names(i_SLX), sep = \"_\")\ni_SDEM_SLX <- cbind(i_SDEM, i_SLX)\ni_SDEM_SLX <- cbind(variable = i_SDEM_SLX[, \"variable\"], \n                    round(i_SDEM_SLX[, -1], 6))\n\n\nCompare impacts from SDEM and SLX model cont.\n\n\nCode\nkable(i_SDEM_SLX[, c(1:2,5,3,6,4,7)])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvariable\nSDEM_direct\nSLX_direct\nSDEM_indirect\nSLX_indirect\nSDEM_total\nSLX_total\n\n\n\n\nI(age_sold)\n0.543545\n0.381566\n1.724314\n1.151030\n2.267859\n1.532596\n\n\nI(age_sold^2)\n-1.211511\n-0.851706\n-3.154620\n-1.649422\n-4.366131\n-2.501128\n\n\nI(age_sold^3)\n0.119899\n-0.093769\n0.858429\n-0.190964\n0.978329\n-0.284733\n\n\nI(log(TLA))\n0.721610\n0.736522\n0.325829\n0.533522\n1.047440\n1.270044\n\n\nI(log(lotsize))\n0.120001\n0.129258\n0.002126\n-0.036567\n0.122127\n0.092691\n\n\nrooms\n0.022980\n0.016284\n0.022090\n-0.021259\n0.045069\n-0.004974\n\n\nbeds\n-0.023773\n-0.022064\n-0.044375\n-0.075222\n-0.068148\n-0.097285\n\n\nsyear1994\n0.058224\n0.051453\n0.014445\n0.007070\n0.072668\n0.058524\n\n\nsyear1995\n0.083153\n0.078807\n-0.081602\n-0.114145\n0.001551\n-0.035338\n\n\nsyear1996\n0.113499\n0.117339\n-0.004495\n0.047101\n0.109004\n0.164440\n\n\nsyear1997\n0.150084\n0.146404\n-0.051995\n-0.042885\n0.098089\n0.103520\n\n\nsyear1998\n0.251561\n0.239963\n0.082366\n0.011152\n0.333927\n0.251114"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global",
    "href": "spatmetrics/LucasCounty/index.html#global",
    "title": "Spatial Hedonic Model",
    "section": "Global",
    "text": "Global\n\nNow spatial lag in y and X."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#some-tests",
    "href": "spatmetrics/LucasCounty/index.html#some-tests",
    "title": "Spatial Hedonic Model",
    "section": "Some tests",
    "text": "Some tests"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#are-our-residuals-normal",
    "href": "spatmetrics/LucasCounty/index.html#are-our-residuals-normal",
    "title": "Spatial Hedonic Model",
    "section": "Are our residuals normal?",
    "text": "Are our residuals normal?\nSDEM\n\n\nCode\nlibrary(DescTools)\n# H0: residuals normal\nJarqueBeraTest(residuals(SDEM), robust = TRUE)\n\n\n\n    Robust Jarque Bera Test\n\ndata:  residuals(SDEM)\nX-squared = 10280, df = 2, p-value < 2.2e-16\n\n\nCode\n# Conclusion: not normal\n\n\nFar from normal.\nSDM\n\n\nCode\n# H0: residuals normal\nJarqueBeraTest(residuals(SDM), robust = TRUE)\n\n\n\n    Robust Jarque Bera Test\n\ndata:  residuals(SDM)\nX-squared = 10921, df = 2, p-value < 2.2e-16\n\n\nCode\n# Conclusion: not normal\n\n\nFar from normal."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#heteroskedasticity",
    "href": "spatmetrics/LucasCounty/index.html#heteroskedasticity",
    "title": "Spatial Hedonic Model",
    "section": "Heteroskedasticity?",
    "text": "Heteroskedasticity?\n\n\nCode\n# test for Heteroskedasticity\nbptest.Sarlm(SDEM, studentize = TRUE)\n\n\n\n    studentized Breusch-Pagan test\n\ndata:  \nBP = 531.81, df = 24, p-value < 2.2e-16\n\n\n\n\nCode\n# test for Heteroskedasticity\nbptest.Sarlm(SDM, studentize = TRUE)\n\n\n\n    studentized Breusch-Pagan test\n\ndata:  \nBP = 550.1, df = 24, p-value < 2.2e-16"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#maps",
    "href": "spatmetrics/LucasCounty/index.html#maps",
    "title": "Spatial Hedonic Model",
    "section": "MAPS",
    "text": "MAPS\n\n\nCode\n#  Start of code to draw a map of Lucas County\n#\n#\n# counties %>% \n#   filter(county_name == \"Lucas County\")\n# \n# \n# tmp <- countydata %>% \n#   left_join(counties, by = \"county_fips\") %>% \n#   filter(state_name ==\"Ohio\") %>% \n#   filter(county_name == \"Lucas County\") %>% \n#   ggplot(mapping = aes(long, lat, group = group, fill = horate)) +\n#   geom_polygon(color = \"#ffffff\", size = .25)\n# \n# class(countydata)\n# names(countydata)\n# class(counties)\n# names(counties)\n# \n# tmp_sf <- st_as_sf(counties, coords = c(\"long\", \"lat\"), \n#     crs = 2834)\n# \n# names(tmp_sf)\n# \n# tmp_sf %>% \n#   filter(state_name == \"Ohio\") %>% \n#   filter(county_name == \"Lucas County\") \n# \n# test <- st_cast(tmp_sf, \"MULTIPOINT\")\n# test1 <- st_cast(test, \"POLYGON\")\n# \n# names(tmp_sf)\n# \n# tmp <- st_transform(tmp, 2834)\n# tmp\n# head(countydata)\n\n\n\n\nCode\n#siste\n\n\n\n\nMSB205\n\n\n\n“0.1 The Reproducible R Toolkit (RRT).” n.d. https://cran.r-project.org/web/packages/checkpoint/vignettes/checkpoint.html.\n\n\n“16 Product Fails That Defined The Decade.” n.d. BuzzFeed News. https://www.buzzfeednews.com/article/nicolenguyen/notable-tech-fails-of-2010s.\n\n\nBechhofer, Sean, Iain Buchan, David De Roure, Paolo Missier, John Ainsworth, Jiten Bhagat, Philip Couch, et al. 2013. “Why Linked Data Is Not Enough for Scientists.” Future Generation Computer Systems 29 (2): 599611. https://doi.org/10.1016/j.future.2011.08.004.\n\n\nBivand, Roger. 2022a. “R Packages for Analyzing Spatial Data: A Comparative Case Study with Areal Data.” Geographical Analysis 54 (3): 488–518. https://doi.org/10.1111/gean.12319.\n\n\n———. 2022b. Spdep: Spatial Dependence: Weighting Schemes, Statistics. https://CRAN.R-project.org/package=spdep.\n\n\nBivand, Roger S., Edzer Pebesma, and Virgilio Gomez-Rubio. 2013a. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013b. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013c. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\nBivand, Roger, Jan Hauke, and Tomasz Kossowski. 2013. “Computing the Jacobian in Gaussian Spatial Autoregressive Models: An Illustrated Comparison of Available Methods.” Geographical Analysis 45 (2): 150–79. https://doi.org/10.1111/gean.12008.\n\n\nBivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. “A Review of Software for Spatial Econometrics in R.” Mathematics 9 (11). https://doi.org/10.3390/math9111276.\n\n\nBivand, Roger, Jakub Nowosad, and Robin Lovelace. 2021. spData: Datasets for Spatial Analysis. https://nowosad.github.io/spData/.\n\n\nBivand, Roger, and Gianfranco Piras. 2015. “Comparing Implementations of Estimation Methods for Spatial Econometrics.” Journal of Statistical Software 63 (18): 1–36. https://doi.org/10.18637/jss.v063.i18.\n\n\n———. 2022. Spatialreg: Spatial Regression Analysis. https://CRAN.R-project.org/package=spatialreg.\n\n\nBivand, Roger, and David W. S. Wong. 2018. “Comparing Implementations of Global and Local Indicators of Spatial Association.” TEST 27 (3): 716–48. https://doi.org/10.1007/s11749-018-0599-x.\n\n\nChan, TszKin Julian. 2022. Jmisc: Julian Miscellaneous Function. https://CRAN.R-project.org/package=Jmisc.\n\n\nGrossenbacher, Timo. n.d. “A (Truly) Reproducible R Workflow.” https://timogrossenbacher.ch/2017/07/a-truly-reproducible-r-workflow/.\n\n\nHugh-Jones, David. 2022. Huxtable: Easily Create and Style Tables for LaTeX, HTML and Other Formats. https://hughjonesd.github.io/huxtable/.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\nPebesma, Edzer J., and Roger S. Bivand. 2005. “Classes and Methods for Spatial Data in R.” R News 5 (2): 9–13. https://CRAN.R-project.org/doc/Rnews/.\n\n\nPebesma, Edzer, and Roger Bivand. 2022. Sp: Classes and Methods for Spatial Data. https://CRAN.R-project.org/package=sp.\n\n\nStrochak, Sarah, Kyle Ueyama, and Aaron Williams. 2022. Urbnmapr: State and County Shapefiles in Sf and Tibble Format. https://github.com/UrbanInstitute/urbnmapr.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\n———. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2022. Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics. https://CRAN.R-project.org/package=ggplot2.\n\n\nXie, Yihui. 2014. “Knitr: A Comprehensive Tool for Reproducible Research in R.” In Implementing Reproducible Computational Research, edited by Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman; Hall/CRC. http://www.crcpress.com/product/isbn/9781466561595.\n\n\n———. 2015. Dynamic Documents with R and Knitr. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. https://yihui.org/knitr/.\n\n\n———. 2022. Knitr: A General-Purpose Package for Dynamic Report Generation in r. https://yihui.org/knitr/.\n\n\nXie, Yihui, Christophe Dervieux, and Emily Riederer. 2020. R Markdown Cookbook. Chapman; Hall/CRC. https://doi.org/10.1201/9781003097471."
  },
  {
    "objectID": "spatmetrics/index.html",
    "href": "spatmetrics/index.html",
    "title": "Spatial Econometrics",
    "section": "",
    "text": "Getting Data\nLucas County Houseing Data\nSpatial regressions polygons"
  },
  {
    "objectID": "spatmetrics/data/index.html#read-in-map-2017-unedited",
    "href": "spatmetrics/data/index.html#read-in-map-2017-unedited",
    "title": "Get ssb data",
    "section": "Read in map 2017 (unedited)",
    "text": "Read in map 2017 (unedited)\nThe map is converted from 432 to 426 multipolygons.\n\n\nCode\nmap_2017 <- st_read(\"map_2017_uned.gpkg\") %>% \n  rename(\"knr\" = KOMMUNENUM) %>% \n  group_by(knr) %>% \n  summarise() %>% \n  st_transform(\"EPSG:5973\")\n\n\nReading layer `map_2017_uned' from data source \n  `/Users/ag/Dev/QQ_MSB205/spatmetrics/data/map_2017_uned.gpkg' \n  using driver `GPKG'\nSimple feature collection with 432 features and 1 field\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744\nProjected CRS: ETRS89 / UTM zone 33N"
  },
  {
    "objectID": "spatmetrics/data/index.html#get-knr-and-knavn-from-local-file",
    "href": "spatmetrics/data/index.html#get-knr-and-knavn-from-local-file",
    "title": "Get ssb data",
    "section": "Get knr and kNavn from local file",
    "text": "Get knr and kNavn from local file\nWe want the Norvegian names, hence we have to adjust the municipality names for Vetsfold 2017.\n\n\nCode\nload(\"bld06_19.Rdata\")\n\nknr_and_knavn <- bld90_19 %>% \n  select(knrNavn) %>% \n  unique() %>%\n  # separate at the space after last digit\n  separate(col = knrNavn, into = c(\"knr\", \"kNavn\"), sep=\"\\\\s\", extra = \"merge\") %>% \n  filter(!knr %in% c(\"0712\", \"0715\", \"0729\")) %>% \n  bind_rows(\n    c(knr = \"0702\", kNavn = \"Holmestrand\"),\n    c(knr = \"0709\", kNavn = \"Larvik\"),\n    c(knr = \"0714\", kNavn = \"Hof\"),\n    c(knr = \"0722\", kNavn = \"Nøtterøy\"),\n    c(knr = \"0723\", kNavn = \"Tjøme\"),\n    c(knr = \"0728\", kNavn = \"Lardal\")\n  )\n\n\n\n\nCode\n# View(knr_and_knavn)"
  },
  {
    "objectID": "spatmetrics/data/index.html#get-ssb-data-via-api",
    "href": "spatmetrics/data/index.html#get-ssb-data-via-api",
    "title": "Get ssb data",
    "section": "Get ssb data via api",
    "text": "Get ssb data via api\n\nGet data registered on the municipality level from SSB\n\none trick to get a list of all these municipality tables is to search at SSB for (K) and then click on Statistikkbanken in the left column.\n\nWe will use the SSB api exposed through the PxWebApiData R package.\n\nThis API can also be used against most Nordic SSB sister organisations.\n\nSince we have a list of the relevant municipalities for 2017 (map_2017$knr) we can restrict our api request to just these.\nWe are just going to use some of these variables in the following example\n\nThe other variables serves as examples and some might be used in further analysis.\n\nThere is still plenty of relevant data at SSB\n\nQuite trivial to get access to these using the techniques shown below.\n\nOur new dataset use pm2 for 2017 to avoid the big changes in Trøndelag 1.1 2018."
  },
  {
    "objectID": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd",
    "href": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd",
    "title": "Get ssb data",
    "section": "Mean price per sqr. meter for SFD",
    "text": "Mean price per sqr. meter for SFD\n\nmean price per square meter in single family dwellings in each municipality (426)\n\n\n\n\nCode\npm2_2017 <- ApiData(\n    urlToData = \"06035\",\n    Region = map_2017$knr,\n    Boligtype = \"01\",\n    Tid = \"2017\"\n)\n\n\n\nPick element 2, dataset, in list returned\n\n\n\n\n\nCode\npm2_2017 <- pm2_2017$dataset"
  },
  {
    "objectID": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.",
    "href": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.",
    "title": "Get ssb data",
    "section": "Mean price per sqr. meter for SFD cont.",
    "text": "Mean price per sqr. meter for SFD cont.\n\nMake it tidy\n\n\n\n\nCode\n# Work on it to get it tidy\npm2_2017 <- pm2_2017 %>% \n  select(-Boligtype, -Tid) %>% \n  rename(\n    knr = Region\n  ) %>% \n  pivot_wider(\n    id_cols = knr, \n    names_from = \"ContentsCode\", \n    values_from = \"value\"\n    ) %>% \n  rename(\n    pm2 = KvPris,\n    num_dwelling_sales = Omsetninger \n  )\n\n\n\nWe are tidy!\n\n\n\n\n\nCode\ndim(pm2_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.-1",
    "href": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.-1",
    "title": "Get ssb data",
    "section": "Mean price per sqr. meter for SFD cont.",
    "text": "Mean price per sqr. meter for SFD cont.\n\nFill in for missing 2017\nGet average price per sqr. meter for single family dwellings (SFD) in each municipality (426)\n\n\n\n\nCode\n# 139 missing values. \n# Try other years for these\npm2_missing <- pm2_2017 %>% \n  filter(is.na(pm2)) %>% \n  select(knr)\n\n# Get data for the years 2010:2016 and 2018\npm2_15to18 <- ApiData(\n    urlToData = \"06035\",\n    Region = pm2_missing$knr,\n    Boligtype = \"01\",\n    Tid = c(as.character(2010:2016), \"2018\")\n)"
  },
  {
    "objectID": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.-2",
    "href": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.-2",
    "title": "Get ssb data",
    "section": "Mean price per sqr. meter for SFD cont.",
    "text": "Mean price per sqr. meter for SFD cont.\n\n\n\n\nCode\n# Bad name, pm2_15to18 has data fram 2010 to 2016 and 2018\n# Note tmp is not tidy, 8 obs. per row\ntmp <- pm2_15to18$dataset %>% \n  select(-Boligtype) %>% \n  rename(knr = Region) %>% \n  pivot_wider(\n    id_cols = knr,\n    names_from = c(\"ContentsCode\", \"Tid\"),\n    values_from = \"value\"\n    ) %>% \n  mutate(\n    pm2 = rowMeans(\n      select(\n        .data = .,\n        KvPris_2010:KvPris_2018\n        ), \n# calculate mean of existing values\n      na.rm = TRUE\n      ),\n    num_dwelling_sales = rowMeans(\n      select(\n        .data = .,\n        Omsetninger_2010:Omsetninger_2018\n        ),\n      na.rm = TRUE\n      )\n    ) %>%\n  select(knr, pm2, num_dwelling_sales)\n\n\n\n\n\nCode\n    # Very crude, we just take the mean of existing values\n    pm2_2017 <- pm2_2017 %>% \n    # add new values from tmp to pm2_2017  \n      left_join(tmp, by = \"knr\") %>% \n      mutate(\n        pm2 = if_else(\n          is.na(pm2.x), \n          as.integer(pm2.y), \n          pm2.x),\n        num_dwelling_sales =  if_else(\n          is.na(pm2.x), \n          as.integer(num_dwelling_sales.y), \n          num_dwelling_sales.x\n          )\n        ) %>% \n      select(knr, pm2, num_dwelling_sales)\n\n\n\n\nCode\nsummary(pm2_2017$pm2)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n   5317   13213   16731   18177   21300   57525      95"
  },
  {
    "objectID": "spatmetrics/data/index.html#population",
    "href": "spatmetrics/data/index.html#population",
    "title": "Get ssb data",
    "section": "Population",
    "text": "Population\n\nStart by getting metadata for the table 07459\n\n\n\n\n\n\nCode\nmetadata_07459 <- ApiData(\n  \"http://data.ssb.no/api/v0/en/table/07459\",\n  returnMetaFrames = TRUE\n  )\n\n\n\n\n\nCode\nprint(head(str(metadata_07459), n = 20))\n\n\nList of 5\n $ Region      :'data.frame':   856 obs. of  2 variables:\n  ..$ values    : chr [1:856] \"0\" \"30\" \"01\" \"3001\" ...\n  ..$ valueTexts: chr [1:856] \"The whole country\" \"Viken\" \"Østfold (-2019)\" \"Halden\" ...\n $ Kjonn       :'data.frame':   2 obs. of  2 variables:\n  ..$ values    : chr [1:2] \"1\" \"2\"\n  ..$ valueTexts: chr [1:2] \"Males\" \"Females\"\n $ Alder       :'data.frame':   106 obs. of  2 variables:\n  ..$ values    : chr [1:106] \"000\" \"001\" \"002\" \"003\" ...\n  ..$ valueTexts: chr [1:106] \"0 years\" \"1 year\" \"2 years\" \"3 years\" ...\n $ ContentsCode:'data.frame':   1 obs. of  2 variables:\n  ..$ values    : chr \"Personer1\"\n  ..$ valueTexts: chr \"Persons\"\n $ Tid         :'data.frame':   37 obs. of  2 variables:\n  ..$ values    : chr [1:37] \"1986\" \"1987\" \"1988\" \"1989\" ...\n  ..$ valueTexts: chr [1:37] \"1986\" \"1987\" \"1988\" \"1989\" ...\n - attr(*, \"text\")= Named chr [1:5] \"region\" \"sex\" \"age\" \"contents\" ...\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Kjonn\" \"Alder\" \"ContentsCode\" ...\n - attr(*, \"elimination\")= Named logi [1:5] TRUE TRUE TRUE FALSE FALSE\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Kjonn\" \"Alder\" \"ContentsCode\" ...\n - attr(*, \"time\")= Named logi [1:5] FALSE FALSE FALSE FALSE TRUE\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Kjonn\" \"Alder\" \"ContentsCode\" ...\nNULL"
  },
  {
    "objectID": "spatmetrics/data/index.html#population-cont.",
    "href": "spatmetrics/data/index.html#population-cont.",
    "title": "Get ssb data",
    "section": "Population cont.",
    "text": "Population cont.\n\nAPI query\n\n\n\n\n\n\nCode\n#Get more info about table\napi_query <- ApiData(\n\"http://data.ssb.no/api/v0/en/table/07459\",\nreturnApiQuery = TRUE\n) \n\n\n\n\n\nCode\nprint(api_query)\n\n\n{\n  \"query\": [\n    {\n      \"code\": \"Region\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"0\", \"99\", \"9999\"]\n      }\n    },\n    {\n      \"code\": \"Kjonn\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"1\", \"2\"]\n      }\n    },\n    {\n      \"code\": \"Alder\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"000\", \"104\", \"105+\"]\n      }\n    },\n    {\n      \"code\": \"ContentsCode\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"Personer1\"]\n      }\n    },\n    {\n      \"code\": \"Tid\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"1986\", \"2021\", \"2022\"]\n      }\n    }\n  ],\n  \"response\": {\n    \"format\": \"json-stat\"\n  }\n}"
  },
  {
    "objectID": "spatmetrics/data/index.html#population-cont.-1",
    "href": "spatmetrics/data/index.html#population-cont.-1",
    "title": "Get ssb data",
    "section": "Population cont.",
    "text": "Population cont.\n\nPopulation, three categories 0-19, 20-64 and 65+\n\n\n\n\n\n\nCode\n# Kjonn = FALSE, aggregate F+M\n# The F in \"F0-19\" DOES NOT indicate Female\nbef_2017 <- ApiData(\n    urlToData = \"07459\",\n# Pick data for the municipallities we have in our map \n    Region = map_2017$knr,\n    Alder = list(\"agg:TredeltGrupperingB2\", \n                 c(\"F0-19\", \"F20-64\", \"F65+\")),\n    Kjonn = FALSE,\n    Tid = \"2017\"\n)\n\n\n\n\nCode\n# list with 2 elements, we want dataset\nbef_2017 <- bef_2017$dataset\n\n\n\n\n\nCode\n# print function used to get console \n# output in slides\nprint(head(bef_2017, n = 4))\n\n\n  Region  Alder ContentsCode  Tid value\n1   0101  F0-19    Personer1 2017  7033\n2   0101 F20-64    Personer1 2017 17828\n3   0101   F65+    Personer1 2017  5929\n4   0104  F0-19    Personer1 2017  7453\n\n\n\n\nCode\nbef_2017 <- bef_2017 %>% \n  select(Region, Alder, value) %>% \n  rename(\n    alder = Alder,\n    knr = Region,\n    bef = value,\n  )"
  },
  {
    "objectID": "spatmetrics/data/index.html#population-cont.-2",
    "href": "spatmetrics/data/index.html#population-cont.-2",
    "title": "Get ssb data",
    "section": "Population cont.",
    "text": "Population cont.\n\n\n\n\nCode\nbef_2017 <- bef_2017 %>% \n  pivot_wider(id_cols = knr, names_from = \"alder\", values_from = \"bef\") %>% \n  # rename variables\n  rename(\n    pop_0_19 = `F0-19`,\n    pop_20_64 = `F20-64`,\n    pop_65p = `F65+`\n    ) %>% \n  # Calculate tot. pop.\n  mutate(tot_pop = pop_0_19 + pop_20_64 + pop_65p)\n\n\n\n\n\nCode\n# we are tidy\nprint(head(bef_2017, n = 5))\n\n\n# A tibble: 5 × 5\n  knr   pop_0_19 pop_20_64 pop_65p tot_pop\n  <chr>    <int>     <int>   <int>   <int>\n1 0101      7033     17828    5929   30790\n2 0104      7453     18688    6266   32407\n3 0105     13227     31829   10071   55127\n4 0106     18728     46969   14424   80121\n5 0111       882      2533    1102    4517\n\n\n\n\nCode\n# we are tidy\ndim(bef_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#education-level-percentage-each-level",
    "href": "spatmetrics/data/index.html#education-level-percentage-each-level",
    "title": "Get ssb data",
    "section": "Education level (percentage each level)",
    "text": "Education level (percentage each level)\n\nMetadata\n\n\n\n\n\n\nCode\n#Get metadata\nmetadata_09429 <- ApiData(\n  urlToData = \"http://data.ssb.no/api/v0/no/table/09429\",  \n  returnMetaFrames = TRUE\n  )\nstr(metadata_09429)\n\n\n\n\n\nList of 5\n $ Region      :'data.frame':   857 obs. of  2 variables:\n  ..$ values    : chr [1:857] \"0\" \"30\" \"01\" \"3001\" ...\n  ..$ valueTexts: chr [1:857] \"Hele landet\" \"Viken\" \"Østfold (-2019)\" \"Halden\" ...\n $ Nivaa       :'data.frame':   7 obs. of  2 variables:\n  ..$ values    : chr [1:7] \"00\" \"01\" \"02a\" \"11\" ...\n  ..$ valueTexts: chr [1:7] \"Utdanningsnivå i alt\" \"Grunnskolenivå\" \"Videregående skolenivå\" \"Fagskolenivå\" ...\n $ Kjonn       :'data.frame':   3 obs. of  2 variables:\n  ..$ values    : chr [1:3] \"0\" \"1\" \"2\"\n  ..$ valueTexts: chr [1:3] \"Begge kjønn\" \"Menn\" \"Kvinner\"\n $ ContentsCode:'data.frame':   2 obs. of  2 variables:\n  ..$ values    : chr [1:2] \"Personer\" \"PersonerProsent\"\n  ..$ valueTexts: chr [1:2] \"Personer 16 år og over\" \"Personer 16 år og over (prosent)\"\n $ Tid         :'data.frame':   43 obs. of  2 variables:\n  ..$ values    : chr [1:43] \"1970\" \"1980\" \"1981\" \"1982\" ...\n  ..$ valueTexts: chr [1:43] \"1970\" \"1980\" \"1981\" \"1982\" ...\n - attr(*, \"text\")= Named chr [1:5] \"region\" \"nivå\" \"kjønn\" \"statistikkvariabel\" ...\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Nivaa\" \"Kjonn\" \"ContentsCode\" ...\n - attr(*, \"elimination\")= Named logi [1:5] TRUE TRUE TRUE FALSE FALSE\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Nivaa\" \"Kjonn\" \"ContentsCode\" ...\n - attr(*, \"time\")= Named logi [1:5] FALSE FALSE FALSE FALSE TRUE\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Nivaa\" \"Kjonn\" \"ContentsCode\" ..."
  },
  {
    "objectID": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.",
    "href": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.",
    "title": "Get ssb data",
    "section": "Education level (percentage each level) cont.",
    "text": "Education level (percentage each level) cont.\n\nApi Query\n\n\n\n\n\n\nCode\n#Get more info about table\napi_query_09429 <- ApiData(\n\"http://data.ssb.no/api/v0/en/table/09429\",\nreturnApiQuery = TRUE)\n\nprint(api_query_09429)\n\n\n\n\n\n{\n  \"query\": [\n    {\n      \"code\": \"Region\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"0\", \"99\", \"9999\"]\n      }\n    },\n    {\n      \"code\": \"Nivaa\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"00\", \"04a\", \"09a\"]\n      }\n    },\n    {\n      \"code\": \"Kjonn\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"0\", \"1\", \"2\"]\n      }\n    },\n    {\n      \"code\": \"ContentsCode\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"Personer\", \"PersonerProsent\"]\n      }\n    },\n    {\n      \"code\": \"Tid\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"1970\", \"2020\", \"2021\"]\n      }\n    }\n  ],\n  \"response\": {\n    \"format\": \"json-stat\"\n  }\n}"
  },
  {
    "objectID": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.-1",
    "href": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.-1",
    "title": "Get ssb data",
    "section": "Education level (percentage each level) cont.",
    "text": "Education level (percentage each level) cont.\n\n\n\n\nCode\n# Get data from SSB\nedu_2017 <- ApiData(\n    urlToData = \"09429\",\n    # we want in percent\n    ContentsCode = \"PersonerProsent\",\n    Region = map_2017$knr,\n    # Drop \"00\" since total, \n    # 100%, also dro \"09a\" Uoppgit\n    Nivaa = c(\"01\", \"02a\", \n              \"11\", \"03a\", \"04a\"),\n    Kjonn = FALSE,\n    Tid = \"2017\"\n)\n\n\n\n\nCode\n# Pick the needed variables\nedu_2017 <- tibble(\n  # want knr\n  knr = edu_2017$dataset$Region , \n  # want level descriptions, not code\n  nivaa = edu_2017$`09429: Personer 16 år og over, etter region, nivå, statistikkvariabel og år`$nivå,\n  edu_lev_percent = edu_2017$dataset$value\n  )\n\n\n\n\n\nCode\n# Have a look at it\nprint(head(edu_2017, n=7))\n\n\n# A tibble: 7 × 3\n  knr   nivaa                               edu_lev_percent\n  <chr> <chr>                                         <dbl>\n1 0101  Grunnskolenivå                                 30.7\n2 0101  Videregående skolenivå                         39.8\n3 0101  Fagskolenivå                                    2.3\n4 0101  Universitets- og høgskolenivå, kort            21.6\n5 0101  Universitets- og høgskolenivå, lang             5.6\n6 0104  Grunnskolenivå                                 29.8\n7 0104  Videregående skolenivå                         37.6"
  },
  {
    "objectID": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.-2",
    "href": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.-2",
    "title": "Get ssb data",
    "section": "Education level (percentage each level) cont.",
    "text": "Education level (percentage each level) cont.\n\n\n\n\nCode\n#make tidy\nedu_2017 <- edu_2017 %>% \n   pivot_wider(\n     id_cols = knr, \n     names_from = \"nivaa\", \n     values_from = \"edu_lev_percent\"\n     ) %>% \n  rename(\n    edu_prim = `Grunnskolenivå`,\n    edu_sec = `Videregående skolenivå`,\n    edu_voc = `Fagskolenivå`,\n    edu_uni_short = `Universitets- og høgskolenivå, kort`,\n    edu_uni_long = `Universitets- og høgskolenivå, lang`\n  )\n\n\n\n\n\nCode\n# Tidy OK\nprint(head(edu_2017, n = 5))\n\n\n# A tibble: 5 × 6\n  knr   edu_prim edu_sec edu_voc edu_uni_short edu_uni_long\n  <chr>    <dbl>   <dbl>   <dbl>         <dbl>        <dbl>\n1 0101      30.7    39.8     2.3          21.6          5.6\n2 0104      29.8    37.6     2.5          21.8          8.3\n3 0105      33.2    40.2     2.5          19.9          4.2\n4 0106      29.8    38.6     2.6          22.6          6.3\n5 0111      25.7    42       3.3          21.9          7.1\n\n\n\n\nCode\ndim(edu_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income",
    "href": "spatmetrics/data/index.html#household-income",
    "title": "Get ssb data",
    "section": "Household income",
    "text": "Household income\n\n\n\n\nCode\n# Get metadata \nmetadata_07183 <- ApiData(\n  urlToData = \"http://data.ssb.no/api/v0/no/table/07183\",\n  returnMetaFrames = TRUE\n  )\n\nprint(str(metadata_07183))\n\n\n\n\n\nList of 3\n $ Region      :'data.frame':   822 obs. of  2 variables:\n  ..$ values    : chr [1:822] \"3001\" \"3002\" \"3003\" \"3004\" ...\n  ..$ valueTexts: chr [1:822] \"Halden\" \"Moss\" \"Sarpsborg\" \"Fredrikstad\" ...\n $ ContentsCode:'data.frame':   8 obs. of  2 variables:\n  ..$ values    : chr [1:8] \"Hushold\" \"Inntekt1\" \"Inntekt2\" \"Inntekt3\" ...\n  ..$ valueTexts: chr [1:8] \"Antall husholdninger\" \"Samlet inntekt under 150 000 kr, prosent\" \"Samlet inntekt 150 000 - 249 999 kr, prosent\" \"Samlet inntekt  250 000 - 349 999 kr, prosent\" ...\n $ Tid         :'data.frame':   15 obs. of  2 variables:\n  ..$ values    : chr [1:15] \"2006\" \"2007\" \"2008\" \"2009\" ...\n  ..$ valueTexts: chr [1:15] \"2006\" \"2007\" \"2008\" \"2009\" ...\n - attr(*, \"text\")= Named chr [1:3] \"region\" \"statistikkvariabel\" \"år\"\n  ..- attr(*, \"names\")= chr [1:3] \"Region\" \"ContentsCode\" \"Tid\"\n - attr(*, \"elimination\")= Named logi [1:3] FALSE FALSE FALSE\n  ..- attr(*, \"names\")= chr [1:3] \"Region\" \"ContentsCode\" \"Tid\"\n - attr(*, \"time\")= Named logi [1:3] FALSE FALSE TRUE\n  ..- attr(*, \"names\")= chr [1:3] \"Region\" \"ContentsCode\" \"Tid\"\nNULL"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-cont.",
    "href": "spatmetrics/data/index.html#household-income-cont.",
    "title": "Get ssb data",
    "section": "Household income cont.",
    "text": "Household income cont.\n\n\n\n\nCode\n#Get more info about table\napi_query_07183 <- ApiData(\n\"http://data.ssb.no/api/v0/en/table/07183\",\nreturnApiQuery = TRUE)\n\nprint(api_query_07183)\n\n\n\n\n\n{\n  \"query\": [\n    {\n      \"code\": \"Region\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"3001\", \"2599\", \"9999\"]\n      }\n    },\n    {\n      \"code\": \"ContentsCode\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"Hushold\", \"Inntekt6\", \"Inntekt7\"]\n      }\n    },\n    {\n      \"code\": \"Tid\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"2006\", \"2019\", \"2020\"]\n      }\n    }\n  ],\n  \"response\": {\n    \"format\": \"json-stat\"\n  }\n}"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-cont.-1",
    "href": "spatmetrics/data/index.html#household-income-cont.-1",
    "title": "Get ssb data",
    "section": "Household income cont.",
    "text": "Household income cont.\n\n\n\n\nCode\ninc_2017 <- ApiData(\n    urlToData = \"07183\",\n    # \"Hushold\" would \n    # also get us \n    # total number of\n    # households in muni\n    ContentsCode = c(\n      paste(\n        \"Inntekt\", \n        seq(\n          from = 1, \n          to = 7), \n        sep = \"\"\n        )\n      ),\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\n\n\n\n\nCode\nprint(head(\n  inc_2017$`07183: Husholdninger, etter region, statistikkvariabel og år`, \n  n=9\n  ))\n\n\n          region                            statistikkvariabel   år value\n1 Halden (-2019)      Samlet inntekt under 150 000 kr, prosent 2017     3\n2 Halden (-2019)  Samlet inntekt 150 000 - 249 999 kr, prosent 2017     9\n3 Halden (-2019) Samlet inntekt  250 000 - 349 999 kr, prosent 2017    13\n4 Halden (-2019) Samlet inntekt  350 000 - 449 999 kr, prosent 2017    12\n5 Halden (-2019) Samlet inntekt  450 000 - 549 999 kr, prosent 2017    11\n6 Halden (-2019) Samlet inntekt  550 000 - 749 999 kr, prosent 2017    17\n7 Halden (-2019)    Samlet inntekt 750 000 kr og over, prosent 2017    37\n8   Moss (-2019)      Samlet inntekt under 150 000 kr, prosent 2017     3\n9   Moss (-2019)  Samlet inntekt 150 000 - 249 999 kr, prosent 2017     8\n  NAstatus\n1     <NA>\n2     <NA>\n3     <NA>\n4     <NA>\n5     <NA>\n6     <NA>\n7     <NA>\n8     <NA>\n9     <NA>"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-cont.-2",
    "href": "spatmetrics/data/index.html#household-income-cont.-2",
    "title": "Get ssb data",
    "section": "Household income cont.",
    "text": "Household income cont.\n\n\n\n\nCode\ninc_2017 <- tibble(\n  # want knr\n  knr = inc_2017$dataset$Region , \n  # want level descriptions, not code\n  inc_cat = inc_2017$`07183: Husholdninger, etter region, statistikkvariabel og år`$statistikkvariabel,\n  inc_lev_percent = inc_2017$dataset$value\n)\n\n\n\n\n\nCode\ninc_2017 <- inc_2017 %>% \n  pivot_wider(\n     id_cols = knr, \n     names_from = \"inc_cat\", \n     values_from = \"inc_lev_percent\"\n     ) %>% \n  rename(\n    # Some problem with names here, had to do names(inc_2017) above and \n    # then copy the text strings\n    inc_0_150 = `Samlet inntekt under 150 000 kr, prosent`,\n    inc_150_250 = `Samlet inntekt 150 000 - 249 999 kr, prosent`,\n    inc_250_350 = `Samlet inntekt  250 000 - 349 999 kr, prosent`,\n    inc_350_450 = `Samlet inntekt  350 000 - 449 999 kr, prosent`,\n    inc_450_550 = `Samlet inntekt  450 000 - 549 999 kr, prosent`,\n    inc_550_750 = `Samlet inntekt  550 000 - 749 999 kr, prosent`,\n    inc_750k_p = `Samlet inntekt 750 000 kr og over, prosent`\n  )\n\n\n\n\nCode\ndim(inc_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-cont.-3",
    "href": "spatmetrics/data/index.html#household-income-cont.-3",
    "title": "Get ssb data",
    "section": "Household income cont.",
    "text": "Household income cont.\n\n\nCode\n# we are tidy\nprint(head(inc_2017, n = 7))\n\n\n# A tibble: 7 × 8\n  knr   inc_0_150 inc_150_250 inc_250_350 inc_350_450 inc_450_…¹ inc_5…² inc_7…³\n  <chr>     <int>       <int>       <int>       <int>      <int>   <int>   <int>\n1 0101          3           9          13          12         11      17      37\n2 0104          3           8          13          12         11      17      36\n3 0105          2           9          13          11         11      17      37\n4 0106          2           9          12          10         11      16      39\n5 0111          1           6           9           9         10      18      46\n6 0118          3           7          13           9         11      17      40\n7 0119          2           9          14          12         10      17      36\n# … with abbreviated variable names ¹​inc_450_550, ²​inc_550_750, ³​inc_750k_p"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-net-capital-wealth",
    "href": "spatmetrics/data/index.html#household-net-capital-wealth",
    "title": "Get ssb data",
    "section": "Household net capital (wealth)",
    "text": "Household net capital (wealth)\n\n\n\n\nCode\nwealth_2017_ssb <- ApiData(\n    urlToData = \"10320\",\n    # \"Hushold\" would also get us \n    # total number of households in muni\n    ContentsCode = c(\"Hushald (prosent)\"),\n    Nettoform = c(\"12\", \"13\", \"10\", \n                  \"25\", \"31\", \"11\", \"32\"\n                  ),\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\n\n\n\n\nCode\nwealth_2017 <- wealth_2017_ssb$dataset %>% \n  tibble() %>% \n  select(-ContentsCode, -Tid) %>% \n  rename(\n    knr = Region,\n    net_cap = Nettoform,\n    cap_lev_percent = value) %>% \n  pivot_wider(\n     id_cols = knr, \n     names_from = \"net_cap\", \n     values_from = \"cap_lev_percent\"\n     ) %>% \n  rename(\n    net_cap_0_250k = `12`,\n    net_cap_250k_500k = `13`,\n    net_cap_500k_1000k = `10`,\n    net_cap_1000k_2000k = `25`,\n    net_cap_2000k_3000k = `31`,\n    net_cap_3000k_4000k = `11`,\n    net_cap_4000k_p = `32`,\n  )"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-net-capital-wealth-1",
    "href": "spatmetrics/data/index.html#household-net-capital-wealth-1",
    "title": "Get ssb data",
    "section": "Household net capital (wealth)",
    "text": "Household net capital (wealth)\n\n\nCode\n# we are tidy\nprint(head(wealth_2017, n = 6))\n\n\n# A tibble: 6 × 8\n  knr   net_cap_0_250k net_cap_250k_500k net_c…¹ net_c…² net_c…³ net_c…⁴ net_c…⁵\n  <chr>          <dbl>             <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>\n1 0101            31.6               5.1    10.1    19.6    13.4     8.6    11.5\n2 0104            28.7               4.1     8      17.5    15       9.7    16.9\n3 0105            27.7               4.5     9.5    19.2    15.6    10.1    13.4\n4 0106            28.8               4.3     8.1    17.6    15.7    10.4    15  \n5 0111            18.4               3.1     5.3    12.7    14      14.7    31.9\n6 0118            30.7               5.6    12.2    19.1    14.3     7.4    10.6\n# … with abbreviated variable names ¹​net_cap_500k_1000k, ²​net_cap_1000k_2000k,\n#   ³​net_cap_2000k_3000k, ⁴​net_cap_3000k_4000k, ⁵​net_cap_4000k_p\n\n\n\n\nCode\ndim(wealth_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#employed-by-government",
    "href": "spatmetrics/data/index.html#employed-by-government",
    "title": "Get ssb data",
    "section": "Employed by government",
    "text": "Employed by government\n\n\n\n\nCode\n# Get vdata from SSB\ngov_emp_2017 <- ApiData(\n    urlToData = \"12628\",\n    # total num.of gov. emp. \n    # in each muni\n    StatligEnhet = \"0\",\n    # in yearly eq.\n    ContentsCode = \"AvtalteArsverk\",\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\n\n\n\n\nCode\n# Select wanted variables\ngov_emp_2017 <- gov_emp_2017$dataset %>% \n  select(Region, value) %>% \n  rename(\n    knr = Region,\n    gov_emp = value\n  )"
  },
  {
    "objectID": "spatmetrics/data/index.html#employed-by-government-1",
    "href": "spatmetrics/data/index.html#employed-by-government-1",
    "title": "Get ssb data",
    "section": "Employed by government",
    "text": "Employed by government\n\n\nCode\n#we are tidy\nprint(head(gov_emp_2017, n = 15))\n\n\n    knr gov_emp\n1  0101     997\n2  0104     614\n3  0105    1102\n4  0106     740\n5  0111      18\n6  0118       3\n7  0119      67\n8  0121       1\n9  0122     142\n10 0123      12\n11 0124     102\n12 0125      48\n13 0127       4\n14 0128      16\n15 0135      56\n\n\n\n\nCode\ndim(gov_emp_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#wholesale-and-retail-trade-sales",
    "href": "spatmetrics/data/index.html#wholesale-and-retail-trade-sales",
    "title": "Get ssb data",
    "section": "Wholesale and retail trade sales",
    "text": "Wholesale and retail trade sales\n\n\n\n\nCode\nsales_per_capita_2017  <- ApiData(\n    urlToData = \"04776\",\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\nsales_per_capita_2017  <- \n  sales_per_capita_2017$dataset %>%  \n  select(Region, value) %>% \n  # spc sales per capita\n  rename(\n    knr = Region,\n    spc = value\n  )\n\n\n\n\n\nCode\n# we are tidy\nprint(head(sales_per_capita_2017))\n\n\n   knr   spc\n1 0101 65919\n2 0104 77498\n3 0105 69540\n4 0106 80019\n5 0111 96079\n6 0118 19794\n\n\n\n\nCode\ndim(sales_per_capita_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-before-and-after-tax-in-decile-percent",
    "href": "spatmetrics/data/index.html#household-income-before-and-after-tax-in-decile-percent",
    "title": "Get ssb data",
    "section": "Household income before and after tax in decile (percent)",
    "text": "Household income before and after tax in decile (percent)\n\nPercent relative to national decile.\n\n\n\n\n\n\nCode\ninc_dec_2017 <- ApiData(\n    urlToData = \"12558\",\n    ContentsCode = \"AndelHush\",\n    Desiler = c(paste(0, 1:9, sep = \"\"), \"10\"),\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\ninc_dec_2017 <- tibble(\n  # want knr\n  knr = inc_dec_2017$dataset$Region , \n  # want level descriptions, not code\n  tax = inc_dec_2017$`12558: Husholdninger, etter region, inntekt før/etter skatt, desil, statistikkvariabel og år`$`inntekt før/etter skatt`,\n  decile = inc_dec_2017$dataset$Desiler,\n  percent = inc_dec_2017$dataset$value\n  )\n\n\n\n\n\nCode\ninc_dec_2017 <- inc_dec_2017 %>% \n  mutate(\n    tax = case_when(\n      # income before and after tax\n      tax == \"Samlet inntekt\" ~ \"inc_bt\",\n      tax == \"Inntekt etter skatt\" ~ \"inc_at\",\n      TRUE ~ as.character(tax)\n    )\n  ) %>%\n  pivot_wider(\n     id_cols = knr, \n     names_from = c(\"tax\", \"decile\"), \n     values_from = \"percent\"\n     )"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-before-and-after-tax-in-decile-percent-cont.",
    "href": "spatmetrics/data/index.html#household-income-before-and-after-tax-in-decile-percent-cont.",
    "title": "Get ssb data",
    "section": "Household income before and after tax in decile (percent) cont.",
    "text": "Household income before and after tax in decile (percent) cont.\n\n\nCode\n# we are tidy\nprint(head(inc_dec_2017))\n\n\n# A tibble: 6 × 21\n  knr   inc_bt…¹ inc_b…² inc_b…³ inc_b…⁴ inc_b…⁵ inc_b…⁶ inc_b…⁷ inc_b…⁸ inc_b…⁹\n  <chr>    <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>\n1 0101      11.7    12      11.3    10.4    10.5    10.5    10       9.7     8.3\n2 0104      10.7    12.2    11.5    11.3    10.4    10.3     9.1     8.6     8.4\n3 0105      10.8    12      10.5    11      10.6    10.6    10.5    10.1     7.9\n4 0106      10.7    11.4    10.2    10.8    10.3    10.2    10.1     9.7     9.1\n5 0111       7.5     8.3     9.4     9.2    10.8    11.6    10.6    11.5    10.3\n6 0118       9.6    11.9     9      10.1    11.3    11.3    11.9    10.6     7.9\n# … with 11 more variables: inc_bt_10 <dbl>, inc_at_01 <dbl>, inc_at_02 <dbl>,\n#   inc_at_03 <dbl>, inc_at_04 <dbl>, inc_at_05 <dbl>, inc_at_06 <dbl>,\n#   inc_at_07 <dbl>, inc_at_08 <dbl>, inc_at_09 <dbl>, inc_at_10 <dbl>, and\n#   abbreviated variable names ¹​inc_bt_01, ²​inc_bt_02, ³​inc_bt_03, ⁴​inc_bt_04,\n#   ⁵​inc_bt_05, ⁶​inc_bt_06, ⁷​inc_bt_07, ⁸​inc_bt_08, ⁹​inc_bt_09\n\n\n\n\nCode\ndim(inc_dec_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#industries",
    "href": "spatmetrics/data/index.html#industries",
    "title": "Get ssb data",
    "section": "Industries",
    "text": "Industries\n\n\n\n\nCode\nnum_emp_2017_ssb <- ApiData(\n    urlToData = \"07196\",\n    OrgFormer = c(\"99\",\"02\",\"03\",\"04\",\"10\",\"24\"),\n    AntAnsatte = c(\"99\", \"00\", \"01\",\"02\",\"03\",\"04\",\"05\",\"15\",\"16\"),\n    NACE2007 = c(\"01-99\"),\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n#so that we keep the ssb data\nnum_emp_2017 <- num_emp_2017_ssb$`07196: Foretak (1.1.) unntatt offentlig forvaltning og primærnæringene, etter region, organisasjonsform, næring (SN2007), antall ansatte, statistikkvariabel og år`\nnum_emp_2017$knr <- num_emp_2017_ssb$dataset$Region\n\n\n\n\n\nCode\nnum_emp_2017 <- num_emp_2017 %>% \n  # drop two variables\n  select(-region, -statistikkvariabel, -år, -`næring (SN2007)`) %>% \n  # want knr to the left, really not necessary \n  select(knr,everything()) %>% \n  # rename before pivot to names liked by R\n  rename(\n    org_form = organisasjonsform,\n    num_emp_group = `antall ansatte`,\n    firms = value\n  )\n\nnum_emp_2017 <-  num_emp_2017 %>% \n  pivot_wider(\n     id_cols = knr, \n     names_from = c(\"org_form\", \"num_emp_group\"), \n     values_from = \"firms\"\n     )"
  },
  {
    "objectID": "spatmetrics/data/index.html#industries-cont.",
    "href": "spatmetrics/data/index.html#industries-cont.",
    "title": "Get ssb data",
    "section": "Industries cont.",
    "text": "Industries cont.\n\n\nCode\n# we are tidy\nprint(head(num_emp_2017))\n\n\n# A tibble: 6 × 55\n  knr   I alt_…¹ I alt…² I alt…³ I alt…⁴ I alt…⁵ I alt…⁶ I alt…⁷ I alt…⁸ I alt…⁹\n  <chr>    <int>   <int>   <int>   <int>   <int>   <int>   <int>   <int>   <int>\n1 0101      2098    1407     414     142      82      40       8       3       2\n2 0104      2550    1698     534     153      87      55      11      11       1\n3 0105      3564    2255     782     261     161      69      19      14       3\n4 0106      6035    3994    1251     384     231     119      32      19       5\n5 0111       429     306      87      25       8       3       0       0       0\n6 0118       114      88      18       5       3       0       0       0       0\n# … with 45 more variables: `Ansvarlig selskap_Alle størrelsesgrupper` <int>,\n#   `Ansvarlig selskap_Ingen ansatte` <int>,\n#   `Ansvarlig selskap_1-4 ansatte` <int>,\n#   `Ansvarlig selskap_5-9 ansatte` <int>,\n#   `Ansvarlig selskap_10-19 ansatte` <int>,\n#   `Ansvarlig selskap_20-49 ansatte` <int>,\n#   `Ansvarlig selskap_50-99 ansatte` <int>, …\n\n\n\n\nCode\ndim(num_emp_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#supply-of-single-family-dwellings-sfd",
    "href": "spatmetrics/data/index.html#supply-of-single-family-dwellings-sfd",
    "title": "Get ssb data",
    "section": "Supply of single family dwellings (SFD)",
    "text": "Supply of single family dwellings (SFD)\n\n\nCode\nsup_sfd_2017 <- ApiData(\n    urlToData = \"05940\",\n    Byggeareal = c(\"111\", \"112\"),\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\nsup_sfd_2017 <- sup_sfd_2017$`05940: Boligbygg, etter region, bygningstype, statistikkvariabel og år` %>% \n  as_tibble() %>% \n  mutate(region = sup_sfd_2017$dataset$Region) %>% \n  rename(knr = region) %>% \n  select(-år) %>% \n  unite(tmp, bygningstype, statistikkvariabel, sep = \"_\") %>% \n    pivot_wider(\n     id_cols = knr, \n     names_from = \"tmp\", \n     values_from = \"value\"\n     ) %>% \n  # sfd Single Family Dwelling\n  # We have to escape the old variable names because of the spaces \n  rename(\n    sfd_started = `Enebolig_Igangsatte boliger`,\n    sfd_ba_started = `Enebolig_Bruksareal igangsatte boliger (m²)`,\n    sfd_ba_completed = `Enebolig_Bruksareal fullførte boliger (m²)`,\n    # w2u with 2 units\n    sfd_w2u_started = `Enebolig med hybelleilighet, sokkelleilighet o.l._Igangsatte boliger`,\n    sfd_w2u_ba_started = `Enebolig med hybelleilighet, sokkelleilighet o.l._Bruksareal igangsatte boliger (m²)`,\n    sfd_w2u_ba_completed = `Enebolig med hybelleilighet, sokkelleilighet o.l._Bruksareal fullførte boliger (m²)`  \n    )"
  },
  {
    "objectID": "spatmetrics/data/index.html#supply-of-single-family-dwellings-sfd-cont.",
    "href": "spatmetrics/data/index.html#supply-of-single-family-dwellings-sfd-cont.",
    "title": "Get ssb data",
    "section": "Supply of single family dwellings (SFD) cont.",
    "text": "Supply of single family dwellings (SFD) cont.\n\n\nCode\n# we are tidy\nprint(head(sup_sfd_2017, n = 8))\n\n\n# A tibble: 8 × 7\n  knr   sfd_started sfd_ba_started sfd_ba_completed sfd_w2u_st…¹ sfd_w…² sfd_w…³\n  <chr>       <int>          <int>            <int>        <int>   <int>   <int>\n1 0101           69          11933             9014           20    1998    1907\n2 0104           20           4401             2879            2     325     291\n3 0105           27           7744            10480           14    1740    2139\n4 0106           80          15658            15084           20    2500    2236\n5 0111           18           3223             4013            0       0     303\n6 0118            0              0              338            0       0       0\n7 0119           10           1942             1526            0       0       0\n8 0121            1            156              156            0       0       0\n# … with abbreviated variable names ¹​sfd_w2u_started, ²​sfd_w2u_ba_started,\n#   ³​sfd_w2u_ba_completed\n\n\n\n\nCode\ndim(sup_sfd_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#centrality-index",
    "href": "spatmetrics/data/index.html#centrality-index",
    "title": "Get ssb data",
    "section": "Centrality index",
    "text": "Centrality index\n\nFrom SSB, for the year 2018, but we use it for 2017. Probably very small changes from 2017 to 2018. Changed knr for Trøndelag to the old numbers. Split 5054 Indre Fosen into 1624 Rissa and 1718 Leksvik. The last two was given the same centrality as the combined entity.\n\n\n\n\nCode\ncentrality_2018_ed <- read_excel(\"Sentralitet 2018_ed.xlsx\")"
  },
  {
    "objectID": "spatmetrics/data/index.html#centrality-index-cont.",
    "href": "spatmetrics/data/index.html#centrality-index-cont.",
    "title": "Get ssb data",
    "section": "Centrality index cont.",
    "text": "Centrality index cont.\n\n\nCode\nprint(head(centrality_2018_ed))\n\n\n# A tibble: 6 × 3\n  knr   sen_ind sen_kl\n  <chr>   <dbl>  <dbl>\n1 0101      843      3\n2 0104      932      1\n3 0105      887      2\n4 0106      884      2\n5 0111      725      4\n6 0118      660      4"
  },
  {
    "objectID": "spatmetrics/data/index.html#put-it-all-together",
    "href": "spatmetrics/data/index.html#put-it-all-together",
    "title": "Get ssb data",
    "section": "Put it all together",
    "text": "Put it all together\n\n\nCode\nnames(pm2_2017)\n\n\n[1] \"knr\"                \"pm2\"                \"num_dwelling_sales\"\n\n\nCode\ndata_2017 <- knr_and_knavn %>% \n  left_join(pm2_2017) %>% \n  left_join(bef_2017) %>% \n  left_join(edu_2017) %>% \n  left_join(inc_2017) %>% \n  left_join(gov_emp_2017) %>%\n  left_join(sales_per_capita_2017) %>%\n  left_join(inc_dec_2017) %>%\n  left_join(wealth_2017) %>% \n  left_join(num_emp_2017) %>%\n  left_join(sup_sfd_2017) %>% \n  left_join(centrality_2018_ed ) %>% \n  mutate(\n    log_pm2 = log(pm2),\n    spc_100k = spc/100000,\n    gov_emp_1k = gov_emp/1000,\n    sen_ind_1k = sen_ind/1000\n  ) %>% \n  # rearrange \n  select(knr, kNavn, pm2, log_pm2, everything())"
  },
  {
    "objectID": "spatmetrics/data/index.html#put-it-all-together-cont.",
    "href": "spatmetrics/data/index.html#put-it-all-together-cont.",
    "title": "Get ssb data",
    "section": "Put it all together cont.",
    "text": "Put it all together cont.\n\n\nCode\ndim(data_2017)\n\n\n[1] 426 115\n\n\n\nWe have 115 variables and 426 observations."
  },
  {
    "objectID": "spatmetrics/data/index.html#add-data-to-our-map",
    "href": "spatmetrics/data/index.html#add-data-to-our-map",
    "title": "Get ssb data",
    "section": "Add data to our map",
    "text": "Add data to our map\n\n\nCode\n# join map and data\nmap_data_2017 <- map_2017 %>% \n  left_join(data_2017)\n# write out new map with data\n# if one add new variables it might \n# be necessary to delete the file \n# before writing new version\nst_write(\n  obj = map_data_2017, \n  dsn = \"map_data_2017.gpkg\", \n  driver = \"GPKG\", \n  append = FALSE\n  )\n\n\nDeleting layer `map_data_2017' using driver `GPKG'\nWriting layer `map_data_2017' to data source `map_data_2017.gpkg' using driver `GPKG'\nWriting 426 features with 115 fields and geometry type Multi Polygon."
  },
  {
    "objectID": "spatmetrics/data/index.html#references",
    "href": "spatmetrics/data/index.html#references",
    "title": "Get ssb data",
    "section": "References",
    "text": "References\n\n\nMSB205\n\n\n\nBivand, Roger. 2022a. “R Packages for Analyzing Spatial Data: A Comparative Case Study with Areal Data.” Geographical Analysis 54 (3): 488–518. https://doi.org/10.1111/gean.12319.\n\n\n———. 2022b. Spdep: Spatial Dependence: Weighting Schemes, Statistics. https://CRAN.R-project.org/package=spdep.\n\n\nBivand, Roger S., Edzer Pebesma, and Virgilio Gomez-Rubio. 2013a. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013b. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013c. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\nBivand, Roger, Jan Hauke, and Tomasz Kossowski. 2013. “Computing the Jacobian in Gaussian Spatial Autoregressive Models: An Illustrated Comparison of Available Methods.” Geographical Analysis 45 (2): 150–79. https://doi.org/10.1111/gean.12008.\n\n\nBivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. “A Review of Software for Spatial Econometrics in R.” Mathematics 9 (11). https://doi.org/10.3390/math9111276.\n\n\nBivand, Roger, and Gianfranco Piras. 2015. “Comparing Implementations of Estimation Methods for Spatial Econometrics.” Journal of Statistical Software 63 (18): 1–36. https://doi.org/10.18637/jss.v063.i18.\n\n\n———. 2022. Spatialreg: Spatial Regression Analysis. https://CRAN.R-project.org/package=spatialreg.\n\n\nBivand, Roger, and David W. S. Wong. 2018. “Comparing Implementations of Global and Local Indicators of Spatial Association.” TEST 27 (3): 716–48. https://doi.org/10.1007/s11749-018-0599-x.\n\n\nHugh-Jones, David. 2022. Huxtable: Easily Create and Style Tables for LaTeX, HTML and Other Formats. https://hughjonesd.github.io/huxtable/.\n\n\nImdad, M. U., M. Aslam, S. Altaf, and A. Munir. 2019. “Some New Diagnostics of Multicollinearity in Linear Regression Model.” Sains Malaysiana 48(9): 2051–60. http://dx.doi.org/10.17576/jsm-2019-4809-26.\n\n\nImdadullah, M., M. Aslam, and S. Altaf. 2016. “Mctest: An r Package for Deteection of Collinearity Among Regressors.” The R Journal 8(2): 499–509. https://journal.r-project.org/archive/2016/RJ-2016-062/index.html.\n\n\nLangsrud, Øyvind, and Jan Bruusgaard. 2021. PxWebApiData: PX-Web Data by API. https://github.com/statisticsnorway/PxWebApiData.\n\n\nMuhammad, Imdad Ullah, and Aslam Muhammad. 2020. Mctest: Multicollinearity Diagnostic Measures. https://CRAN.R-project.org/package=mctest.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\nPebesma, Edzer J., and Roger S. Bivand. 2005. “Classes and Methods for Spatial Data in R.” R News 5 (2): 9–13. https://CRAN.R-project.org/doc/Rnews/.\n\n\nPebesma, Edzer, and Roger Bivand. 2022. Sp: Classes and Methods for Spatial Data. https://CRAN.R-project.org/package=sp.\n\n\nRobinson, David, Alex Hayes, and Simon Couch. 2022. Broom: Convert Statistical Objects into Tidy Tibbles. https://CRAN.R-project.org/package=broom.\n\n\nTennekes, Martijn. 2018. “tmap: Thematic Maps in R.” Journal of Statistical Software 84 (6): 1–39. https://doi.org/10.18637/jss.v084.i06.\n\n\n———. 2022. Tmap: Thematic Maps. https://github.com/r-tmap/tmap.\n\n\nWickham, Hadley. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, and Jennifer Bryan. 2022. Readxl: Read Excel Files. https://CRAN.R-project.org/package=readxl."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "MSB205",
    "section": "",
    "text": "To learn more about Quarto websites visit https://quarto.org/docs/websites."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-4",
    "href": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-4",
    "title": "Spatial Hedonic Model",
    "section": "Dataset info (R help)",
    "text": "Dataset info (R help)\nIts projection is CRS(+init=epsg:2834), the Ohio North State Plane."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf",
    "href": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf",
    "title": "Spatial Hedonic Model",
    "section": "From SpatialPointsDataFrame to sf",
    "text": "From SpatialPointsDataFrame to sf\nWe convert from SpatialPointsDataFrame to sf (simple feature, point).\n\n\nCode\nhist(100*house_sf$age, breaks = 30)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.",
    "href": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.",
    "title": "Spatial Hedonic Model",
    "section": "From SpatialPointsDataFrame to sf cont.",
    "text": "From SpatialPointsDataFrame to sf cont.\n\n\nCode\nsummary(100*house_sf$age)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   1.00   35.00   49.00   53.66   75.00  164.00 \n\n\n\n\nCode\nmy_age <- as.numeric(levels(house_sf$syear))[as.integer(house_sf$syear)] - house_sf$yrbuilt\nmy_age <- my_age + 3\nmy_age1 <- 1999 - house_sf$yrbuilt\n\n\n\n\nCode\nsummary(100*house_sf$age - my_age)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n-2.0000 -1.0000  0.0000  0.2981  2.0000  3.0000"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.-1",
    "href": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.-1",
    "title": "Spatial Hedonic Model",
    "section": "From SpatialPointsDataFrame to sf cont.",
    "text": "From SpatialPointsDataFrame to sf cont.\n\n\nCode\nhist(my_age1, breaks = 30)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.-2",
    "href": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.-2",
    "title": "Spatial Hedonic Model",
    "section": "From SpatialPointsDataFrame to sf cont.",
    "text": "From SpatialPointsDataFrame to sf cont.\n\n\nCode\nsummary(my_age1)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   1.00   35.00   49.00   53.66   75.00  164.00 \n\n\nCode\ntable(round(my_age1, 3) == round(100*house_sf$age, 3))\n\n\n\n TRUE \n25357"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#running-the-first-model-cont.",
    "href": "spatmetrics/LucasCounty/index.html#running-the-first-model-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Running the first model cont.",
    "text": "Running the first model cont.\n\n\nCode\nsummary(lm1)\n\n\n\nCall:\nlm(formula = hmod1, data = red_house_sf)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.28253 -0.17076  0.04916  0.23925  2.19288 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)      3.18294    0.24525  12.979  < 2e-16 ***\nI(age_sold)      1.36458    0.18896   7.222 6.49e-13 ***\nI(age_sold^2)   -3.07357    0.35572  -8.640  < 2e-16 ***\nI(age_sold^3)    0.69686    0.19888   3.504 0.000465 ***\nI(log(TLA))      0.87255    0.03930  22.203  < 2e-16 ***\nI(log(lotsize))  0.17240    0.01170  14.736  < 2e-16 ***\nrooms            0.02096    0.01216   1.723 0.084952 .  \nbeds            -0.03325    0.01771  -1.877 0.060574 .  \nsyear1994        0.06870    0.02856   2.406 0.016201 *  \nsyear1995        0.09797    0.02789   3.513 0.000450 ***\nsyear1996        0.14211    0.02746   5.176 2.42e-07 ***\nsyear1997        0.16377    0.02710   6.043 1.70e-09 ***\nsyear1998        0.26449    0.02802   9.439  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4175 on 2987 degrees of freedom\nMultiple R-squared:  0.6897,    Adjusted R-squared:  0.6884 \nF-statistic: 553.2 on 12 and 2987 DF,  p-value: < 2.2e-16"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-start-with-sdem-cont.",
    "href": "spatmetrics/LucasCounty/index.html#local-start-with-sdem-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Local, start with SDEM cont.",
    "text": "Local, start with SDEM cont.\n\n\nCode\nsummary(impacts(SDEM), zstats = TRUE)\n\n\nImpact measures (SDEM, estimable, n):\n                     Direct     Indirect       Total\nI(age_sold)      0.54354495  1.724313763  2.26785872\nI(age_sold^2)   -1.21151106 -3.154619724 -4.36613078\nI(age_sold^3)    0.11989915  0.858429426  0.97832858\nI(log(TLA))      0.72161017  0.325829444  1.04743962\nI(log(lotsize))  0.12000068  0.002125825  0.12212651\nrooms            0.02297956  0.022089512  0.04506907\nbeds            -0.02377263 -0.044374996 -0.06814763\nsyear1994        0.05822351  0.014444954  0.07266846\nsyear1995        0.08315349 -0.081602445  0.00155105\nsyear1996        0.11349889 -0.004495018  0.10900387\nsyear1997        0.15008363 -0.051995070  0.09808856\nsyear1998        0.25156113  0.082365747  0.33392688\n========================================================\nStandard errors:\n                    Direct   Indirect      Total\nI(age_sold)     0.18923927 0.38948601 0.43443469\nI(age_sold^2)   0.34201530 0.75080528 0.85762746\nI(age_sold^3)   0.18247954 0.42982524 0.49956776\nI(log(TLA))     0.03385523 0.08982915 0.10418040\nI(log(lotsize)) 0.01291015 0.02403307 0.02544146\nrooms           0.01026090 0.02939071 0.03485904\nbeds            0.01499544 0.04409250 0.05258579\nsyear1994       0.02411830 0.07143272 0.08526701\nsyear1995       0.02367407 0.06854508 0.08227209\nsyear1996       0.02326275 0.06749020 0.08095887\nsyear1997       0.02276712 0.06575233 0.07821040\nsyear1998       0.02378814 0.06937785 0.08321369\n========================================================\nZ-values:\n                    Direct    Indirect       Total\nI(age_sold)      2.8722631  4.42715202  5.22025240\nI(age_sold^2)   -3.5422715 -4.20164829 -5.09094101\nI(age_sold^3)    0.6570553  1.99715921  1.95835012\nI(log(TLA))     21.3145857  3.62721279 10.05409494\nI(log(lotsize))  9.2950616  0.08845415  4.80029465\nrooms            2.2395272  0.75158132  1.29289471\nbeds            -1.5853238 -1.00640696 -1.29593239\nsyear1994        2.4140802  0.20221761  0.85224590\nsyear1995        3.5124295 -1.19049312  0.01885269\nsyear1996        4.8789969 -0.06660253  1.34641049\nsyear1997        6.5921205 -0.79077157  1.25416262\nsyear1998       10.5750638  1.18720529  4.01288416\n\np-values:\n                Direct            Indirect     Total        \nI(age_sold)     0.00407544        0.0000095485 0.00000017868\nI(age_sold^2)   0.00039670        0.0000264979 0.00000035629\nI(age_sold^3)   0.51114534        0.0458079    0.050189     \nI(log(TLA))     < 2.22e-16        0.0002865    < 2.22e-16   \nI(log(lotsize)) < 2.22e-16        0.9295157    0.00000158432\nrooms           0.02512163        0.4523029    0.196047     \nbeds            0.11289279        0.3142198    0.194999     \nsyear1994       0.01577499        0.8397466    0.394078     \nsyear1995       0.00044403        0.2338526    0.984959     \nsyear1996       0.000001066267611 0.9468981    0.178170     \nsyear1997       0.000000000043359 0.4290773    0.209783     \nsyear1998       < 2.22e-16        0.2351467    0.00005998135"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-sem-cont.",
    "href": "spatmetrics/LucasCounty/index.html#local-sem-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Local, SEM cont.",
    "text": "Local, SEM cont.\n\n\nCode\n# normal summary, no impacts\nsummary(SEM)\n\n\n\nCall:errorsarlm(formula = hmod1, data = red_house_sf, listw = red_house_sf_w, \n    Durbin = FALSE)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-2.247145 -0.123725  0.048252  0.183358  1.409720 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                  Estimate Std. Error z value  Pr(>|z|)\n(Intercept)      4.5722371  0.2218972 20.6052 < 2.2e-16\nI(age_sold)      0.4324416  0.1929360  2.2414 0.0250019\nI(age_sold^2)   -1.2513269  0.3432463 -3.6456 0.0002668\nI(age_sold^3)    0.2529478  0.1798265  1.4066 0.1595397\nI(log(TLA))      0.6881769  0.0328172 20.9700 < 2.2e-16\nI(log(lotsize))  0.1547907  0.0129766 11.9285 < 2.2e-16\nrooms            0.0203277  0.0094133  2.1595 0.0308137\nbeds            -0.0154644  0.0134197 -1.1524 0.2491686\nsyear1994        0.0591256  0.0214624  2.7549 0.0058719\nsyear1995        0.1019680  0.0209649  4.8638 1.152e-06\nsyear1996        0.1156346  0.0206226  5.6072 2.057e-08\nsyear1997        0.1581283  0.0206646  7.6521 1.976e-14\nsyear1998        0.2419856  0.0210379 11.5024 < 2.2e-16\n\nLambda: 0.71779, LR test value: 1068.1, p-value: < 2.22e-16\nAsymptotic standard error: 0.012617\n    z-value: 56.889, p-value: < 2.22e-16\nWald statistic: 3236.4, p-value: < 2.22e-16\n\nLog likelihood: -1095.658 for error model\nML residual variance (sigma squared): 0.10709, (sigma: 0.32725)\nNumber of observations: 3000 \nNumber of parameters estimated: 15 \nAIC: 2221.3, (AIC for lm: 3287.4)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-slx-cont.",
    "href": "spatmetrics/LucasCounty/index.html#local-slx-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Local, SLX cont.",
    "text": "Local, SLX cont.\n\n\nCode\n# NEW\nsummary(SLX)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.14787 -0.16031  0.03406  0.21892  1.74104 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)          1.38667    0.39699   3.493 0.000485 ***\nI.age_sold.          0.38157    0.22873   1.668 0.095382 .  \nI.age_sold.2.       -0.85171    0.40573  -2.099 0.035883 *  \nI.age_sold.3.       -0.09377    0.21181  -0.443 0.658017    \nI.log.TLA..          0.73652    0.03866  19.052  < 2e-16 ***\nI.log.lotsize..      0.12926    0.01603   8.065 1.05e-15 ***\nrooms                0.01628    0.01124   1.449 0.147501    \nbeds                -0.02206    0.01622  -1.360 0.173951    \nsyear1994            0.05145    0.02611   1.970 0.048899 *  \nsyear1995            0.07881    0.02553   3.086 0.002045 ** \nsyear1996            0.11734    0.02513   4.670 3.15e-06 ***\nsyear1997            0.14640    0.02488   5.885 4.41e-09 ***\nsyear1998            0.23996    0.02566   9.351  < 2e-16 ***\nlag.I.age_sold.      1.15103    0.30450   3.780 0.000160 ***\nlag.I.age_sold.2.   -1.64942    0.57575  -2.865 0.004202 ** \nlag.I.age_sold.3.   -0.19096    0.32339  -0.591 0.554896    \nlag.I.log.TLA..      0.53352    0.07137   7.475 1.01e-13 ***\nlag.I.log.lotsize.. -0.03657    0.02014  -1.815 0.069590 .  \nlag.rooms           -0.02126    0.02312  -0.920 0.357889    \nlag.beds            -0.07522    0.03587  -2.097 0.036045 *  \nlag.syear1994        0.00707    0.05885   0.120 0.904383    \nlag.syear1995       -0.11414    0.05515  -2.070 0.038566 *  \nlag.syear1996        0.04710    0.05467   0.862 0.389028    \nlag.syear1997       -0.04288    0.05345  -0.802 0.422461    \nlag.syear1998        0.01115    0.05630   0.198 0.843002    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.3806 on 2975 degrees of freedom\nMultiple R-squared:  0.7432,    Adjusted R-squared:  0.7411 \nF-statistic: 358.7 on 24 and 2975 DF,  p-value: < 2.2e-16"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-slx-cont.-1",
    "href": "spatmetrics/LucasCounty/index.html#local-slx-cont.-1",
    "title": "Spatial Hedonic Model",
    "section": "Local, SLX cont.",
    "text": "Local, SLX cont.\n\n\nCode\nsummary(impacts(SLX))\n\n\nImpact measures (SlX, estimable, n-k):\n                     Direct    Indirect        Total\nI(age_sold)      0.38156590  1.15103005  1.532595952\nI(age_sold^2)   -0.85170575 -1.64942197 -2.501127726\nI(age_sold^3)   -0.09376923 -0.19096402 -0.284733249\nI(log(TLA))      0.73652194  0.53352169  1.270043628\nI(log(lotsize))  0.12925829 -0.03656680  0.092691491\nrooms            0.01628444 -0.02125872 -0.004974276\nbeds            -0.02206352 -0.07522198 -0.097285494\nsyear1994        0.05145317  0.00707043  0.058523597\nsyear1995        0.07880749 -0.11414540 -0.035337908\nsyear1996        0.11733890  0.04710113  0.164440031\nsyear1997        0.14640447 -0.04288481  0.103519660\nsyear1998        0.23996283  0.01115155  0.251114383\n========================================================\nStandard errors:\n                    Direct   Indirect      Total\nI(age_sold)     0.22872967 0.30449602 0.24918360\nI(age_sold^2)   0.40572698 0.57575170 0.50525662\nI(age_sold^3)   0.21181383 0.32339030 0.30064908\nI(log(TLA))     0.03865767 0.07137542 0.07111016\nI(log(lotsize)) 0.01602681 0.02014448 0.01484568\nrooms           0.01124002 0.02311892 0.02442589\nbeds            0.01622385 0.03586492 0.03868248\nsyear1994       0.02611467 0.05885307 0.06406798\nsyear1995       0.02553422 0.05515050 0.06017843\nsyear1996       0.02512742 0.05467291 0.05970609\nsyear1997       0.02487559 0.05345438 0.05731268\nsyear1998       0.02566200 0.05630042 0.06152147\n========================================================\nZ-values:\n                    Direct   Indirect      Total\nI(age_sold)      1.6681959  3.7801153  6.1504688\nI(age_sold^2)   -2.0992091 -2.8648148 -4.9502127\nI(age_sold^3)   -0.4426965 -0.5905063 -0.9470618\nI(log(TLA))     19.0524144  7.4748656 17.8602283\nI(log(lotsize))  8.0651294 -1.8152268  6.2436693\nrooms            1.4487917 -0.9195379 -0.2036477\nbeds            -1.3599432 -2.0973689 -2.5149753\nsyear1994        1.9702784  0.1201370  0.9134610\nsyear1995        3.0863483 -2.0697075 -0.5872189\nsyear1996        4.6697557  0.8615077  2.7541587\nsyear1997        5.8854663 -0.8022693  1.8062261\nsyear1998        9.3509031  0.1980722  4.0817360\n\np-values:\n                Direct     Indirect   Total           \nI(age_sold)     0.0952768  0.00015676 0.00000000077254\nI(age_sold^2)   0.0357985  0.00417253 0.00000074132419\nI(age_sold^3)   0.6579853  0.55485125 0.3436073       \nI(log(TLA))     < 2.22e-16 7.7272e-14 < 2.22e-16      \nI(log(lotsize)) 6.6613e-16 0.06948906 0.00000000042742\nrooms           0.1473958  0.35781429 0.8386288       \nbeds            0.1738479  0.03596093 0.0119041       \nsyear1994       0.0488065  0.90437463 0.3610001       \nsyear1995       0.0020263  0.03847974 0.5570567       \nsyear1996       3.0156e-06 0.38895846 0.0058843       \nsyear1997       3.9693e-09 0.42239720 0.0708830       \nsyear1998       < 2.22e-16 0.84298854 0.00004470055406"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sem-versus-sdem",
    "href": "spatmetrics/LucasCounty/index.html#sem-versus-sdem",
    "title": "Spatial Hedonic Model",
    "section": "SEM versus SDEM",
    "text": "SEM versus SDEM\n\n\nCode\nLR.Sarlm(SEM, SDEM)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = -266.63, df = 12, p-value < 2.2e-16\nsample estimates:\n Log likelihood of SEM Log likelihood of SDEM \n            -1095.6575              -962.3424 \n\n\nDiscard H0, do not restrict to SEM. We keep \\(\\theta > 0\\)."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdem-versus-slx",
    "href": "spatmetrics/LucasCounty/index.html#sdem-versus-slx",
    "title": "Spatial Hedonic Model",
    "section": "SDEM versus SLX",
    "text": "SDEM versus SLX\n\n\nCode\nLR.Sarlm(SDEM, SLX)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 767.28, df = 1, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDEM  Log likelihood of SLX \n             -962.3424             -1345.9840 \n\n\nWe discard H0 and will not restrict to SLX, continue with SDEM."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdem-versus-lm1",
    "href": "spatmetrics/LucasCounty/index.html#sdem-versus-lm1",
    "title": "Spatial Hedonic Model",
    "section": "SDEM versus lm1",
    "text": "SDEM versus lm1\n\n\nCode\nLR.Sarlm(SDEM, lm1)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 1334.7, df = 13, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDEM  Log likelihood of lm1 \n             -962.3424             -1629.6987 \n\n\nDiscard H0, we will not restrict to OLS."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#conclusion",
    "href": "spatmetrics/LucasCounty/index.html#conclusion",
    "title": "Spatial Hedonic Model",
    "section": "Conclusion",
    "text": "Conclusion\n\nWe end up with SDEM as the best local model.\n\nNo endogeniety in the price variable.\n\n\n\n\n\nCode\n# residuals are with attributes, hence as.vector()\nmoran.plot(SDEM$residuals, listw = red_house_sf_w)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sdm",
    "href": "spatmetrics/LucasCounty/index.html#global-sdm",
    "title": "Spatial Hedonic Model",
    "section": "Global; SDM",
    "text": "Global; SDM\n\n\nCode\n#\n# expensive to compute\nSDM <- lagsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = TRUE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sdm-impacts",
    "href": "spatmetrics/LucasCounty/index.html#global-sdm-impacts",
    "title": "Spatial Hedonic Model",
    "section": "Global; SDM impacts",
    "text": "Global; SDM impacts\n\n\nCode\n#\n# Computing the impacts is expensive too\nimpacts(SDM, listw = red_house_sf_w)\n\n\nImpact measures (mixed, exact):\n                     Direct     Indirect        Total\nI(age_sold)      0.44458343  1.998987232  2.443570658\nI(age_sold^2)   -1.00533917 -3.230813468 -4.236152639\nI(age_sold^3)    0.03747523  0.571379837  0.608855065\nI(log(TLA))      0.73179133  0.538408810  1.270200141\nI(log(lotsize))  0.11643717 -0.031417681  0.085019488\nrooms            0.01892389 -0.009570688  0.009353204\nbeds            -0.02425261 -0.074563783 -0.098816393\nsyear1994        0.05338215  0.010866667  0.064248814\nsyear1995        0.08036644 -0.127280373 -0.046913936\nsyear1996        0.11360203  0.019036422  0.132638448\nsyear1997        0.14408151 -0.083271804  0.060809708\nsyear1998        0.24456200  0.065133136  0.309695135"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sdm-impacts-cont.",
    "href": "spatmetrics/LucasCounty/index.html#global-sdm-impacts-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Global; SDM impacts cont.",
    "text": "Global; SDM impacts cont.\n\n\nCode\n#\n# Simulated, varies somewhat with each sample (note that seed is set above). Results might \n# differ with another seed\nsummary(impacts(SDM, listw = red_house_sf_w, R = 500), zstats = TRUE)\n\n\nImpact measures (mixed, exact):\n                     Direct     Indirect        Total\nI(age_sold)      0.44458343  1.998987232  2.443570658\nI(age_sold^2)   -1.00533917 -3.230813468 -4.236152639\nI(age_sold^3)    0.03747523  0.571379837  0.608855065\nI(log(TLA))      0.73179133  0.538408810  1.270200141\nI(log(lotsize))  0.11643717 -0.031417681  0.085019488\nrooms            0.01892389 -0.009570688  0.009353204\nbeds            -0.02425261 -0.074563783 -0.098816393\nsyear1994        0.05338215  0.010866667  0.064248814\nsyear1995        0.08036644 -0.127280373 -0.046913936\nsyear1996        0.11360203  0.019036422  0.132638448\nsyear1997        0.14408151 -0.083271804  0.060809708\nsyear1998        0.24456200  0.065133136  0.309695135\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      0.43570 0.19042 0.0085158      0.0085158\nI(age_sold^2)   -0.99295 0.34738 0.0155351      0.0155351\nI(age_sold^3)    0.03269 0.18442 0.0082475      0.0082475\nI(log(TLA))      0.73000 0.03447 0.0015415      0.0015415\nI(log(lotsize))  0.11661 0.01307 0.0005846      0.0005846\nrooms            0.01909 0.01092 0.0004882      0.0004882\nbeds            -0.02397 0.01598 0.0007145      0.0007145\nsyear1994        0.05506 0.02482 0.0011101      0.0012457\nsyear1995        0.08085 0.02429 0.0010863      0.0011869\nsyear1996        0.11416 0.02495 0.0011160      0.0011160\nsyear1997        0.14598 0.02399 0.0010726      0.0010726\nsyear1998        0.24526 0.02551 0.0011409      0.0010602\n\n2. Quantiles for each variable:\n\n                     2.5%      25%      50%      75%     97.5%\nI(age_sold)      0.095565  0.30503  0.44227  0.54876  0.809285\nI(age_sold^2)   -1.724104 -1.20116 -0.96789 -0.76943 -0.334029\nI(age_sold^3)   -0.315551 -0.09222  0.02300  0.15148  0.416582\nI(log(TLA))      0.665457  0.70655  0.72949  0.75204  0.799164\nI(log(lotsize))  0.090251  0.10840  0.11656  0.12512  0.142325\nrooms           -0.001500  0.01174  0.01959  0.02626  0.038572\nbeds            -0.055530 -0.03359 -0.02394 -0.01279  0.007231\nsyear1994        0.005699  0.03975  0.05516  0.07112  0.101494\nsyear1995        0.036205  0.06447  0.07939  0.09711  0.129766\nsyear1996        0.067438  0.09793  0.11354  0.13034  0.165083\nsyear1997        0.099891  0.12911  0.14580  0.16159  0.194748\nsyear1998        0.197348  0.22780  0.24600  0.26312  0.292044\n\n========================================================\nIndirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD Naive SE Time-series SE\nI(age_sold)      2.025320 0.46676 0.020874       0.019017\nI(age_sold^2)   -3.266763 0.92210 0.041238       0.037790\nI(age_sold^3)    0.584661 0.54236 0.024255       0.022181\nI(log(TLA))      0.535366 0.12898 0.005768       0.005357\nI(log(lotsize)) -0.030654 0.02804 0.001254       0.001254\nrooms           -0.009554 0.04452 0.001991       0.001991\nbeds            -0.073332 0.06929 0.003099       0.003349\nsyear1994        0.021722 0.11005 0.004922       0.004992\nsyear1995       -0.126917 0.10376 0.004640       0.004640\nsyear1996        0.019737 0.10825 0.004841       0.004841\nsyear1997       -0.076148 0.10519 0.004704       0.004704\nsyear1998        0.072323 0.10853 0.004854       0.004854\n\n2. Quantiles for each variable:\n\n                    2.5%      25%       50%       75%    97.5%\nI(age_sold)      1.15398  1.70131  2.008675  2.331730  3.00100\nI(age_sold^2)   -5.03359 -3.91820 -3.271442 -2.690050 -1.43346\nI(age_sold^3)   -0.50260  0.22930  0.598291  0.958270  1.61196\nI(log(TLA))      0.30486  0.44808  0.530356  0.622814  0.79635\nI(log(lotsize)) -0.08743 -0.04791 -0.032662 -0.012741  0.02549\nrooms           -0.09241 -0.03704 -0.008471  0.018965  0.07568\nbeds            -0.20182 -0.12365 -0.069357 -0.025177  0.05546\nsyear1994       -0.18232 -0.05392  0.016279  0.093570  0.23186\nsyear1995       -0.32440 -0.19655 -0.125605 -0.060039  0.08411\nsyear1996       -0.18293 -0.05864  0.020883  0.096351  0.22812\nsyear1997       -0.27454 -0.14934 -0.071229 -0.004911  0.12856\nsyear1998       -0.13039 -0.00286  0.070220  0.149466  0.27953\n\n========================================================\nTotal:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD Naive SE Time-series SE\nI(age_sold)      2.461016 0.50719 0.022682       0.019115\nI(age_sold^2)   -4.259714 1.01230 0.045271       0.041124\nI(age_sold^3)    0.617346 0.59918 0.026796       0.024313\nI(log(TLA))      1.265368 0.14348 0.006417       0.006417\nI(log(lotsize))  0.085955 0.02923 0.001307       0.001307\nrooms            0.009539 0.05049 0.002258       0.002258\nbeds            -0.097298 0.07854 0.003512       0.003798\nsyear1994        0.076780 0.12487 0.005584       0.005802\nsyear1995       -0.046069 0.11801 0.005278       0.005278\nsyear1996        0.133893 0.12292 0.005497       0.005497\nsyear1997        0.069828 0.11893 0.005319       0.004983\nsyear1998        0.317586 0.12483 0.005583       0.005583\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%      75%    97.5%\nI(age_sold)      1.45427  2.111280  2.49526  2.76011  3.48662\nI(age_sold^2)   -6.32389 -4.889165 -4.28008 -3.56764 -2.32134\nI(age_sold^3)   -0.57794  0.205209  0.62019  1.03076  1.84534\nI(log(TLA))      1.00436  1.167136  1.25655  1.36218  1.56029\nI(log(lotsize))  0.03000  0.066597  0.08467  0.10659  0.14223\nrooms           -0.08354 -0.024711  0.01104  0.04254  0.10627\nbeds            -0.24361 -0.154012 -0.09187 -0.04515  0.05514\nsyear1994       -0.14955 -0.009261  0.06750  0.16067  0.32880\nsyear1995       -0.26477 -0.122388 -0.04623  0.02764  0.18902\nsyear1996       -0.09288  0.047321  0.14036  0.21944  0.38363\nsyear1997       -0.15751 -0.017669  0.07465  0.14384  0.30954\nsyear1998        0.07058  0.235313  0.31418  0.40323  0.55379\n\n========================================================\nSimulated standard errors\n                    Direct   Indirect      Total\nI(age_sold)     0.19041885 0.46676400 0.50719217\nI(age_sold^2)   0.34737516 0.92209917 1.01229557\nI(age_sold^3)   0.18442029 0.54235807 0.59917636\nI(log(TLA))     0.03446933 0.12897668 0.14347930\nI(log(lotsize)) 0.01307219 0.02803738 0.02922747\nrooms           0.01091571 0.04451850 0.05049288\nbeds            0.01597671 0.06929074 0.07854027\nsyear1994       0.02482295 0.11005341 0.12486755\nsyear1995       0.02429102 0.10376346 0.11801248\nsyear1996       0.02495361 0.10825326 0.12291700\nsyear1997       0.02398517 0.10519073 0.11893279\nsyear1998       0.02551176 0.10853417 0.12483401\n\nSimulated z-values:\n                    Direct   Indirect      Total\nI(age_sold)      2.2880916  4.3390667  4.8522356\nI(age_sold^2)   -2.8584393 -3.5427457 -4.2079742\nI(age_sold^3)    0.1772314  1.0779973  1.0303237\nI(log(TLA))     21.1783112  4.1508715  8.8191672\nI(log(lotsize))  8.9203562 -1.0933185  2.9408911\nrooms            1.7491371 -0.2146006  0.1889252\nbeds            -1.5000821 -1.0583224 -1.2388335\nsyear1994        2.2180426  0.1973775  0.6148950\nsyear1995        3.3283225 -1.2231399 -0.3903728\nsyear1996        4.5747137  0.1823254  1.0892957\nsyear1997        6.0860982 -0.7239017  0.5871244\nsyear1998        9.6137168  0.6663654  2.5440680\n\nSimulated p-values:\n                Direct         Indirect    Total       \nI(age_sold)     0.02213218     0.000014309 0.0000012208\nI(age_sold^2)   0.00425731     0.00039598  0.0000257670\nI(age_sold^3)   0.85932663     0.28103497  0.3028581   \nI(log(TLA))     < 2.22e-16     0.000033121 < 2.22e-16  \nI(log(lotsize)) < 2.22e-16     0.27425396  0.0032727   \nrooms           0.08026732     0.83007876  0.8501515   \nbeds            0.13359315     0.28990849  0.2154072   \nsyear1994       0.02655193     0.84353210  0.5386240   \nsyear1995       0.00087371     0.22127688  0.6962609   \nsyear1996       0.000004768716 0.85532733  0.2760235   \nsyear1997       0.000000001157 0.46912608  0.5571201   \nsyear1998       < 2.22e-16     0.50517759  0.0109570"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sar",
    "href": "spatmetrics/LucasCounty/index.html#global-sar",
    "title": "Spatial Hedonic Model",
    "section": "Global SAR",
    "text": "Global SAR\n\n\nCode\n#\nSAR <- lagsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = FALSE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sar-cont.",
    "href": "spatmetrics/LucasCounty/index.html#global-sar-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Global SAR cont.",
    "text": "Global SAR cont.\n\n\nCode\n# NEW\nsummary(SAR)\n\n\n\nCall:lagsarlm(formula = hmod1, data = red_house_sf, listw = red_house_sf_w, \n    Durbin = FALSE)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-2.107445 -0.138104  0.035175  0.189967  1.226065 \n\nType: lag \nCoefficients: (asymptotic standard errors) \n                  Estimate Std. Error z value  Pr(>|z|)\n(Intercept)     -0.2514883  0.2074699 -1.2122 0.2254484\nI(age_sold)      1.1792030  0.1497421  7.8749 3.331e-15\nI(age_sold^2)   -2.1020853  0.2832284 -7.4219 1.155e-13\nI(age_sold^3)    0.4826410  0.1578425  3.0577 0.0022301\nI(log(TLA))      0.6415673  0.0317194 20.2263 < 2.2e-16\nI(log(lotsize))  0.0632934  0.0097473  6.4935 8.389e-11\nrooms            0.0098137  0.0096416  1.0178 0.3087538\nbeds            -0.0103466  0.0140334 -0.7373 0.4609509\nsyear1994        0.0530507  0.0226122  2.3461 0.0189707\nsyear1995        0.0831306  0.0220890  3.7634 0.0001676\nsyear1996        0.1124883  0.0217470  5.1726 2.309e-07\nsyear1997        0.1434820  0.0214686  6.6834 2.335e-11\nsyear1998        0.2302061  0.0222179 10.3613 < 2.2e-16\n\nRho: 0.53679, LR test value: 1211, p-value: < 2.22e-16\nAsymptotic standard error: 0.013019\n    z-value: 41.23, p-value: < 2.22e-16\nWald statistic: 1699.9, p-value: < 2.22e-16\n\nLog likelihood: -1024.179 for lag model\nML residual variance (sigma squared): 0.10922, (sigma: 0.33048)\nNumber of observations: 3000 \nNumber of parameters estimated: 15 \nAIC: 2078.4, (AIC for lm: 3287.4)\nLM test for residual autocorrelation\ntest value: 16.821, p-value: 0.000041075"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sar-impacts",
    "href": "spatmetrics/LucasCounty/index.html#global-sar-impacts",
    "title": "Spatial Hedonic Model",
    "section": "Global SAR impacts",
    "text": "Global SAR impacts\n\n\nCode\n#\nsummary(impacts(SAR, listw = red_house_sf_w, R = 500), zstats = TRUE)\n\n\nImpact measures (lag, exact):\n                     Direct    Indirect       Total\nI(age_sold)      1.26420440  1.28149989  2.54570429\nI(age_sold^2)   -2.25361156 -2.28444307 -4.53805462\nI(age_sold^3)    0.51743158  0.52451052  1.04194210\nI(log(TLA))      0.68781390  0.69722384  1.38503774\nI(log(lotsize))  0.06785580  0.06878413  0.13663994\nrooms            0.01052106  0.01066500  0.02118606\nbeds            -0.01109238 -0.01124413 -0.02233651\nsyear1994        0.05687482  0.05765292  0.11452773\nsyear1995        0.08912299  0.09034227  0.17946526\nsyear1996        0.12059686  0.12224674  0.24284360\nsyear1997        0.15382468  0.15592915  0.30975383\nsyear1998        0.24680025  0.25017671  0.49697696\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      1.26025 0.15977 0.0071450      0.0071450\nI(age_sold^2)   -2.24439 0.30058 0.0134423      0.0134423\nI(age_sold^3)    0.51261 0.16883 0.0075505      0.0075505\nI(log(TLA))      0.68739 0.03446 0.0015409      0.0015409\nI(log(lotsize))  0.06759 0.01040 0.0004651      0.0004651\nrooms            0.01021 0.01044 0.0004669      0.0004669\nbeds            -0.01100 0.01487 0.0006649      0.0006952\nsyear1994        0.05764 0.02449 0.0010951      0.0010951\nsyear1995        0.08795 0.02304 0.0010303      0.0009506\nsyear1996        0.12164 0.02300 0.0010284      0.0010284\nsyear1997        0.15275 0.02228 0.0009964      0.0009964\nsyear1998        0.24797 0.02337 0.0010451      0.0010451\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%       75%    97.5%\nI(age_sold)      0.95193  1.146580  1.26169  1.369476  1.56285\nI(age_sold^2)   -2.86083 -2.449798 -2.24210 -2.019410 -1.69138\nI(age_sold^3)    0.20056  0.386196  0.51102  0.626061  0.85781\nI(log(TLA))      0.61733  0.664741  0.68938  0.710671  0.75385\nI(log(lotsize))  0.04816  0.060242  0.06767  0.074200  0.08775\nrooms           -0.01036  0.003069  0.01005  0.016863  0.03122\nbeds            -0.03873 -0.021511 -0.01093 -0.001402  0.01758\nsyear1994        0.01349  0.040084  0.05661  0.073386  0.10991\nsyear1995        0.04036  0.072303  0.08829  0.103800  0.13469\nsyear1996        0.07525  0.105768  0.12192  0.136018  0.16755\nsyear1997        0.11034  0.137457  0.15303  0.169033  0.19775\nsyear1998        0.20171  0.231964  0.24718  0.263191  0.29284\n\n========================================================\nIndirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      1.28535 0.17304 0.0077384      0.0077384\nI(age_sold^2)   -2.28791 0.31545 0.0141071      0.0141071\nI(age_sold^3)    0.52215 0.17191 0.0076880      0.0076880\nI(log(TLA))      0.70101 0.04624 0.0020680      0.0020680\nI(log(lotsize))  0.06881 0.01027 0.0004592      0.0004592\nrooms            0.01040 0.01063 0.0004753      0.0004753\nbeds            -0.01122 0.01520 0.0006798      0.0007161\nsyear1994        0.05876 0.02501 0.0011183      0.0011183\nsyear1995        0.08967 0.02371 0.0010604      0.0009817\nsyear1996        0.12411 0.02436 0.0010896      0.0010896\nsyear1997        0.15576 0.02364 0.0010573      0.0010573\nsyear1998        0.25289 0.02626 0.0011743      0.0010732\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%       75%    97.5%\nI(age_sold)      0.98056  1.159990  1.28737  1.401580  1.60832\nI(age_sold^2)   -2.89437 -2.515919 -2.28766 -2.038621 -1.73314\nI(age_sold^3)    0.20727  0.396610  0.52308  0.640856  0.85633\nI(log(TLA))      0.61581  0.668739  0.69880  0.731618  0.78762\nI(log(lotsize))  0.04977  0.061999  0.06859  0.075324  0.08888\nrooms           -0.01058  0.003169  0.01018  0.017436  0.03188\nbeds            -0.03854 -0.021630 -0.01124 -0.001413  0.01811\nsyear1994        0.01366  0.041261  0.05775  0.075834  0.11084\nsyear1995        0.04134  0.074005  0.09025  0.104628  0.13693\nsyear1996        0.07679  0.109271  0.12332  0.139899  0.17421\nsyear1997        0.10973  0.138764  0.15444  0.172310  0.20128\nsyear1998        0.20578  0.234911  0.25280  0.269421  0.30551\n\n========================================================\nTotal:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      2.54560 0.32720 0.0146329      0.0146329\nI(age_sold^2)   -4.53229 0.60627 0.0271132      0.0271132\nI(age_sold^3)    1.03476 0.33978 0.0151952      0.0151952\nI(log(TLA))      1.38840 0.07422 0.0033194      0.0033194\nI(log(lotsize))  0.13640 0.02041 0.0009125      0.0009125\nrooms            0.02060 0.02106 0.0009416      0.0009416\nbeds            -0.02221 0.03005 0.0013441      0.0014106\nsyear1994        0.11641 0.04940 0.0022092      0.0022092\nsyear1995        0.17762 0.04654 0.0020815      0.0019233\nsyear1996        0.24575 0.04698 0.0021008      0.0021008\nsyear1997        0.30851 0.04530 0.0020259      0.0020259\nsyear1998        0.50085 0.04819 0.0021550      0.0020016\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%       75%    97.5%\nI(age_sold)      1.93314  2.302860  2.54386  2.773892  3.18479\nI(age_sold^2)   -5.73807 -4.955812 -4.53804 -4.069087 -3.46982\nI(age_sold^3)    0.40600  0.779277  1.03778  1.266064  1.70556\nI(log(TLA))      1.24824  1.340392  1.38644  1.441256  1.53225\nI(log(lotsize))  0.09875  0.122579  0.13666  0.149246  0.17677\nrooms           -0.02104  0.006228  0.02030  0.034402  0.06266\nbeds            -0.07717 -0.042681 -0.02233 -0.002814  0.03584\nsyear1994        0.02714  0.081830  0.11438  0.149401  0.21800\nsyear1995        0.08231  0.146453  0.17925  0.208317  0.26745\nsyear1996        0.15390  0.216484  0.24499  0.275720  0.34104\nsyear1997        0.21935  0.276633  0.30762  0.341804  0.39632\nsyear1998        0.41329  0.465082  0.50072  0.531943  0.59766\n\n========================================================\nSimulated standard errors\n                    Direct   Indirect      Total\nI(age_sold)     0.15976723 0.17303609 0.32720114\nI(age_sold^2)   0.30057961 0.31544513 0.60626867\nI(age_sold^3)   0.16883390 0.17190919 0.33977541\nI(log(TLA))     0.03445540 0.04624199 0.07422347\nI(log(lotsize)) 0.01039887 0.01026724 0.02040508\nrooms           0.01044088 0.01062763 0.02105534\nbeds            0.01486771 0.01520147 0.03005495\nsyear1994       0.02448819 0.02500572 0.04939863\nsyear1995       0.02303752 0.02371105 0.04654484\nsyear1996       0.02299602 0.02436439 0.04697513\nsyear1997       0.02228025 0.02364143 0.04530111\nsyear1998       0.02336821 0.02625869 0.04818774\n\nSimulated z-values:\n                    Direct   Indirect      Total\nI(age_sold)      7.8880583  7.4281924  7.7799196\nI(age_sold^2)   -7.4668589 -7.2529490 -7.4757169\nI(age_sold^3)    3.0361977  3.0373582  3.0454320\nI(log(TLA))     19.9501148 15.1596347 18.7056837\nI(log(lotsize))  6.4997999  6.7022049  6.6847881\nrooms            0.9774854  0.9782034  0.9784588\nbeds            -0.7396518 -0.7379508 -0.7391418\nsyear1994        2.3539528  2.3500092  2.3564971\nsyear1995        3.8178655  3.7815947  3.8160992\nsyear1996        5.2896726  5.0940188  5.2315784\nsyear1997        6.8558430  6.5884934  6.8102374\nsyear1998       10.6112557  9.6306610 10.3938194\n\nSimulated p-values:\n                Direct     Indirect   Total     \nI(age_sold)     3.1086e-15 1.1013e-13 7.3275e-15\nI(age_sold^2)   8.2157e-14 4.0790e-13 7.6827e-14\nI(age_sold^3)   0.00239582 0.00238662 0.00232346\nI(log(TLA))     < 2.22e-16 < 2.22e-16 < 2.22e-16\nI(log(lotsize)) 8.0427e-11 2.0530e-11 2.3126e-11\nrooms           0.32832888 0.32797373 0.32784747\nbeds            0.45951133 0.46054434 0.45982088\nsyear1994       0.01857497 0.01877295 0.01844821\nsyear1995       0.00013461 0.00015583 0.00013558\nsyear1996       1.2254e-07 3.5055e-07 1.6807e-07\nsyear1997       7.0892e-12 4.4431e-11 9.7438e-12\nsyear1998       < 2.22e-16 < 2.22e-16 < 2.22e-16"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#choosing-a-global-model",
    "href": "spatmetrics/LucasCounty/index.html#choosing-a-global-model",
    "title": "Spatial Hedonic Model",
    "section": "Choosing a global model",
    "text": "Choosing a global model\n\nSome of the models are estimated above so no reason to repeat a costly calculation."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdm-versus-sar",
    "href": "spatmetrics/LucasCounty/index.html#sdm-versus-sar",
    "title": "Spatial Hedonic Model",
    "section": "SDM versus SAR",
    "text": "SDM versus SAR\n\n\nCode\nLR.Sarlm(SDM, SAR)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 160.38, df = 12, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of SAR \n            -943.9908            -1024.1791 \n\n\nWe reject H0 and do not restrict to SAR. Keep SDM."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdm-versus-slx",
    "href": "spatmetrics/LucasCounty/index.html#sdm-versus-slx",
    "title": "Spatial Hedonic Model",
    "section": "SDM versus SLX",
    "text": "SDM versus SLX\n\n\nCode\n# SLX estimated above\nLR.Sarlm(SDM, SLX)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 803.99, df = 1, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of SLX \n            -943.9908            -1345.9840 \n\n\nWe reject H0 and do not restrict to SLX. Keep SDM."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdm-versus-sem",
    "href": "spatmetrics/LucasCounty/index.html#sdm-versus-sem",
    "title": "Spatial Hedonic Model",
    "section": "SDM versus SEM",
    "text": "SDM versus SEM\n\n\nCode\n# Common factor?\nLR.Sarlm(SDM, SEM)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 303.33, df = 12, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of SEM \n            -943.9908            -1095.6575 \n\n\nWe reject H0 and do not restrict to SEM. Keep SDM."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdm-versus-lm1",
    "href": "spatmetrics/LucasCounty/index.html#sdm-versus-lm1",
    "title": "Spatial Hedonic Model",
    "section": "SDM versus lm1",
    "text": "SDM versus lm1\n\n\nCode\nLR.Sarlm(SDM, lm1)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 1371.4, df = 13, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of lm1 \n            -943.9908            -1629.6987 \n\n\nWe reject H0 and do not restrict to OLS. SDM seems to be the best global model. We have spatial effects both in price and the explanatory variables. There is a strong negative indirect effect regarding number of rooms that might be regarded as counter intuitive and should perhaps be looked further into."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#impacts-sdm",
    "href": "spatmetrics/LucasCounty/index.html#impacts-sdm",
    "title": "Spatial Hedonic Model",
    "section": "Impacts SDM",
    "text": "Impacts SDM\n\n\nCode\nsummary(impacts(SDM, listw = red_house_sf_w, R = 1000), zstats = TRUE)\n\n\nImpact measures (mixed, exact):\n                     Direct     Indirect        Total\nI(age_sold)      0.44458343  1.998987232  2.443570658\nI(age_sold^2)   -1.00533917 -3.230813468 -4.236152639\nI(age_sold^3)    0.03747523  0.571379837  0.608855065\nI(log(TLA))      0.73179133  0.538408810  1.270200141\nI(log(lotsize))  0.11643717 -0.031417681  0.085019488\nrooms            0.01892389 -0.009570688  0.009353204\nbeds            -0.02425261 -0.074563783 -0.098816393\nsyear1994        0.05338215  0.010866667  0.064248814\nsyear1995        0.08036644 -0.127280373 -0.046913936\nsyear1996        0.11360203  0.019036422  0.132638448\nsyear1997        0.14408151 -0.083271804  0.060809708\nsyear1998        0.24456200  0.065133136  0.309695135\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      0.44163 0.19377 0.0061276      0.0061276\nI(age_sold^2)   -0.99382 0.35057 0.0110860      0.0102378\nI(age_sold^3)    0.02969 0.18626 0.0058901      0.0051524\nI(log(TLA))      0.73078 0.03257 0.0010299      0.0010863\nI(log(lotsize))  0.11679 0.01215 0.0003843      0.0003843\nrooms            0.01923 0.01035 0.0003274      0.0003274\nbeds            -0.02409 0.01587 0.0005018      0.0004713\nsyear1994        0.05342 0.02498 0.0007900      0.0007900\nsyear1995        0.08006 0.02421 0.0007657      0.0007657\nsyear1996        0.11402 0.02340 0.0007401      0.0007401\nsyear1997        0.14407 0.02386 0.0007545      0.0007545\nsyear1998        0.24365 0.02383 0.0007537      0.0007181\n\n2. Quantiles for each variable:\n\n                     2.5%      25%      50%      75%     97.5%\nI(age_sold)      0.074639  0.31072  0.44131  0.57788  0.823934\nI(age_sold^2)   -1.654443 -1.23954 -0.98375 -0.74901 -0.312213\nI(age_sold^3)   -0.331864 -0.09906  0.02408  0.16328  0.384121\nI(log(TLA))      0.662652  0.70997  0.73028  0.75257  0.794955\nI(log(lotsize))  0.093972  0.10851  0.11640  0.12506  0.141285\nrooms           -0.000960  0.01248  0.01921  0.02617  0.039231\nbeds            -0.056780 -0.03526 -0.02444 -0.01286  0.007228\nsyear1994        0.005384  0.03728  0.05332  0.06965  0.103500\nsyear1995        0.032870  0.06292  0.07937  0.09665  0.126562\nsyear1996        0.071023  0.09945  0.11395  0.12923  0.159480\nsyear1997        0.096356  0.12847  0.14491  0.16070  0.188601\nsyear1998        0.197509  0.22849  0.24247  0.25867  0.291718\n\n========================================================\nIndirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD  Naive SE Time-series SE\nI(age_sold)      1.994437 0.48431 0.0153152      0.0144140\nI(age_sold^2)   -3.229999 0.95731 0.0302729      0.0283359\nI(age_sold^3)    0.575901 0.55609 0.0175853      0.0151665\nI(log(TLA))      0.539949 0.12916 0.0040846      0.0040846\nI(log(lotsize)) -0.031352 0.02798 0.0008847      0.0008847\nrooms           -0.009271 0.04387 0.0013873      0.0013228\nbeds            -0.075175 0.07048 0.0022288      0.0022288\nsyear1994        0.007199 0.11337 0.0035849      0.0035849\nsyear1995       -0.126615 0.11073 0.0035017      0.0029545\nsyear1996        0.015906 0.10680 0.0033774      0.0033774\nsyear1997       -0.086813 0.10132 0.0032040      0.0032040\nsyear1998        0.063025 0.10730 0.0033932      0.0033932\n\n2. Quantiles for each variable:\n\n                    2.5%      25%       50%      75%    97.5%\nI(age_sold)      1.01684  1.66122  1.978365  2.32081  2.94284\nI(age_sold^2)   -5.11638 -3.84502 -3.221522 -2.61815 -1.35199\nI(age_sold^3)   -0.54360  0.21805  0.569439  0.93971  1.65820\nI(log(TLA))      0.27728  0.45640  0.542007  0.62837  0.78507\nI(log(lotsize)) -0.08540 -0.05012 -0.031308 -0.01405  0.02491\nrooms           -0.09071 -0.03874 -0.010332  0.02283  0.07262\nbeds            -0.21370 -0.12136 -0.075312 -0.02773  0.05845\nsyear1994       -0.20521 -0.06970  0.006784  0.08441  0.22773\nsyear1995       -0.34029 -0.19814 -0.127557 -0.05271  0.09324\nsyear1996       -0.19977 -0.05091  0.013166  0.09140  0.21724\nsyear1997       -0.29699 -0.15556 -0.083571 -0.01477  0.09978\nsyear1998       -0.14518 -0.01269  0.062252  0.13750  0.26969\n\n========================================================\nTotal:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD  Naive SE Time-series SE\nI(age_sold)      2.436063 0.51093 0.0161569      0.0151156\nI(age_sold^2)   -4.223821 1.03839 0.0328367      0.0306742\nI(age_sold^3)    0.605587 0.61494 0.0194460      0.0147596\nI(log(TLA))      1.270729 0.14184 0.0044854      0.0044854\nI(log(lotsize))  0.085441 0.02879 0.0009106      0.0009106\nrooms            0.009956 0.04928 0.0015584      0.0014839\nbeds            -0.099269 0.07971 0.0025206      0.0025206\nsyear1994        0.060621 0.12829 0.0040570      0.0040570\nsyear1995       -0.046555 0.12591 0.0039817      0.0033623\nsyear1996        0.129926 0.12085 0.0038217      0.0038217\nsyear1997        0.057257 0.11588 0.0036643      0.0036643\nsyear1998        0.306675 0.12106 0.0038283      0.0038283\n\n2. Quantiles for each variable:\n\n                    2.5%      25%      50%      75%   97.5%\nI(age_sold)      1.43744  2.10139  2.43041  2.75368  3.4702\nI(age_sold^2)   -6.31630 -4.89596 -4.20326 -3.56986 -2.2270\nI(age_sold^3)   -0.63654  0.20606  0.60551  1.00928  1.8235\nI(log(TLA))      0.98215  1.17960  1.27291  1.37072  1.5434\nI(log(lotsize))  0.02875  0.06531  0.08558  0.10425  0.1428\nrooms           -0.08065 -0.02585  0.01045  0.04540  0.1035\nbeds            -0.25372 -0.15241 -0.10144 -0.04542  0.0566\nsyear1994       -0.18865 -0.02399  0.06155  0.14613  0.3073\nsyear1995       -0.29434 -0.12999 -0.04696  0.03934  0.1981\nsyear1996       -0.12225  0.05450  0.12698  0.21204  0.3625\nsyear1997       -0.18161 -0.01896  0.05603  0.14139  0.2682\nsyear1998        0.07651  0.22255  0.30815  0.38914  0.5382\n\n========================================================\nSimulated standard errors\n                    Direct   Indirect      Total\nI(age_sold)     0.19377043 0.48430840 0.51092743\nI(age_sold^2)   0.35056995 0.95731289 1.03838680\nI(age_sold^3)   0.18626069 0.55609460 0.61493681\nI(log(TLA))     0.03256839 0.12916484 0.14184154\nI(log(lotsize)) 0.01215369 0.02797698 0.02879443\nrooms           0.01035366 0.04387138 0.04927992\nbeds            0.01586979 0.07047965 0.07970720\nsyear1994       0.02498084 0.11336570 0.12829442\nsyear1995       0.02421323 0.11073355 0.12591184\nsyear1996       0.02340386 0.10680158 0.12085180\nsyear1997       0.02385899 0.10131951 0.11587633\nsyear1998       0.02383429 0.10730107 0.12106130\n\nSimulated z-values:\n                    Direct    Indirect      Total\nI(age_sold)      2.2791192  4.11811449  4.7679244\nI(age_sold^2)   -2.8348746 -3.37402650 -4.0676758\nI(age_sold^3)    0.1593776  1.03561785  0.9847959\nI(log(TLA))     22.4383057  4.18031245  8.9587916\nI(log(lotsize))  9.6096536 -1.12062046  2.9672808\nrooms            1.8570362 -0.21132079  0.2020332\nbeds            -1.5182149 -1.06662051 -1.2454182\nsyear1994        2.1385335  0.06349941  0.4725149\nsyear1995        3.3064592 -1.14341815 -0.3697403\nsyear1996        4.8718380  0.14893491  1.0750879\nsyear1997        6.0383741 -0.85682032  0.4941207\nsyear1998       10.2226717  0.58736331  2.5332198\n\nSimulated p-values:\n                Direct          Indirect    Total       \nI(age_sold)     0.02265998      0.000038198 0.0000018613\nI(age_sold^2)   0.00458437      0.00074077  0.0000474844\nI(age_sold^3)   0.87337138      0.30038046  0.3247243   \nI(log(TLA))     < 2.22e-16      0.000029111 < 2.22e-16  \nI(log(lotsize)) < 2.22e-16      0.26244945  0.0030045   \nrooms           0.06330600      0.83263696  0.8398908   \nbeds            0.12896023      0.28614323  0.2129781   \nsyear1994       0.03247347      0.94936883  0.6365593   \nsyear1995       0.00094483      0.25286502  0.7115760   \nsyear1996       0.0000011056480 0.88160500  0.2823354   \nsyear1997       0.0000000015567 0.39154419  0.6212209   \nsyear1998       < 2.22e-16      0.55695973  0.0113020"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#spatial-autocorrelation-left-in-sdm",
    "href": "spatmetrics/LucasCounty/index.html#spatial-autocorrelation-left-in-sdm",
    "title": "Spatial Hedonic Model",
    "section": "Spatial autocorrelation left in SDM",
    "text": "Spatial autocorrelation left in SDM\n\n\nCode\n# residuals are with attributes, hence as.vector()\nmoran.plot(as.vector(SDM$residuals), listw = red_house_sf_w)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#global-morans-i-plot-for-log_pm2",
    "href": "spatmetrics/spatreg/index.html#global-morans-i-plot-for-log_pm2",
    "title": "Spatial regressions",
    "section": "Global Morans I plot for log_pm2",
    "text": "Global Morans I plot for log_pm2\n\n\nCode\nmoran.plot(md_2017$log_pm2, listw = md_2017_w)\n\n\n\n\n\nCode\nmoran.test(md_2017$log_pm2, listw = md_2017_w)\n\n\n\n    Moran I test under randomisation\n\ndata:  md_2017$log_pm2  \nweights: md_2017_w    \n\nMoran I statistic standard deviate = 14.014, p-value < 2.2e-16\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.526358833      -0.003048780       0.001427167 \n\n\nHardly any doubt that we have spatial autocorrelation in log_pm2 (not a big surprise)."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#eda",
    "href": "spatmetrics/spatreg/index.html#eda",
    "title": "Spatial regressions",
    "section": "EDA",
    "text": "EDA\nOpen a new project in Geoda and read in the reduced dataset md_2017 and do EDA."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#the-model",
    "href": "spatmetrics/spatreg/index.html#the-model",
    "title": "Spatial regressions",
    "section": "The model",
    "text": "The model\n\n\nCode\nmod1 <- \"log_pm2 ~ log_prct_20_64 + log_prct_uni_edu + log_inc_750k_p\n + log_net_cap_3000k_p + log_gov_emp + log_spc + log_sen_ind\"\n# mod2 <- \"log_pm2 ~ log_prct_20_64 +  log_net_cap_3000k_p + log_sen_ind\"\nmod2 <- \"log_pm2 ~ prct_20_64 + inc_bt_9and10 + spc_k +  sen_ind\""
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#the-variables-we-use",
    "href": "spatmetrics/spatreg/index.html#the-variables-we-use",
    "title": "Spatial regressions",
    "section": "The variables we use",
    "text": "The variables we use\nWe have 329 observations. We lack pm2 for 96 municipalities. One, Høyanger, no NA, but no neighbours.\n\n\n\n\n\n\nConvert to definition list\n\n\n\n\n\n\nlog_pm2\nWe use the natural logarithms of price per square meter as our dependent variable.\nprct_20_64\nPercentage of population of a “working age”.\ninc_bt_9and10\nThis variable is a little bit more involved. Imagine income for all income earners of the country ordered in a long list, from lowest to highest income. This list is then divided into 10 parts with an equal number of individuals in each part. Then we will have 9 income levels \\(I_{i,i+1}, i = 1\\ldots 9\\) representing the border between to groups (deciles). If an individual has an income above \\(I_{8,9}\\), this individual will be in the top 20% earners in the country. Our variable inc_bt_9and10 contains the percentage of income earners in each municipality that has an income above \\(I_{8,9}\\).\nspc_k\nWholesale and retail trade sales per capita in each municipality in NOK 1000.\nsen_ind\nThe value of the SSB centrality index for 2018. The index value for Oslo (the most central place) is 1000."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#simple-linear-model",
    "href": "spatmetrics/spatreg/index.html#simple-linear-model",
    "title": "Spatial regressions",
    "section": "Simple linear model",
    "text": "Simple linear model\n\n\nCode\nmd_2017 %>% \n  select(log_pm2, prct_20_64, inc_bt_9and10, spc_k, sen_ind) %>% \n  summary()\n\n\n    log_pm2         prct_20_64    inc_bt_9and10       spc_k       \n Min.   : 8.579   Min.   :51.51   Min.   : 8.10   Min.   : 10.24  \n 1st Qu.: 9.491   1st Qu.:55.23   1st Qu.:14.90   1st Qu.: 43.97  \n Median : 9.725   Median :56.70   Median :17.60   Median : 65.24  \n Mean   : 9.738   Mean   :56.75   Mean   :18.15   Mean   : 67.86  \n 3rd Qu.: 9.970   3rd Qu.:58.04   3rd Qu.:20.60   3rd Qu.: 88.05  \n Max.   :10.960   Max.   :66.14   Max.   :35.50   Max.   :228.10  \n    sen_ind                  geom    \n Min.   : 368.0   MULTIPOLYGON :329  \n 1st Qu.: 616.0   epsg:5973    :  0  \n Median : 686.0   +proj=utm ...:  0  \n Mean   : 700.3                      \n 3rd Qu.: 793.0                      \n Max.   :1000.0"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#local-or-global",
    "href": "spatmetrics/spatreg/index.html#local-or-global",
    "title": "Spatial regressions",
    "section": "Local or global?",
    "text": "Local or global?\nTo formally test this we have to use Bayesian modelling. Outside our scope.\nOne might argue that a local perspective is best suited for this dataset.\nA change in one of the explanatory variables for one municipality (haugesund) might effect pm2 in this municipality and potentially also change pm2 in neighbouring municipalities (Sveio, Karmøy, Bømlo, Tysvær), but there are scarce reasons to think that these changes will ripple through the whole country (and eventually change pm2 in Hammerfest).\n\nIf one can narrow down the relationship being investigated as reflecting a local spillover situation, then the SDEM model is the only model one needs to estimate. This specification subsumes the SLX and SEM specifications as special cases.(lesage?)\n\nNote that plain OLS is a special case of SDEM. (all spatial autocorrelation coefficients are zero (\\(\\rho = 0, \\theta = 0\\) and \\(\\lambda =0\\)))\nManski (“includes everything”):\n\\[ {\\bf y = \\rho W y + X \\beta +W X\\theta + u\\quad u = \\lambda Wu + \\epsilon}\\] ## LeSages (2014) 5 principles\n\nLocal versus global spillover\n\n\n“A resource shared by numerous regions such as a highway (or river) can be one cause of global spillovers.”\n“Global spillover phenomena should be rarer than local spillovers in applied regional science modeling situations, hence the statement: ‘most spatial spillovers are local.’”\n“Global spillover specifications are more difficult to estimate and correct interpretation of estimates from these specifications is more difficult. Because of the interesting theoretical econometric aspects of these specifications, they represent those most studied in the spatial econometrics literature. Still, this does not mean they should be those most frequently used by regional science practitioners.”\n\n\nOnly two model specifications relevant for applied work\n\n\nSDEM\nSDM\n\n\nEstimation procedures, not only point estimates\n\n\nEstimates of dispersion\nCalculate direct/indirect effects\n\n\n“Avoid the temptation for observation-level inference”\n“Keep the weight matrix simple”\n\n\n“Sparse connectivity structures work best”\nParameterised decay can give identification problems\nDo not use multiple weight matrices\nDo not use non-spatial weight matrices"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#local-dgp-data-generating-process",
    "href": "spatmetrics/spatreg/index.html#local-dgp-data-generating-process",
    "title": "Spatial regressions",
    "section": "Local DGP (Data Generating Process)",
    "text": "Local DGP (Data Generating Process)\nWe decide that DGP is probably local in our data\nWe start out with a Spatial Durban Error Model (SDEM) model, i.e. \\(\\rho = 0\\) (notation follows Burkey:\nNested models:\nSDEM:\n\\[ \\rho = 0:\\quad y = {\\bf X \\beta + W X\\theta + u\\quad u = \\lambda Wu + \\epsilon} \\]\nSEM:\n\\[ \\rho = 0, \\theta = 0: \\quad y = {\\bf X \\beta  + u\\quad u = \\lambda Wu + \\epsilon} \\]\nSLX:\n\\[ \\rho = 0, \\lambda = 0: \\quad y = {\\bf X \\beta  + W X\\theta + \\epsilon} \\]\nOLS:\n\\[ \\rho = 0, \\theta = 0, \\lambda = 0: \\quad y = {\\bf X \\beta  + \\epsilon} \\]\nThe last three models are all restricted versions of SDEM and we can use Likelihood ratios (for spatial linear models) to decide which is the best model (spatialreg::LR.Sarlm() or lmtest::lrtest(), they will give the same answer) ."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#sdem-spatial-durban-error-model-model",
    "href": "spatmetrics/spatreg/index.html#sdem-spatial-durban-error-model-model",
    "title": "Spatial regressions",
    "section": "SDEM (Spatial Durban Error Model) model",
    "text": "SDEM (Spatial Durban Error Model) model\n\n\nCode\n# Old (Burkey): errorsarlm(mod2, data = md_2017, listw = md_2017_w, etype = \"emixed\")\nSDEM <- errorsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#slx-model",
    "href": "spatmetrics/spatreg/index.html#slx-model",
    "title": "Spatial regressions",
    "section": "SLX model",
    "text": "SLX model\n\n\nCode\nSLX <- lmSLX(mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)\n\n\n\n\nCode\nsummary(SLX)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.41882 -0.08986  0.00751  0.09590  0.48144 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)        4.5243803  0.5740667   7.881 5.13e-14 ***\nprct_20_64         0.0293684  0.0060045   4.891 1.59e-06 ***\ninc_bt_9and10      0.0270304  0.0034650   7.801 8.76e-14 ***\nspc_k              0.0008658  0.0003574   2.422  0.01597 *  \nsen_ind            0.0016788  0.0001799   9.330  < 2e-16 ***\nlag.prct_20_64     0.0357609  0.0107963   3.312  0.00103 ** \nlag.inc_bt_9and10  0.0076629  0.0045320   1.691  0.09184 .  \nlag.spc_k         -0.0003430  0.0007303  -0.470  0.63891    \nlag.sen_ind       -0.0004633  0.0002367  -1.957  0.05117 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1679 on 320 degrees of freedom\nMultiple R-squared:  0.803, Adjusted R-squared:  0.7981 \nF-statistic: 163.1 on 8 and 320 DF,  p-value: < 2.2e-16\n\n\n\n\nCode\nsummary(impacts(SLX), z.values = TRUE)\n\n\nImpact measures (SlX, estimable, n-k):\n                    Direct      Indirect        Total\nprct_20_64    0.0293684472  0.0357608695 0.0651293167\ninc_bt_9and10 0.0270304048  0.0076629095 0.0346933144\nspc_k         0.0008657653 -0.0003430118 0.0005227535\nsen_ind       0.0016787649 -0.0004632674 0.0012154975\n========================================================\nStandard errors:\n                    Direct     Indirect        Total\nprct_20_64    0.0060045003 0.0107963186 0.0118891646\ninc_bt_9and10 0.0034649565 0.0045320133 0.0030025656\nspc_k         0.0003573903 0.0007303328 0.0008350451\nsen_ind       0.0001799356 0.0002366776 0.0001615114\n========================================================\nZ-values:\n                Direct   Indirect      Total\nprct_20_64    4.891073  3.3123207  5.4780398\ninc_bt_9and10 7.801081  1.6908401 11.5545568\nspc_k         2.422464 -0.4696651  0.6260184\nsen_ind       9.329811 -1.9573772  7.5257702\n\np-values:\n              Direct     Indirect   Total     \nprct_20_64    1.0029e-06 0.00092525 4.3006e-08\ninc_bt_9and10 6.2172e-15 0.09086736 < 2.22e-16\nspc_k         0.015416   0.63859433 0.5313    \nsen_ind       < 2.22e-16 0.05030313 5.2403e-14\n\n\nPerhaps spatial lag just for prct_20_64is more appropriate?\n\n\nCode\nSLX_red <- lmSLX(mod2, data = md_2017, listw = md_2017_w, Durbin =~prct_20_64 + sen_ind)\n\n\n\n\nCode\nsummary(SLX_red)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.42200 -0.08543  0.00297  0.09024  0.48073 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     4.5543075  0.5672570   8.029 1.87e-14 ***\nprct_20_64      0.0299614  0.0059617   5.026 8.34e-07 ***\ninc_bt_9and10   0.0313854  0.0022985  13.655  < 2e-16 ***\nspc_k           0.0008600  0.0003570   2.409  0.01657 *  \nsen_ind         0.0016553  0.0001726   9.590  < 2e-16 ***\nlag.prct_20_64  0.0346104  0.0105264   3.288  0.00112 ** \nlag.sen_ind    -0.0003859  0.0002325  -1.659  0.09804 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1682 on 322 degrees of freedom\nMultiple R-squared:  0.801, Adjusted R-squared:  0.7973 \nF-statistic: 216.1 on 6 and 322 DF,  p-value: < 2.2e-16\n\n\nTesting for spatial autocorrelation in the residuals of the SLX model.\n\n\nCode\nlm.morantest(SLX, listw = md_2017_w, alternative = \"greater\", resfun=residuals, naSubset=TRUE)\n\n\n\n    Global Moran I for regression residuals\n\ndata:  \nmodel: lm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1],\ncollapse = \"+\"))), data = as.data.frame(x), weights = weights)\nweights: md_2017_w\n\nMoran I statistic standard deviate = 6.5847, p-value = 2.279e-11\nalternative hypothesis: greater\nsample estimates:\nObserved Moran I      Expectation         Variance \n     0.238535538     -0.008918982      0.001412270 \n\n\nThe SLX model leaves lots of spatial autocorrelation in the residuals.\n\n\nCode\nmoran.plot(residuals(SLX), listw = md_2017_w)\n\n\n\n\n\n\n\nCode\n# Spatial error model\n# SDEM (Durbin = TRUE), no lagged y only lagged X and u\n# SEM Durbin = FALSE\nSEM <- errorsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = FALSE)\nsummary(SEM)\n\n\n\nCall:errorsarlm(formula = mod2, data = md_2017, listw = md_2017_w, \n    Durbin = FALSE)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.460521 -0.087668  0.005035  0.090322  0.510908 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                Estimate Std. Error z value    Pr(>|z|)\n(Intercept)   6.56625269 0.26173947 25.0870   < 2.2e-16\nprct_20_64    0.02397394 0.00528907  4.5327 0.000005823\ninc_bt_9and10 0.02958639 0.00267133 11.0755   < 2.2e-16\nspc_k         0.00087237 0.00028872  3.0215    0.002516\nsen_ind       0.00172460 0.00012859 13.4111   < 2.2e-16\n\nLambda: 0.45542, LR test value: 44.506, p-value: 2.5356e-11\nAsymptotic standard error: 0.060428\n    z-value: 7.5366, p-value: 4.8184e-14\nWald statistic: 56.8, p-value: 4.8295e-14\n\nLog likelihood: 139.8287 for error model\nML residual variance (sigma squared): 0.023715, (sigma: 0.154)\nNumber of observations: 329 \nNumber of parameters estimated: 7 \nAIC: -265.66, (AIC for lm: -223.15)\n\n\n\n\nCode\nmoran.plot(residuals(SEM), listw = md_2017_w)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#selecting-model",
    "href": "spatmetrics/spatreg/index.html#selecting-model",
    "title": "Spatial regressions",
    "section": "Selecting model",
    "text": "Selecting model\nTesting nested models. Since the models we consider is nested we can use a Likelihood ratio test to decide which model to chose.\nNote: Above, in the Anselin approach, we used Lagrange multiplier tests. If H0 is true LR, LM and Walds test (a third alternative) will converge asymptotically. See\nWe have used the LR test below (since its in the spatialreg package).\n\n\nCode\n# H0: model should be restricted to SEM,\n# p > 0,05, can not discard H0. Discard SDEM select SEM\n# Restrict lagged variables to zero. df is number of lagged variables (to be restricted)\n# LR.sarlm moved to spatialreg, now called LR.Sarlm()\nLR.Sarlm(SDEM, SEM)# used to be spdep::LR.sarlm() now spatialreg::LR.Sarlm()\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 6.0486, df = 4, p-value = 0.1955\nsample estimates:\nLog likelihood of SDEM  Log likelihood of SEM \n              142.8530               139.8287 \n\n\nCode\n# Conclusion: Drop SDEM (theta = 0), but marginally since p = 0,064. \n# Go with SEM, Drop spatial effects in X\n\n\nWe apparently need \\(\\lambda > 0\\) to handle spatial effects in the error terms.\n\n\nCode\n# lrtest from the lmtest packages gives the same result.\n#broom::tidy(lmtest::lrtest(SDEM, SEM))\n#lmtest::lrtest(SDEM, SEM)\n\n\nShould we restrict SDEM to SLX?\n\n\nCode\n# p <0,05. Do not restrict. Keep SDEM\nLR.Sarlm(SDEM, SLX)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 36.009, df = 1, p-value = 0.000000001964\nsample estimates:\nLog likelihood of SDEM  Log likelihood of SLX \n              142.8530               124.8482 \n\n\nCode\n# or broom::tidy(lmtest::lrtest(SLX, SDEM))\n\n\nH0: restrict model to SLX, p < 0,05 and we discard H0. We chose SDEM over SLX.\nHence we end up with SEM as the best (given that DGP is local) spatial model for this dataset.\n\\[ \\rho = 0, \\theta = 0: \\quad y = {\\bf X \\beta  + u\\quad u = \\lambda Wu + \\epsilon} \\]"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#should-we-restrict-even-more",
    "href": "spatmetrics/spatreg/index.html#should-we-restrict-even-more",
    "title": "Spatial regressions",
    "section": "Should we restrict even more?",
    "text": "Should we restrict even more?\nShould we restrict it even more (\\(\\rho = 0, \\theta = 0, \\lambda = 0\\)) to OLS?\n\nWe can use spatialreg::LR.sarlm() to apply a likelihood ratio test between nested models, but here choose lmtest::lrtest(), which gives the same results, preferring models including spatially lagged covariates.\n\nFrom R help lmtest::lrtest:\n\nlrtest is a generic function for carrying out likelihood ratio tests. The default method can be employed for comparing nested (generalized) linear models\n\nFrom R help spatialreg::LR.sarlm:\n\nThe LR.Sarlm() function provides a likelihood ratio test for objects for which a logLik() function exists for their class, or for objects of class logLik.\n\nThe two tests give the same results. We go with LR.Sarlm(). Why (bivand?) use lrtest() was not clear. Probably because the broom package was not updated to support the spatialreg package (now updated) when chapter was written.\nTest the spatial models against OLS.\n\n\nCode\n# Likelihood ratio test\n# SDEM\nLR1.Sarlm(SDEM)\n\n\n\n    Likelihood Ratio diagnostics for spatial dependence\n\ndata:  \nLikelihood ratio = 36.009, df = 1, p-value = 0.000000001964\nsample estimates:\nLog likelihood of spatial error model           Log likelihood of OLS fit y \n                             142.8530                              124.8482 \n\n\n\n\nCode\n# Likelihood ratio test\n# SEM\nLR1.Sarlm(SEM)\n\n\n\n    Likelihood Ratio diagnostics for spatial dependence\n\ndata:  \nLikelihood ratio = 44.506, df = 1, p-value = 2.536e-11\nsample estimates:\nLog likelihood of spatial error model           Log likelihood of OLS fit y \n                             139.8287                              117.5756 \n\n\nNo, we should not restrict SEM to OLS (H0). Hence we end up with SEM as the best model for the data, given that this a local phenomenon."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#we-go-with-sem",
    "href": "spatmetrics/spatreg/index.html#we-go-with-sem",
    "title": "Spatial regressions",
    "section": "We go with SEM",
    "text": "We go with SEM\nAll good?\nWe can use a Hausman-test to test for omitted variables. The test compares the coefficient estimates from the spatial model (SEM) and OLS model. If no omitted variables the estimates should be similar.\n\n\nCode\n# Spatial Hausman test\nHausman.test(SEM)\n\n\n\n    Spatial Hausman test (asymptotic)\n\ndata:  NULL\nHausman test = 52.496, df = 5, p-value = 4.268e-10\n\n\nConclusion: There are marked difference between SEM and OLS coefficients. Hence, the Hausman test indicates that we have a problem with omitted variable(s).\n\n\nCode\nmoran.plot(residuals(SEM), listw = md_2017_w)\n\n\n\nAre there other problems like Heteroskedasticity?\n\n\nCode\n# test for Heteroskedasticity\nbptest.Sarlm(SEM, studentize = TRUE)\n\n\n\n    studentized Breusch-Pagan test\n\ndata:  \nBP = 35.423, df = 4, p-value = 0.0000003803\n\n\nWe do have heteroskedasticity! The estimates should be unbiased, but we might underestimate the standard error. Hence we risk accepting as significant variables that in reality are not. However, note that none of the t-values are marginal."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#are-our-residuals-normal",
    "href": "spatmetrics/spatreg/index.html#are-our-residuals-normal",
    "title": "Spatial regressions",
    "section": "Are our residuals normal?",
    "text": "Are our residuals normal?\n\n\nCode\nlibrary(DescTools)\n# H0: residuals normal\nJarqueBeraTest(residuals(SEM), robust = TRUE)\n\n\n\n    Robust Jarque Bera Test\n\ndata:  residuals(SEM)\nX-squared = 19.847, df = 2, p-value = 0.00004902\n\n\nCode\n# Conclusion: not normal\n\n\nThe residuals are far from normal!\n\n\nCode\n md_2017 <- md_2017 %>% \n  mutate(\n    SEM_residuals = residuals(SEM),\n    OLS_residuals = residuals(lm2)\n  )\n# write md_2017 with residuals\nst_write(obj = md_2017, dsn = \"../data/md_2017.gpkg\", driver = \"GPKG\", append=FALSE)\n\n\nDeleting layer `md_2017' using driver `GPKG'\nWriting layer `md_2017' to data source `../data/md_2017.gpkg' using driver `GPKG'\nWriting 329 features with 23 fields and geometry type Multi Polygon.\n\n\nWe update data/md_2017.gkpkg with the residuals from the SEM and OLS models. This file can then be opened in Geoda and we can do further EDA of the resisuals.\n\n\nCode\ntmap_mode(\"plot\")\nt1 <-tm_shape(md_2017) +\n  tm_borders(alpha=0.1) +\n   tm_polygons(\"SEM_residuals\")\nt2 <-tm_shape(md_2017) +\n    tm_borders(alpha=0.1) +\n   tm_polygons(\"OLS_residuals\")\ntmap_arrange(t1, t2, nrow=1)\n\n\n\n\n\nCode\nhuxreg(\"OLS\" = lm2, \"SEM\" = SEM,\n       error_format = \"({statistic})\",\n       note = \"{stars}. T-values reported.\")\n\n\n\n\n\nOLSSEM\n\n(Intercept)6.191 ***6.566 ***\n\n(21.152)   (25.087)   \n\nprct_20_640.032 ***0.024 ***\n\n(5.331)   (4.533)   \n\ninc_bt_9and100.033 ***0.030 ***\n\n(14.267)   (11.076)   \n\nspc_k0.001 ** 0.001 ** \n\n(2.812)   (3.021)   \n\nsen_ind0.002 ***0.002 ***\n\n(14.546)   (13.411)   \n\nlambda        0.455 ***\n\n        (7.537)   \n\nN329        329        \n\nR20.794    0.830    \n\nlogLik117.576    139.829    \n\nAIC-223.151    -265.657    \n\n *** p < 0.001;  ** p < 0.01;  * p < 0.05. T-values reported."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#do-we-have-omitted-variables",
    "href": "spatmetrics/spatreg/index.html#do-we-have-omitted-variables",
    "title": "Spatial regressions",
    "section": "Do we have omitted variables?",
    "text": "Do we have omitted variables?\n\n\nCode\nbroom::tidy(Hausman.test(SEM))\n\n\n\n\n\nstatisticp.valueparametermethod\n\n52.54.27e-105Spatial Hausman test (asymptotic)\n\n\n\n\nWithout doubt there is something more to this story. What might it be?"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#a-better-model",
    "href": "spatmetrics/spatreg/index.html#a-better-model",
    "title": "Spatial regressions",
    "section": "A “better” model?",
    "text": "A “better” model?\n\n\nCode\nmod3 <- \"log_pm2 ~ log_prct_20_64 + log_net_cap_3000k_p + log_sen_ind\"\n\n\nThe variable log_prct_20_64 is just the natural logarithm of the percentage op population of a working age. The variable log_net_cap_3000k_p the natural logarithm of the percentage of population with a net wealth exceeding NOK 3.000.000.\n\n\nCode\nlm3 <- lm(mod3, data = md_2017)\nsummary(lm3)\n\n\n\nCall:\nlm(formula = mod3, data = md_2017)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.41498 -0.08067 -0.00378  0.08628  0.68254 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)         -4.24750    1.02765  -4.133 4.56e-05 ***\nlog_prct_20_64       2.28497    0.29799   7.668 2.04e-13 ***\nlog_net_cap_3000k_p  0.55823    0.02879  19.391  < 2e-16 ***\nlog_sen_ind          0.47109    0.07677   6.136 2.46e-09 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1553 on 325 degrees of freedom\nMultiple R-squared:  0.8288,    Adjusted R-squared:  0.8273 \nF-statistic: 524.6 on 3 and 325 DF,  p-value: < 2.2e-16\n\n\n\n\nCode\nmctest(lm3, type = \"i\", method=\"VIF\")\n\n\n\nCall:\nimcdiag(mod = mod, method = method, corr = FALSE, vif = vif, \n    tol = tol, conf = conf, cvif = cvif, ind1 = ind1, ind2 = ind2, \n    leamer = leamer, all = all)\n\n\n VIF Multicollinearity Diagnostics\n\n                       VIF detection\nlog_prct_20_64      1.6559         0\nlog_net_cap_3000k_p 1.8423         0\nlog_sen_ind         2.4180         0\n\nNOTE:  VIF Method Failed to detect multicollinearity\n\n\n0 --> COLLINEARITY is not detected by the test\n\n===================================\n\n\n\n\nCode\nSEM_mod3 <- errorsarlm(mod3, data = md_2017, listw = md_2017_w, Durbin = FALSE)\n\n\n\n\nCode\nsummary(SEM_mod3)\n\n\n\nCall:errorsarlm(formula = mod3, data = md_2017, listw = md_2017_w, \n    Durbin = FALSE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.3988746 -0.0659741  0.0024313  0.0654742  0.6800960 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                     Estimate Std. Error z value  Pr(>|z|)\n(Intercept)         -2.687507   0.856437 -3.1380  0.001701\nlog_prct_20_64       1.735017   0.254544  6.8162 9.349e-12\nlog_net_cap_3000k_p  0.542116   0.031306 17.3167 < 2.2e-16\nlog_sen_ind          0.578234   0.086140  6.7128 1.910e-11\n\nLambda: 0.54686, LR test value: 74.573, p-value: < 2.22e-16\nAsymptotic standard error: 0.054144\n    z-value: 10.1, p-value: < 2.22e-16\nWald statistic: 102.01, p-value: < 2.22e-16\n\nLog likelihood: 185.2578 for error model\nML residual variance (sigma squared): 0.0175, (sigma: 0.13229)\nNumber of observations: 329 \nNumber of parameters estimated: 6 \nAIC: -358.52, (AIC for lm: -285.94)\n\n\n\n\nCode\nmoran.plot(residuals(SEM_mod3), listw = md_2017_w)\n\n\n\nhuxreg(“OLS_mod3” = lm3, “SEM_mod3” = SEM_mod3, error_format = “({statistic})”, note = “{stars}. T-values reported.”)\nWhat´s the big problem with this model?"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#selecting-model-1",
    "href": "spatmetrics/spatreg/index.html#selecting-model-1",
    "title": "Spatial regressions",
    "section": "Selecting model",
    "text": "Selecting model\nShould we restrict to \\(\\theta = 0\\)?\n\n\nCode\nLR.Sarlm(SDM, SAR)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 20.134, df = 4, p-value = 0.0004698\nsample estimates:\nLog likelihood of SDM Log likelihood of SAR \n             143.7601              133.6930 \n\n\nH0 restrict $$ to 0.\nWe reject H0, continue with SDM.\nShould we restrict with \\(\\rho = 0\\)?\n\n\nCode\nLR.Sarlm(SDM, SLX)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 37.824, df = 1, p-value = 7.744e-10\nsample estimates:\nLog likelihood of SDM Log likelihood of SLX \n             143.7601              124.8482 \n\n\nH0 restrict $$ to 0.\nWe reject H0, continue with SDM.\nShould we restrict \\(\\theta = - \\rho \\beta\\).\n\n\nCode\nLR.Sarlm(SDM, SEM)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 7.8628, df = 4, p-value = 0.09673\nsample estimates:\nLog likelihood of SDM Log likelihood of SEM \n             143.7601              139.8287 \n\n\nChoose SEM (and we know from local analyses that we should not restrict to OLS)\nIf we skip restrict \\(\\theta = - \\rho \\beta\\). Should we restrict to OLS.\n\n\nCode\nLR.Sarlm(SEM, lm2)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 44.506, df = 1, p-value = 2.536e-11\nsample estimates:\nLog likelihood of SEM Log likelihood of lm2 \n             139.8287              117.5756 \n\n\nReject H0, we should not restrict to OLS."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#final-question",
    "href": "spatmetrics/spatreg/index.html#final-question",
    "title": "Spatial regressions",
    "section": "Final question",
    "text": "Final question\nWhy not start with the Manski (below called the GNS model) model and use a LR test to decide if SAC, SDM or SDEM is the best nested model?\nGood question ;-)\nThe following quote might give the answer:\n\nEven though taking the GNS model as point of departure to measure spillovers seems appealing since it contains all possible interaction effects, two major issues are that a formal proof under which conditions the parameters of this model are identified is not available yet (see Section 1) and the problem of overfitting. Even though the parameters are not identified, they can still be estimated. However, they have the tendency either to blow each other up or to become insignificant as a result of which this model does not help to choose among the SDM and SDEM models.(halleckvegaSLXMODEL2015?) p. 347.\n\nThere are several problems with fitting the Manski (GNS) model. Should these be solved the Manski model might be a starting point in the future. For the time being the best we can do is probably to follow (lesageWhatRegionalScientists?) and\n\nDon’t bother with SAC\nDecide if the phenomenon we study is of a local or global character\nIf local start with SDEM, if global start with SDM\nUse LR.Sarlm() to decide which of the nested models to use\nRemember to report impacts, not coefficient estimates.\n\n\n\nCode\n# new dwellings\nmod4 <- \"log_pm2 ~ prct_20_64 + inc_bt_9and10  +  sen_ind + I(sfd_ba_completed + sfd_w2u_ba_completed)\"\nlm4 <- lm(mod4, data = md_2017)\n\n\n\n\nCode\nsummary(lm4)\n\n\n\nCall:\nlm(formula = mod4, data = md_2017)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.48403 -0.10321  0.00623  0.10032  0.53345 \n\nCoefficients:\n                                              Estimate  Std. Error t value\n(Intercept)                                6.387177798 0.313421930  20.379\nprct_20_64                                 0.029999697 0.006078476   4.935\ninc_bt_9and10                              0.031585407 0.002304524  13.706\nsen_ind                                    0.001502981 0.000112447  13.366\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.000004981 0.000001812   2.749\n                                             Pr(>|t|)    \n(Intercept)                                   < 2e-16 ***\nprct_20_64                                 0.00000128 ***\ninc_bt_9and10                                 < 2e-16 ***\nsen_ind                                       < 2e-16 ***\nI(sfd_ba_completed + sfd_w2u_ba_completed)    0.00631 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1707 on 324 degrees of freedom\nMultiple R-squared:  0.7939,    Adjusted R-squared:  0.7913 \nF-statistic:   312 on 4 and 324 DF,  p-value: < 2.2e-16\n\n\n\n\nCode\nSDEM_mod4 <- errorsarlm(mod4, data = md_2017, listw = md_2017_w, Durbin = TRUE)\nsummary(impacts(SDEM_mod4), zstats = TRUE)\n\n\nImpact measures (SDEM, estimable, n):\n                                                   Direct        Indirect\nprct_20_64                                 0.024959397785  0.016643621634\ninc_bt_9and10                              0.026220603474  0.004875123116\nsen_ind                                    0.001750268724 -0.000471082348\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.000004612348  0.000005561148\n                                                  Total\nprct_20_64                                 0.0416030194\ninc_bt_9and10                              0.0310957266\nsen_ind                                    0.0012791864\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.0000101735\n========================================================\nStandard errors:\n                                                   Direct       Indirect\nprct_20_64                                 0.005918134102 0.011778249231\ninc_bt_9and10                              0.003011189510 0.004763498651\nsen_ind                                    0.000143362464 0.000231312783\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.000001747715 0.000003930684\n                                                    Total\nprct_20_64                                 0.014729222137\ninc_bt_9and10                              0.004549428099\nsen_ind                                    0.000223008497\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.000004845399\n========================================================\nZ-values:\n                                              Direct  Indirect    Total\nprct_20_64                                  4.217444  1.413081 2.824523\ninc_bt_9and10                               8.707723  1.023433 6.835085\nsen_ind                                    12.208696 -2.036560 5.736043\nI(sfd_ba_completed + sfd_w2u_ba_completed)  2.639073  1.414804 2.099620\n\np-values:\n                                           Direct      Indirect Total     \nprct_20_64                                 0.000024709 0.157632 0.0047351 \ninc_bt_9and10                              < 2.22e-16  0.306103 8.1957e-12\nsen_ind                                    < 2.22e-16  0.041694 9.6914e-09\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.0083133   0.157126 0.0357623 \n\n\n\n\nCode\nSEM_mod4 <- errorsarlm(mod4, data = md_2017, listw = md_2017_w, Durbin = FALSE)\nsummary(SEM_mod4)\n\n\n\nCall:errorsarlm(formula = mod4, data = md_2017, listw = md_2017_w, \n    Durbin = FALSE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.4638081 -0.0921883  0.0038205  0.0919993  0.5023677 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                                               Estimate   Std. Error z value\n(Intercept)                                6.7015322967 0.2814504975 23.8107\nprct_20_64                                 0.0224038565 0.0054991334  4.0741\ninc_bt_9and10                              0.0292077896 0.0026677847 10.9483\nsen_ind                                    0.0017287275 0.0001295926 13.3397\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.0000040784 0.0000016145  2.5261\n                                            Pr(>|z|)\n(Intercept)                                < 2.2e-16\nprct_20_64                                 0.0000462\ninc_bt_9and10                              < 2.2e-16\nsen_ind                                    < 2.2e-16\nI(sfd_ba_completed + sfd_w2u_ba_completed)   0.01153\n\nLambda: 0.44751, LR test value: 42.147, p-value: 8.4683e-11\nAsymptotic standard error: 0.06093\n    z-value: 7.3446, p-value: 2.065e-13\nWald statistic: 53.943, p-value: 2.0639e-13\n\nLog likelihood: 138.4757 for error model\nML residual variance (sigma squared): 0.02396, (sigma: 0.15479)\nNumber of observations: 329 \nNumber of parameters estimated: 7 \nAIC: -262.95, (AIC for lm: -222.8)\n\n\n\n\nCode\nmoran.plot(residuals(SEM_mod4), listw = md_2017_w)\n\n\n\n\n\nCode\nmoran(residuals(SEM_mod4), listw = md_2017_w, n = length(md_2017_nb), S0 = Szero(md_2017_w))\n\n\n$I\n[1] -0.01430735\n\n$K\n[1] 3.788702\n\n\nMorans I for the residuals are now slightly negative (-0.01434). The kurtosis of the residuals is 3.8, compared to 3.0 for a normal distribution, so the distribution of residuals are slightly leptokurtic. Hence more outliers that if they were normaly distributed.\n\n\nCode\nJarqueBeraTest(residuals(SEM_mod4), robust = TRUE)\n\n\n\n    Robust Jarque Bera Test\n\ndata:  residuals(SEM_mod4)\nX-squared = 13.335, df = 2, p-value = 0.001272\n\n\n\n\nCode\nSLX_mod4 <- lmSLX(mod4, data = md_2017, listw = md_2017_w, Durbin = TRUE)\nsummary(SLX_mod4)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.40527 -0.09317  0.00553  0.10366  0.48804 \n\nCoefficients:\n                                                   Estimate   Std. Error\n(Intercept)                                     4.940435659  0.603180867\nprct_20_64                                      0.027048664  0.006133710\ninc_bt_9and10                                   0.026259939  0.003506692\nsen_ind                                         0.001741089  0.000168758\nI.sfd_ba_completed...sfd_w2u_ba_completed.      0.000004501  0.000001817\nlag.prct_20_64                                  0.033881537  0.010768718\nlag.inc_bt_9and10                               0.004932595  0.004618570\nlag.sen_ind                                    -0.000698463  0.000226843\nlag.I.sfd_ba_completed...sfd_w2u_ba_completed.  0.000004644  0.000003633\n                                               t value Pr(>|t|)    \n(Intercept)                                      8.191 6.28e-15 ***\nprct_20_64                                       4.410 1.41e-05 ***\ninc_bt_9and10                                    7.489 6.83e-13 ***\nsen_ind                                         10.317  < 2e-16 ***\nI.sfd_ba_completed...sfd_w2u_ba_completed.       2.477  0.01376 *  \nlag.prct_20_64                                   3.146  0.00181 ** \nlag.inc_bt_9and10                                1.068  0.28633    \nlag.sen_ind                                     -3.079  0.00226 ** \nlag.I.sfd_ba_completed...sfd_w2u_ba_completed.   1.278  0.20215    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1675 on 320 degrees of freedom\nMultiple R-squared:  0.8039,    Adjusted R-squared:  0.799 \nF-statistic:   164 on 8 and 320 DF,  p-value: < 2.2e-16\n\n\n\n\nCode\nLR.Sarlm(SDEM_mod4, SEM_mod4)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 7.1726, df = 4, p-value = 0.127\nsample estimates:\nLog likelihood of SDEM_mod4  Log likelihood of SEM_mod4 \n                   142.0620                    138.4757 \n\n\nH0 can not be discarded and we should restrict SDEM to SEM, i.e. we should not restrict $$ to zero.\n\n\nCode\nLR.Sarlm(SDEM_mod4, SLX_mod4)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 32.981, df = 1, p-value = 0.000000009308\nsample estimates:\nLog likelihood of SDEM_mod4  Log likelihood of SLX_mod4 \n                   142.0620                    125.5718 \n\n\nH0 can be discarded and we should not restrict SDEM to SLX, i.e. we should restrict $$ to zero.\nShould we restrict further, i.e. SEM to OLS?\n\n\nCode\n# H0 restrict SEM to OLS\nLR.Sarlm(SEM_mod4, lm4)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 42.147, df = 1, p-value = 8.468e-11\nsample estimates:\nLog likelihood of SEM_mod4      Log likelihood of lm4 \n                  138.4757                   117.4025 \n\n\nH0 can be discarded and we should not restrict SEM further to OLS.\n\n\nCode\n#siste"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#sdm",
    "href": "spatmetrics/spatreg/index.html#sdm",
    "title": "Spatial regressions",
    "section": "SDM:",
    "text": "SDM:\n\n\nCode\n# Old style (Burkey): lagsarlm(mod2, data = md_2017, listw = md_2017_w, type = \"mixed\")\nSDM <- lagsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)\n# Do not interpret coefficient estimates!!!!!\n\n\n\n\nCode\n# be careful\nsummary(SDM)\n\n\n\nCall:lagsarlm(formula = mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.4583940 -0.0843224  0.0026429  0.0899973  0.5340799 \n\nType: mixed \nCoefficients: (asymptotic standard errors) \n                     Estimate  Std. Error z value  Pr(>|z|)\n(Intercept)        2.67809841  0.62210440  4.3049 1.671e-05\nprct_20_64         0.02568975  0.00548463  4.6839 2.814e-06\ninc_bt_9and10      0.02602639  0.00315629  8.2459 2.220e-16\nspc_k              0.00087101  0.00032547  2.6762  0.007447\nsen_ind            0.00173814  0.00016389 10.6053 < 2.2e-16\nlag.prct_20_64     0.01048689  0.01013826  1.0344  0.300955\nlag.inc_bt_9and10 -0.00552064  0.00459166 -1.2023  0.229240\nlag.spc_k         -0.00052949  0.00066621 -0.7948  0.426738\nlag.sen_ind       -0.00098770  0.00023529 -4.1978 2.696e-05\n\nRho: 0.41917, LR test value: 37.824, p-value: 7.7436e-10\nAsymptotic standard error: 0.062316\n    z-value: 6.7265, p-value: 1.7379e-11\nWald statistic: 45.246, p-value: 1.7379e-11\n\nLog likelihood: 143.7601 for mixed model\nML residual variance (sigma squared): 0.023364, (sigma: 0.15285)\nNumber of observations: 329 \nNumber of parameters estimated: 11 \nAIC: -265.52, (AIC for lm: -229.7)\nLM test for residual autocorrelation\ntest value: 3.3921, p-value: 0.065508\n\n\n\n\nCode\nsummary(impacts(SDM, listw = md_2017_w, R=1000), zstats = TRUE)\n\n\nImpact measures (mixed, exact):\n                    Direct      Indirect        Total\nprct_20_64    0.0281782979  0.0341061297 0.0622844277\ninc_bt_9and10 0.0266573125  0.0086469222 0.0353042347\nspc_k         0.0008517659 -0.0002637761 0.0005879898\nsen_ind       0.0017078022 -0.0004157873 0.0012920150\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                   Mean        SD    Naive SE Time-series SE\nprct_20_64    0.0284309 0.0058514 0.000185037    0.000185037\ninc_bt_9and10 0.0266861 0.0030649 0.000096921    0.000096921\nspc_k         0.0008692 0.0003606 0.000011405    0.000010787\nsen_ind       0.0017118 0.0001620 0.000005121    0.000004825\n\n2. Quantiles for each variable:\n\n                   2.5%       25%       50%      75%    97.5%\nprct_20_64    0.0170892 0.0244570 0.0283698 0.032568 0.039880\ninc_bt_9and10 0.0207534 0.0246060 0.0265777 0.028773 0.032718\nspc_k         0.0001554 0.0006275 0.0008605 0.001112 0.001562\nsen_ind       0.0013935 0.0016014 0.0017137 0.001815 0.002040\n\n========================================================\nIndirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean        SD    Naive SE Time-series SE\nprct_20_64     0.0341758 0.0162590 0.000514153    0.000497700\ninc_bt_9and10  0.0088321 0.0052765 0.000166859    0.000159147\nspc_k         -0.0002209 0.0010886 0.000034423    0.000034423\nsen_ind       -0.0004297 0.0002825 0.000008933    0.000008421\n\n2. Quantiles for each variable:\n\n                    2.5%        25%        50%        75%     97.5%\nprct_20_64     0.0038329  0.0235098  0.0344587  0.0445773 0.0658033\ninc_bt_9and10 -0.0016088  0.0052518  0.0091076  0.0125895 0.0192073\nspc_k         -0.0023760 -0.0009668 -0.0002511  0.0005577 0.0018715\nsen_ind       -0.0009437 -0.0006257 -0.0004234 -0.0002278 0.0001241\n\n========================================================\nTotal:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                   Mean        SD    Naive SE Time-series SE\nprct_20_64    0.0626068 0.0191096 0.000604297    0.000564255\ninc_bt_9and10 0.0355181 0.0048230 0.000152517    0.000145184\nspc_k         0.0006483 0.0012889 0.000040757    0.000040757\nsen_ind       0.0012821 0.0002612 0.000008261    0.000008038\n\n2. Quantiles for each variable:\n\n                    2.5%        25%       50%      75%    97.5%\nprct_20_64     0.0254361  0.0501719 0.0629513 0.074716 0.100307\ninc_bt_9and10  0.0260615  0.0322303 0.0355536 0.038733 0.044504\nspc_k         -0.0019121 -0.0001819 0.0006473 0.001567 0.003059\nsen_ind        0.0007878  0.0011106 0.0012777 0.001462 0.001771\n\n========================================================\nSimulated standard errors\n                   Direct     Indirect        Total\nprct_20_64    0.005851372 0.0162589592 0.0191095574\ninc_bt_9and10 0.003064925 0.0052765376 0.0048230165\nspc_k         0.000360650 0.0010885507 0.0012888542\nsen_ind       0.000161956 0.0002824761 0.0002612378\n\nSimulated z-values:\n                 Direct  Indirect     Total\nprct_20_64     4.858847  2.101970 3.2762016\ninc_bt_9and10  8.706926  1.673838 7.3643014\nspc_k          2.410101 -0.202896 0.5030363\nsen_ind       10.569846 -1.521279 4.9078825\n\nSimulated p-values:\n              Direct       Indirect Total     \nprct_20_64    0.0000011807 0.035556 0.0010521 \ninc_bt_9and10 < 2.22e-16   0.094162 1.7808e-13\nspc_k         0.015948     0.839216 0.6149387 \nsen_ind       < 2.22e-16   0.128190 9.2065e-07"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#full-manski",
    "href": "spatmetrics/spatreg/index.html#full-manski",
    "title": "Spatial regressions",
    "section": "Full Manski",
    "text": "Full Manski\nYou should probably stay off this track. See (lesageWhatRegionalScientists?)\nThere is problems estimating this model (identification problems). The reason why one does not start with this model and then treat SAC, SDM and SDEM as nested models.\n\n\nCode\n# Old style (Burkey): sacsarlm(mod2, data = md_2017, listw = md_2017_w, type = \"sacmixed\")\nMANSKI <- sacsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)\nsummary(MANSKI)\n\n\n\nCall:sacsarlm(formula = mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.4198354 -0.0825496  0.0020849  0.0833636  0.4784596 \n\nType: sacmixed \nCoefficients: (asymptotic standard errors) \n                     Estimate  Std. Error z value  Pr(>|z|)\n(Intercept)        1.50425742  0.63914448  2.3535   0.01860\nprct_20_64         0.02293222  0.00548048  4.1843 2.860e-05\ninc_bt_9and10      0.02584618  0.00322845  8.0058 1.110e-15\nspc_k              0.00086502  0.00031586  2.7386   0.00617\nsen_ind            0.00180838  0.00016761 10.7891 < 2.2e-16\nlag.prct_20_64     0.00485516  0.01002833  0.4841   0.62828\nlag.inc_bt_9and10 -0.01250273  0.00516204 -2.4221   0.01543\nlag.spc_k         -0.00075156  0.00058742 -1.2794   0.20074\nlag.sen_ind       -0.00137809  0.00024757 -5.5665 2.599e-08\n\nRho: 0.62666\nAsymptotic standard error: 0.099265\n    z-value: 6.3131, p-value: 2.7355e-10\nLambda: -0.33341\nAsymptotic standard error: 0.17285\n    z-value: -1.9289, p-value: 0.053748\n\nLR test value: 54.897, p-value: 4.8638e-10\n\nLog likelihood: 145.0239 for sacmixed model\nML residual variance (sigma squared): 0.02115, (sigma: 0.14543)\nNumber of observations: 329 \nNumber of parameters estimated: 12 \nAIC: -266.05, (AIC for lm: -223.15)\n\n\n\n\nCode\n# Old style (Burkey): sacsarlm(mod2, data = md_2017, listw = md_2017_w, type = \"sac\")\n# No lagged X, just lagged y and u\nKELEJIAN_PRUCA <- sacsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = FALSE)\nsummary(KELEJIAN_PRUCA)\n\n\n\nCall:\nsacsarlm(formula = mod2, data = md_2017, listw = md_2017_w, Durbin = FALSE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.4587765 -0.0935582  0.0026026  0.0963646  0.5289599 \n\nType: sac \nCoefficients: (asymptotic standard errors) \n                Estimate Std. Error z value    Pr(>|z|)\n(Intercept)   5.59638908 0.64606968  8.6622   < 2.2e-16\nprct_20_64    0.02613147 0.00542404  4.8177 0.000001452\ninc_bt_9and10 0.02856009 0.00273856 10.4289   < 2.2e-16\nspc_k         0.00105297 0.00031362  3.3574   0.0007868\nsen_ind       0.00161434 0.00013901 11.6127   < 2.2e-16\n\nRho: 0.095544\nAsymptotic standard error: 0.060718\n    z-value: 1.5736, p-value: 0.11559\nLambda: 0.37353\nAsymptotic standard error: 0.082757\n    z-value: 4.5135, p-value: 0.0000063752\n\nLR test value: 46.779, p-value: 6.9525e-11\n\nLog likelihood: 140.9649 for sac model\nML residual variance (sigma squared): 0.023951, (sigma: 0.15476)\nNumber of observations: 329 \nNumber of parameters estimated: 8 \nAIC: -265.93, (AIC for lm: -223.15)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#models",
    "href": "spatmetrics/spatreg/index.html#models",
    "title": "Spatial regressions",
    "section": "Models",
    "text": "Models\nRead in data via map.\n\n\nCode\n# run data/get_ssb_data.Rmd if data needs to be updated\nmap_data_2017 <- st_read(dsn = \"../data/map_data_2017.gpkg\")\n\n\nReading layer `map_data_2017' from data source \n  `/Users/ag/Dev/QQ_MSB205/spatmetrics/data/map_data_2017.gpkg' \n  using driver `GPKG'\nSimple feature collection with 426 features and 115 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744\nProjected CRS: ETRS89 / UTM zone 33N + NN2000 height\n\n\nFilter out municipalities with no recorded pm2.\n\n\nCode\nmap_data_2017_noNA <- map_data_2017 %>% \n  filter(!is.na(log_pm2))\n# Drop obs. 14, 1416 Høyanger because of no neighbours. Makes life simpler\nmap_data_2017_noNA <- map_data_2017_noNA[-14,]\n\n\nMake new variables and strip down dataset to variables we will use\n\n\nCode\nmd_2017 <- map_data_2017_noNA %>% \n  mutate(\n    # percentage of pop. in a working age\n    prct_20_64 = 100*pop_20_64/tot_pop,\n    # log percentage of pop. of a working age\n    log_prct_20_64 = log(100*pop_20_64/tot_pop),\n    # log percentage of pop. with an univeristy education\n    log_prct_uni_edu = log(edu_uni_short + edu_uni_long),\n    # log percentage of households with an income above NOK 750.000\n    log_inc_750k_p = log(inc_750k_p),\n    # percentage of household wealth above 3.000.000\n    net_cap_3000k_p = net_cap_3000k_4000k + net_cap_4000k_p,\n    # log percentage of household wealth above 3.000.000\n    log_net_cap_3000k_p = log(net_cap_3000k_4000k + net_cap_4000k_p),\n    # gov emp relative to pop_20_64\n    gov_emp_rel = 100*gov_emp/pop_20_64,\n    # log (number of gov. emp. + 1)\n    log_gov_emp = log(100*(gov_emp+1)/pop_20_64),\n    # scale spc, to trane in NOK 1000\n    spc_k = spc/1000,\n    # log trade revenue per capita\n    log_spc = log(spc),\n    # log of centrality index (max index value 1000)\n    log_sen_ind = log(sen_ind),\n    # percentage in two top deciles of before tax income\n    inc_bt_9and10 = inc_bt_09 + inc_bt_10\n  ) %>% \n  select(knr, kNavn, log_pm2, prct_20_64, gov_emp, gov_emp_rel, spc, spc_k, inc_750k_p, sen_ind, net_cap_3000k_p, inc_bt_9and10, log_prct_20_64, log_prct_uni_edu, \n         log_inc_750k_p, log_net_cap_3000k_p, log_gov_emp, log_spc,log_sen_ind, sfd_ba_completed, sfd_w2u_ba_completed) %>% \n  arrange(knr)\n# write out reduced dataset\nst_write(obj = md_2017, dsn = \"../data/md_2017.gpkg\", driver = \"GPKG\", append=FALSE)\n\n\nDeleting layer `md_2017' using driver `GPKG'\nWriting layer `md_2017' to data source `../data/md_2017.gpkg' using driver `GPKG'\nWriting 330 features with 21 fields and geometry type Multi Polygon.\n\n\nRemove Høyanger, no neighbours.\n\n\nCode\nmd_2017 <- md_2017 %>% \n  filter(!kNavn == \"Høyanger\")\n\n\nMaking the weights matrix.\n\n\nCode\n# remove line 200 Høyanger, no neighbours\nmd_2017_nb <- poly2nb(md_2017)\nmd_2017_nb\n\n\nNeighbour list object:\nNumber of regions: 329 \nNumber of nonzero links: 1556 \nPercentage nonzero weights: 1.437533 \nAverage number of links: 4.729483 \n\n\nCode\nmd_2017_w <- nb2listw(md_2017_nb, style = \"W\")\nprint(md_2017_w)\n\n\nCharacteristics of weights list object:\nNeighbour list object:\nNumber of regions: 329 \nNumber of nonzero links: 1556 \nPercentage nonzero weights: 1.437533 \nAverage number of links: 4.729483 \n\nWeights style: W \nWeights constants summary:\n    n     nn  S0       S1       S2\nW 329 108241 329 156.7205 1357.883"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem",
    "href": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem",
    "title": "Spatial regressions",
    "section": "Is multicollinearity a problem?",
    "text": "Is multicollinearity a problem?\n\n\nCode\n# drop gov_emp_1k\nlm2 <- lm(mod2, data = md_2017)\nsummary(lm2)\n\n\n\nCall:\nlm(formula = mod2, data = md_2017)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.46579 -0.09363  0.00813  0.09060  0.55811 \n\nCoefficients:\n               Estimate Std. Error t value    Pr(>|t|)    \n(Intercept)   6.1907249  0.2926722  21.152     < 2e-16 ***\nprct_20_64    0.0315756  0.0059235   5.331 0.000000184 ***\ninc_bt_9and10 0.0327213  0.0022935  14.267     < 2e-16 ***\nspc_k         0.0009024  0.0003210   2.812     0.00523 ** \nsen_ind       0.0015705  0.0001080  14.546     < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1706 on 324 degrees of freedom\nMultiple R-squared:  0.7941,    Adjusted R-squared:  0.7916 \nF-statistic: 312.4 on 4 and 324 DF,  p-value: < 2.2e-16\n\n\n\n\nCode\nmctest(lm2)\n\n\n\nCall:\nomcdiag(mod = mod, Inter = TRUE, detr = detr, red = red, conf = conf, \n    theil = theil, cn = cn)\n\n\nOverall Multicollinearity Diagnostics\n\n                       MC Results detection\nDeterminant |X'X|:         0.4439         0\nFarrar Chi-Square:       264.6359         1\nRed Indicator:             0.3663         0\nSum of Lambda Inverse:     5.9601         0\nTheil's Method:           -1.2117         0\nCondition Number:        103.8824         1\n\n1 --> COLLINEARITY is detected by the test \n0 --> COLLINEARITY is not detected by the test\n\n\n\n\nCode\nimcdiag(lm2, all = TRUE)\n\n\n\nCall:\nimcdiag(mod = lm2, all = TRUE)\n\n\nAll Individual Multicollinearity Diagnostics in 0 or 1 \n\n              VIF TOL Wi Fi Leamer CVIF Klein IND1 IND2\nprct_20_64      0   0  1  1      0    0     0    1    0\ninc_bt_9and10   0   0  1  1      0    0     0    0    0\nspc_k           0   0  1  1      0    0     0    0    0\nsen_ind         0   0  1  1      0    0     0    1    0\n\n1 --> COLLINEARITY is detected by the test \n0 --> COLLINEARITY is not detected by the test\n\n* all coefficients have significant t-ratios\n\nR-square of y on all x: 0.7941 \n\n* use method argument to check which regressors may be the reason of collinearity\n===================================\n\n\nThree out of nine tests indicate that multicollinearity might be a problem.\n\n\nCode\n# If we only want to do one test\nimcdiag(lm2, method=\"VIF\")\n\n\n\nCall:\nimcdiag(mod = lm2, method = \"VIF\")\n\n\n VIF Multicollinearity Diagnostics\n\n                 VIF detection\nprct_20_64    1.7674         0\ninc_bt_9and10 1.2125         0\nspc_k         1.1040         0\nsen_ind       1.8762         0\n\nNOTE:  VIF Method Failed to detect multicollinearity\n\n\n0 --> COLLINEARITY is not detected by the test\n\n===================================\n\n\n\n\nCode\n# If we only want to do one test\nimcdiag(lm2, method=\"IND1\")\n\n\n\nCall:\nimcdiag(mod = lm2, method = \"IND1\")\n\n\n IND1 Multicollinearity Diagnostics\n\n                IND1 detection\nprct_20_64    0.0052         1\ninc_bt_9and10 0.0076         0\nspc_k         0.0084         0\nsen_ind       0.0049         1\n\nMulticollinearity may be due to prct_20_64 sen_ind regressors\n\n1 --> COLLINEARITY is detected by the test \n0 --> COLLINEARITY is not detected by the test\n\n===================================\n\n\nThe positive correlation between sen_ind and prct_20_64.\n\n\nCode\nplot(md_2017$sen_ind, md_2017$prct_20_64)\n\n\n\n\n\n\n\nCode\ncor(md_2017$sen_ind, md_2017$prct_20_64)\n\n\n[1] 0.6390244\n\n\nWe have seen worse.\n\n\nCode\nlm.morantest(lm2, listw = md_2017_w)\n\n\n\n    Global Moran I for regression residuals\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nMoran I statistic standard deviate = 7.2984, p-value = 1.456e-13\nalternative hypothesis: greater\nsample estimates:\nObserved Moran I      Expectation         Variance \n     0.267216998     -0.006847098      0.001410110 \n\n\n\n\nCode\nmoran.plot(residuals(lm2), listw = md_2017_w)\n\n\n\n\n\nWe will use mod2 in the following. We have spatial autocorrelation in the residuals from OLS."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#the-anselin-approach",
    "href": "spatmetrics/spatreg/index.html#the-anselin-approach",
    "title": "Spatial regressions",
    "section": "The Anselin approach",
    "text": "The Anselin approach\n\n\nCode\n# From BurkeyAcademy\nlm.LMtests(lm2, listw=md_2017_w, test=\"all\")\n\n\n\n    Lagrange multiplier diagnostics for spatial dependence\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nLMerr = 49.317, df = 1, p-value = 2.178e-12\n\n\n    Lagrange multiplier diagnostics for spatial dependence\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nLMlag = 35.015, df = 1, p-value = 0.000000003273\n\n\n    Lagrange multiplier diagnostics for spatial dependence\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nRLMerr = 18.191, df = 1, p-value = 0.00001998\n\n\n    Lagrange multiplier diagnostics for spatial dependence\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nRLMlag = 3.8892, df = 1, p-value = 0.0486\n\n\n    Lagrange multiplier diagnostics for spatial dependence\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nSARMA = 53.206, df = 2, p-value = 2.796e-12\n\n\nBoth LMerr and LMLag are significant. Proceed with RLMlerr and RLMlag. Again both are significant. So we don´t have a clear conclusion. One might argue that since RLMlag are just marginally significant, SEM is probably the best choice.\nFor a more thorough discussion see (osland2010a?) and (chi2019spatial?) page 55."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#the-lesage-approach",
    "href": "spatmetrics/spatreg/index.html#the-lesage-approach",
    "title": "Spatial regressions",
    "section": "The LeSage approach",
    "text": "The LeSage approach"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#regression-report",
    "href": "spatmetrics/spatreg/index.html#regression-report",
    "title": "Spatial regressions",
    "section": "Regression report",
    "text": "Regression report\n\n\nCode\n# Take care\nsummary(SDEM)\n\n\n\nCall:errorsarlm(formula = mod2, data = md_2017, listw = md_2017_w, \n    Durbin = TRUE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.4571586 -0.0841577  0.0049056  0.0996526  0.5374538 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                      Estimate   Std. Error z value  Pr(>|z|)\n(Intercept)        5.459962672  0.722236361  7.5598 4.041e-14\nprct_20_64         0.027171328  0.005813866  4.6735 2.961e-06\ninc_bt_9and10      0.026867040  0.002940012  9.1384 < 2.2e-16\nspc_k              0.000949083  0.000345221  2.7492  0.005974\nsen_ind            0.001692672  0.000152011 11.1352 < 2.2e-16\nlag.prct_20_64     0.017090668  0.011868677  1.4400  0.149873\nlag.inc_bt_9and10  0.007906567  0.004632381  1.7068  0.087858\nlag.spc_k          0.000078155  0.000791456  0.0987  0.921338\nlag.sen_ind       -0.000181715  0.000237360 -0.7656  0.443935\n\nLambda: 0.42445, LR test value: 36.009, p-value: 0.0000000019636\nAsymptotic standard error: 0.062357\n    z-value: 6.8068, p-value: 9.9791e-12\nWald statistic: 46.333, p-value: 9.9791e-12\n\nLog likelihood: 142.853 for error model\nML residual variance (sigma squared): 0.023464, (sigma: 0.15318)\nNumber of observations: 329 \nNumber of parameters estimated: 11 \nAIC: -263.71, (AIC for lm: -229.7)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#the-impacts",
    "href": "spatmetrics/spatreg/index.html#the-impacts",
    "title": "Spatial regressions",
    "section": "The impacts",
    "text": "The impacts\n\n\nCode\nsummary(impacts(SDEM), zstats = TRUE)\n\n\nImpact measures (SDEM, estimable, n):\n                    Direct       Indirect       Total\nprct_20_64    0.0271713282  0.01709066796 0.044261996\ninc_bt_9and10 0.0268670398  0.00790656673 0.034773607\nspc_k         0.0009490832  0.00007815519 0.001027238\nsen_ind       0.0016926717 -0.00018171458 0.001510957\n========================================================\nStandard errors:\n                    Direct     Indirect        Total\nprct_20_64    0.0058138661 0.0118686767 0.0149430539\ninc_bt_9and10 0.0029400122 0.0046323806 0.0042956559\nspc_k         0.0003452214 0.0007914562 0.0009861918\nsen_ind       0.0001520106 0.0002373598 0.0002194918\n========================================================\nZ-values:\n                 Direct    Indirect    Total\nprct_20_64     4.673539  1.43998092 2.962045\ninc_bt_9and10  9.138411  1.70680422 8.095063\nspc_k          2.749201  0.09874859 1.041621\nsen_ind       11.135220 -0.76556593 6.883890\n\np-values:\n              Direct       Indirect Total     \nprct_20_64    0.0000029605 0.149873 0.003056  \ninc_bt_9and10 < 2.22e-16   0.087858 6.6613e-16\nspc_k         0.0059741    0.921338 0.297587  \nsen_ind       < 2.22e-16   0.443935 5.8240e-12\n\n\nThe impacts are reported to show how it is done. One might argue that the impacts could wait until the correct model is decided upon below.\n\n\nCode\nmoran.plot(residuals(SDEM), listw = md_2017_w)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#global-dgp",
    "href": "spatmetrics/spatreg/index.html#global-dgp",
    "title": "Spatial regressions",
    "section": "Global DGP",
    "text": "Global DGP\nHow we would have analysed this if we though it was a global phenomenon. You should have good arguments to select this track."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#nested-models",
    "href": "spatmetrics/spatreg/index.html#nested-models",
    "title": "Spatial regressions",
    "section": "Nested models",
    "text": "Nested models\nNested models:\nSDM:\n\\[ \\lambda = 0:\\quad {\\bf y = \\rho Wy + X \\beta + W X\\theta + \\epsilon} \\]\nSLX:\n\\[ \\lambda = 0, \\rho = 0: \\quad {\\bf y = X \\beta  + W X\\theta + \\epsilon} \\]\nSAR (Spatial lag):\n\\[ \\lambda = 0, \\theta = 0:\\quad {\\bf y = \\rho Wy + X \\beta + \\epsilon} \\]\nSEM (\\(\\theta = - \\rho \\beta\\))\n\\[ \\lambda = 0, \\theta = -\\rho \\beta:\\quad {\\bf y = X \\beta  + u,\\quad u = \\lambda W u + \\epsilon}\\]\nOLS:\n\\[ \\rho = 0, \\theta = 0, \\lambda = 0: \\quad y = {\\bf X \\beta  + \\epsilon} \\] ## Estimating the models"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#sar",
    "href": "spatmetrics/spatreg/index.html#sar",
    "title": "Spatial regressions",
    "section": "SAR:",
    "text": "SAR:\n\n\nCode\nSAR <- lagsarlm(mod2, data = md_2017, listw = md_2017_w)\n# Do not interpret estimates and p values\n\n\n\n\nCode\n# be careful\nsummary(SAR)\n\n\n\nCall:lagsarlm(formula = mod2, data = md_2017, listw = md_2017_w)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.423991 -0.096486  0.004449  0.105846  0.505091 \n\nType: lag \nCoefficients: (asymptotic standard errors) \n                Estimate Std. Error z value      Pr(>|z|)\n(Intercept)   4.00984776 0.47937122  8.3648     < 2.2e-16\nprct_20_64    0.03080525 0.00555618  5.5443 0.00000002951\ninc_bt_9and10 0.02628991 0.00240127 10.9483     < 2.2e-16\nspc_k         0.00143368 0.00031659  4.5284 0.00000594185\nsen_ind       0.00128260 0.00012032 10.6594     < 2.2e-16\n\nRho: 0.25684, LR test value: 32.235, p-value: 0.000000013663\nAsymptotic standard error: 0.045279\n    z-value: 5.6725, p-value: 0.000000014076\nWald statistic: 32.177, p-value: 0.000000014076\n\nLog likelihood: 133.693 for lag model\nML residual variance (sigma squared): 0.025569, (sigma: 0.1599)\nNumber of observations: 329 \nNumber of parameters estimated: 7 \nAIC: -253.39, (AIC for lm: -223.15)\nLM test for residual autocorrelation\ntest value: 12.684, p-value: 0.00036876\n\n\n\n\nCode\n# Look at the impacts\nimpacts(SAR,  listw = md_2017_w)\n\n\nImpact measures (lag, exact):\n                   Direct     Indirect       Total\nprct_20_64    0.031311751 0.0101401184 0.041451869\ninc_bt_9and10 0.026722170 0.0086538109 0.035375981\nspc_k         0.001457256 0.0004719234 0.001929179\nsen_ind       0.001303683 0.0004221899 0.001725873\n\n\nIllustrations of constant ratio (direct/indirect) for the SAR model. Not a good feature of the model for applied work.\n\n\nCode\nimpacts(SAR,  listw = md_2017_w)$direct/impacts(SAR,  listw = md_2017_w)$indirect\n\n\n         [,1]\n[1,] 3.087908\n[2,] 3.087908\n[3,] 3.087908\n[4,] 3.087908\n\n\nImpacts with z-values.\n\n\nCode\nsummary(impacts(SAR, listw = md_2017_w, R=1000), zstats = TRUE)\n\n\nImpact measures (lag, exact):\n                   Direct     Indirect       Total\nprct_20_64    0.031311751 0.0101401184 0.041451869\ninc_bt_9and10 0.026722170 0.0086538109 0.035375981\nspc_k         0.001457256 0.0004719234 0.001929179\nsen_ind       0.001303683 0.0004221899 0.001725873\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                  Mean        SD    Naive SE Time-series SE\nprct_20_64    0.031383 0.0056828 0.000179706    0.000179706\ninc_bt_9and10 0.026886 0.0023074 0.000072967    0.000072967\nspc_k         0.001465 0.0003053 0.000009655    0.000009115\nsen_ind       0.001298 0.0001175 0.000003716    0.000003533\n\n2. Quantiles for each variable:\n\n                   2.5%      25%      50%      75%    97.5%\nprct_20_64    0.0200698 0.027530 0.031639 0.035337 0.041868\ninc_bt_9and10 0.0224954 0.025408 0.026924 0.028449 0.031594\nspc_k         0.0008599 0.001259 0.001462 0.001679 0.002086\nsen_ind       0.0010770 0.001222 0.001298 0.001375 0.001535\n\n========================================================\nIndirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                   Mean         SD    Naive SE Time-series SE\nprct_20_64    0.0104411 0.00313496 0.000099136    0.000099136\ninc_bt_9and10 0.0088468 0.00183458 0.000058014    0.000058014\nspc_k         0.0004937 0.00017562 0.000005554    0.000005554\nsen_ind       0.0004262 0.00008482 0.000002682    0.000002682\n\n2. Quantiles for each variable:\n\n                   2.5%       25%       50%       75%     97.5%\nprct_20_64    0.0050021 0.0082298 0.0101816 0.0123541 0.0170544\ninc_bt_9and10 0.0053552 0.0075994 0.0088554 0.0100002 0.0126825\nspc_k         0.0002112 0.0003712 0.0004736 0.0005997 0.0009244\nsen_ind       0.0002700 0.0003687 0.0004223 0.0004799 0.0006063\n\n========================================================\nTotal:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                  Mean        SD    Naive SE Time-series SE\nprct_20_64    0.041824 0.0081004 0.000256158     0.00025616\ninc_bt_9and10 0.035732 0.0029259 0.000092526     0.00009253\nspc_k         0.001959 0.0004576 0.000014472     0.00001374\nsen_ind       0.001725 0.0001374 0.000004344     0.00000370\n\n2. Quantiles for each variable:\n\n                  2.5%      25%      50%      75%    97.5%\nprct_20_64    0.026410 0.036128 0.041860 0.047359 0.057863\ninc_bt_9and10 0.030073 0.033663 0.035702 0.037652 0.041654\nspc_k         0.001113 0.001631 0.001937 0.002260 0.002953\nsen_ind       0.001460 0.001637 0.001719 0.001815 0.001997\n\n========================================================\nSimulated standard errors\n                    Direct     Indirect        Total\nprct_20_64    0.0056828124 0.0031349648 0.0081004129\ninc_bt_9and10 0.0023074307 0.0018345783 0.0029259235\nspc_k         0.0003053070 0.0001756201 0.0004576462\nsen_ind       0.0001174959 0.0000848195 0.0001373668\n\nSimulated z-values:\n                 Direct Indirect     Total\nprct_20_64     5.522440 3.330541  5.163209\ninc_bt_9and10 11.651758 4.822264 12.212365\nspc_k          4.798889 2.811013  4.280173\nsen_ind       11.050309 5.025279 12.554763\n\nSimulated p-values:\n              Direct         Indirect     Total        \nprct_20_64    0.000000033432 0.00086677   0.00000024275\ninc_bt_9and10 < 2.22e-16     0.0000014194 < 2.22e-16   \nspc_k         0.000001595481 0.00493858   0.00001867479\nsen_ind       < 2.22e-16     0.0000005027 < 2.22e-16   \n\n\nNote that the simulated z-values and p-values differ somewhat between each run, so only an approximation.\nIt´s also possible to specify that the spatial interaction is just for some variables.\n\n\nCode\n# Only lag sen_ind\nSAR_red <- lagsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = ~sen_ind)\n\n\n\n\nCode\nsummary(impacts(SAR_red, listw = md_2017_w, R=1000), zstats = TRUE)\n\n\nImpact measures (mixed, exact):\n                    Direct      Indirect       Total\nprct_20_64    0.0265861539  0.0161990337 0.042785188\ninc_bt_9and10 0.0245037707  0.0149302305 0.039434001\nspc_k         0.0009822063  0.0005984616 0.001580668\nsen_ind       0.0017309676 -0.0002764329 0.001454535\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                   Mean        SD    Naive SE Time-series SE\nprct_20_64    0.0263928 0.0058750 0.000185783    0.000205084\ninc_bt_9and10 0.0246624 0.0023788 0.000075224    0.000075224\nspc_k         0.0009756 0.0003312 0.000010472    0.000010472\nsen_ind       0.0017312 0.0001459 0.000004614    0.000004614\n\n2. Quantiles for each variable:\n\n                   2.5%       25%       50%      75%    97.5%\nprct_20_64    0.0148803 0.0223994 0.0263851 0.030322 0.038096\ninc_bt_9and10 0.0201291 0.0229376 0.0247417 0.026320 0.029397\nspc_k         0.0002777 0.0007671 0.0009728 0.001204 0.001589\nsen_ind       0.0014565 0.0016297 0.0017366 0.001832 0.002009\n\n========================================================\nIndirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean        SD    Naive SE Time-series SE\nprct_20_64     0.0162392 0.0048297 0.000152728    0.000152728\ninc_bt_9and10  0.0150961 0.0028416 0.000089860    0.000089860\nspc_k          0.0006031 0.0002475 0.000007825    0.000007825\nsen_ind       -0.0002811 0.0001990 0.000006293    0.000006293\n\n2. Quantiles for each variable:\n\n                    2.5%        25%        50%        75%      97.5%\nprct_20_64     0.0085952  0.0127376  0.0156827  0.0191644 0.02681997\ninc_bt_9and10  0.0101471  0.0131723  0.0149077  0.0167379 0.02153275\nspc_k          0.0001592  0.0004352  0.0005921  0.0007487 0.00113075\nsen_ind       -0.0006726 -0.0004063 -0.0002801 -0.0001495 0.00009539\n\n========================================================\nTotal:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                  Mean        SD   Naive SE Time-series SE\nprct_20_64    0.042632 0.0098662 0.00031200     0.00034051\ninc_bt_9and10 0.039759 0.0037389 0.00011823     0.00011823\nspc_k         0.001579 0.0005557 0.00001757     0.00001757\nsen_ind       0.001450 0.0001863 0.00000589     0.00000589\n\n2. Quantiles for each variable:\n\n                   2.5%      25%      50%      75%    97.5%\nprct_20_64    0.0240878 0.035828 0.042497 0.049170 0.063636\ninc_bt_9and10 0.0326358 0.037265 0.039672 0.042186 0.047886\nspc_k         0.0004345 0.001232 0.001584 0.001934 0.002681\nsen_ind       0.0010658 0.001325 0.001462 0.001578 0.001799\n\n========================================================\nSimulated standard errors\n                    Direct     Indirect        Total\nprct_20_64    0.0058749636 0.0048296860 0.0098661750\ninc_bt_9and10 0.0023787938 0.0028416206 0.0037388770\nspc_k         0.0003311597 0.0002474614 0.0005557496\nsen_ind       0.0001458989 0.0001989940 0.0001862548\n\nSimulated z-values:\n                 Direct  Indirect     Total\nprct_20_64     4.492411  3.362375  4.321023\ninc_bt_9and10 10.367619  5.312514 10.633828\nspc_k          2.946114  2.437264  2.840781\nsen_ind       11.865800 -1.412765  7.785435\n\nSimulated p-values:\n              Direct       Indirect      Total     \nprct_20_64    0.0000070421 0.00077275    1.5531e-05\ninc_bt_9and10 < 2.22e-16   0.00000010812 < 2.22e-16\nspc_k         0.0032179    0.01479887    0.0045003 \nsen_ind       < 2.22e-16   0.15772482    6.8834e-15"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#slx",
    "href": "spatmetrics/spatreg/index.html#slx",
    "title": "Spatial regressions",
    "section": "SLX:",
    "text": "SLX:\nEstimated above.\n\n\nCode\nsummary(SLX)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.41882 -0.08986  0.00751  0.09590  0.48144 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)        4.5243803  0.5740667   7.881 5.13e-14 ***\nprct_20_64         0.0293684  0.0060045   4.891 1.59e-06 ***\ninc_bt_9and10      0.0270304  0.0034650   7.801 8.76e-14 ***\nspc_k              0.0008658  0.0003574   2.422  0.01597 *  \nsen_ind            0.0016788  0.0001799   9.330  < 2e-16 ***\nlag.prct_20_64     0.0357609  0.0107963   3.312  0.00103 ** \nlag.inc_bt_9and10  0.0076629  0.0045320   1.691  0.09184 .  \nlag.spc_k         -0.0003430  0.0007303  -0.470  0.63891    \nlag.sen_ind       -0.0004633  0.0002367  -1.957  0.05117 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1679 on 320 degrees of freedom\nMultiple R-squared:  0.803, Adjusted R-squared:  0.7981 \nF-statistic: 163.1 on 8 and 320 DF,  p-value: < 2.2e-16\n\n\n\n\nCode\nimpacts(SLX, listw = md_2017_w)\n\n\nImpact measures (SlX, estimable):\n                    Direct      Indirect        Total\nprct_20_64    0.0293684472  0.0357608695 0.0651293167\ninc_bt_9and10 0.0270304048  0.0076629095 0.0346933144\nspc_k         0.0008657653 -0.0003430118 0.0005227535\nsen_ind       0.0016787649 -0.0004632674 0.0012154975"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#bibliography",
    "href": "spatmetrics/spatreg/index.html#bibliography",
    "title": "Spatial regressions",
    "section": "Bibliography",
    "text": "Bibliography\n\n\nMSB205\n\n\n\n“0.1 The Reproducible R Toolkit (RRT).” n.d. https://cran.r-project.org/web/packages/checkpoint/vignettes/checkpoint.html.\n\n\n“16 Product Fails That Defined The Decade.” n.d. BuzzFeed News. https://www.buzzfeednews.com/article/nicolenguyen/notable-tech-fails-of-2010s.\n\n\nBechhofer, Sean, Iain Buchan, David De Roure, Paolo Missier, John Ainsworth, Jiten Bhagat, Philip Couch, et al. 2013. “Why Linked Data Is Not Enough for Scientists.” Future Generation Computer Systems 29 (2): 599611. https://doi.org/10.1016/j.future.2011.08.004.\n\n\nBivand, Roger. 2022a. “R Packages for Analyzing Spatial Data: A Comparative Case Study with Areal Data.” Geographical Analysis 54 (3): 488–518. https://doi.org/10.1111/gean.12319.\n\n\n———. 2022b. Spdep: Spatial Dependence: Weighting Schemes, Statistics. https://CRAN.R-project.org/package=spdep.\n\n\nBivand, Roger S., Edzer Pebesma, and Virgilio Gomez-Rubio. 2013a. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013b. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013c. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\nBivand, Roger, Jan Hauke, and Tomasz Kossowski. 2013. “Computing the Jacobian in Gaussian Spatial Autoregressive Models: An Illustrated Comparison of Available Methods.” Geographical Analysis 45 (2): 150–79. https://doi.org/10.1111/gean.12008.\n\n\nBivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. “A Review of Software for Spatial Econometrics in R.” Mathematics 9 (11). https://doi.org/10.3390/math9111276.\n\n\nBivand, Roger, and Gianfranco Piras. 2015. “Comparing Implementations of Estimation Methods for Spatial Econometrics.” Journal of Statistical Software 63 (18): 1–36. https://doi.org/10.18637/jss.v063.i18.\n\n\n———. 2022. Spatialreg: Spatial Regression Analysis. https://CRAN.R-project.org/package=spatialreg.\n\n\nBivand, Roger, and David W. S. Wong. 2018. “Comparing Implementations of Global and Local Indicators of Spatial Association.” TEST 27 (3): 716–48. https://doi.org/10.1007/s11749-018-0599-x.\n\n\nGrossenbacher, Timo. n.d. “A (Truly) Reproducible R Workflow.” https://timogrossenbacher.ch/2017/07/a-truly-reproducible-r-workflow/.\n\n\nHugh-Jones, David. 2022. Huxtable: Easily Create and Style Tables for LaTeX, HTML and Other Formats. https://hughjonesd.github.io/huxtable/.\n\n\nLangsrud, Øyvind, and Jan Bruusgaard. 2021. PxWebApiData: PX-Web Data by API. https://github.com/statisticsnorway/PxWebApiData.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\nPebesma, Edzer J., and Roger S. Bivand. 2005. “Classes and Methods for Spatial Data in R.” R News 5 (2): 9–13. https://CRAN.R-project.org/doc/Rnews/.\n\n\nPebesma, Edzer, and Roger Bivand. 2022. Sp: Classes and Methods for Spatial Data. https://CRAN.R-project.org/package=sp.\n\n\nRobinson, David, Alex Hayes, and Simon Couch. 2022. Broom: Convert Statistical Objects into Tidy Tibbles. https://CRAN.R-project.org/package=broom.\n\n\nTennekes, Martijn. 2018. “tmap: Thematic Maps in R.” Journal of Statistical Software 84 (6): 1–39. https://doi.org/10.18637/jss.v084.i06.\n\n\n———. 2022. Tmap: Thematic Maps. https://github.com/r-tmap/tmap.\n\n\nWickham, Hadley. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, and Jennifer Bryan. 2022. Readxl: Read Excel Files. https://CRAN.R-project.org/package=readxl.\n\n\nXie, Yihui, Christophe Dervieux, and Emily Riederer. 2020. R Markdown Cookbook. Chapman; Hall/CRC. https://doi.org/10.1201/9781003097471."
  }
]