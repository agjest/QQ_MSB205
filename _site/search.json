[
  {
    "objectID": "maps/index.html",
    "href": "maps/index.html",
    "title": "Maps",
    "section": "",
    "text": "The Process\nEDA\nProjections 1\nProjections 2\nMore about maps"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#loading-packages",
    "href": "spatmetrics/LucasCounty/index.html#loading-packages",
    "title": "Spatial Hedonic Model",
    "section": "Loading packages",
    "text": "Loading packages\n\n\nCode\n# To install urbnmapr from github\ndevtools::install_github(\"UrbanInstitute/urbnmapr\")\n\n\n\n\nCode\n# for demean\nsuppressPackageStartupMessages({\nlibrary(Jmisc)\nlibrary(sf)\nlibrary(urbnmapr)\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(sp)\nlibrary(spdep)\nlibrary(spatialreg)\nlibrary(spData)\nlibrary(huxtable)\nlibrary(knitr)\n})\n# Options\noptions(scipen = 7)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#read-in-data",
    "href": "spatmetrics/LucasCounty/index.html#read-in-data",
    "title": "Spatial Hedonic Model",
    "section": "Read in data",
    "text": "Read in data\nWe convert from SpatialPointsDataFrame to sf (simple feature, point). Sample 3000 “random” observations from the 25357 available.\n\n\nCode\nset.seed(42)\nred_house_sf <- house %>% \n  st_as_sf() %>% \n# pick 3000 numbers from 1:25357 without replacement\n# classic solution\n#.[sample(dim(.)[1], size = 3000),]\n# tidyverse \n  slice_sample(n = 3000)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#quick-check-of-data",
    "href": "spatmetrics/LucasCounty/index.html#quick-check-of-data",
    "title": "Spatial Hedonic Model",
    "section": "Quick check of data",
    "text": "Quick check of data\n\n\nCode\nplot(red_house_sf[\"price\"], cex = 0.1, pch = 20)\n\n\n\n\n\nCode\ndim(red_house_sf)\n\n\n[1] 3000   25"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#dataset-info-r-help",
    "href": "spatmetrics/LucasCounty/index.html#dataset-info-r-help",
    "title": "Spatial Hedonic Model",
    "section": "Dataset info (R help)",
    "text": "Dataset info (R help)\nData on 25,357 single family homes sold in Lucas County, Ohio, 1993-1998 from the county auditor.\nFormal class ‘SpatialPointsDataFrame’ [package “sp”] with 5 slots. The data slot is a data frame with 25357 observations on the following 24 variables.\n\nprice\n\na numeric vector\n\nyrbuilt\n\na numeric vector\n\nstories\n\na factor with levels one bilevel multilvl one+half two two+half three\n\nTLA\n\na numeric vector"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-1",
    "href": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-1",
    "title": "Spatial Hedonic Model",
    "section": "Dataset info (R help)",
    "text": "Dataset info (R help)\n\nwall\n\na factor with levels stucdrvt ccbtile metlvnyl brick stone wood partbrk\n\nbeds\n\na numeric vector\n\nbaths\n\na numeric vector\n\nhalfbaths\n\na numeric vector\n\nfrontage\n\na numeric vector\n\ndepth\n\na numeric vector"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-2",
    "href": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-2",
    "title": "Spatial Hedonic Model",
    "section": "Dataset info (R help)",
    "text": "Dataset info (R help)\n\ngarage\n\na factor with levels no garage basement attached detached carport\n\ngaragesqft\n\na numeric vector\n\nrooms\n\na numeric vector\n\nlotsize\n\na numeric vector\n\nsdate\n\na numeric vector\n\navalue\n\na numeric vector"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-3",
    "href": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-3",
    "title": "Spatial Hedonic Model",
    "section": "Dataset info (R help)",
    "text": "Dataset info (R help)\n\ns1993 to s1998\n\na numeric vector\n\nsyear\n\na factor with levels 1993 1994 1995 1996 1997 1998\n\nage\n\na numeric vector"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-4",
    "href": "spatmetrics/LucasCounty/index.html#dataset-info-r-help-4",
    "title": "Spatial Hedonic Model",
    "section": "Dataset info (R help)",
    "text": "Dataset info (R help)\nIts projection is CRS(+init=epsg:2834), the Ohio North State Plane."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#histogram-of-age-variable",
    "href": "spatmetrics/LucasCounty/index.html#histogram-of-age-variable",
    "title": "Spatial Hedonic Model",
    "section": "Histogram of age variable",
    "text": "Histogram of age variable\n\n\nCode\nhist(100*red_house_sf$age, breaks = 30)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.",
    "href": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.",
    "title": "Spatial Hedonic Model",
    "section": "From SpatialPointsDataFrame to sf cont.",
    "text": "From SpatialPointsDataFrame to sf cont.\n\n\nCode\nsummary(100*red_house_sf$age)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   2.00   34.00   49.00   53.49   74.00  157.00 \n\n\n\n\nCode\nmy_age <- as.numeric(levels(red_house_sf$syear))[as.integer(red_house_sf$syear)] - red_house_sf$yrbuilt\nmy_age <- my_age + 3\nmy_age1 <- 1999 - red_house_sf$yrbuilt\n\n\n\n\nCode\nsummary(100*red_house_sf$age - my_age)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n -2.000  -1.000   0.000   0.348   2.000   3.000"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.-1",
    "href": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.-1",
    "title": "Spatial Hedonic Model",
    "section": "From SpatialPointsDataFrame to sf cont.",
    "text": "From SpatialPointsDataFrame to sf cont.\n\n\nCode\nhist(my_age1, breaks = 30)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.-2",
    "href": "spatmetrics/LucasCounty/index.html#from-spatialpointsdataframe-to-sf-cont.-2",
    "title": "Spatial Hedonic Model",
    "section": "From SpatialPointsDataFrame to sf cont.",
    "text": "From SpatialPointsDataFrame to sf cont.\n\n\nCode\nsummary(my_age1)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   2.00   34.00   49.00   53.49   74.00  157.00 \n\n\nCode\ntable(round(my_age1, 3) == round(100*red_house_sf$age, 3))\n\n\n\nTRUE \n3000"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#changing-the-age-variable",
    "href": "spatmetrics/LucasCounty/index.html#changing-the-age-variable",
    "title": "Spatial Hedonic Model",
    "section": "Changing the age variable",
    "text": "Changing the age variable\nOk, the age variable is the age of the house 1999 (not when sold), divided by 100. The age of the house when sold seems to be a more reasonable variable.\n\n\nCode\n# Trying to follow Bivand 2011, NHH Discussion Paper\n# age seems to include strange values. Turns out to be age in 1999 divided by 100\n# We calculate age at time of sale as age_sold = syear - yrbuilt\n# syear is factor, convert to numeric\nred_house_sf$age_sold <- as.numeric(levels(red_house_sf$syear))[as.integer(red_house_sf$syear)] - red_house_sf$yrbuilt\n# Scale age_sold by dividing by 100\nred_house_sf$age_sold <- red_house_sf$age_sold/100"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#running-the-first-model",
    "href": "spatmetrics/LucasCounty/index.html#running-the-first-model",
    "title": "Spatial Hedonic Model",
    "section": "Running the first model",
    "text": "Running the first model\n\n\nCode\n# define the model\nhmod1 <- \"I(log(price)) ~ I(age_sold) + I(age_sold^2) + \nI(age_sold^3) + I(log(TLA)) + I(log(lotsize)) + rooms + beds + syear\"\n\n\n\n\nCode\n# put result in lm1\nlm1 <- lm(hmod1, data = red_house_sf)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#running-the-first-model-cont.",
    "href": "spatmetrics/LucasCounty/index.html#running-the-first-model-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Running the first model cont.",
    "text": "Running the first model cont.\n\n\nCode\nsummary(lm1)\n\n\n\nCall:\nlm(formula = hmod1, data = red_house_sf)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.28253 -0.17076  0.04916  0.23925  2.19288 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)      3.18294    0.24525  12.979  < 2e-16 ***\nI(age_sold)      1.36458    0.18896   7.222 6.49e-13 ***\nI(age_sold^2)   -3.07357    0.35572  -8.640  < 2e-16 ***\nI(age_sold^3)    0.69686    0.19888   3.504 0.000465 ***\nI(log(TLA))      0.87255    0.03930  22.203  < 2e-16 ***\nI(log(lotsize))  0.17240    0.01170  14.736  < 2e-16 ***\nrooms            0.02096    0.01216   1.723 0.084952 .  \nbeds            -0.03325    0.01771  -1.877 0.060574 .  \nsyear1994        0.06870    0.02856   2.406 0.016201 *  \nsyear1995        0.09797    0.02789   3.513 0.000450 ***\nsyear1996        0.14211    0.02746   5.176 2.42e-07 ***\nsyear1997        0.16377    0.02710   6.043 1.70e-09 ***\nsyear1998        0.26449    0.02802   9.439  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.4175 on 2987 degrees of freedom\nMultiple R-squared:  0.6897,    Adjusted R-squared:  0.6884 \nF-statistic: 553.2 on 12 and 2987 DF,  p-value: < 2.2e-16"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#generate-neighbour-structure",
    "href": "spatmetrics/LucasCounty/index.html#generate-neighbour-structure",
    "title": "Spatial Hedonic Model",
    "section": "Generate neighbour structure",
    "text": "Generate neighbour structure\nFind 5 nearest, make neighbour list and finally convert the neighbour list to a row standardised weight matrix.\n\n\nCode\nred_house_sf_mat_nb <- knearneigh(red_house_sf, k = 5)\nred_house_sf_nb <- knn2nb(red_house_sf_mat_nb)\nred_house_sf_w <- nb2listw(red_house_sf_nb, style = \"W\")\n\n\nPlot the price of a house against the mean price of its (5 nearest) neighbours. There seems to be a positive spatial association"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#moran-plot",
    "href": "spatmetrics/LucasCounty/index.html#moran-plot",
    "title": "Spatial Hedonic Model",
    "section": "Moran Plot",
    "text": "Moran Plot\n\n\nCode\nmoran.plot(log(red_house_sf$price), listw = red_house_sf_w, labels = FALSE, pch = 20, cex=0.3)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#approximate-profile-likelihood-estimator-aple",
    "href": "spatmetrics/LucasCounty/index.html#approximate-profile-likelihood-estimator-aple",
    "title": "Spatial Hedonic Model",
    "section": "Approximate profile-likelihood estimator (APLE)",
    "text": "Approximate profile-likelihood estimator (APLE)\nApproximate profile-likelihood estimator (APLE), see (OnestepEstimationSpatial?)\n\n\nCode\n# Calculate APLE for the variables\nred_house_sf %>% \n  select(price, age_sold, TLA, lotsize, rooms, beds) %>% \n  st_set_geometry(., NULL) %>% \n  demean() %>% \n  as_tibble() %>% \n  map(aple,listw = red_house_sf_w)\n\n\n$price\n[1] 0.7672068\n\n$age_sold\n[1] 0.7658228\n\n$TLA\n[1] 0.7120571\n\n$lotsize\n[1] 0.5974422\n\n$rooms\n[1] 0.5652239\n\n$beds\n[1] 0.4316318"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#conclusion-aple",
    "href": "spatmetrics/LucasCounty/index.html#conclusion-aple",
    "title": "Spatial Hedonic Model",
    "section": "Conclusion APLE",
    "text": "Conclusion APLE\nWe see that the strength of positive spatial dependence is greatest for price, TLA and lotsize and lowest for number of bedrooms (beds) in the dwellings.\n\n[APLE], which may be viewed somewhat like a correlation coefficient between the values observed for each state and the average values for neighbouring states.(bivandReviewSoftwareSpatial2021?)\n\n\n\nCode\n# If we want to see which obs. are the most influential we can \n# change labels to TRUE\n# The row number for each influential obs. will then be plotted in the figure.\nmoran.plot(red_house_sf$age_sold, listw = red_house_sf_w, \n           labels = FALSE, pch = 20, cex = 0.3)\n\n\n\n\n\nCode\n# Remember that age_sold is scaled by 1/100, so the max age 1.59 is in fact 159 years\nsummary(red_house_sf$age_sold)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n-0.0200  0.3000  0.4600  0.5014  0.7200  1.5500"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#spatial-models",
    "href": "spatmetrics/LucasCounty/index.html#spatial-models",
    "title": "Spatial Hedonic Model",
    "section": "Spatial models",
    "text": "Spatial models\n\nLocal: SDEM, SEM, SLX, lm\nGlobal: SDM, SAR, SLX, SEM, lm"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-start-with-sdem",
    "href": "spatmetrics/LucasCounty/index.html#local-start-with-sdem",
    "title": "Spatial Hedonic Model",
    "section": "Local, start with SDEM",
    "text": "Local, start with SDEM\n\n\nCode\n#\n# Some of these models are quite expensive to compute, so we cache the results\n# It should automagically be recomputed if something change, but caching is complex\n# so we should check that the models really are recomputed if we change the data or model\n# Note the use of the option Durbin to choose the kind of model. Used to be done by the options\n# type and etype until recently.\nSDEM <- errorsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = TRUE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-start-with-sdem-cont.",
    "href": "spatmetrics/LucasCounty/index.html#local-start-with-sdem-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Local, start with SDEM cont.",
    "text": "Local, start with SDEM cont.\n\n\nCode\nsummary(impacts(SDEM), zstats = TRUE)\n\n\nImpact measures (SDEM, estimable, n):\n                     Direct     Indirect       Total\nI(age_sold)      0.54354495  1.724313763  2.26785872\nI(age_sold^2)   -1.21151106 -3.154619724 -4.36613078\nI(age_sold^3)    0.11989915  0.858429426  0.97832858\nI(log(TLA))      0.72161017  0.325829444  1.04743962\nI(log(lotsize))  0.12000068  0.002125825  0.12212651\nrooms            0.02297956  0.022089512  0.04506907\nbeds            -0.02377263 -0.044374996 -0.06814763\nsyear1994        0.05822351  0.014444954  0.07266846\nsyear1995        0.08315349 -0.081602445  0.00155105\nsyear1996        0.11349889 -0.004495018  0.10900387\nsyear1997        0.15008363 -0.051995070  0.09808856\nsyear1998        0.25156113  0.082365747  0.33392688\n========================================================\nStandard errors:\n                    Direct   Indirect      Total\nI(age_sold)     0.18923927 0.38948601 0.43443469\nI(age_sold^2)   0.34201530 0.75080528 0.85762746\nI(age_sold^3)   0.18247954 0.42982524 0.49956776\nI(log(TLA))     0.03385523 0.08982915 0.10418040\nI(log(lotsize)) 0.01291015 0.02403307 0.02544146\nrooms           0.01026090 0.02939071 0.03485904\nbeds            0.01499544 0.04409250 0.05258579\nsyear1994       0.02411830 0.07143272 0.08526701\nsyear1995       0.02367407 0.06854508 0.08227209\nsyear1996       0.02326275 0.06749020 0.08095887\nsyear1997       0.02276712 0.06575233 0.07821040\nsyear1998       0.02378814 0.06937785 0.08321369\n========================================================\nZ-values:\n                    Direct    Indirect       Total\nI(age_sold)      2.8722631  4.42715202  5.22025240\nI(age_sold^2)   -3.5422715 -4.20164829 -5.09094101\nI(age_sold^3)    0.6570553  1.99715921  1.95835012\nI(log(TLA))     21.3145857  3.62721279 10.05409494\nI(log(lotsize))  9.2950616  0.08845415  4.80029465\nrooms            2.2395272  0.75158132  1.29289471\nbeds            -1.5853238 -1.00640696 -1.29593239\nsyear1994        2.4140802  0.20221761  0.85224590\nsyear1995        3.5124295 -1.19049312  0.01885269\nsyear1996        4.8789969 -0.06660253  1.34641049\nsyear1997        6.5921205 -0.79077157  1.25416262\nsyear1998       10.5750638  1.18720529  4.01288416\n\np-values:\n                Direct            Indirect     Total        \nI(age_sold)     0.00407544        0.0000095485 0.00000017868\nI(age_sold^2)   0.00039670        0.0000264979 0.00000035629\nI(age_sold^3)   0.51114534        0.0458079    0.050189     \nI(log(TLA))     < 2.22e-16        0.0002865    < 2.22e-16   \nI(log(lotsize)) < 2.22e-16        0.9295157    0.00000158432\nrooms           0.02512163        0.4523029    0.196047     \nbeds            0.11289279        0.3142198    0.194999     \nsyear1994       0.01577499        0.8397466    0.394078     \nsyear1995       0.00044403        0.2338526    0.984959     \nsyear1996       0.000001066267611 0.9468981    0.178170     \nsyear1997       0.000000000043359 0.4290773    0.209783     \nsyear1998       < 2.22e-16        0.2351467    0.00005998135"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-sem",
    "href": "spatmetrics/LucasCounty/index.html#local-sem",
    "title": "Spatial Hedonic Model",
    "section": "Local, SEM",
    "text": "Local, SEM\n\n\nCode\n#\n# No spatial effects in the explanatory variables\nSEM <- errorsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = FALSE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-sem-cont.",
    "href": "spatmetrics/LucasCounty/index.html#local-sem-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Local, SEM cont.",
    "text": "Local, SEM cont.\n\n\nCode\n# normal summary, no impacts\nsummary(SEM)\n\n\n\nCall:errorsarlm(formula = hmod1, data = red_house_sf, listw = red_house_sf_w, \n    Durbin = FALSE)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-2.247145 -0.123725  0.048252  0.183358  1.409720 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                  Estimate Std. Error z value  Pr(>|z|)\n(Intercept)      4.5722371  0.2218972 20.6052 < 2.2e-16\nI(age_sold)      0.4324416  0.1929360  2.2414 0.0250019\nI(age_sold^2)   -1.2513269  0.3432463 -3.6456 0.0002668\nI(age_sold^3)    0.2529478  0.1798265  1.4066 0.1595397\nI(log(TLA))      0.6881769  0.0328172 20.9700 < 2.2e-16\nI(log(lotsize))  0.1547907  0.0129766 11.9285 < 2.2e-16\nrooms            0.0203277  0.0094133  2.1595 0.0308137\nbeds            -0.0154644  0.0134197 -1.1524 0.2491686\nsyear1994        0.0591256  0.0214624  2.7549 0.0058719\nsyear1995        0.1019680  0.0209649  4.8638 1.152e-06\nsyear1996        0.1156346  0.0206226  5.6072 2.057e-08\nsyear1997        0.1581283  0.0206646  7.6521 1.976e-14\nsyear1998        0.2419856  0.0210379 11.5024 < 2.2e-16\n\nLambda: 0.71779, LR test value: 1068.1, p-value: < 2.22e-16\nAsymptotic standard error: 0.012617\n    z-value: 56.889, p-value: < 2.22e-16\nWald statistic: 3236.4, p-value: < 2.22e-16\n\nLog likelihood: -1095.658 for error model\nML residual variance (sigma squared): 0.10709, (sigma: 0.32725)\nNumber of observations: 3000 \nNumber of parameters estimated: 15 \nAIC: 2221.3, (AIC for lm: 3287.4)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-slx",
    "href": "spatmetrics/LucasCounty/index.html#local-slx",
    "title": "Spatial Hedonic Model",
    "section": "Local, SLX",
    "text": "Local, SLX\n\n\nCode\n# SLX is not costly to compute, so no caching\nSLX <- lmSLX(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = TRUE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-slx-cont.",
    "href": "spatmetrics/LucasCounty/index.html#local-slx-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Local, SLX cont.",
    "text": "Local, SLX cont.\n\n\nCode\n# NEW\nsummary(SLX)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-2.14787 -0.16031  0.03406  0.21892  1.74104 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)          1.38667    0.39699   3.493 0.000485 ***\nI.age_sold.          0.38157    0.22873   1.668 0.095382 .  \nI.age_sold.2.       -0.85171    0.40573  -2.099 0.035883 *  \nI.age_sold.3.       -0.09377    0.21181  -0.443 0.658017    \nI.log.TLA..          0.73652    0.03866  19.052  < 2e-16 ***\nI.log.lotsize..      0.12926    0.01603   8.065 1.05e-15 ***\nrooms                0.01628    0.01124   1.449 0.147501    \nbeds                -0.02206    0.01622  -1.360 0.173951    \nsyear1994            0.05145    0.02611   1.970 0.048899 *  \nsyear1995            0.07881    0.02553   3.086 0.002045 ** \nsyear1996            0.11734    0.02513   4.670 3.15e-06 ***\nsyear1997            0.14640    0.02488   5.885 4.41e-09 ***\nsyear1998            0.23996    0.02566   9.351  < 2e-16 ***\nlag.I.age_sold.      1.15103    0.30450   3.780 0.000160 ***\nlag.I.age_sold.2.   -1.64942    0.57575  -2.865 0.004202 ** \nlag.I.age_sold.3.   -0.19096    0.32339  -0.591 0.554896    \nlag.I.log.TLA..      0.53352    0.07137   7.475 1.01e-13 ***\nlag.I.log.lotsize.. -0.03657    0.02014  -1.815 0.069590 .  \nlag.rooms           -0.02126    0.02312  -0.920 0.357889    \nlag.beds            -0.07522    0.03587  -2.097 0.036045 *  \nlag.syear1994        0.00707    0.05885   0.120 0.904383    \nlag.syear1995       -0.11414    0.05515  -2.070 0.038566 *  \nlag.syear1996        0.04710    0.05467   0.862 0.389028    \nlag.syear1997       -0.04288    0.05345  -0.802 0.422461    \nlag.syear1998        0.01115    0.05630   0.198 0.843002    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.3806 on 2975 degrees of freedom\nMultiple R-squared:  0.7432,    Adjusted R-squared:  0.7411 \nF-statistic: 358.7 on 24 and 2975 DF,  p-value: < 2.2e-16"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#local-slx-cont.-1",
    "href": "spatmetrics/LucasCounty/index.html#local-slx-cont.-1",
    "title": "Spatial Hedonic Model",
    "section": "Local, SLX cont.",
    "text": "Local, SLX cont.\n\n\nCode\nsummary(impacts(SLX))\n\n\nImpact measures (SlX, estimable, n-k):\n                     Direct    Indirect        Total\nI(age_sold)      0.38156590  1.15103005  1.532595952\nI(age_sold^2)   -0.85170575 -1.64942197 -2.501127726\nI(age_sold^3)   -0.09376923 -0.19096402 -0.284733249\nI(log(TLA))      0.73652194  0.53352169  1.270043628\nI(log(lotsize))  0.12925829 -0.03656680  0.092691491\nrooms            0.01628444 -0.02125872 -0.004974276\nbeds            -0.02206352 -0.07522198 -0.097285494\nsyear1994        0.05145317  0.00707043  0.058523597\nsyear1995        0.07880749 -0.11414540 -0.035337908\nsyear1996        0.11733890  0.04710113  0.164440031\nsyear1997        0.14640447 -0.04288481  0.103519660\nsyear1998        0.23996283  0.01115155  0.251114383\n========================================================\nStandard errors:\n                    Direct   Indirect      Total\nI(age_sold)     0.22872967 0.30449602 0.24918360\nI(age_sold^2)   0.40572698 0.57575170 0.50525662\nI(age_sold^3)   0.21181383 0.32339030 0.30064908\nI(log(TLA))     0.03865767 0.07137542 0.07111016\nI(log(lotsize)) 0.01602681 0.02014448 0.01484568\nrooms           0.01124002 0.02311892 0.02442589\nbeds            0.01622385 0.03586492 0.03868248\nsyear1994       0.02611467 0.05885307 0.06406798\nsyear1995       0.02553422 0.05515050 0.06017843\nsyear1996       0.02512742 0.05467291 0.05970609\nsyear1997       0.02487559 0.05345438 0.05731268\nsyear1998       0.02566200 0.05630042 0.06152147\n========================================================\nZ-values:\n                    Direct   Indirect      Total\nI(age_sold)      1.6681959  3.7801153  6.1504688\nI(age_sold^2)   -2.0992091 -2.8648148 -4.9502127\nI(age_sold^3)   -0.4426965 -0.5905063 -0.9470618\nI(log(TLA))     19.0524144  7.4748656 17.8602283\nI(log(lotsize))  8.0651294 -1.8152268  6.2436693\nrooms            1.4487917 -0.9195379 -0.2036477\nbeds            -1.3599432 -2.0973689 -2.5149753\nsyear1994        1.9702784  0.1201370  0.9134610\nsyear1995        3.0863483 -2.0697075 -0.5872189\nsyear1996        4.6697557  0.8615077  2.7541587\nsyear1997        5.8854663 -0.8022693  1.8062261\nsyear1998        9.3509031  0.1980722  4.0817360\n\np-values:\n                Direct     Indirect   Total           \nI(age_sold)     0.0952768  0.00015676 0.00000000077254\nI(age_sold^2)   0.0357985  0.00417253 0.00000074132419\nI(age_sold^3)   0.6579853  0.55485125 0.3436073       \nI(log(TLA))     < 2.22e-16 7.7272e-14 < 2.22e-16      \nI(log(lotsize)) 6.6613e-16 0.06948906 0.00000000042742\nrooms           0.1473958  0.35781429 0.8386288       \nbeds            0.1738479  0.03596093 0.0119041       \nsyear1994       0.0488065  0.90437463 0.3610001       \nsyear1995       0.0020263  0.03847974 0.5570567       \nsyear1996       3.0156e-06 0.38895846 0.0058843       \nsyear1997       3.9693e-09 0.42239720 0.0708830       \nsyear1998       < 2.22e-16 0.84298854 0.00004470055406"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#choosing-a-local-model",
    "href": "spatmetrics/LucasCounty/index.html#choosing-a-local-model",
    "title": "Spatial Hedonic Model",
    "section": "Choosing a local model",
    "text": "Choosing a local model\n\nSince the models are nested we can test the models against each other with a likelihood ratio test"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sem-versus-sdem",
    "href": "spatmetrics/LucasCounty/index.html#sem-versus-sdem",
    "title": "Spatial Hedonic Model",
    "section": "SEM versus SDEM",
    "text": "SEM versus SDEM\n\n\nCode\nLR.Sarlm(SEM, SDEM)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = -266.63, df = 12, p-value < 2.2e-16\nsample estimates:\n Log likelihood of SEM Log likelihood of SDEM \n            -1095.6575              -962.3424 \n\n\nDiscard H0, do not restrict to SEM. We keep \\(\\theta > 0\\)."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdem-versus-slx",
    "href": "spatmetrics/LucasCounty/index.html#sdem-versus-slx",
    "title": "Spatial Hedonic Model",
    "section": "SDEM versus SLX",
    "text": "SDEM versus SLX\n\n\nCode\nLR.Sarlm(SDEM, SLX)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 767.28, df = 1, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDEM  Log likelihood of SLX \n             -962.3424             -1345.9840 \n\n\nWe discard H0 and will not restrict to SLX, continue with SDEM."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdem-versus-lm1",
    "href": "spatmetrics/LucasCounty/index.html#sdem-versus-lm1",
    "title": "Spatial Hedonic Model",
    "section": "SDEM versus lm1",
    "text": "SDEM versus lm1\n\n\nCode\nLR.Sarlm(SDEM, lm1)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 1334.7, df = 13, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDEM  Log likelihood of lm1 \n             -962.3424             -1629.6987 \n\n\nDiscard H0, we will not restrict to OLS."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#conclusion",
    "href": "spatmetrics/LucasCounty/index.html#conclusion",
    "title": "Spatial Hedonic Model",
    "section": "Conclusion",
    "text": "Conclusion\n\nWe end up with SDEM as the best local model.\n\nNo endogeniety in the price variable.\n\n\n\n\n\nCode\n# residuals are with attributes, hence as.vector()\nmoran.plot(SDEM$residuals, listw = red_house_sf_w)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#results",
    "href": "spatmetrics/LucasCounty/index.html#results",
    "title": "Spatial Hedonic Model",
    "section": "Results",
    "text": "Results\n\n\nCode\n# Do not use \"SDEM\" = SDEM, report coeffisent estimates not impacts\nhuxreg(\"OLS\" = lm1, \"SEM\" = SEM, \n       error_format = \"({statistic})\",\n       note = \"{stars}. T-values reported.\")\n\n\n\n\n\nOLSSEM\n\n(Intercept)3.183 ***4.572 ***\n\n(12.979)   (20.605)   \n\nI(age_sold)1.365 ***0.432 *  \n\n(7.222)   (2.241)   \n\nI(age_sold^2)-3.074 ***-1.251 ***\n\n(-8.640)   (-3.646)   \n\nI(age_sold^3)0.697 ***0.253    \n\n(3.504)   (1.407)   \n\nI(log(TLA))0.873 ***0.688 ***\n\n(22.203)   (20.970)   \n\nI(log(lotsize))0.172 ***0.155 ***\n\n(14.736)   (11.928)   \n\nrooms0.021    0.020 *  \n\n(1.723)   (2.159)   \n\nbeds-0.033    -0.015    \n\n(-1.877)   (-1.152)   \n\nsyear19940.069 *  0.059 ** \n\n(2.406)   (2.755)   \n\nsyear19950.098 ***0.102 ***\n\n(3.513)   (4.864)   \n\nsyear19960.142 ***0.116 ***\n\n(5.176)   (5.607)   \n\nsyear19970.164 ***0.158 ***\n\n(6.043)   (7.652)   \n\nsyear19980.264 ***0.242 ***\n\n(9.439)   (11.502)   \n\nlambda        0.718 ***\n\n        (56.889)   \n\nN3000        3000        \n\nR20.690    0.815    \n\nlogLik-1629.699    -1095.658    \n\nAIC3287.397    2221.315    \n\n *** p < 0.001;  ** p < 0.01;  * p < 0.05. T-values reported.\n\n\n\n\nCompare impacts from SDEM and SLX model\n\n\nCode\n# tidy(SDEM) or tidy(SLX) reports regression coefficients\n# make our own table for easy comparison of impacts\ni_SDEM <- impacts(SDEM)$impacts %>% \n  as_tibble() %>% \n  mutate(\n    variable = names(impacts(SDEM)$impacts$direct)\n  ) %>% \n  select(variable, everything())\n\ni_SLX <- impacts(SLX)$impacts %>% \n  as_tibble()\n\nnames(i_SDEM)[2:4] <- paste(\"SDEM\", names(i_SDEM)[2:4], sep = \"_\")\nnames(i_SLX) <- paste(\"SLX\", names(i_SLX), sep = \"_\")\ni_SDEM_SLX <- cbind(i_SDEM, i_SLX)\ni_SDEM_SLX <- cbind(variable = i_SDEM_SLX[, \"variable\"], \n                    round(i_SDEM_SLX[, -1], 6))\n\n\nCompare impacts from SDEM and SLX model cont.\n\n\nCode\nkable(i_SDEM_SLX[, c(1:2,5,3,6,4,7)])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvariable\nSDEM_direct\nSLX_direct\nSDEM_indirect\nSLX_indirect\nSDEM_total\nSLX_total\n\n\n\n\nI(age_sold)\n0.543545\n0.381566\n1.724314\n1.151030\n2.267859\n1.532596\n\n\nI(age_sold^2)\n-1.211511\n-0.851706\n-3.154620\n-1.649422\n-4.366131\n-2.501128\n\n\nI(age_sold^3)\n0.119899\n-0.093769\n0.858429\n-0.190964\n0.978329\n-0.284733\n\n\nI(log(TLA))\n0.721610\n0.736522\n0.325829\n0.533522\n1.047440\n1.270044\n\n\nI(log(lotsize))\n0.120001\n0.129258\n0.002126\n-0.036567\n0.122127\n0.092691\n\n\nrooms\n0.022980\n0.016284\n0.022090\n-0.021259\n0.045069\n-0.004974\n\n\nbeds\n-0.023773\n-0.022064\n-0.044375\n-0.075222\n-0.068148\n-0.097285\n\n\nsyear1994\n0.058224\n0.051453\n0.014445\n0.007070\n0.072668\n0.058524\n\n\nsyear1995\n0.083153\n0.078807\n-0.081602\n-0.114145\n0.001551\n-0.035338\n\n\nsyear1996\n0.113499\n0.117339\n-0.004495\n0.047101\n0.109004\n0.164440\n\n\nsyear1997\n0.150084\n0.146404\n-0.051995\n-0.042885\n0.098089\n0.103520\n\n\nsyear1998\n0.251561\n0.239963\n0.082366\n0.011152\n0.333927\n0.251114"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global",
    "href": "spatmetrics/LucasCounty/index.html#global",
    "title": "Spatial Hedonic Model",
    "section": "Global",
    "text": "Global\n\nNow spatial lag in y and X."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sdm",
    "href": "spatmetrics/LucasCounty/index.html#global-sdm",
    "title": "Spatial Hedonic Model",
    "section": "Global; SDM",
    "text": "Global; SDM\n\n\nCode\n#\n# expensive to compute\nSDM <- lagsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = TRUE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sdm-impacts",
    "href": "spatmetrics/LucasCounty/index.html#global-sdm-impacts",
    "title": "Spatial Hedonic Model",
    "section": "Global; SDM impacts",
    "text": "Global; SDM impacts\n\n\nCode\n#\n# Computing the impacts is expensive too\nimpacts(SDM, listw = red_house_sf_w)\n\n\nImpact measures (mixed, exact):\n                     Direct     Indirect        Total\nI(age_sold)      0.44458343  1.998987232  2.443570658\nI(age_sold^2)   -1.00533917 -3.230813468 -4.236152639\nI(age_sold^3)    0.03747523  0.571379837  0.608855065\nI(log(TLA))      0.73179133  0.538408810  1.270200141\nI(log(lotsize))  0.11643717 -0.031417681  0.085019488\nrooms            0.01892389 -0.009570688  0.009353204\nbeds            -0.02425261 -0.074563783 -0.098816393\nsyear1994        0.05338215  0.010866667  0.064248814\nsyear1995        0.08036644 -0.127280373 -0.046913936\nsyear1996        0.11360203  0.019036422  0.132638448\nsyear1997        0.14408151 -0.083271804  0.060809708\nsyear1998        0.24456200  0.065133136  0.309695135"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sdm-impacts-cont.",
    "href": "spatmetrics/LucasCounty/index.html#global-sdm-impacts-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Global; SDM impacts cont.",
    "text": "Global; SDM impacts cont.\n\n\nCode\n#\n# Simulated, varies somewhat with each sample (note that seed is set above). Results might \n# differ with another seed\nsummary(impacts(SDM, listw = red_house_sf_w, R = 500), zstats = TRUE)\n\n\nImpact measures (mixed, exact):\n                     Direct     Indirect        Total\nI(age_sold)      0.44458343  1.998987232  2.443570658\nI(age_sold^2)   -1.00533917 -3.230813468 -4.236152639\nI(age_sold^3)    0.03747523  0.571379837  0.608855065\nI(log(TLA))      0.73179133  0.538408810  1.270200141\nI(log(lotsize))  0.11643717 -0.031417681  0.085019488\nrooms            0.01892389 -0.009570688  0.009353204\nbeds            -0.02425261 -0.074563783 -0.098816393\nsyear1994        0.05338215  0.010866667  0.064248814\nsyear1995        0.08036644 -0.127280373 -0.046913936\nsyear1996        0.11360203  0.019036422  0.132638448\nsyear1997        0.14408151 -0.083271804  0.060809708\nsyear1998        0.24456200  0.065133136  0.309695135\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      0.43570 0.19042 0.0085158      0.0085158\nI(age_sold^2)   -0.99295 0.34738 0.0155351      0.0155351\nI(age_sold^3)    0.03269 0.18442 0.0082475      0.0082475\nI(log(TLA))      0.73000 0.03447 0.0015415      0.0015415\nI(log(lotsize))  0.11661 0.01307 0.0005846      0.0005846\nrooms            0.01909 0.01092 0.0004882      0.0004882\nbeds            -0.02397 0.01598 0.0007145      0.0007145\nsyear1994        0.05506 0.02482 0.0011101      0.0012457\nsyear1995        0.08085 0.02429 0.0010863      0.0011869\nsyear1996        0.11416 0.02495 0.0011160      0.0011160\nsyear1997        0.14598 0.02399 0.0010726      0.0010726\nsyear1998        0.24526 0.02551 0.0011409      0.0010602\n\n2. Quantiles for each variable:\n\n                     2.5%      25%      50%      75%     97.5%\nI(age_sold)      0.095565  0.30503  0.44227  0.54876  0.809285\nI(age_sold^2)   -1.724104 -1.20116 -0.96789 -0.76943 -0.334029\nI(age_sold^3)   -0.315551 -0.09222  0.02300  0.15148  0.416582\nI(log(TLA))      0.665457  0.70655  0.72949  0.75204  0.799164\nI(log(lotsize))  0.090251  0.10840  0.11656  0.12512  0.142325\nrooms           -0.001500  0.01174  0.01959  0.02626  0.038572\nbeds            -0.055530 -0.03359 -0.02394 -0.01279  0.007231\nsyear1994        0.005699  0.03975  0.05516  0.07112  0.101494\nsyear1995        0.036205  0.06447  0.07939  0.09711  0.129766\nsyear1996        0.067438  0.09793  0.11354  0.13034  0.165083\nsyear1997        0.099891  0.12911  0.14580  0.16159  0.194748\nsyear1998        0.197348  0.22780  0.24600  0.26312  0.292044\n\n========================================================\nIndirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD Naive SE Time-series SE\nI(age_sold)      2.025320 0.46676 0.020874       0.019017\nI(age_sold^2)   -3.266763 0.92210 0.041238       0.037790\nI(age_sold^3)    0.584661 0.54236 0.024255       0.022181\nI(log(TLA))      0.535366 0.12898 0.005768       0.005357\nI(log(lotsize)) -0.030654 0.02804 0.001254       0.001254\nrooms           -0.009554 0.04452 0.001991       0.001991\nbeds            -0.073332 0.06929 0.003099       0.003349\nsyear1994        0.021722 0.11005 0.004922       0.004992\nsyear1995       -0.126917 0.10376 0.004640       0.004640\nsyear1996        0.019737 0.10825 0.004841       0.004841\nsyear1997       -0.076148 0.10519 0.004704       0.004704\nsyear1998        0.072323 0.10853 0.004854       0.004854\n\n2. Quantiles for each variable:\n\n                    2.5%      25%       50%       75%    97.5%\nI(age_sold)      1.15398  1.70131  2.008675  2.331730  3.00100\nI(age_sold^2)   -5.03359 -3.91820 -3.271442 -2.690050 -1.43346\nI(age_sold^3)   -0.50260  0.22930  0.598291  0.958270  1.61196\nI(log(TLA))      0.30486  0.44808  0.530356  0.622814  0.79635\nI(log(lotsize)) -0.08743 -0.04791 -0.032662 -0.012741  0.02549\nrooms           -0.09241 -0.03704 -0.008471  0.018965  0.07568\nbeds            -0.20182 -0.12365 -0.069357 -0.025177  0.05546\nsyear1994       -0.18232 -0.05392  0.016279  0.093570  0.23186\nsyear1995       -0.32440 -0.19655 -0.125605 -0.060039  0.08411\nsyear1996       -0.18293 -0.05864  0.020883  0.096351  0.22812\nsyear1997       -0.27454 -0.14934 -0.071229 -0.004911  0.12856\nsyear1998       -0.13039 -0.00286  0.070220  0.149466  0.27953\n\n========================================================\nTotal:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD Naive SE Time-series SE\nI(age_sold)      2.461016 0.50719 0.022682       0.019115\nI(age_sold^2)   -4.259714 1.01230 0.045271       0.041124\nI(age_sold^3)    0.617346 0.59918 0.026796       0.024313\nI(log(TLA))      1.265368 0.14348 0.006417       0.006417\nI(log(lotsize))  0.085955 0.02923 0.001307       0.001307\nrooms            0.009539 0.05049 0.002258       0.002258\nbeds            -0.097298 0.07854 0.003512       0.003798\nsyear1994        0.076780 0.12487 0.005584       0.005802\nsyear1995       -0.046069 0.11801 0.005278       0.005278\nsyear1996        0.133893 0.12292 0.005497       0.005497\nsyear1997        0.069828 0.11893 0.005319       0.004983\nsyear1998        0.317586 0.12483 0.005583       0.005583\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%      75%    97.5%\nI(age_sold)      1.45427  2.111280  2.49526  2.76011  3.48662\nI(age_sold^2)   -6.32389 -4.889165 -4.28008 -3.56764 -2.32134\nI(age_sold^3)   -0.57794  0.205209  0.62019  1.03076  1.84534\nI(log(TLA))      1.00436  1.167136  1.25655  1.36218  1.56029\nI(log(lotsize))  0.03000  0.066597  0.08467  0.10659  0.14223\nrooms           -0.08354 -0.024711  0.01104  0.04254  0.10627\nbeds            -0.24361 -0.154012 -0.09187 -0.04515  0.05514\nsyear1994       -0.14955 -0.009261  0.06750  0.16067  0.32880\nsyear1995       -0.26477 -0.122388 -0.04623  0.02764  0.18902\nsyear1996       -0.09288  0.047321  0.14036  0.21944  0.38363\nsyear1997       -0.15751 -0.017669  0.07465  0.14384  0.30954\nsyear1998        0.07058  0.235313  0.31418  0.40323  0.55379\n\n========================================================\nSimulated standard errors\n                    Direct   Indirect      Total\nI(age_sold)     0.19041885 0.46676400 0.50719217\nI(age_sold^2)   0.34737516 0.92209917 1.01229557\nI(age_sold^3)   0.18442029 0.54235807 0.59917636\nI(log(TLA))     0.03446933 0.12897668 0.14347930\nI(log(lotsize)) 0.01307219 0.02803738 0.02922747\nrooms           0.01091571 0.04451850 0.05049288\nbeds            0.01597671 0.06929074 0.07854027\nsyear1994       0.02482295 0.11005341 0.12486755\nsyear1995       0.02429102 0.10376346 0.11801248\nsyear1996       0.02495361 0.10825326 0.12291700\nsyear1997       0.02398517 0.10519073 0.11893279\nsyear1998       0.02551176 0.10853417 0.12483401\n\nSimulated z-values:\n                    Direct   Indirect      Total\nI(age_sold)      2.2880916  4.3390667  4.8522356\nI(age_sold^2)   -2.8584393 -3.5427457 -4.2079742\nI(age_sold^3)    0.1772314  1.0779973  1.0303237\nI(log(TLA))     21.1783112  4.1508715  8.8191672\nI(log(lotsize))  8.9203562 -1.0933185  2.9408911\nrooms            1.7491371 -0.2146006  0.1889252\nbeds            -1.5000821 -1.0583224 -1.2388335\nsyear1994        2.2180426  0.1973775  0.6148950\nsyear1995        3.3283225 -1.2231399 -0.3903728\nsyear1996        4.5747137  0.1823254  1.0892957\nsyear1997        6.0860982 -0.7239017  0.5871244\nsyear1998        9.6137168  0.6663654  2.5440680\n\nSimulated p-values:\n                Direct         Indirect    Total       \nI(age_sold)     0.02213218     0.000014309 0.0000012208\nI(age_sold^2)   0.00425731     0.00039598  0.0000257670\nI(age_sold^3)   0.85932663     0.28103497  0.3028581   \nI(log(TLA))     < 2.22e-16     0.000033121 < 2.22e-16  \nI(log(lotsize)) < 2.22e-16     0.27425396  0.0032727   \nrooms           0.08026732     0.83007876  0.8501515   \nbeds            0.13359315     0.28990849  0.2154072   \nsyear1994       0.02655193     0.84353210  0.5386240   \nsyear1995       0.00087371     0.22127688  0.6962609   \nsyear1996       0.000004768716 0.85532733  0.2760235   \nsyear1997       0.000000001157 0.46912608  0.5571201   \nsyear1998       < 2.22e-16     0.50517759  0.0109570"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sar",
    "href": "spatmetrics/LucasCounty/index.html#global-sar",
    "title": "Spatial Hedonic Model",
    "section": "Global SAR",
    "text": "Global SAR\n\n\nCode\n#\nSAR <- lagsarlm(hmod1, data = red_house_sf, listw = red_house_sf_w, Durbin = FALSE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sar-cont.",
    "href": "spatmetrics/LucasCounty/index.html#global-sar-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Global SAR cont.",
    "text": "Global SAR cont.\n\n\nCode\n# NEW\nsummary(SAR)\n\n\n\nCall:lagsarlm(formula = hmod1, data = red_house_sf, listw = red_house_sf_w, \n    Durbin = FALSE)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-2.107445 -0.138104  0.035175  0.189967  1.226065 \n\nType: lag \nCoefficients: (asymptotic standard errors) \n                  Estimate Std. Error z value  Pr(>|z|)\n(Intercept)     -0.2514883  0.2074699 -1.2122 0.2254484\nI(age_sold)      1.1792030  0.1497421  7.8749 3.331e-15\nI(age_sold^2)   -2.1020853  0.2832284 -7.4219 1.155e-13\nI(age_sold^3)    0.4826410  0.1578425  3.0577 0.0022301\nI(log(TLA))      0.6415673  0.0317194 20.2263 < 2.2e-16\nI(log(lotsize))  0.0632934  0.0097473  6.4935 8.389e-11\nrooms            0.0098137  0.0096416  1.0178 0.3087538\nbeds            -0.0103466  0.0140334 -0.7373 0.4609509\nsyear1994        0.0530507  0.0226122  2.3461 0.0189707\nsyear1995        0.0831306  0.0220890  3.7634 0.0001676\nsyear1996        0.1124883  0.0217470  5.1726 2.309e-07\nsyear1997        0.1434820  0.0214686  6.6834 2.335e-11\nsyear1998        0.2302061  0.0222179 10.3613 < 2.2e-16\n\nRho: 0.53679, LR test value: 1211, p-value: < 2.22e-16\nAsymptotic standard error: 0.013019\n    z-value: 41.23, p-value: < 2.22e-16\nWald statistic: 1699.9, p-value: < 2.22e-16\n\nLog likelihood: -1024.179 for lag model\nML residual variance (sigma squared): 0.10922, (sigma: 0.33048)\nNumber of observations: 3000 \nNumber of parameters estimated: 15 \nAIC: 2078.4, (AIC for lm: 3287.4)\nLM test for residual autocorrelation\ntest value: 16.821, p-value: 0.000041075"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#global-sar-impacts",
    "href": "spatmetrics/LucasCounty/index.html#global-sar-impacts",
    "title": "Spatial Hedonic Model",
    "section": "Global SAR impacts",
    "text": "Global SAR impacts\n\n\nCode\n#\nsummary(impacts(SAR, listw = red_house_sf_w, R = 500), zstats = TRUE)\n\n\nImpact measures (lag, exact):\n                     Direct    Indirect       Total\nI(age_sold)      1.26420440  1.28149989  2.54570429\nI(age_sold^2)   -2.25361156 -2.28444307 -4.53805462\nI(age_sold^3)    0.51743158  0.52451052  1.04194210\nI(log(TLA))      0.68781390  0.69722384  1.38503774\nI(log(lotsize))  0.06785580  0.06878413  0.13663994\nrooms            0.01052106  0.01066500  0.02118606\nbeds            -0.01109238 -0.01124413 -0.02233651\nsyear1994        0.05687482  0.05765292  0.11452773\nsyear1995        0.08912299  0.09034227  0.17946526\nsyear1996        0.12059686  0.12224674  0.24284360\nsyear1997        0.15382468  0.15592915  0.30975383\nsyear1998        0.24680025  0.25017671  0.49697696\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      1.26025 0.15977 0.0071450      0.0071450\nI(age_sold^2)   -2.24439 0.30058 0.0134423      0.0134423\nI(age_sold^3)    0.51261 0.16883 0.0075505      0.0075505\nI(log(TLA))      0.68739 0.03446 0.0015409      0.0015409\nI(log(lotsize))  0.06759 0.01040 0.0004651      0.0004651\nrooms            0.01021 0.01044 0.0004669      0.0004669\nbeds            -0.01100 0.01487 0.0006649      0.0006952\nsyear1994        0.05764 0.02449 0.0010951      0.0010951\nsyear1995        0.08795 0.02304 0.0010303      0.0009506\nsyear1996        0.12164 0.02300 0.0010284      0.0010284\nsyear1997        0.15275 0.02228 0.0009964      0.0009964\nsyear1998        0.24797 0.02337 0.0010451      0.0010451\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%       75%    97.5%\nI(age_sold)      0.95193  1.146580  1.26169  1.369476  1.56285\nI(age_sold^2)   -2.86083 -2.449798 -2.24210 -2.019410 -1.69138\nI(age_sold^3)    0.20056  0.386196  0.51102  0.626061  0.85781\nI(log(TLA))      0.61733  0.664741  0.68938  0.710671  0.75385\nI(log(lotsize))  0.04816  0.060242  0.06767  0.074200  0.08775\nrooms           -0.01036  0.003069  0.01005  0.016863  0.03122\nbeds            -0.03873 -0.021511 -0.01093 -0.001402  0.01758\nsyear1994        0.01349  0.040084  0.05661  0.073386  0.10991\nsyear1995        0.04036  0.072303  0.08829  0.103800  0.13469\nsyear1996        0.07525  0.105768  0.12192  0.136018  0.16755\nsyear1997        0.11034  0.137457  0.15303  0.169033  0.19775\nsyear1998        0.20171  0.231964  0.24718  0.263191  0.29284\n\n========================================================\nIndirect:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      1.28535 0.17304 0.0077384      0.0077384\nI(age_sold^2)   -2.28791 0.31545 0.0141071      0.0141071\nI(age_sold^3)    0.52215 0.17191 0.0076880      0.0076880\nI(log(TLA))      0.70101 0.04624 0.0020680      0.0020680\nI(log(lotsize))  0.06881 0.01027 0.0004592      0.0004592\nrooms            0.01040 0.01063 0.0004753      0.0004753\nbeds            -0.01122 0.01520 0.0006798      0.0007161\nsyear1994        0.05876 0.02501 0.0011183      0.0011183\nsyear1995        0.08967 0.02371 0.0010604      0.0009817\nsyear1996        0.12411 0.02436 0.0010896      0.0010896\nsyear1997        0.15576 0.02364 0.0010573      0.0010573\nsyear1998        0.25289 0.02626 0.0011743      0.0010732\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%       75%    97.5%\nI(age_sold)      0.98056  1.159990  1.28737  1.401580  1.60832\nI(age_sold^2)   -2.89437 -2.515919 -2.28766 -2.038621 -1.73314\nI(age_sold^3)    0.20727  0.396610  0.52308  0.640856  0.85633\nI(log(TLA))      0.61581  0.668739  0.69880  0.731618  0.78762\nI(log(lotsize))  0.04977  0.061999  0.06859  0.075324  0.08888\nrooms           -0.01058  0.003169  0.01018  0.017436  0.03188\nbeds            -0.03854 -0.021630 -0.01124 -0.001413  0.01811\nsyear1994        0.01366  0.041261  0.05775  0.075834  0.11084\nsyear1995        0.04134  0.074005  0.09025  0.104628  0.13693\nsyear1996        0.07679  0.109271  0.12332  0.139899  0.17421\nsyear1997        0.10973  0.138764  0.15444  0.172310  0.20128\nsyear1998        0.20578  0.234911  0.25280  0.269421  0.30551\n\n========================================================\nTotal:\n\nIterations = 1:500\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 500 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      2.54560 0.32720 0.0146329      0.0146329\nI(age_sold^2)   -4.53229 0.60627 0.0271132      0.0271132\nI(age_sold^3)    1.03476 0.33978 0.0151952      0.0151952\nI(log(TLA))      1.38840 0.07422 0.0033194      0.0033194\nI(log(lotsize))  0.13640 0.02041 0.0009125      0.0009125\nrooms            0.02060 0.02106 0.0009416      0.0009416\nbeds            -0.02221 0.03005 0.0013441      0.0014106\nsyear1994        0.11641 0.04940 0.0022092      0.0022092\nsyear1995        0.17762 0.04654 0.0020815      0.0019233\nsyear1996        0.24575 0.04698 0.0021008      0.0021008\nsyear1997        0.30851 0.04530 0.0020259      0.0020259\nsyear1998        0.50085 0.04819 0.0021550      0.0020016\n\n2. Quantiles for each variable:\n\n                    2.5%       25%      50%       75%    97.5%\nI(age_sold)      1.93314  2.302860  2.54386  2.773892  3.18479\nI(age_sold^2)   -5.73807 -4.955812 -4.53804 -4.069087 -3.46982\nI(age_sold^3)    0.40600  0.779277  1.03778  1.266064  1.70556\nI(log(TLA))      1.24824  1.340392  1.38644  1.441256  1.53225\nI(log(lotsize))  0.09875  0.122579  0.13666  0.149246  0.17677\nrooms           -0.02104  0.006228  0.02030  0.034402  0.06266\nbeds            -0.07717 -0.042681 -0.02233 -0.002814  0.03584\nsyear1994        0.02714  0.081830  0.11438  0.149401  0.21800\nsyear1995        0.08231  0.146453  0.17925  0.208317  0.26745\nsyear1996        0.15390  0.216484  0.24499  0.275720  0.34104\nsyear1997        0.21935  0.276633  0.30762  0.341804  0.39632\nsyear1998        0.41329  0.465082  0.50072  0.531943  0.59766\n\n========================================================\nSimulated standard errors\n                    Direct   Indirect      Total\nI(age_sold)     0.15976723 0.17303609 0.32720114\nI(age_sold^2)   0.30057961 0.31544513 0.60626867\nI(age_sold^3)   0.16883390 0.17190919 0.33977541\nI(log(TLA))     0.03445540 0.04624199 0.07422347\nI(log(lotsize)) 0.01039887 0.01026724 0.02040508\nrooms           0.01044088 0.01062763 0.02105534\nbeds            0.01486771 0.01520147 0.03005495\nsyear1994       0.02448819 0.02500572 0.04939863\nsyear1995       0.02303752 0.02371105 0.04654484\nsyear1996       0.02299602 0.02436439 0.04697513\nsyear1997       0.02228025 0.02364143 0.04530111\nsyear1998       0.02336821 0.02625869 0.04818774\n\nSimulated z-values:\n                    Direct   Indirect      Total\nI(age_sold)      7.8880583  7.4281924  7.7799196\nI(age_sold^2)   -7.4668589 -7.2529490 -7.4757169\nI(age_sold^3)    3.0361977  3.0373582  3.0454320\nI(log(TLA))     19.9501148 15.1596347 18.7056837\nI(log(lotsize))  6.4997999  6.7022049  6.6847881\nrooms            0.9774854  0.9782034  0.9784588\nbeds            -0.7396518 -0.7379508 -0.7391418\nsyear1994        2.3539528  2.3500092  2.3564971\nsyear1995        3.8178655  3.7815947  3.8160992\nsyear1996        5.2896726  5.0940188  5.2315784\nsyear1997        6.8558430  6.5884934  6.8102374\nsyear1998       10.6112557  9.6306610 10.3938194\n\nSimulated p-values:\n                Direct     Indirect   Total     \nI(age_sold)     3.1086e-15 1.1013e-13 7.3275e-15\nI(age_sold^2)   8.2157e-14 4.0790e-13 7.6827e-14\nI(age_sold^3)   0.00239582 0.00238662 0.00232346\nI(log(TLA))     < 2.22e-16 < 2.22e-16 < 2.22e-16\nI(log(lotsize)) 8.0427e-11 2.0530e-11 2.3126e-11\nrooms           0.32832888 0.32797373 0.32784747\nbeds            0.45951133 0.46054434 0.45982088\nsyear1994       0.01857497 0.01877295 0.01844821\nsyear1995       0.00013461 0.00015583 0.00013558\nsyear1996       1.2254e-07 3.5055e-07 1.6807e-07\nsyear1997       7.0892e-12 4.4431e-11 9.7438e-12\nsyear1998       < 2.22e-16 < 2.22e-16 < 2.22e-16"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#choosing-a-global-model",
    "href": "spatmetrics/LucasCounty/index.html#choosing-a-global-model",
    "title": "Spatial Hedonic Model",
    "section": "Choosing a global model",
    "text": "Choosing a global model\n\nSome of the models are estimated above so no reason to repeat a costly calculation."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdm-versus-sar",
    "href": "spatmetrics/LucasCounty/index.html#sdm-versus-sar",
    "title": "Spatial Hedonic Model",
    "section": "SDM versus SAR",
    "text": "SDM versus SAR\n\n\nCode\nLR.Sarlm(SDM, SAR)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 160.38, df = 12, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of SAR \n            -943.9908            -1024.1791 \n\n\nWe reject H0 and do not restrict to SAR. Keep SDM."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdm-versus-slx",
    "href": "spatmetrics/LucasCounty/index.html#sdm-versus-slx",
    "title": "Spatial Hedonic Model",
    "section": "SDM versus SLX",
    "text": "SDM versus SLX\n\n\nCode\n# SLX estimated above\nLR.Sarlm(SDM, SLX)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 803.99, df = 1, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of SLX \n            -943.9908            -1345.9840 \n\n\nWe reject H0 and do not restrict to SLX. Keep SDM."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdm-versus-sem",
    "href": "spatmetrics/LucasCounty/index.html#sdm-versus-sem",
    "title": "Spatial Hedonic Model",
    "section": "SDM versus SEM",
    "text": "SDM versus SEM\n\n\nCode\n# Common factor?\nLR.Sarlm(SDM, SEM)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 303.33, df = 12, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of SEM \n            -943.9908            -1095.6575 \n\n\nWe reject H0 and do not restrict to SEM. Keep SDM."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#sdm-versus-lm1",
    "href": "spatmetrics/LucasCounty/index.html#sdm-versus-lm1",
    "title": "Spatial Hedonic Model",
    "section": "SDM versus lm1",
    "text": "SDM versus lm1\n\n\nCode\nLR.Sarlm(SDM, lm1)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 1371.4, df = 13, p-value < 2.2e-16\nsample estimates:\nLog likelihood of SDM Log likelihood of lm1 \n            -943.9908            -1629.6987 \n\n\nWe reject H0 and do not restrict to OLS. SDM seems to be the best global model. We have spatial effects both in price and the explanatory variables. There is a strong negative indirect effect regarding number of rooms that might be regarded as counter intuitive and should perhaps be looked further into."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#impacts-sdm",
    "href": "spatmetrics/LucasCounty/index.html#impacts-sdm",
    "title": "Spatial Hedonic Model",
    "section": "Impacts SDM",
    "text": "Impacts SDM\n\n\nCode\nsummary(impacts(SDM, listw = red_house_sf_w, R = 1000), zstats = TRUE)\n\n\nImpact measures (mixed, exact):\n                     Direct     Indirect        Total\nI(age_sold)      0.44458343  1.998987232  2.443570658\nI(age_sold^2)   -1.00533917 -3.230813468 -4.236152639\nI(age_sold^3)    0.03747523  0.571379837  0.608855065\nI(log(TLA))      0.73179133  0.538408810  1.270200141\nI(log(lotsize))  0.11643717 -0.031417681  0.085019488\nrooms            0.01892389 -0.009570688  0.009353204\nbeds            -0.02425261 -0.074563783 -0.098816393\nsyear1994        0.05338215  0.010866667  0.064248814\nsyear1995        0.08036644 -0.127280373 -0.046913936\nsyear1996        0.11360203  0.019036422  0.132638448\nsyear1997        0.14408151 -0.083271804  0.060809708\nsyear1998        0.24456200  0.065133136  0.309695135\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean      SD  Naive SE Time-series SE\nI(age_sold)      0.44163 0.19377 0.0061276      0.0061276\nI(age_sold^2)   -0.99382 0.35057 0.0110860      0.0102378\nI(age_sold^3)    0.02969 0.18626 0.0058901      0.0051524\nI(log(TLA))      0.73078 0.03257 0.0010299      0.0010863\nI(log(lotsize))  0.11679 0.01215 0.0003843      0.0003843\nrooms            0.01923 0.01035 0.0003274      0.0003274\nbeds            -0.02409 0.01587 0.0005018      0.0004713\nsyear1994        0.05342 0.02498 0.0007900      0.0007900\nsyear1995        0.08006 0.02421 0.0007657      0.0007657\nsyear1996        0.11402 0.02340 0.0007401      0.0007401\nsyear1997        0.14407 0.02386 0.0007545      0.0007545\nsyear1998        0.24365 0.02383 0.0007537      0.0007181\n\n2. Quantiles for each variable:\n\n                     2.5%      25%      50%      75%     97.5%\nI(age_sold)      0.074639  0.31072  0.44131  0.57788  0.823934\nI(age_sold^2)   -1.654443 -1.23954 -0.98375 -0.74901 -0.312213\nI(age_sold^3)   -0.331864 -0.09906  0.02408  0.16328  0.384121\nI(log(TLA))      0.662652  0.70997  0.73028  0.75257  0.794955\nI(log(lotsize))  0.093972  0.10851  0.11640  0.12506  0.141285\nrooms           -0.000960  0.01248  0.01921  0.02617  0.039231\nbeds            -0.056780 -0.03526 -0.02444 -0.01286  0.007228\nsyear1994        0.005384  0.03728  0.05332  0.06965  0.103500\nsyear1995        0.032870  0.06292  0.07937  0.09665  0.126562\nsyear1996        0.071023  0.09945  0.11395  0.12923  0.159480\nsyear1997        0.096356  0.12847  0.14491  0.16070  0.188601\nsyear1998        0.197509  0.22849  0.24247  0.25867  0.291718\n\n========================================================\nIndirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD  Naive SE Time-series SE\nI(age_sold)      1.994437 0.48431 0.0153152      0.0144140\nI(age_sold^2)   -3.229999 0.95731 0.0302729      0.0283359\nI(age_sold^3)    0.575901 0.55609 0.0175853      0.0151665\nI(log(TLA))      0.539949 0.12916 0.0040846      0.0040846\nI(log(lotsize)) -0.031352 0.02798 0.0008847      0.0008847\nrooms           -0.009271 0.04387 0.0013873      0.0013228\nbeds            -0.075175 0.07048 0.0022288      0.0022288\nsyear1994        0.007199 0.11337 0.0035849      0.0035849\nsyear1995       -0.126615 0.11073 0.0035017      0.0029545\nsyear1996        0.015906 0.10680 0.0033774      0.0033774\nsyear1997       -0.086813 0.10132 0.0032040      0.0032040\nsyear1998        0.063025 0.10730 0.0033932      0.0033932\n\n2. Quantiles for each variable:\n\n                    2.5%      25%       50%      75%    97.5%\nI(age_sold)      1.01684  1.66122  1.978365  2.32081  2.94284\nI(age_sold^2)   -5.11638 -3.84502 -3.221522 -2.61815 -1.35199\nI(age_sold^3)   -0.54360  0.21805  0.569439  0.93971  1.65820\nI(log(TLA))      0.27728  0.45640  0.542007  0.62837  0.78507\nI(log(lotsize)) -0.08540 -0.05012 -0.031308 -0.01405  0.02491\nrooms           -0.09071 -0.03874 -0.010332  0.02283  0.07262\nbeds            -0.21370 -0.12136 -0.075312 -0.02773  0.05845\nsyear1994       -0.20521 -0.06970  0.006784  0.08441  0.22773\nsyear1995       -0.34029 -0.19814 -0.127557 -0.05271  0.09324\nsyear1996       -0.19977 -0.05091  0.013166  0.09140  0.21724\nsyear1997       -0.29699 -0.15556 -0.083571 -0.01477  0.09978\nsyear1998       -0.14518 -0.01269  0.062252  0.13750  0.26969\n\n========================================================\nTotal:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                     Mean      SD  Naive SE Time-series SE\nI(age_sold)      2.436063 0.51093 0.0161569      0.0151156\nI(age_sold^2)   -4.223821 1.03839 0.0328367      0.0306742\nI(age_sold^3)    0.605587 0.61494 0.0194460      0.0147596\nI(log(TLA))      1.270729 0.14184 0.0044854      0.0044854\nI(log(lotsize))  0.085441 0.02879 0.0009106      0.0009106\nrooms            0.009956 0.04928 0.0015584      0.0014839\nbeds            -0.099269 0.07971 0.0025206      0.0025206\nsyear1994        0.060621 0.12829 0.0040570      0.0040570\nsyear1995       -0.046555 0.12591 0.0039817      0.0033623\nsyear1996        0.129926 0.12085 0.0038217      0.0038217\nsyear1997        0.057257 0.11588 0.0036643      0.0036643\nsyear1998        0.306675 0.12106 0.0038283      0.0038283\n\n2. Quantiles for each variable:\n\n                    2.5%      25%      50%      75%   97.5%\nI(age_sold)      1.43744  2.10139  2.43041  2.75368  3.4702\nI(age_sold^2)   -6.31630 -4.89596 -4.20326 -3.56986 -2.2270\nI(age_sold^3)   -0.63654  0.20606  0.60551  1.00928  1.8235\nI(log(TLA))      0.98215  1.17960  1.27291  1.37072  1.5434\nI(log(lotsize))  0.02875  0.06531  0.08558  0.10425  0.1428\nrooms           -0.08065 -0.02585  0.01045  0.04540  0.1035\nbeds            -0.25372 -0.15241 -0.10144 -0.04542  0.0566\nsyear1994       -0.18865 -0.02399  0.06155  0.14613  0.3073\nsyear1995       -0.29434 -0.12999 -0.04696  0.03934  0.1981\nsyear1996       -0.12225  0.05450  0.12698  0.21204  0.3625\nsyear1997       -0.18161 -0.01896  0.05603  0.14139  0.2682\nsyear1998        0.07651  0.22255  0.30815  0.38914  0.5382\n\n========================================================\nSimulated standard errors\n                    Direct   Indirect      Total\nI(age_sold)     0.19377043 0.48430840 0.51092743\nI(age_sold^2)   0.35056995 0.95731289 1.03838680\nI(age_sold^3)   0.18626069 0.55609460 0.61493681\nI(log(TLA))     0.03256839 0.12916484 0.14184154\nI(log(lotsize)) 0.01215369 0.02797698 0.02879443\nrooms           0.01035366 0.04387138 0.04927992\nbeds            0.01586979 0.07047965 0.07970720\nsyear1994       0.02498084 0.11336570 0.12829442\nsyear1995       0.02421323 0.11073355 0.12591184\nsyear1996       0.02340386 0.10680158 0.12085180\nsyear1997       0.02385899 0.10131951 0.11587633\nsyear1998       0.02383429 0.10730107 0.12106130\n\nSimulated z-values:\n                    Direct    Indirect      Total\nI(age_sold)      2.2791192  4.11811449  4.7679244\nI(age_sold^2)   -2.8348746 -3.37402650 -4.0676758\nI(age_sold^3)    0.1593776  1.03561785  0.9847959\nI(log(TLA))     22.4383057  4.18031245  8.9587916\nI(log(lotsize))  9.6096536 -1.12062046  2.9672808\nrooms            1.8570362 -0.21132079  0.2020332\nbeds            -1.5182149 -1.06662051 -1.2454182\nsyear1994        2.1385335  0.06349941  0.4725149\nsyear1995        3.3064592 -1.14341815 -0.3697403\nsyear1996        4.8718380  0.14893491  1.0750879\nsyear1997        6.0383741 -0.85682032  0.4941207\nsyear1998       10.2226717  0.58736331  2.5332198\n\nSimulated p-values:\n                Direct          Indirect    Total       \nI(age_sold)     0.02265998      0.000038198 0.0000018613\nI(age_sold^2)   0.00458437      0.00074077  0.0000474844\nI(age_sold^3)   0.87337138      0.30038046  0.3247243   \nI(log(TLA))     < 2.22e-16      0.000029111 < 2.22e-16  \nI(log(lotsize)) < 2.22e-16      0.26244945  0.0030045   \nrooms           0.06330600      0.83263696  0.8398908   \nbeds            0.12896023      0.28614323  0.2129781   \nsyear1994       0.03247347      0.94936883  0.6365593   \nsyear1995       0.00094483      0.25286502  0.7115760   \nsyear1996       0.0000011056480 0.88160500  0.2823354   \nsyear1997       0.0000000015567 0.39154419  0.6212209   \nsyear1998       < 2.22e-16      0.55695973  0.0113020"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#spatial-autocorrelation-left-in-sdm",
    "href": "spatmetrics/LucasCounty/index.html#spatial-autocorrelation-left-in-sdm",
    "title": "Spatial Hedonic Model",
    "section": "Spatial autocorrelation left in SDM",
    "text": "Spatial autocorrelation left in SDM\n\n\nCode\n# residuals are with attributes, hence as.vector()\nmoran.plot(as.vector(SDM$residuals), listw = red_house_sf_w)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#some-tests",
    "href": "spatmetrics/LucasCounty/index.html#some-tests",
    "title": "Spatial Hedonic Model",
    "section": "Some tests",
    "text": "Some tests"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#are-our-residuals-normal",
    "href": "spatmetrics/LucasCounty/index.html#are-our-residuals-normal",
    "title": "Spatial Hedonic Model",
    "section": "Are our residuals normal?",
    "text": "Are our residuals normal?\nSDEM\n\n\nCode\nlibrary(DescTools)\n# H0: residuals normal\nJarqueBeraTest(residuals(SDEM), robust = TRUE)\n\n\n\n    Robust Jarque Bera Test\n\ndata:  residuals(SDEM)\nX-squared = 10280, df = 2, p-value < 2.2e-16\n\n\nCode\n# Conclusion: not normal\n\n\nFar from normal.\nSDM\n\n\nCode\n# H0: residuals normal\nJarqueBeraTest(residuals(SDM), robust = TRUE)\n\n\n\n    Robust Jarque Bera Test\n\ndata:  residuals(SDM)\nX-squared = 10921, df = 2, p-value < 2.2e-16\n\n\nCode\n# Conclusion: not normal\n\n\nFar from normal."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#heteroskedasticity",
    "href": "spatmetrics/LucasCounty/index.html#heteroskedasticity",
    "title": "Spatial Hedonic Model",
    "section": "Heteroskedasticity?",
    "text": "Heteroskedasticity?\n\n\nCode\n# test for Heteroskedasticity\nbptest.Sarlm(SDEM, studentize = TRUE)\n\n\n\n    studentized Breusch-Pagan test\n\ndata:  \nBP = 531.81, df = 24, p-value < 2.2e-16\n\n\n\n\nCode\n# test for Heteroskedasticity\nbptest.Sarlm(SDM, studentize = TRUE)\n\n\n\n    studentized Breusch-Pagan test\n\ndata:  \nBP = 550.1, df = 24, p-value < 2.2e-16"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#maps",
    "href": "spatmetrics/LucasCounty/index.html#maps",
    "title": "Spatial Hedonic Model",
    "section": "MAPS",
    "text": "MAPS\n\n\n\n\n\nCode\n#siste\n\n\n\n\nMSB205\n\n\n\n“0.1 The Reproducible R Toolkit (RRT).” n.d. https://cran.r-project.org/web/packages/checkpoint/vignettes/checkpoint.html.\n\n\n“16 Product Fails That Defined The Decade.” n.d. BuzzFeed News. https://www.buzzfeednews.com/article/nicolenguyen/notable-tech-fails-of-2010s.\n\n\nBechhofer, Sean, Iain Buchan, David De Roure, Paolo Missier, John Ainsworth, Jiten Bhagat, Philip Couch, et al. 2013. “Why Linked Data Is Not Enough for Scientists.” Future Generation Computer Systems 29 (2): 599611. https://doi.org/10.1016/j.future.2011.08.004.\n\n\nBivand, Roger. 2022a. “R Packages for Analyzing Spatial Data: A Comparative Case Study with Areal Data.” Geographical Analysis 54 (3): 488–518. https://doi.org/10.1111/gean.12319.\n\n\n———. 2022b. Spdep: Spatial Dependence: Weighting Schemes, Statistics. https://CRAN.R-project.org/package=spdep.\n\n\nBivand, Roger S., Edzer Pebesma, and Virgilio Gomez-Rubio. 2013a. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013b. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013c. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\nBivand, Roger, Jan Hauke, and Tomasz Kossowski. 2013. “Computing the Jacobian in Gaussian Spatial Autoregressive Models: An Illustrated Comparison of Available Methods.” Geographical Analysis 45 (2): 150–79. https://doi.org/10.1111/gean.12008.\n\n\nBivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. “A Review of Software for Spatial Econometrics in R.” Mathematics 9 (11). https://doi.org/10.3390/math9111276.\n\n\nBivand, Roger, Jakub Nowosad, and Robin Lovelace. 2021. spData: Datasets for Spatial Analysis. https://nowosad.github.io/spData/.\n\n\nBivand, Roger, and Gianfranco Piras. 2015. “Comparing Implementations of Estimation Methods for Spatial Econometrics.” Journal of Statistical Software 63 (18): 1–36. https://doi.org/10.18637/jss.v063.i18.\n\n\n———. 2022. Spatialreg: Spatial Regression Analysis. https://CRAN.R-project.org/package=spatialreg.\n\n\nBivand, Roger, and David W. S. Wong. 2018. “Comparing Implementations of Global and Local Indicators of Spatial Association.” TEST 27 (3): 716–48. https://doi.org/10.1007/s11749-018-0599-x.\n\n\nChan, TszKin Julian. 2022. Jmisc: Julian Miscellaneous Function. https://CRAN.R-project.org/package=Jmisc.\n\n\nGrossenbacher, Timo. n.d. “A (Truly) Reproducible R Workflow.” https://timogrossenbacher.ch/2017/07/a-truly-reproducible-r-workflow/.\n\n\nHugh-Jones, David. 2022. Huxtable: Easily Create and Style Tables for LaTeX, HTML and Other Formats. https://hughjonesd.github.io/huxtable/.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\nPebesma, Edzer J., and Roger S. Bivand. 2005. “Classes and Methods for Spatial Data in R.” R News 5 (2): 9–13. https://CRAN.R-project.org/doc/Rnews/.\n\n\nPebesma, Edzer, and Roger Bivand. 2022. Sp: Classes and Methods for Spatial Data. https://CRAN.R-project.org/package=sp.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\n———. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2022. Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics. https://CRAN.R-project.org/package=ggplot2.\n\n\nXie, Yihui. 2014. “Knitr: A Comprehensive Tool for Reproducible Research in R.” In Implementing Reproducible Computational Research, edited by Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman; Hall/CRC. http://www.crcpress.com/product/isbn/9781466561595.\n\n\n———. 2015. Dynamic Documents with R and Knitr. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. https://yihui.org/knitr/.\n\n\n———. 2022. Knitr: A General-Purpose Package for Dynamic Report Generation in r. https://yihui.org/knitr/.\n\n\nXie, Yihui, Christophe Dervieux, and Emily Riederer. 2020. R Markdown Cookbook. Chapman; Hall/CRC. https://doi.org/10.1201/9781003097471."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#read-in-data-via-map.",
    "href": "spatmetrics/spatreg/index.html#read-in-data-via-map.",
    "title": "Spatial regressions area data",
    "section": "Read in data via map.",
    "text": "Read in data via map.\n\nThis is the municipalities map with data from SSB generated under Getting Data.\n\n\n\n\nCode\n# run data/get_ssb_data.Rmd if data needs to be updated\nmap_data_2017 <- st_read(dsn = \"../data/map_data_2017.gpkg\")\n\n\nReading layer `map_data_2017' from data source \n  `/Users/ag/Dev/QQ_MSB205/spatmetrics/data/map_data_2017.gpkg' \n  using driver `GPKG'\nSimple feature collection with 426 features and 115 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744\nProjected CRS: ETRS89 / UTM zone 33N + NN2000 height\n\n\n\nFilter out municipalities with no recorded pm2.\n\n\n\n\n\nCode\nmap_data_2017_noNA <- map_data_2017 %>% \n  filter(!is.na(log_pm2))\n# Drop obs. 14, 1416 Høyanger because of no neighbours. Makes life simpler\nmap_data_2017_noNA <- map_data_2017_noNA[-14,]"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#make-new-variables",
    "href": "spatmetrics/spatreg/index.html#make-new-variables",
    "title": "Spatial regressions area data",
    "section": "Make new variables",
    "text": "Make new variables\n\nMake new variables and strip down dataset to variables we will use\n\n\n\n\nCode\nmd_2017 <- map_data_2017_noNA %>% \n  mutate(\n    # percentage of pop. in a working age\n    prct_20_64 = 100*pop_20_64/tot_pop,\n    # log percentage of pop. of a working age\n    log_prct_20_64 = log(100*pop_20_64/tot_pop),\n    # log percentage of pop. with an univeristy education\n    log_prct_uni_edu = log(edu_uni_short + edu_uni_long),\n    # log percentage of households with an income above NOK 750.000\n    log_inc_750k_p = log(inc_750k_p),\n    # percentage of household wealth above 3.000.000\n    net_cap_3000k_p = net_cap_3000k_4000k + net_cap_4000k_p,\n    # log percentage of household wealth above 3.000.000\n    log_net_cap_3000k_p = log(net_cap_3000k_4000k + net_cap_4000k_p),\n    # gov emp relative to pop_20_64\n    gov_emp_rel = 100*gov_emp/pop_20_64,\n    # log (number of gov. emp. + 1)\n    log_gov_emp = log(100*(gov_emp+1)/pop_20_64),\n    # scale spc, to trane in NOK 1000\n    spc_k = spc/1000,\n    # log trade revenue per capita\n    log_spc = log(spc),\n    # log of centrality index (max index value 1000)\n    log_sen_ind = log(sen_ind),\n    # percentage in two top deciles of before tax income\n    inc_bt_9and10 = inc_bt_09 + inc_bt_10\n  ) %>% \n  select(knr, kNavn, log_pm2, prct_20_64, gov_emp, gov_emp_rel, spc, spc_k, inc_750k_p, sen_ind, net_cap_3000k_p, inc_bt_9and10, log_prct_20_64, log_prct_uni_edu, \n         log_inc_750k_p, log_net_cap_3000k_p, log_gov_emp, log_spc,log_sen_ind, sfd_ba_completed, sfd_w2u_ba_completed) %>% \n  arrange(knr)\n# write out reduced dataset\nst_write(obj = md_2017, dsn = \"../data/md_2017.gpkg\", driver = \"GPKG\", append=FALSE)\n\n\nDeleting layer `md_2017' using driver `GPKG'\nWriting layer `md_2017' to data source `../data/md_2017.gpkg' using driver `GPKG'\nWriting 330 features with 21 fields and geometry type Multi Polygon."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#remove-høyanger-no-neighbours.",
    "href": "spatmetrics/spatreg/index.html#remove-høyanger-no-neighbours.",
    "title": "Spatial regressions area data",
    "section": "Remove Høyanger, no neighbours.",
    "text": "Remove Høyanger, no neighbours.\n\nWe have to remove the municipality “Høyanger” since it has no neighbour with data (only NAs).\n\n\n\n\nCode\nmd_2017 <- md_2017 %>% \n  filter(!kNavn == \"Høyanger\")\n\n\n\nMaking the weights matrix.\n\n\n\n\n\nCode\n# remove line 200 Høyanger, no neighbours\nmd_2017_nb <- poly2nb(md_2017)\nmd_2017_nb\n\n\nNeighbour list object:\nNumber of regions: 329 \nNumber of nonzero links: 1556 \nPercentage nonzero weights: 1.437533 \nAverage number of links: 4.729483 \n\n\nCode\nmd_2017_w <- nb2listw(md_2017_nb, style = \"W\")\nprint(md_2017_w)\n\n\nCharacteristics of weights list object:\nNeighbour list object:\nNumber of regions: 329 \nNumber of nonzero links: 1556 \nPercentage nonzero weights: 1.437533 \nAverage number of links: 4.729483 \n\nWeights style: W \nWeights constants summary:\n    n     nn  S0       S1       S2\nW 329 108241 329 156.7205 1357.883"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#global-morans-i-plot-for-log_pm2",
    "href": "spatmetrics/spatreg/index.html#global-morans-i-plot-for-log_pm2",
    "title": "Spatial regressions area data",
    "section": "Global Morans I plot for log_pm2",
    "text": "Global Morans I plot for log_pm2\n\n\nCode\nmoran.plot(md_2017$log_pm2, listw = md_2017_w)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#moran-test-on-dependant-variable",
    "href": "spatmetrics/spatreg/index.html#moran-test-on-dependant-variable",
    "title": "Spatial regressions area data",
    "section": "Moran test on dependant variable",
    "text": "Moran test on dependant variable\n\n\nCode\nmoran.test(md_2017$log_pm2, listw = md_2017_w)\n\n\n\n    Moran I test under randomisation\n\ndata:  md_2017$log_pm2  \nweights: md_2017_w    \n\nMoran I statistic standard deviate = 14.014, p-value < 2.2e-16\nalternative hypothesis: greater\nsample estimates:\nMoran I statistic       Expectation          Variance \n      0.526358833      -0.003048780       0.001427167 \n\n\n\nHardly any doubt that we have spatial autocorrelation in log_pm2 (not a big surprise)."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#eda",
    "href": "spatmetrics/spatreg/index.html#eda",
    "title": "Spatial regressions area data",
    "section": "EDA",
    "text": "EDA\nOpen a new project in Geoda and read in the reduced dataset md_2017 and do EDA."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#the-model",
    "href": "spatmetrics/spatreg/index.html#the-model",
    "title": "Spatial regressions area data",
    "section": "The model",
    "text": "The model\n\n\nCode\nmod1 <- \"log_pm2 ~ log_prct_20_64 + log_prct_uni_edu + log_inc_750k_p\n + log_net_cap_3000k_p + log_gov_emp + log_spc + log_sen_ind\"\n# mod2 <- \"log_pm2 ~ log_prct_20_64 +  log_net_cap_3000k_p + log_sen_ind\"\nmod2 <- \"log_pm2 ~ prct_20_64 + inc_bt_9and10 + spc_k +  sen_ind\""
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#the-variables-we-use",
    "href": "spatmetrics/spatreg/index.html#the-variables-we-use",
    "title": "Spatial regressions area data",
    "section": "The variables we use",
    "text": "The variables we use\nWe have 329 observations. We lack pm2 for 96 municipalities. One, Høyanger, no NA, but no neighbours which have registered data (only NAs).\n\nlog_pm2\n\nWe use the natural logarithms of price per square meter as our dependent variable.\n\nprct_20_64\n\nPercentage of population of a “working age”.\n\ninc_bt_9and10\n\nThis variable is a little bit more involved. Imagine income for all income earners of the country ordered in a long list, from lowest to highest income. This list is then divided into 10 parts with an equal number of individuals in each part. Then we will have 9 income levels \\(I_{i,i+1}, i = 1\\ldots 9\\) representing the border between to groups (deciles). If an individual has an income above \\(I_{8,9}\\), this individual will be in the top 20% earners in the country. Our variable inc_bt_9and10 contains the percentage of income earners in each municipality that has an income above \\(I_{8,9}\\).\n\nspc_k\n\nWholesale and retail trade sales per capita in each municipality in NOK 1000.\n\nsen_ind\n\nThe value of the SSB centrality index for 2018. The index value for Oslo (the most central place) is 1000."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#simple-linear-model",
    "href": "spatmetrics/spatreg/index.html#simple-linear-model",
    "title": "Spatial regressions area data",
    "section": "Simple linear model",
    "text": "Simple linear model\n\n\nCode\nmd_2017 %>% \n  select(log_pm2, prct_20_64, inc_bt_9and10, spc_k, sen_ind) %>% \n  summary()\n\n\n    log_pm2         prct_20_64    inc_bt_9and10       spc_k       \n Min.   : 8.579   Min.   :51.51   Min.   : 8.10   Min.   : 10.24  \n 1st Qu.: 9.491   1st Qu.:55.23   1st Qu.:14.90   1st Qu.: 43.97  \n Median : 9.725   Median :56.70   Median :17.60   Median : 65.24  \n Mean   : 9.738   Mean   :56.75   Mean   :18.15   Mean   : 67.86  \n 3rd Qu.: 9.970   3rd Qu.:58.04   3rd Qu.:20.60   3rd Qu.: 88.05  \n Max.   :10.960   Max.   :66.14   Max.   :35.50   Max.   :228.10  \n    sen_ind                  geom    \n Min.   : 368.0   MULTIPOLYGON :329  \n 1st Qu.: 616.0   epsg:5973    :  0  \n Median : 686.0   +proj=utm ...:  0  \n Mean   : 700.3                      \n 3rd Qu.: 793.0                      \n Max.   :1000.0"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem",
    "href": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem",
    "title": "Spatial regressions area data",
    "section": "Is multicollinearity a problem?",
    "text": "Is multicollinearity a problem?\n\n\nCode\n# drop gov_emp_1k\nlm2 <- lm(mod2, data = md_2017)\nsummary(lm2)\n\n\n\nCall:\nlm(formula = mod2, data = md_2017)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.46579 -0.09363  0.00813  0.09060  0.55811 \n\nCoefficients:\n               Estimate Std. Error t value    Pr(>|t|)    \n(Intercept)   6.1907249  0.2926722  21.152     < 2e-16 ***\nprct_20_64    0.0315756  0.0059235   5.331 0.000000184 ***\ninc_bt_9and10 0.0327213  0.0022935  14.267     < 2e-16 ***\nspc_k         0.0009024  0.0003210   2.812     0.00523 ** \nsen_ind       0.0015705  0.0001080  14.546     < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1706 on 324 degrees of freedom\nMultiple R-squared:  0.7941,    Adjusted R-squared:  0.7916 \nF-statistic: 312.4 on 4 and 324 DF,  p-value: < 2.2e-16"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem-1",
    "href": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem-1",
    "title": "Spatial regressions area data",
    "section": "Is multicollinearity a problem?",
    "text": "Is multicollinearity a problem?\n\n\nCode\nmctest(lm2)\n\n\n\nCall:\nomcdiag(mod = mod, Inter = TRUE, detr = detr, red = red, conf = conf, \n    theil = theil, cn = cn)\n\n\nOverall Multicollinearity Diagnostics\n\n                       MC Results detection\nDeterminant |X'X|:         0.4439         0\nFarrar Chi-Square:       264.6359         1\nRed Indicator:             0.3663         0\nSum of Lambda Inverse:     5.9601         0\nTheil's Method:           -1.2117         0\nCondition Number:        103.8824         1\n\n1 --> COLLINEARITY is detected by the test \n0 --> COLLINEARITY is not detected by the test"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem-cont.",
    "href": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem-cont.",
    "title": "Spatial regressions area data",
    "section": "Is multicollinearity a problem? cont.",
    "text": "Is multicollinearity a problem? cont.\n\n\nCode\nimcdiag(lm2, all = TRUE)\n\n\n\nCall:\nimcdiag(mod = lm2, all = TRUE)\n\n\nAll Individual Multicollinearity Diagnostics in 0 or 1 \n\n              VIF TOL Wi Fi Leamer CVIF Klein IND1 IND2\nprct_20_64      0   0  1  1      0    0     0    1    0\ninc_bt_9and10   0   0  1  1      0    0     0    0    0\nspc_k           0   0  1  1      0    0     0    0    0\nsen_ind         0   0  1  1      0    0     0    1    0\n\n1 --> COLLINEARITY is detected by the test \n0 --> COLLINEARITY is not detected by the test\n\n* all coefficients have significant t-ratios\n\nR-square of y on all x: 0.7941 \n\n* use method argument to check which regressors may be the reason of collinearity\n==================================="
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem-cont.-1",
    "href": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem-cont.-1",
    "title": "Spatial regressions area data",
    "section": "Is multicollinearity a problem? cont.",
    "text": "Is multicollinearity a problem? cont.\nThree out of nine tests indicate that multicollinearity might be a problem.\n\n\nCode\n# If we only want to do one test\nimcdiag(lm2, method = \"VIF\")\n\n\n\nCall:\nimcdiag(mod = lm2, method = \"VIF\")\n\n\n VIF Multicollinearity Diagnostics\n\n                 VIF detection\nprct_20_64    1.7674         0\ninc_bt_9and10 1.2125         0\nspc_k         1.1040         0\nsen_ind       1.8762         0\n\nNOTE:  VIF Method Failed to detect multicollinearity\n\n\n0 --> COLLINEARITY is not detected by the test\n\n==================================="
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem-cont.-2",
    "href": "spatmetrics/spatreg/index.html#is-multicollinearity-a-problem-cont.-2",
    "title": "Spatial regressions area data",
    "section": "Is multicollinearity a problem? cont.",
    "text": "Is multicollinearity a problem? cont.\n\n\nCode\n# If we only want to do one test\nimcdiag(lm2, method = \"IND1\")\n\n\n\nCall:\nimcdiag(mod = lm2, method = \"IND1\")\n\n\n IND1 Multicollinearity Diagnostics\n\n                IND1 detection\nprct_20_64    0.0052         1\ninc_bt_9and10 0.0076         0\nspc_k         0.0084         0\nsen_ind       0.0049         1\n\nMulticollinearity may be due to prct_20_64 sen_ind regressors\n\n1 --> COLLINEARITY is detected by the test \n0 --> COLLINEARITY is not detected by the test\n\n==================================="
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#correlation",
    "href": "spatmetrics/spatreg/index.html#correlation",
    "title": "Spatial regressions area data",
    "section": "Correlation",
    "text": "Correlation\n\nThe positive correlation between sen_ind and prct_20_64.\n\n\n\n\nCode\nplot(md_2017$sen_ind, md_2017$prct_20_64)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#correlation-cont.",
    "href": "spatmetrics/spatreg/index.html#correlation-cont.",
    "title": "Spatial regressions area data",
    "section": "Correlation cont.",
    "text": "Correlation cont.\n\n\nCode\ncor(md_2017$sen_ind, md_2017$prct_20_64)\n\n\n[1] 0.6390244\n\n\nWe have seen worse."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#moran-test-on-residuals",
    "href": "spatmetrics/spatreg/index.html#moran-test-on-residuals",
    "title": "Spatial regressions area data",
    "section": "Moran test on residuals",
    "text": "Moran test on residuals\n\n\nCode\nlm.morantest(lm2, listw = md_2017_w)\n\n\n\n    Global Moran I for regression residuals\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nMoran I statistic standard deviate = 7.2984, p-value = 1.456e-13\nalternative hypothesis: greater\nsample estimates:\nObserved Moran I      Expectation         Variance \n     0.267216998     -0.006847098      0.001410110"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#moran-plot-residuals",
    "href": "spatmetrics/spatreg/index.html#moran-plot-residuals",
    "title": "Spatial regressions area data",
    "section": "Moran plot residuals",
    "text": "Moran plot residuals\n\n\nCode\nmoran.plot(residuals(lm2), listw = md_2017_w)\n\n\n\n\nWe will use mod2 in the following. We have spatial autocorrelation in the residuals from OLS."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#the-anselin-approach-1",
    "href": "spatmetrics/spatreg/index.html#the-anselin-approach-1",
    "title": "Spatial regressions area data",
    "section": "The Anselin approach",
    "text": "The Anselin approach\n\n\n\n\nCode\n# From BurkeyAcademy\nlm.LMtests(lm2, listw = md_2017_w, test = \"all\")\n\n\n\n    Lagrange multiplier diagnostics for spatial dependence\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nLMerr = 49.317, df = 1, p-value = 2.178e-12\n\n\n    Lagrange multiplier diagnostics for spatial dependence\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nLMlag = 35.015, df = 1, p-value = 0.000000003273\n\n\n    Lagrange multiplier diagnostics for spatial dependence\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nRLMerr = 18.191, df = 1, p-value = 0.00001998\n\n\n    Lagrange multiplier diagnostics for spatial dependence\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nRLMlag = 3.8892, df = 1, p-value = 0.0486\n\n\n    Lagrange multiplier diagnostics for spatial dependence\n\ndata:  \nmodel: lm(formula = mod2, data = md_2017)\nweights: md_2017_w\n\nSARMA = 53.206, df = 2, p-value = 2.796e-12\n\n\n\n\nBoth LMerr and LMLag are significant.\nProceed with RLMlerr and RLMlag.\nAgain both are significant.\nSo we don´t have a clear conclusion. One might argue that since RLMlag are just marginally significant, SEM is probably the best choice.\n\n\n\nFor a more thorough discussion see Osland (2010) and Chi and Zhu (2019) page 55."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#local-or-global",
    "href": "spatmetrics/spatreg/index.html#local-or-global",
    "title": "Spatial regressions area data",
    "section": "Local or global?",
    "text": "Local or global?\n\nTo formally test this we have to use Bayesian modelling. Outside our scope.\nOne might argue that a local perspective is best suited for this dataset.\nA change in one of the explanatory variables for one municipality (haugesund) might effect pm2 in this municipality and potentially also change pm2 in neighbouring municipalities (Sveio, Karmøy, Bømlo, Tysvær), but there are scarce reasons to think that these changes will ripple through the whole country (and eventually change pm2 in Hammerfest).\n\nIf one can narrow down the relationship being investigated as reflecting a local spillover situation, then the SDEM model is the only model one needs to estimate. This specification subsumes the SLX and SEM specifications as special cases.(LeSage 2014)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#local-or-global-cont.",
    "href": "spatmetrics/spatreg/index.html#local-or-global-cont.",
    "title": "Spatial regressions area data",
    "section": "Local or global? cont.",
    "text": "Local or global? cont.\nNote that plain OLS is a special case of SDEM. (all spatial autocorrelation coefficients are zero (\\(\\rho = 0, \\theta = 0\\) and \\(\\lambda =0\\)))\nManski (“includes everything”):\n\\[ {\\bf y = \\rho W y + X \\beta +W X\\theta + u\\quad u = \\lambda Wu + \\epsilon}\\]"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#lesages-2014-5-principles",
    "href": "spatmetrics/spatreg/index.html#lesages-2014-5-principles",
    "title": "Spatial regressions area data",
    "section": "LeSages (2014) 5 principles",
    "text": "LeSages (2014) 5 principles\n\nLocal versus global spillover\n\n“A resource shared by numerous regions such as a highway (or river) can be one cause of global spillovers.”\n“Global spillover phenomena should be rarer than local spillovers in applied regional science modeling situations, hence the statement: ‘most spatial spillovers are local.’”\n“Global spillover specifications are more difficult to estimate and correct interpretation of estimates from these specifications is more difficult. Because of the interesting theoretical econometric aspects of these specifications, they represent those most studied in the spatial econometrics literature. Still, this does not mean they should be those most frequently used by regional science practitioners.”\n\nOnly two model specifications relevant for applied work\n\nSDEM\nSDM"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#lesages-2014-5-principles-1",
    "href": "spatmetrics/spatreg/index.html#lesages-2014-5-principles-1",
    "title": "Spatial regressions area data",
    "section": "LeSages (2014) 5 principles",
    "text": "LeSages (2014) 5 principles\n\nEstimation procedures, not only point estimates\n\nEstimates of dispersion\nCalculate direct/indirect effects\n\n“Avoid the temptation for observation-level inference”\n“Keep the weight matrix simple”"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#lesages-2014-recommendations",
    "href": "spatmetrics/spatreg/index.html#lesages-2014-recommendations",
    "title": "Spatial regressions area data",
    "section": "LeSages (2014) recommendations",
    "text": "LeSages (2014) recommendations\n\n“Sparse connectivity structures work best”\nParameterised decay can give identification problems\nDo not use multiple weight matrices\nDo not use non-spatial weight matrices"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#local-dgp-data-generating-process",
    "href": "spatmetrics/spatreg/index.html#local-dgp-data-generating-process",
    "title": "Spatial regressions area data",
    "section": "Local DGP (Data Generating Process)",
    "text": "Local DGP (Data Generating Process)\nWe decide that the DGP is probably local in our data\nWe start out with a Spatial Durban Error Model (SDEM) model, i.e. \\(\\rho = 0\\) (notation follows Burkey:\nNested models:\nManskin:\n\\[{\\bf y = \\rho W y + X \\beta +W X\\theta + u\\quad u = \\lambda Wu + \\epsilon}\\] SDEM:\n\\[ \\rho = 0:\\quad y = {\\bf X \\beta + W X\\theta + u\\quad u = \\lambda Wu + \\epsilon} \\]\nSEM:\n\\[ \\rho = 0, \\theta = 0: \\quad y = {\\bf X \\beta  + u\\quad u = \\lambda Wu + \\epsilon} \\]\nSLX:\n\\[ \\rho = 0, \\lambda = 0: \\quad y = {\\bf X \\beta  + W X\\theta + \\epsilon} \\]\nOLS:\n\\[ \\rho = 0, \\theta = 0, \\lambda = 0: \\quad y = {\\bf X \\beta  + \\epsilon} \\]\nThe last three models are all restricted versions of SDEM and we can use Likelihood ratios (for spatial linear models) to decide which is the best model (spatialreg::LR.Sarlm() or lmtest::lrtest(), they will give the same answer) ."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#sdem-spatial-durban-error-model-model",
    "href": "spatmetrics/spatreg/index.html#sdem-spatial-durban-error-model-model",
    "title": "Spatial regressions area data",
    "section": "SDEM (Spatial Durban Error Model) model",
    "text": "SDEM (Spatial Durban Error Model) model\n\n\nCode\n# Old (Burkey): errorsarlm(mod2, data = md_2017, listw = md_2017_w, etype = \"emixed\")\nSDEM <- errorsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#regression-report",
    "href": "spatmetrics/spatreg/index.html#regression-report",
    "title": "Spatial regressions area data",
    "section": "Regression report",
    "text": "Regression report\n\n\nCode\n# Take care. Do NOT interpret the regression coefficients\nsummary(SDEM)\n\n\n\nCall:errorsarlm(formula = mod2, data = md_2017, listw = md_2017_w, \n    Durbin = TRUE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.4571586 -0.0841577  0.0049056  0.0996526  0.5374538 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                      Estimate   Std. Error z value  Pr(>|z|)\n(Intercept)        5.459962672  0.722236361  7.5598 4.041e-14\nprct_20_64         0.027171328  0.005813866  4.6735 2.961e-06\ninc_bt_9and10      0.026867040  0.002940012  9.1384 < 2.2e-16\nspc_k              0.000949083  0.000345221  2.7492  0.005974\nsen_ind            0.001692672  0.000152011 11.1352 < 2.2e-16\nlag.prct_20_64     0.017090668  0.011868677  1.4400  0.149873\nlag.inc_bt_9and10  0.007906567  0.004632381  1.7068  0.087858\nlag.spc_k          0.000078155  0.000791456  0.0987  0.921338\nlag.sen_ind       -0.000181715  0.000237360 -0.7656  0.443935\n\nLambda: 0.42445, LR test value: 36.009, p-value: 0.0000000019636\nAsymptotic standard error: 0.062357\n    z-value: 6.8068, p-value: 9.9791e-12\nWald statistic: 46.333, p-value: 9.9791e-12\n\nLog likelihood: 142.853 for error model\nML residual variance (sigma squared): 0.023464, (sigma: 0.15318)\nNumber of observations: 329 \nNumber of parameters estimated: 11 \nAIC: -263.71, (AIC for lm: -229.7)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#the-impacts",
    "href": "spatmetrics/spatreg/index.html#the-impacts",
    "title": "Spatial regressions area data",
    "section": "The impacts",
    "text": "The impacts\n\n\nCode\n# The relevant info. for SDEM. Interpret impacts\nsummary(impacts(SDEM), zstats = TRUE)\n\n\nImpact measures (SDEM, estimable, n):\n                    Direct       Indirect       Total\nprct_20_64    0.0271713282  0.01709066796 0.044261996\ninc_bt_9and10 0.0268670398  0.00790656673 0.034773607\nspc_k         0.0009490832  0.00007815519 0.001027238\nsen_ind       0.0016926717 -0.00018171458 0.001510957\n========================================================\nStandard errors:\n                    Direct     Indirect        Total\nprct_20_64    0.0058138661 0.0118686767 0.0149430539\ninc_bt_9and10 0.0029400122 0.0046323806 0.0042956559\nspc_k         0.0003452214 0.0007914562 0.0009861918\nsen_ind       0.0001520106 0.0002373598 0.0002194918\n========================================================\nZ-values:\n                 Direct    Indirect    Total\nprct_20_64     4.673539  1.43998092 2.962045\ninc_bt_9and10  9.138411  1.70680422 8.095063\nspc_k          2.749201  0.09874859 1.041621\nsen_ind       11.135220 -0.76556593 6.883890\n\np-values:\n              Direct       Indirect Total     \nprct_20_64    0.0000029605 0.149873 0.003056  \ninc_bt_9and10 < 2.22e-16   0.087858 6.6613e-16\nspc_k         0.0059741    0.921338 0.297587  \nsen_ind       < 2.22e-16   0.443935 5.8240e-12\n\n\nThe impacts are reported to show how it is done. One might argue that the impacts could wait until the correct model is decided upon below."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#slx-model",
    "href": "spatmetrics/spatreg/index.html#slx-model",
    "title": "Spatial regressions area data",
    "section": "SLX model",
    "text": "SLX model\n\n\nCode\nSLX <- lmSLX(\n  mod2, \n  data = md_2017, \n  listw = md_2017_w, \n  Durbin = TRUE\n  )\n\n\n\n\nCode\nsummary(SLX)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.41882 -0.08986  0.00751  0.09590  0.48144 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)        4.5243803  0.5740667   7.881 5.13e-14 ***\nprct_20_64         0.0293684  0.0060045   4.891 1.59e-06 ***\ninc_bt_9and10      0.0270304  0.0034650   7.801 8.76e-14 ***\nspc_k              0.0008658  0.0003574   2.422  0.01597 *  \nsen_ind            0.0016788  0.0001799   9.330  < 2e-16 ***\nlag.prct_20_64     0.0357609  0.0107963   3.312  0.00103 ** \nlag.inc_bt_9and10  0.0076629  0.0045320   1.691  0.09184 .  \nlag.spc_k         -0.0003430  0.0007303  -0.470  0.63891    \nlag.sen_ind       -0.0004633  0.0002367  -1.957  0.05117 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1679 on 320 degrees of freedom\nMultiple R-squared:  0.803, Adjusted R-squared:  0.7981 \nF-statistic: 163.1 on 8 and 320 DF,  p-value: < 2.2e-16"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#slx-model-cont.",
    "href": "spatmetrics/spatreg/index.html#slx-model-cont.",
    "title": "Spatial regressions area data",
    "section": "SLX model cont.",
    "text": "SLX model cont.\n\n\nCode\nsummary(impacts(SLX), z.values = TRUE)\n\n\nImpact measures (SlX, estimable, n-k):\n                    Direct      Indirect        Total\nprct_20_64    0.0293684472  0.0357608695 0.0651293167\ninc_bt_9and10 0.0270304048  0.0076629095 0.0346933144\nspc_k         0.0008657653 -0.0003430118 0.0005227535\nsen_ind       0.0016787649 -0.0004632674 0.0012154975\n========================================================\nStandard errors:\n                    Direct     Indirect        Total\nprct_20_64    0.0060045003 0.0107963186 0.0118891646\ninc_bt_9and10 0.0034649565 0.0045320133 0.0030025656\nspc_k         0.0003573903 0.0007303328 0.0008350451\nsen_ind       0.0001799356 0.0002366776 0.0001615114\n========================================================\nZ-values:\n                Direct   Indirect      Total\nprct_20_64    4.891073  3.3123207  5.4780398\ninc_bt_9and10 7.801081  1.6908401 11.5545568\nspc_k         2.422464 -0.4696651  0.6260184\nsen_ind       9.329811 -1.9573772  7.5257702\n\np-values:\n              Direct     Indirect   Total     \nprct_20_64    1.0029e-06 0.00092525 4.3006e-08\ninc_bt_9and10 6.2172e-15 0.09086736 < 2.22e-16\nspc_k         0.015416   0.63859433 0.5313    \nsen_ind       < 2.22e-16 0.05030313 5.2403e-14"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#spatial-lag-only-prct_20_64",
    "href": "spatmetrics/spatreg/index.html#spatial-lag-only-prct_20_64",
    "title": "Spatial regressions area data",
    "section": "Spatial lag only prct_20_64?",
    "text": "Spatial lag only prct_20_64?\nPerhaps spatial lag just for prct_20_64is more appropriate?\n\n\nCode\nSLX_red <- lmSLX(mod2, data = md_2017, listw = md_2017_w, Durbin =~prct_20_64 + sen_ind)\n\n\n\n\nCode\nsummary(SLX_red)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.42200 -0.08543  0.00297  0.09024  0.48073 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     4.5543075  0.5672570   8.029 1.87e-14 ***\nprct_20_64      0.0299614  0.0059617   5.026 8.34e-07 ***\ninc_bt_9and10   0.0313854  0.0022985  13.655  < 2e-16 ***\nspc_k           0.0008600  0.0003570   2.409  0.01657 *  \nsen_ind         0.0016553  0.0001726   9.590  < 2e-16 ***\nlag.prct_20_64  0.0346104  0.0105264   3.288  0.00112 ** \nlag.sen_ind    -0.0003859  0.0002325  -1.659  0.09804 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1682 on 322 degrees of freedom\nMultiple R-squared:  0.801, Adjusted R-squared:  0.7973 \nF-statistic: 216.1 on 6 and 322 DF,  p-value: < 2.2e-16"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#slx-residuals",
    "href": "spatmetrics/spatreg/index.html#slx-residuals",
    "title": "Spatial regressions area data",
    "section": "SLX residuals?",
    "text": "SLX residuals?\n\nTesting for spatial autocorrelation in the residuals of the SLX model.\n\n\n\nCode\nlm.morantest(\n  SLX, \n  listw = md_2017_w, \n  alternative = \"greater\", \n  resfun = residuals, \n  naSubset = TRUE\n  )\n\n\n\n    Global Moran I for regression residuals\n\ndata:  \nmodel: lm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1],\ncollapse = \"+\"))), data = as.data.frame(x), weights = weights)\nweights: md_2017_w\n\nMoran I statistic standard deviate = 6.5847, p-value = 2.279e-11\nalternative hypothesis: greater\nsample estimates:\nObserved Moran I      Expectation         Variance \n     0.238535538     -0.008918982      0.001412270 \n\n\n\nPlenty of spatial effects in residuals."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#slx-residuals-plot",
    "href": "spatmetrics/spatreg/index.html#slx-residuals-plot",
    "title": "Spatial regressions area data",
    "section": "SLX residuals plot",
    "text": "SLX residuals plot\n\nThe SLX model leaves lots of spatial autocorrelation in the residuals, as seen in plot below.\n\n\n\n\nCode\nmoran.plot(residuals(SLX), listw = md_2017_w)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#sem-model",
    "href": "spatmetrics/spatreg/index.html#sem-model",
    "title": "Spatial regressions area data",
    "section": "SEM model",
    "text": "SEM model\n\nSpatial Error Model\n\n\n\n\nCode\n# Spatial error model\n# SDEM (Durbin = TRUE), no lagged y only lagged X and u\n# SEM Durbin = FALSE\nSEM <- errorsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = FALSE)\n\n\n\n\nCode\nsummary(SEM)\n\n\n\nCall:errorsarlm(formula = mod2, data = md_2017, listw = md_2017_w, \n    Durbin = FALSE)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.460521 -0.087668  0.005035  0.090322  0.510908 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                Estimate Std. Error z value    Pr(>|z|)\n(Intercept)   6.56625269 0.26173947 25.0870   < 2.2e-16\nprct_20_64    0.02397394 0.00528907  4.5327 0.000005823\ninc_bt_9and10 0.02958639 0.00267133 11.0755   < 2.2e-16\nspc_k         0.00087237 0.00028872  3.0215    0.002516\nsen_ind       0.00172460 0.00012859 13.4111   < 2.2e-16\n\nLambda: 0.45542, LR test value: 44.506, p-value: 2.5356e-11\nAsymptotic standard error: 0.060428\n    z-value: 7.5366, p-value: 4.8184e-14\nWald statistic: 56.8, p-value: 4.8295e-14\n\nLog likelihood: 139.8287 for error model\nML residual variance (sigma squared): 0.023715, (sigma: 0.154)\nNumber of observations: 329 \nNumber of parameters estimated: 7 \nAIC: -265.66, (AIC for lm: -223.15)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#moran-plot-residuals-sem",
    "href": "spatmetrics/spatreg/index.html#moran-plot-residuals-sem",
    "title": "Spatial regressions area data",
    "section": "Moran plot residuals SEM",
    "text": "Moran plot residuals SEM\n\n\nCode\nmoran.plot(\n  x = residuals(SEM), \n  listw = md_2017_w\n  )"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#selecting-model",
    "href": "spatmetrics/spatreg/index.html#selecting-model",
    "title": "Spatial regressions area data",
    "section": "Selecting model",
    "text": "Selecting model\nTesting nested models. Since the models we consider is nested we can use a Likelihood ratio test to decide which model to chose.\nNote: Above, in the Anselin approach, we used Lagrange multiplier tests. If H0 is true LR, LM and Walds test (a third alternative) will converge asymptotically. See\nWe have used the LR test below (since its in the spatialreg package).\n\n\nCode\n# H0: model should be restricted to SEM,\n# p > 0,05, can not discard H0. Discard SDEM select SEM\n# Restrict lagged variables to zero. df is number of lagged variables (to be restricted)\n# LR.sarlm moved to spatialreg, now called LR.Sarlm()\nLR.Sarlm(SDEM, SEM)# used to be spdep::LR.sarlm() now spatialreg::LR.Sarlm()\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 6.0486, df = 4, p-value = 0.1955\nsample estimates:\nLog likelihood of SDEM  Log likelihood of SEM \n              142.8530               139.8287 \n\n\nCode\n# Conclusion: Drop SDEM (theta = 0), but marginally since p = 0,064. \n# Go with SEM, Drop spatial effects in X\n\n\n\nWe should restrict \\(\\theta\\) to zero. Spatial interaction in Xs not required.\nDrop SDEM and continue with SEM\n\n\n\nCode\n# lrtest from the lmtest packages gives the same result.\n#broom::tidy(lmtest::lrtest(SDEM, SEM))\n#lmtest::lrtest(SDEM, SEM)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#should-we-restrict-even-more",
    "href": "spatmetrics/spatreg/index.html#should-we-restrict-even-more",
    "title": "Spatial regressions area data",
    "section": "Should we restrict even more?",
    "text": "Should we restrict even more?\nShould we restrict it even more (\\(\\rho = 0, \\theta = 0, \\lambda = 0\\)) to OLS?\n\nWe can use spatialreg::LR.sarlm() to apply a likelihood ratio test between nested models, but here choose lmtest::lrtest(), which gives the same results, preferring models including spatially lagged covariates.\n\nFrom R help lmtest::lrtest:\n\nlrtest is a generic function for carrying out likelihood ratio tests. The default method can be employed for comparing nested (generalized) linear models\n\nFrom R help spatialreg::LR.sarlm:\n\nThe LR.Sarlm() function provides a likelihood ratio test for objects for which a logLik() function exists for their class, or for objects of class logLik.\n\nThe two tests give the same results. We go with LR.Sarlm(). Why (E. P. Bivand Roger n.d.) use lrtest() was not clear. Probably because the broom package was not updated to support the spatialreg package (now updated) when chapter was written.\nTest the spatial models against OLS.\n\n\nCode\n# Likelihood ratio test\n# SDEM\n# LR1.Sarlm(SDEM)\n\n\n\n\nCode\n# Likelihood ratio test\n# SEM\nLR1.Sarlm(SEM)\n\n\n\n    Likelihood Ratio diagnostics for spatial dependence\n\ndata:  \nLikelihood ratio = 44.506, df = 1, p-value = 2.536e-11\nsample estimates:\nLog likelihood of spatial error model           Log likelihood of OLS fit y \n                             139.8287                              117.5756 \n\n\nNo, we should not restrict SEM to OLS (H0). Hence we end up with SEM as the best model for the data, given that this a local phenomenon."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#we-go-with-sem",
    "href": "spatmetrics/spatreg/index.html#we-go-with-sem",
    "title": "Spatial regressions area data",
    "section": "We go with SEM",
    "text": "We go with SEM\nAll good?\nWe can use a Hausman-test to test for omitted variables. The test compares the coefficient estimates from the spatial model (SEM) and OLS model. If no omitted variables the estimates should be similar.\n\n\nCode\n# Spatial Hausman test\nHausman.test(SEM)\n\n\n\n    Spatial Hausman test (asymptotic)\n\ndata:  NULL\nHausman test = 52.496, df = 5, p-value = 4.268e-10\n\n\nConclusion: There are marked difference between SEM and OLS coefficients. Hence, the Hausman test indicates that we have a problem with omitted variable(s).\n\n\nCode\nmoran.plot(residuals(SEM), listw = md_2017_w)\n\n\n\nAre there other problems like Heteroskedasticity?\n\n\nCode\n# test for Heteroskedasticity\nbptest.Sarlm(SEM, studentize = TRUE)\n\n\n\n    studentized Breusch-Pagan test\n\ndata:  \nBP = 35.423, df = 4, p-value = 0.0000003803\n\n\nWe do have heteroskedasticity! The estimates should be unbiased, but we might underestimate the standard error. Hence we risk accepting as significant variables that in reality are not. However, note that none of the t-values are marginal."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#are-our-residuals-normal",
    "href": "spatmetrics/spatreg/index.html#are-our-residuals-normal",
    "title": "Spatial regressions area data",
    "section": "Are our residuals normal?",
    "text": "Are our residuals normal?\n\n\nCode\nlibrary(DescTools)\n# H0: residuals normal\nJarqueBeraTest(residuals(SEM), robust = TRUE)\n\n\n\n    Robust Jarque Bera Test\n\ndata:  residuals(SEM)\nX-squared = 19.847, df = 2, p-value = 0.00004902\n\n\nCode\n# Conclusion: not normal\n\n\nThe residuals are not normal!\n\n\nCode\n md_2017 <- md_2017 %>% \n  mutate(\n    SEM_residuals = residuals(SEM),\n    OLS_residuals = residuals(lm2)\n  )\n# write md_2017 with residuals\nst_write(obj = md_2017, dsn = \"../data/md_2017.gpkg\", driver = \"GPKG\", append=FALSE)\n\n\nDeleting layer `md_2017' using driver `GPKG'\nWriting layer `md_2017' to data source `../data/md_2017.gpkg' using driver `GPKG'\nWriting 329 features with 23 fields and geometry type Multi Polygon.\n\n\nWe update data/md_2017.gkpkg with the residuals from the SEM and OLS models. This file can then be opened in Geoda and we can do further EDA of the resisuals.\n\n\nCode\ntmap_mode(\"plot\")\nt1 <- tm_shape(md_2017) +\n  tm_borders(alpha = 0.1) +\n   tm_polygons(\"SEM_residuals\")\nt2 <- tm_shape(md_2017) +\n    tm_borders(alpha = 0.1) +\n   tm_polygons(\"OLS_residuals\")\ntmap_arrange(t1, t2, nrow = 1)\n\n\n\n\n\nCode\nhuxreg(\"OLS\" = lm2, \"SEM\" = SEM,\n       error_format = \"({statistic})\",\n       note = \"{stars}. T-values reported.\")\n\n\n\n\n\nOLSSEM\n\n(Intercept)6.191 ***6.566 ***\n\n(21.152)   (25.087)   \n\nprct_20_640.032 ***0.024 ***\n\n(5.331)   (4.533)   \n\ninc_bt_9and100.033 ***0.030 ***\n\n(14.267)   (11.076)   \n\nspc_k0.001 ** 0.001 ** \n\n(2.812)   (3.021)   \n\nsen_ind0.002 ***0.002 ***\n\n(14.546)   (13.411)   \n\nlambda        0.455 ***\n\n        (7.537)   \n\nN329        329        \n\nR20.794    0.830    \n\nlogLik117.576    139.829    \n\nAIC-223.151    -265.657    \n\n *** p < 0.001;  ** p < 0.01;  * p < 0.05. T-values reported."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#do-we-have-omitted-variables",
    "href": "spatmetrics/spatreg/index.html#do-we-have-omitted-variables",
    "title": "Spatial regressions area data",
    "section": "Do we have omitted variables?",
    "text": "Do we have omitted variables?\n\n\nCode\nbroom::tidy(Hausman.test(SEM))\n\n\n\n\n\nstatisticp.valueparametermethod\n\n52.54.27e-105Spatial Hausman test (asymptotic)\n\n\n\n\nWithout doubt there is something more to this story. What might it be?"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#a-better-model",
    "href": "spatmetrics/spatreg/index.html#a-better-model",
    "title": "Spatial regressions area data",
    "section": "A “better” model?",
    "text": "A “better” model?\n\n\nCode\nmod3 <- \"log_pm2 ~ log_prct_20_64 + log_net_cap_3000k_p + log_sen_ind\"\n\n\nThe variable log_prct_20_64 is just the natural logarithm of the percentage of population of a working age. The variable log_net_cap_3000k_p the natural logarithm of the percentage of population with a net wealth exceeding NOK 3.000.000.\n\n\nCode\nlm3 <- lm(mod3, data = md_2017)\nsummary(lm3)\n\n\n\nCall:\nlm(formula = mod3, data = md_2017)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.41498 -0.08067 -0.00378  0.08628  0.68254 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)         -4.24750    1.02765  -4.133 4.56e-05 ***\nlog_prct_20_64       2.28497    0.29799   7.668 2.04e-13 ***\nlog_net_cap_3000k_p  0.55823    0.02879  19.391  < 2e-16 ***\nlog_sen_ind          0.47109    0.07677   6.136 2.46e-09 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1553 on 325 degrees of freedom\nMultiple R-squared:  0.8288,    Adjusted R-squared:  0.8273 \nF-statistic: 524.6 on 3 and 325 DF,  p-value: < 2.2e-16\n\n\n\n\nCode\nmctest(lm3, type = \"i\", method=\"VIF\")\n\n\n\nCall:\nimcdiag(mod = mod, method = method, corr = FALSE, vif = vif, \n    tol = tol, conf = conf, cvif = cvif, ind1 = ind1, ind2 = ind2, \n    leamer = leamer, all = all)\n\n\n VIF Multicollinearity Diagnostics\n\n                       VIF detection\nlog_prct_20_64      1.6559         0\nlog_net_cap_3000k_p 1.8423         0\nlog_sen_ind         2.4180         0\n\nNOTE:  VIF Method Failed to detect multicollinearity\n\n\n0 --> COLLINEARITY is not detected by the test\n\n===================================\n\n\n\n\nCode\nSEM_mod3 <- errorsarlm(mod3, data = md_2017, listw = md_2017_w, Durbin = FALSE)\n\n\n\n\nCode\nsummary(SEM_mod3)\n\n\n\nCall:errorsarlm(formula = mod3, data = md_2017, listw = md_2017_w, \n    Durbin = FALSE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.3988746 -0.0659741  0.0024313  0.0654742  0.6800960 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                     Estimate Std. Error z value  Pr(>|z|)\n(Intercept)         -2.687507   0.856437 -3.1380  0.001701\nlog_prct_20_64       1.735017   0.254544  6.8162 9.349e-12\nlog_net_cap_3000k_p  0.542116   0.031306 17.3167 < 2.2e-16\nlog_sen_ind          0.578234   0.086140  6.7128 1.910e-11\n\nLambda: 0.54686, LR test value: 74.573, p-value: < 2.22e-16\nAsymptotic standard error: 0.054144\n    z-value: 10.1, p-value: < 2.22e-16\nWald statistic: 102.01, p-value: < 2.22e-16\n\nLog likelihood: 185.2578 for error model\nML residual variance (sigma squared): 0.0175, (sigma: 0.13229)\nNumber of observations: 329 \nNumber of parameters estimated: 6 \nAIC: -358.52, (AIC for lm: -285.94)\n\n\n\n\nCode\nmoran.plot(residuals(SEM_mod3), listw = md_2017_w)\n\n\n\n\n\nCode\nhuxreg(\"OLS_mod3\" = lm3, \"SEM_mod3\" = SEM_mod3, error_format = \"({statistic})\", note = \"{stars}. T-values reported.\")\n\n\n\n\n\nOLS_mod3SEM_mod3\n\n(Intercept)-4.247 ***-2.688 ** \n\n(-4.133)   (-3.138)   \n\nlog_prct_20_642.285 ***1.735 ***\n\n(7.668)   (6.816)   \n\nlog_net_cap_3000k_p0.558 ***0.542 ***\n\n(19.391)   (17.317)   \n\nlog_sen_ind0.471 ***0.578 ***\n\n(6.136)   (6.713)   \n\nlambda        0.547 ***\n\n        (10.100)   \n\nN329        329        \n\nR20.829    0.875    \n\nlogLik147.971    185.258    \n\nAIC-285.943    -358.516    \n\n *** p < 0.001;  ** p < 0.01;  * p < 0.05. T-values reported."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#global-dgp",
    "href": "spatmetrics/spatreg/index.html#global-dgp",
    "title": "Spatial regressions area data",
    "section": "Global DGP",
    "text": "Global DGP\nHow we would have analysed this if we though it was a global phenomenon. You should have good arguments to select this track."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#nested-models",
    "href": "spatmetrics/spatreg/index.html#nested-models",
    "title": "Spatial regressions area data",
    "section": "Nested models",
    "text": "Nested models\nNested models:\nSDM:\n\\[ \\lambda = 0:\\quad {\\bf y = \\rho Wy + X \\beta + W X\\theta + \\epsilon} \\]\nSLX:\n\\[ \\lambda = 0, \\rho = 0: \\quad {\\bf y = X \\beta  + W X\\theta + \\epsilon} \\]\nSAR (Spatial lag):\n\\[ \\lambda = 0, \\theta = 0:\\quad {\\bf y = \\rho Wy + X \\beta + \\epsilon} \\]\nSEM (\\(\\theta = - \\rho \\beta\\))\n\\[ \\lambda = 0, \\theta = -\\rho \\beta:\\quad {\\bf y = X \\beta  + u,\\quad u = \\lambda W u + \\epsilon}\\]\nOLS:\n\\[ \\rho = 0, \\theta = 0, \\lambda = 0: \\quad y = {\\bf X \\beta  + \\epsilon} \\] ## Estimating the models"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#sdm",
    "href": "spatmetrics/spatreg/index.html#sdm",
    "title": "Spatial regressions area data",
    "section": "SDM:",
    "text": "SDM:\n\n\nCode\n# Old style (Burkey): lagsarlm(mod2, data = md_2017, listw = md_2017_w, type = \"mixed\")\nSDM <- lagsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)\n# Do not interpret coefficient estimates!!!!!\n\n\n\n\nCode\n# be careful\nsummary(SDM)\n\n\n\nCall:lagsarlm(formula = mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.4583940 -0.0843224  0.0026429  0.0899973  0.5340799 \n\nType: mixed \nCoefficients: (asymptotic standard errors) \n                     Estimate  Std. Error z value  Pr(>|z|)\n(Intercept)        2.67809841  0.62210440  4.3049 1.671e-05\nprct_20_64         0.02568975  0.00548463  4.6839 2.814e-06\ninc_bt_9and10      0.02602639  0.00315629  8.2459 2.220e-16\nspc_k              0.00087101  0.00032547  2.6762  0.007447\nsen_ind            0.00173814  0.00016389 10.6053 < 2.2e-16\nlag.prct_20_64     0.01048689  0.01013826  1.0344  0.300955\nlag.inc_bt_9and10 -0.00552064  0.00459166 -1.2023  0.229240\nlag.spc_k         -0.00052949  0.00066621 -0.7948  0.426738\nlag.sen_ind       -0.00098770  0.00023529 -4.1978 2.696e-05\n\nRho: 0.41917, LR test value: 37.824, p-value: 7.7436e-10\nAsymptotic standard error: 0.062316\n    z-value: 6.7265, p-value: 1.7379e-11\nWald statistic: 45.246, p-value: 1.7379e-11\n\nLog likelihood: 143.7601 for mixed model\nML residual variance (sigma squared): 0.023364, (sigma: 0.15285)\nNumber of observations: 329 \nNumber of parameters estimated: 11 \nAIC: -265.52, (AIC for lm: -229.7)\nLM test for residual autocorrelation\ntest value: 3.3921, p-value: 0.065508\n\n\n\n\nCode\nsummary(impacts(SDM, listw = md_2017_w, R=1000), zstats = TRUE)\n\n\nImpact measures (mixed, exact):\n                    Direct      Indirect        Total\nprct_20_64    0.0281782979  0.0341061297 0.0622844277\ninc_bt_9and10 0.0266573125  0.0086469222 0.0353042347\nspc_k         0.0008517659 -0.0002637761 0.0005879898\nsen_ind       0.0017078022 -0.0004157873 0.0012920150\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                   Mean        SD    Naive SE Time-series SE\nprct_20_64    0.0280181 0.0058445 0.000184820    0.000184820\ninc_bt_9and10 0.0265255 0.0029375 0.000092891    0.000092891\nspc_k         0.0008563 0.0003704 0.000011712    0.000011712\nsen_ind       0.0017162 0.0001576 0.000004984    0.000004984\n\n2. Quantiles for each variable:\n\n                   2.5%       25%       50%      75%    97.5%\nprct_20_64    0.0160324 0.0241478 0.0280063 0.031990 0.038831\ninc_bt_9and10 0.0209177 0.0245514 0.0263943 0.028520 0.032379\nspc_k         0.0001407 0.0006174 0.0008522 0.001108 0.001541\nsen_ind       0.0014181 0.0016072 0.0017166 0.001822 0.002037\n\n========================================================\nIndirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean        SD    Naive SE Time-series SE\nprct_20_64     0.0339659 0.0161841 0.000511785    0.000511785\ninc_bt_9and10  0.0087898 0.0050672 0.000160240    0.000182010\nspc_k         -0.0002419 0.0011520 0.000036429    0.000039680\nsen_ind       -0.0004198 0.0002851 0.000009016    0.000008973\n\n2. Quantiles for each variable:\n\n                    2.5%        25%        50%        75%     97.5%\nprct_20_64     0.0020574  0.0231985  0.0336305  0.0446912 0.0648830\ninc_bt_9and10 -0.0015780  0.0058146  0.0087115  0.0122466 0.0180174\nspc_k         -0.0024656 -0.0010192 -0.0001939  0.0005079 0.0019196\nsen_ind       -0.0009576 -0.0006043 -0.0004298 -0.0002238 0.0001322\n\n========================================================\nTotal:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                   Mean        SD    Naive SE Time-series SE\nprct_20_64    0.0619839 0.0189711 0.000599918    0.000599918\ninc_bt_9and10 0.0353153 0.0048004 0.000151803    0.000151803\nspc_k         0.0006144 0.0013790 0.000043607    0.000043607\nsen_ind       0.0012964 0.0002563 0.000008104    0.000008104\n\n2. Quantiles for each variable:\n\n                    2.5%        25%       50%      75%    97.5%\nprct_20_64     0.0242587  0.0495963 0.0620992 0.074465 0.098872\ninc_bt_9and10  0.0259296  0.0320983 0.0355132 0.038369 0.044736\nspc_k         -0.0021275 -0.0002773 0.0006635 0.001501 0.003200\nsen_ind        0.0008164  0.0011233 0.0013029 0.001466 0.001781\n\n========================================================\nSimulated standard errors\n                    Direct     Indirect        Total\nprct_20_64    0.0058445231 0.0161840500 0.0189710613\ninc_bt_9and10 0.0029374597 0.0050672267 0.0048004248\nspc_k         0.0003703648 0.0011519953 0.0013789706\nsen_ind       0.0001576221 0.0002851123 0.0002562599\n\nSimulated z-values:\n                 Direct   Indirect     Total\nprct_20_64     4.793905  2.0987240 3.2672892\ninc_bt_9and10  9.030067  1.7346452 7.3567028\nspc_k          2.312030 -0.2099888 0.4455414\nsen_ind       10.887790 -1.4724198 5.0587344\n\nSimulated p-values:\n              Direct       Indirect Total     \nprct_20_64    0.0000016357 0.035841 0.0010858 \ninc_bt_9and10 < 2.22e-16   0.082804 1.8852e-13\nspc_k         0.020776     0.833676 0.6559285 \nsen_ind       < 2.22e-16   0.140908 4.2205e-07"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#sar",
    "href": "spatmetrics/spatreg/index.html#sar",
    "title": "Spatial regressions area data",
    "section": "SAR:",
    "text": "SAR:\n\n\nCode\nSAR <- lagsarlm(mod2, data = md_2017, listw = md_2017_w)\n# Do not interpret estimates and p values\n\n\n\n\nCode\n# be careful\nsummary(SAR)\n\n\n\nCall:lagsarlm(formula = mod2, data = md_2017, listw = md_2017_w)\n\nResiduals:\n      Min        1Q    Median        3Q       Max \n-0.423991 -0.096486  0.004449  0.105846  0.505091 \n\nType: lag \nCoefficients: (asymptotic standard errors) \n                Estimate Std. Error z value      Pr(>|z|)\n(Intercept)   4.00984776 0.47937122  8.3648     < 2.2e-16\nprct_20_64    0.03080525 0.00555618  5.5443 0.00000002951\ninc_bt_9and10 0.02628991 0.00240127 10.9483     < 2.2e-16\nspc_k         0.00143368 0.00031659  4.5284 0.00000594185\nsen_ind       0.00128260 0.00012032 10.6594     < 2.2e-16\n\nRho: 0.25684, LR test value: 32.235, p-value: 0.000000013663\nAsymptotic standard error: 0.045279\n    z-value: 5.6725, p-value: 0.000000014076\nWald statistic: 32.177, p-value: 0.000000014076\n\nLog likelihood: 133.693 for lag model\nML residual variance (sigma squared): 0.025569, (sigma: 0.1599)\nNumber of observations: 329 \nNumber of parameters estimated: 7 \nAIC: -253.39, (AIC for lm: -223.15)\nLM test for residual autocorrelation\ntest value: 12.684, p-value: 0.00036876\n\n\n\n\nCode\n# Look at the impacts\nimpacts(SAR,  listw = md_2017_w)\n\n\nImpact measures (lag, exact):\n                   Direct     Indirect       Total\nprct_20_64    0.031311751 0.0101401184 0.041451869\ninc_bt_9and10 0.026722170 0.0086538109 0.035375981\nspc_k         0.001457256 0.0004719234 0.001929179\nsen_ind       0.001303683 0.0004221899 0.001725873\n\n\nIllustrations of constant ratio (direct/indirect) for the SAR model. Not a good feature of the model for applied work.\n\n\nCode\nimpacts(SAR,  listw = md_2017_w)$direct/impacts(SAR,  listw = md_2017_w)$indirect\n\n\n         [,1]\n[1,] 3.087908\n[2,] 3.087908\n[3,] 3.087908\n[4,] 3.087908\n\n\nImpacts with z-values.\n\n\nCode\nsummary(impacts(SAR, listw = md_2017_w, R=1000), zstats = TRUE)\n\n\nImpact measures (lag, exact):\n                   Direct     Indirect       Total\nprct_20_64    0.031311751 0.0101401184 0.041451869\ninc_bt_9and10 0.026722170 0.0086538109 0.035375981\nspc_k         0.001457256 0.0004719234 0.001929179\nsen_ind       0.001303683 0.0004221899 0.001725873\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                  Mean        SD    Naive SE Time-series SE\nprct_20_64    0.031188 0.0059777 0.000189032    0.000189032\ninc_bt_9and10 0.026677 0.0023929 0.000075670    0.000071998\nspc_k         0.001451 0.0003322 0.000010504    0.000010504\nsen_ind       0.001306 0.0001208 0.000003819    0.000003819\n\n2. Quantiles for each variable:\n\n                   2.5%      25%      50%      75%    97.5%\nprct_20_64    0.0199658 0.027161 0.031406 0.035197 0.042869\ninc_bt_9and10 0.0222928 0.025069 0.026615 0.028377 0.031493\nspc_k         0.0008133 0.001229 0.001445 0.001664 0.002087\nsen_ind       0.0010443 0.001229 0.001305 0.001384 0.001546\n\n========================================================\nIndirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                   Mean         SD    Naive SE Time-series SE\nprct_20_64    0.0102641 0.00317905 0.000100531    0.000100531\ninc_bt_9and10 0.0086769 0.00177715 0.000056198    0.000056198\nspc_k         0.0004843 0.00017777 0.000005622    0.000005622\nsen_ind       0.0004244 0.00008475 0.000002680    0.000002540\n\n2. Quantiles for each variable:\n\n                   2.5%       25%       50%       75%     97.5%\nprct_20_64    0.0052003 0.0079711 0.0100699 0.0123043 0.0170681\ninc_bt_9and10 0.0053770 0.0074650 0.0086875 0.0097936 0.0123723\nspc_k         0.0001883 0.0003546 0.0004707 0.0005886 0.0008713\nsen_ind       0.0002692 0.0003641 0.0004219 0.0004817 0.0005981\n\n========================================================\nTotal:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                  Mean        SD   Naive SE Time-series SE\nprct_20_64    0.041452 0.0084481 0.00026715     0.00026715\ninc_bt_9and10 0.035354 0.0029637 0.00009372     0.00009372\nspc_k         0.001935 0.0004882 0.00001544     0.00001544\nsen_ind       0.001731 0.0001439 0.00000455     0.00000455\n\n2. Quantiles for each variable:\n\n                  2.5%      25%      50%      75%    97.5%\nprct_20_64    0.026241 0.035574 0.041427 0.046783 0.057998\ninc_bt_9and10 0.029818 0.033359 0.035363 0.037384 0.040920\nspc_k         0.001011 0.001601 0.001923 0.002241 0.002946\nsen_ind       0.001447 0.001634 0.001726 0.001827 0.002011\n\n========================================================\nSimulated standard errors\n                    Direct      Indirect        Total\nprct_20_64    0.0059777210 0.00317905378 0.0084480855\ninc_bt_9and10 0.0023929049 0.00177714840 0.0029637325\nspc_k         0.0003321655 0.00017777050 0.0004881885\nsen_ind       0.0001207673 0.00008475402 0.0001438768\n\nSimulated z-values:\n                 Direct Indirect     Total\nprct_20_64     5.217428 3.228651  4.906719\ninc_bt_9and10 11.148553 4.882508 11.929001\nspc_k          4.366844 2.724129  3.963191\nsen_ind       10.818318 5.006986 12.030158\n\nSimulated p-values:\n              Direct        Indirect      Total        \nprct_20_64    0.00000018142 0.0012438     0.00000092612\ninc_bt_9and10 < 2.22e-16    0.00000104745 < 2.22e-16   \nspc_k         0.00001260550 0.0064471     0.00007395467\nsen_ind       < 2.22e-16    0.00000055289 < 2.22e-16   \n\n\nNote that the simulated z-values and p-values differ somewhat between each run, so only an approximation.\nIt´s also possible to specify that the spatial interaction is just for some variables.\n\n\nCode\n# Only lag sen_ind\nSAR_red <- lagsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = ~sen_ind)\n\n\n\n\nCode\nsummary(impacts(SAR_red, listw = md_2017_w, R=1000), zstats = TRUE)\n\n\nImpact measures (mixed, exact):\n                    Direct      Indirect       Total\nprct_20_64    0.0265861539  0.0161990337 0.042785188\ninc_bt_9and10 0.0245037707  0.0149302305 0.039434001\nspc_k         0.0009822063  0.0005984616 0.001580668\nsen_ind       0.0017309676 -0.0002764329 0.001454535\n========================================================\nSimulation results ( variance matrix):\nDirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                   Mean        SD    Naive SE Time-series SE\nprct_20_64    0.0263813 0.0056651 0.000179145    0.000179145\ninc_bt_9and10 0.0245192 0.0023998 0.000075889    0.000075889\nspc_k         0.0009673 0.0003341 0.000010565    0.000010565\nsen_ind       0.0017376 0.0001454 0.000004599    0.000004599\n\n2. Quantiles for each variable:\n\n                  2.5%       25%       50%      75%    97.5%\nprct_20_64    0.015369 0.0224618 0.0265182 0.030105 0.037071\ninc_bt_9and10 0.019953 0.0228545 0.0245235 0.026147 0.029183\nspc_k         0.000325 0.0007439 0.0009684 0.001180 0.001637\nsen_ind       0.001465 0.0016366 0.0017370 0.001834 0.002019\n\n========================================================\nIndirect:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                    Mean        SD    Naive SE Time-series SE\nprct_20_64     0.0161315 0.0048207 0.000152445    0.000152445\ninc_bt_9and10  0.0148733 0.0027696 0.000087582    0.000087582\nspc_k          0.0005941 0.0002493 0.000007882    0.000007882\nsen_ind       -0.0002786 0.0002024 0.000006399    0.000006399\n\n2. Quantiles for each variable:\n\n                    2.5%        25%        50%        75%    97.5%\nprct_20_64     0.0079955  0.0128705  0.0156414  0.0191479 0.026111\ninc_bt_9and10  0.0098372  0.0128696  0.0147673  0.0166294 0.020369\nspc_k          0.0001833  0.0004192  0.0005763  0.0007352 0.001152\nsen_ind       -0.0006853 -0.0004094 -0.0002732 -0.0001416 0.000131\n\n========================================================\nTotal:\n\nIterations = 1:1000\nThinning interval = 1 \nNumber of chains = 1 \nSample size per chain = 1000 \n\n1. Empirical mean and standard deviation for each variable,\n   plus standard error of the mean:\n\n                  Mean        SD    Naive SE Time-series SE\nprct_20_64    0.042513 0.0096712 0.000305830    0.000305830\ninc_bt_9and10 0.039392 0.0036973 0.000116920    0.000116920\nspc_k         0.001561 0.0005617 0.000017761    0.000017761\nsen_ind       0.001459 0.0001855 0.000005868    0.000006214\n\n2. Quantiles for each variable:\n\n                  2.5%      25%      50%      75%    97.5%\nprct_20_64    0.024586 0.035789 0.042234 0.049079 0.062440\ninc_bt_9and10 0.032701 0.036996 0.039117 0.041674 0.047118\nspc_k         0.000517 0.001187 0.001552 0.001907 0.002725\nsen_ind       0.001069 0.001342 0.001467 0.001586 0.001828\n\n========================================================\nSimulated standard errors\n                    Direct     Indirect        Total\nprct_20_64    0.0056650575 0.0048207244 0.0096711983\ninc_bt_9and10 0.0023998343 0.0027695767 0.0036973386\nspc_k         0.0003340842 0.0002492560 0.0005616641\nsen_ind       0.0001454356 0.0002023675 0.0001855500\n\nSimulated z-values:\n                 Direct  Indirect     Total\nprct_20_64     4.656845  3.346279  4.395814\ninc_bt_9and10 10.217044  5.370227 10.654276\nspc_k          2.895379  2.383495  2.779955\nsen_ind       11.947898 -1.376711  7.863367\n\nSimulated p-values:\n              Direct       Indirect       Total     \nprct_20_64    0.0000032109 0.00081904     1.1036e-05\ninc_bt_9and10 < 2.22e-16   0.000000078638 < 2.22e-16\nspc_k         0.003787     0.01714912     0.0054366 \nsen_ind       < 2.22e-16   0.16860147     3.7748e-15"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#slx",
    "href": "spatmetrics/spatreg/index.html#slx",
    "title": "Spatial regressions area data",
    "section": "SLX:",
    "text": "SLX:\nEstimated above.\n\n\nCode\nsummary(SLX)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.41882 -0.08986  0.00751  0.09590  0.48144 \n\nCoefficients:\n                    Estimate Std. Error t value Pr(>|t|)    \n(Intercept)        4.5243803  0.5740667   7.881 5.13e-14 ***\nprct_20_64         0.0293684  0.0060045   4.891 1.59e-06 ***\ninc_bt_9and10      0.0270304  0.0034650   7.801 8.76e-14 ***\nspc_k              0.0008658  0.0003574   2.422  0.01597 *  \nsen_ind            0.0016788  0.0001799   9.330  < 2e-16 ***\nlag.prct_20_64     0.0357609  0.0107963   3.312  0.00103 ** \nlag.inc_bt_9and10  0.0076629  0.0045320   1.691  0.09184 .  \nlag.spc_k         -0.0003430  0.0007303  -0.470  0.63891    \nlag.sen_ind       -0.0004633  0.0002367  -1.957  0.05117 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1679 on 320 degrees of freedom\nMultiple R-squared:  0.803, Adjusted R-squared:  0.7981 \nF-statistic: 163.1 on 8 and 320 DF,  p-value: < 2.2e-16\n\n\n\n\nCode\nimpacts(SLX, listw = md_2017_w)\n\n\nImpact measures (SlX, estimable):\n                    Direct      Indirect        Total\nprct_20_64    0.0293684472  0.0357608695 0.0651293167\ninc_bt_9and10 0.0270304048  0.0076629095 0.0346933144\nspc_k         0.0008657653 -0.0003430118 0.0005227535\nsen_ind       0.0016787649 -0.0004632674 0.0012154975"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#selecting-model-1",
    "href": "spatmetrics/spatreg/index.html#selecting-model-1",
    "title": "Spatial regressions area data",
    "section": "Selecting model",
    "text": "Selecting model\nShould we restrict to \\(\\theta = 0\\)?\n\n\nCode\nLR.Sarlm(SDM, SAR)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 20.134, df = 4, p-value = 0.0004698\nsample estimates:\nLog likelihood of SDM Log likelihood of SAR \n             143.7601              133.6930 \n\n\nH0 restrict \\(\\theta\\) to 0.\nWe reject H0, continue with SDM.\nShould we restrict with \\(\\rho = 0\\)?\n\n\nCode\nLR.Sarlm(SDM, SLX)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 37.824, df = 1, p-value = 7.744e-10\nsample estimates:\nLog likelihood of SDM Log likelihood of SLX \n             143.7601              124.8482 \n\n\nH0 restrict \\(\\rho\\) to 0.\nWe reject H0, continue with SDM.\nShould we restrict \\(\\theta = - \\rho \\beta\\).\n\n\nCode\nLR.Sarlm(SDM, SEM)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 7.8628, df = 4, p-value = 0.09673\nsample estimates:\nLog likelihood of SDM Log likelihood of SEM \n             143.7601              139.8287 \n\n\nChoose SEM (and we know from local analyses that we should not restrict to OLS)\nIf we skip restrict \\(\\theta = - \\rho \\beta\\). Should we restrict to OLS.\n\n\nCode\nLR.Sarlm(SEM, lm2)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 44.506, df = 1, p-value = 2.536e-11\nsample estimates:\nLog likelihood of SEM Log likelihood of lm2 \n             139.8287              117.5756 \n\n\nReject H0, we should not restrict to OLS."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#full-manski",
    "href": "spatmetrics/spatreg/index.html#full-manski",
    "title": "Spatial regressions area data",
    "section": "Full Manski",
    "text": "Full Manski\nYou should probably stay off this track. See (LeSage 2014)\nThere is problems estimating this model (identification problems). The reason why one does not start with this model and then treat SAC, SDM and SDEM as nested models.\n\n\nCode\n# Old style (Burkey): sacsarlm(mod2, data = md_2017, listw = md_2017_w, type = \"sacmixed\")\nMANSKI <- sacsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)\nsummary(MANSKI)\n\n\n\nCall:sacsarlm(formula = mod2, data = md_2017, listw = md_2017_w, Durbin = TRUE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.4198354 -0.0825496  0.0020849  0.0833636  0.4784596 \n\nType: sacmixed \nCoefficients: (asymptotic standard errors) \n                     Estimate  Std. Error z value  Pr(>|z|)\n(Intercept)        1.50425742  0.63914448  2.3535   0.01860\nprct_20_64         0.02293222  0.00548048  4.1843 2.860e-05\ninc_bt_9and10      0.02584618  0.00322845  8.0058 1.110e-15\nspc_k              0.00086502  0.00031586  2.7386   0.00617\nsen_ind            0.00180838  0.00016761 10.7891 < 2.2e-16\nlag.prct_20_64     0.00485516  0.01002833  0.4841   0.62828\nlag.inc_bt_9and10 -0.01250273  0.00516204 -2.4221   0.01543\nlag.spc_k         -0.00075156  0.00058742 -1.2794   0.20074\nlag.sen_ind       -0.00137809  0.00024757 -5.5665 2.599e-08\n\nRho: 0.62666\nAsymptotic standard error: 0.099265\n    z-value: 6.3131, p-value: 2.7355e-10\nLambda: -0.33341\nAsymptotic standard error: 0.17285\n    z-value: -1.9289, p-value: 0.053748\n\nLR test value: 54.897, p-value: 4.8638e-10\n\nLog likelihood: 145.0239 for sacmixed model\nML residual variance (sigma squared): 0.02115, (sigma: 0.14543)\nNumber of observations: 329 \nNumber of parameters estimated: 12 \nAIC: -266.05, (AIC for lm: -223.15)\n\n\n\n\nCode\n# Old style (Burkey): sacsarlm(mod2, data = md_2017, listw = md_2017_w, type = \"sac\")\n# No lagged X, just lagged y and u\nKELEJIAN_PRUCA <- sacsarlm(mod2, data = md_2017, listw = md_2017_w, Durbin = FALSE)\nsummary(KELEJIAN_PRUCA)\n\n\n\nCall:\nsacsarlm(formula = mod2, data = md_2017, listw = md_2017_w, Durbin = FALSE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.4587765 -0.0935582  0.0026026  0.0963646  0.5289599 \n\nType: sac \nCoefficients: (asymptotic standard errors) \n                Estimate Std. Error z value    Pr(>|z|)\n(Intercept)   5.59638908 0.64606968  8.6622   < 2.2e-16\nprct_20_64    0.02613147 0.00542404  4.8177 0.000001452\ninc_bt_9and10 0.02856009 0.00273856 10.4289   < 2.2e-16\nspc_k         0.00105297 0.00031362  3.3574   0.0007868\nsen_ind       0.00161434 0.00013901 11.6127   < 2.2e-16\n\nRho: 0.095544\nAsymptotic standard error: 0.060718\n    z-value: 1.5736, p-value: 0.11559\nLambda: 0.37353\nAsymptotic standard error: 0.082757\n    z-value: 4.5135, p-value: 0.0000063752\n\nLR test value: 46.779, p-value: 6.9525e-11\n\nLog likelihood: 140.9649 for sac model\nML residual variance (sigma squared): 0.023951, (sigma: 0.15476)\nNumber of observations: 329 \nNumber of parameters estimated: 8 \nAIC: -265.93, (AIC for lm: -223.15)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#final-question",
    "href": "spatmetrics/spatreg/index.html#final-question",
    "title": "Spatial regressions area data",
    "section": "Final question",
    "text": "Final question\nWhy not start with the Manski (below called the GNS model) model and use a LR test to decide if SAC, SDM or SDEM is the best nested model?\nGood question ;-)\nThe following quote might give the answer:\n\nEven though taking the GNS model as point of departure to measure spillovers seems appealing since it contains all possible interaction effects, two major issues are that a formal proof under which conditions the parameters of this model are identified is not available yet (see Section 1) and the problem of overfitting. Even though the parameters are not identified, they can still be estimated. However, they have the tendency either to blow each other up or to become insignificant as a result of which this model does not help to choose among the SDM and SDEM models.(Halleck Vega and Elhorst 2015) p. 347.\n\nThere are several problems with fitting the Manski (GNS) model. Should these be solved the Manski model might be a starting point in the future. For the time being the best we can do is probably to follow (LeSage 2014) and\n\nDon’t bother with SAC\nDecide if the phenomenon we study is of a local or global character\nIf local start with SDEM, if global start with SDM\nUse LR.Sarlm() to decide which of the nested models to use\nRemember to report impacts, not coefficient estimates.\n\n\n\nCode\n# new dwellings\nmod4 <- \"log_pm2 ~ prct_20_64 + inc_bt_9and10  +  sen_ind + I(sfd_ba_completed + sfd_w2u_ba_completed)\"\nlm4 <- lm(mod4, data = md_2017)\n\n\n\n\nCode\nsummary(lm4)\n\n\n\nCall:\nlm(formula = mod4, data = md_2017)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.48403 -0.10321  0.00623  0.10032  0.53345 \n\nCoefficients:\n                                              Estimate  Std. Error t value\n(Intercept)                                6.387177798 0.313421930  20.379\nprct_20_64                                 0.029999697 0.006078476   4.935\ninc_bt_9and10                              0.031585407 0.002304524  13.706\nsen_ind                                    0.001502981 0.000112447  13.366\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.000004981 0.000001812   2.749\n                                             Pr(>|t|)    \n(Intercept)                                   < 2e-16 ***\nprct_20_64                                 0.00000128 ***\ninc_bt_9and10                                 < 2e-16 ***\nsen_ind                                       < 2e-16 ***\nI(sfd_ba_completed + sfd_w2u_ba_completed)    0.00631 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1707 on 324 degrees of freedom\nMultiple R-squared:  0.7939,    Adjusted R-squared:  0.7913 \nF-statistic:   312 on 4 and 324 DF,  p-value: < 2.2e-16\n\n\n\n\nCode\nSDEM_mod4 <- errorsarlm(mod4, data = md_2017, listw = md_2017_w, Durbin = TRUE)\nsummary(impacts(SDEM_mod4), zstats = TRUE)\n\n\nImpact measures (SDEM, estimable, n):\n                                                   Direct        Indirect\nprct_20_64                                 0.024959397785  0.016643621634\ninc_bt_9and10                              0.026220603474  0.004875123116\nsen_ind                                    0.001750268724 -0.000471082348\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.000004612348  0.000005561148\n                                                  Total\nprct_20_64                                 0.0416030194\ninc_bt_9and10                              0.0310957266\nsen_ind                                    0.0012791864\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.0000101735\n========================================================\nStandard errors:\n                                                   Direct       Indirect\nprct_20_64                                 0.005918134102 0.011778249231\ninc_bt_9and10                              0.003011189510 0.004763498651\nsen_ind                                    0.000143362464 0.000231312783\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.000001747715 0.000003930684\n                                                    Total\nprct_20_64                                 0.014729222137\ninc_bt_9and10                              0.004549428099\nsen_ind                                    0.000223008497\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.000004845399\n========================================================\nZ-values:\n                                              Direct  Indirect    Total\nprct_20_64                                  4.217444  1.413081 2.824523\ninc_bt_9and10                               8.707723  1.023433 6.835085\nsen_ind                                    12.208696 -2.036560 5.736043\nI(sfd_ba_completed + sfd_w2u_ba_completed)  2.639073  1.414804 2.099620\n\np-values:\n                                           Direct      Indirect Total     \nprct_20_64                                 0.000024709 0.157632 0.0047351 \ninc_bt_9and10                              < 2.22e-16  0.306103 8.1957e-12\nsen_ind                                    < 2.22e-16  0.041694 9.6914e-09\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.0083133   0.157126 0.0357623 \n\n\n\n\nCode\nSEM_mod4 <- errorsarlm(mod4, data = md_2017, listw = md_2017_w, Durbin = FALSE)\nsummary(SEM_mod4)\n\n\n\nCall:errorsarlm(formula = mod4, data = md_2017, listw = md_2017_w, \n    Durbin = FALSE)\n\nResiduals:\n       Min         1Q     Median         3Q        Max \n-0.4638081 -0.0921883  0.0038205  0.0919993  0.5023677 \n\nType: error \nCoefficients: (asymptotic standard errors) \n                                               Estimate   Std. Error z value\n(Intercept)                                6.7015322967 0.2814504975 23.8107\nprct_20_64                                 0.0224038565 0.0054991334  4.0741\ninc_bt_9and10                              0.0292077896 0.0026677847 10.9483\nsen_ind                                    0.0017287275 0.0001295926 13.3397\nI(sfd_ba_completed + sfd_w2u_ba_completed) 0.0000040784 0.0000016145  2.5261\n                                            Pr(>|z|)\n(Intercept)                                < 2.2e-16\nprct_20_64                                 0.0000462\ninc_bt_9and10                              < 2.2e-16\nsen_ind                                    < 2.2e-16\nI(sfd_ba_completed + sfd_w2u_ba_completed)   0.01153\n\nLambda: 0.44751, LR test value: 42.147, p-value: 8.4683e-11\nAsymptotic standard error: 0.06093\n    z-value: 7.3446, p-value: 2.065e-13\nWald statistic: 53.943, p-value: 2.0639e-13\n\nLog likelihood: 138.4757 for error model\nML residual variance (sigma squared): 0.02396, (sigma: 0.15479)\nNumber of observations: 329 \nNumber of parameters estimated: 7 \nAIC: -262.95, (AIC for lm: -222.8)\n\n\n\n\nCode\nmoran.plot(residuals(SEM_mod4), listw = md_2017_w)\n\n\n\n\n\nCode\nmoran(residuals(SEM_mod4), listw = md_2017_w, n = length(md_2017_nb), S0 = Szero(md_2017_w))\n\n\n$I\n[1] -0.01430735\n\n$K\n[1] 3.788702\n\n\nMorans I for the residuals are now slightly negative (-0.01434). The kurtosis of the residuals is 3.8, compared to 3.0 for a normal distribution, so the distribution of residuals are slightly leptokurtic. Hence more outliers that if they were normaly distributed.\n\n\nCode\nJarqueBeraTest(residuals(SEM_mod4), robust = TRUE)\n\n\n\n    Robust Jarque Bera Test\n\ndata:  residuals(SEM_mod4)\nX-squared = 13.335, df = 2, p-value = 0.001272\n\n\n\n\nCode\nSLX_mod4 <- lmSLX(mod4, data = md_2017, listw = md_2017_w, Durbin = TRUE)\nsummary(SLX_mod4)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.40527 -0.09317  0.00553  0.10366  0.48804 \n\nCoefficients:\n                                                   Estimate   Std. Error\n(Intercept)                                     4.940435659  0.603180867\nprct_20_64                                      0.027048664  0.006133710\ninc_bt_9and10                                   0.026259939  0.003506692\nsen_ind                                         0.001741089  0.000168758\nI.sfd_ba_completed...sfd_w2u_ba_completed.      0.000004501  0.000001817\nlag.prct_20_64                                  0.033881537  0.010768718\nlag.inc_bt_9and10                               0.004932595  0.004618570\nlag.sen_ind                                    -0.000698463  0.000226843\nlag.I.sfd_ba_completed...sfd_w2u_ba_completed.  0.000004644  0.000003633\n                                               t value Pr(>|t|)    \n(Intercept)                                      8.191 6.28e-15 ***\nprct_20_64                                       4.410 1.41e-05 ***\ninc_bt_9and10                                    7.489 6.83e-13 ***\nsen_ind                                         10.317  < 2e-16 ***\nI.sfd_ba_completed...sfd_w2u_ba_completed.       2.477  0.01376 *  \nlag.prct_20_64                                   3.146  0.00181 ** \nlag.inc_bt_9and10                                1.068  0.28633    \nlag.sen_ind                                     -3.079  0.00226 ** \nlag.I.sfd_ba_completed...sfd_w2u_ba_completed.   1.278  0.20215    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1675 on 320 degrees of freedom\nMultiple R-squared:  0.8039,    Adjusted R-squared:  0.799 \nF-statistic:   164 on 8 and 320 DF,  p-value: < 2.2e-16\n\n\n\n\nCode\nLR.Sarlm(SDEM_mod4, SEM_mod4)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 7.1726, df = 4, p-value = 0.127\nsample estimates:\nLog likelihood of SDEM_mod4  Log likelihood of SEM_mod4 \n                   142.0620                    138.4757 \n\n\nH0 can not be discarded and we should restrict SDEM to SEM, i.e. we should not restrict $$ to zero.\n\n\nCode\nLR.Sarlm(SDEM_mod4, SLX_mod4)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 32.981, df = 1, p-value = 0.000000009308\nsample estimates:\nLog likelihood of SDEM_mod4  Log likelihood of SLX_mod4 \n                   142.0620                    125.5718 \n\n\nH0 can be discarded and we should not restrict SDEM to SLX, i.e. we should restrict $$ to zero.\nShould we restrict further, i.e. SEM to OLS?\n\n\nCode\n# H0 restrict SEM to OLS\nLR.Sarlm(SEM_mod4, lm4)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 42.147, df = 1, p-value = 8.468e-11\nsample estimates:\nLog likelihood of SEM_mod4      Log likelihood of lm4 \n                  138.4757                   117.4025 \n\n\nH0 can be discarded and we should not restrict SEM further to OLS.\n\n\nCode\n#siste"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#bibliography",
    "href": "spatmetrics/spatreg/index.html#bibliography",
    "title": "Spatial regressions area data",
    "section": "Bibliography",
    "text": "Bibliography\n\n\nMSB205\n\n\n\nn.d. https://hdl.handle.net/11250/2732299.\n\n\nAarland, Kristin, Liv Aileen Osland, and Arnstein Gjestland. 2015a. “Do Area-based Intervention Programs Affect House Prices? A Quasi-experimental Approach.” In.\n\n\n———. 2015b. “Do Area-based Intervention Programs Affect House Prices? A Quasi-experimental Approach.” In.\n\n\n———. 2016. “Do Area-Based Intervention Programs Affect House Prices? A Quasi-experimental Approach.” In.\n\n\n———. 2017. “Do Area-Based Intervention Programs Affect House Prices? A Quasi-Experimental Approach.” Journal of Housing Economics 37: 67–83. http://www.sciencedirect.com/science/journal/10511377.\n\n\nAllaire, JJ, Yihui Xie, Jonathan McPherson, Javier Luraschi, Kevin Ushey, Aron Atkins, Hadley Wickham, Joe Cheng, Winston Chang, and Richard Iannone. 2022. Rmarkdown: Dynamic Documents for R. Manual. https://github.com/rstudio/rmarkdown.\n\n\nBivand, Edzer Pebesma, Roger. n.d. Spatial Data Science. Accessed May 12, 2021. https://keen-swartz-3146c4.netlify.app/index.html.\n\n\nBivand, Roger. 2022a. “R Packages for Analyzing Spatial Data: A Comparative Case Study with Areal Data.” Geographical Analysis 54 (3): 488–518. https://doi.org/10.1111/gean.12319.\n\n\n———. 2022b. Spdep: Spatial Dependence: Weighting Schemes, Statistics. https://CRAN.R-project.org/package=spdep.\n\n\nBivand, Roger S., Edzer Pebesma, and Virgilio Gomez-Rubio. 2013a. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013b. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013c. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\nBivand, Roger, Jan Hauke, and Tomasz Kossowski. 2013. “Computing the Jacobian in Gaussian Spatial Autoregressive Models: An Illustrated Comparison of Available Methods.” Geographical Analysis 45 (2): 150–79. https://doi.org/10.1111/gean.12008.\n\n\nBivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. “A Review of Software for Spatial Econometrics in R.” Mathematics 9 (11). https://doi.org/10.3390/math9111276.\n\n\nBivand, Roger, and Gianfranco Piras. 2015. “Comparing Implementations of Estimation Methods for Spatial Econometrics.” Journal of Statistical Software 63 (18): 1–36. https://doi.org/10.18637/jss.v063.i18.\n\n\n———. 2022. Spatialreg: Spatial Regression Analysis. https://CRAN.R-project.org/package=spatialreg.\n\n\nBivand, Roger, and David W. S. Wong. 2018. “Comparing Implementations of Global and Local Indicators of Spatial Association.” TEST 27 (3): 716–48. https://doi.org/10.1007/s11749-018-0599-x.\n\n\nChi, G., and J. Zhu. 2019. Spatial Regression Models for the Social Sciences. Advanced Quantitative Techniques in the Social Sciences. SAGE Publications. https://books.google.no/books?id=zHGkvwEACAAJ.\n\n\n“Definition of Peer-Reviewed Scientific Journal - NCI Dictionary of Cancer Terms - NCI.” 02/02/2011 - 07:00. nciAppModulePage. 02/02/2011 - 07:00. https://www.cancer.gov/publications/dictionaries/cancer-terms/def/peer-reviewed-scientific-journal.\n\n\n“Dependency and Reproducibility – GSS.” n.d. Accessed September 12, 2022. https://gss.civilservice.gov.uk/reproducible-analytical-pipelines/dependency-and-reproducibility/.\n\n\nEpskamp, Sacha. 2019. “Reproducibility and Replicability in a Fast-Paced Methodological World.” Advances in Methods and Practices in Psychological Science 2 (May): 251524591984742. https://doi.org/10.1177/2515245919847421.\n\n\nGjestland, Arnstein, David Philip McArthur, Liv Aileen Osland, and Inge Thorsen. 2010a. “Relationships Between Housing Prices and Commuting Flows.” In.\n\n\n———. 2010b. “Relationships Between Housing Prices and Commuting Flows.” In.\n\n\n———. 2011. “A Bridge over Troubled Waters: Valuing Accessibility Effects of a New Bridge.” In.\n\n\n———. 2012. “A Bridge over Troubled Waters: Valuing Accessibility Effects of a New Bridge.” Accessibility Analysis and Transport Planning: Challenges for Europe and North America.\n\n\n———. 2014. “The Suitability of Hedonic Models for Cost-Benefit Analysis: EVIDENCE from Commuting Flows.” Transportation Research Part A: Policy and Practice 61: 136–51. http://www.sciencedirect.com/science/journal/09658564.\n\n\nGjestland, Arnstein, David Philip McArthur, Inge Thorsen, and Liv Aileen Osland. 2011. “Alternative Methods for Quantifying Commuting-Related Benefits of New Transport Infrastructure.” In.\n\n\nGjestland, Arnstein, Liv Osland, David McArthur, and Inge Thorsen. 2010. “A Bridge over Troubled Waters: Valuing Accessibility Effects of a New Bridge.” In.\n\n\nGjestland, Arnstein, Liv Osland, and Inge Thorsen. 2020. “Measures of Labour Market Accessibility. What Can We Learn from Observed Commuting Patterns?” REGION 7 (1): 49–70. http://region.wu.ac.at/.\n\n\nGjestland, Arnstein, Inge Heldal Thorsen, and Jan Ub�e. 2006. “Some Aspects on the Intraregional Spatial Distribution of Local Sector Activities.” The Annals of Regional Science 40: 559–82. http://www.springerlink.com/?MUD=MP.\n\n\nGjestland, Arnstein, Inge Thorsen, and Jan Ub�e. 2000. “Some Aspects on the Intraregional Spatial Distribution of Local Sector Activities.” In.\n\n\nGrolemund, Garrett, and Hadley Wickham. 2017. R for Data Science: Import, Tidy, Transform, Visualize, and Model Data. 1st edition. Sebastopol, CA: O’Reilly Media.\n\n\nGrossenbacher, Timo. n.d. “A (Truly) Reproducible R Workflow.” Accessed September 12, 2022. https://timogrossenbacher.ch/2017/07/a-truly-reproducible-r-workflow/.\n\n\nGuidotti, Emanuele, and David Ardia. 2020. “COVID-19 Data Hub.” Journal of Open Source Software 5 (51): 2376. https://doi.org/10.21105/joss.02376.\n\n\nHalleck Vega, Solmaria, and J. Paul Elhorst. 2015. “THE SLX MODEL.” Journal of Regional Science 55 (3): 339–63. https://doi.org/10.1111/jors.12188.\n\n\nHugh-Jones, David. 2022. Huxtable: Easily Create and Style Tables for LaTeX, HTML and Other Formats. https://hughjonesd.github.io/huxtable/.\n\n\nJudge, Timothy A., and Daniel M. Cable. 2004. “The Effect of Physical Height on Workplace Success and Income: Preliminary Test of a Theoretical Model.” Journal of Applied Psychology 89 (3): 428–41. https://doi.org/10.1037/0021-9010.89.3.428.\n\n\nLander, Jared. 2017. R for Everyone: Advanced Analytics and Graphics. 2nd edition. Boston: Addison-Wesley Professional.\n\n\nLangsrud, Øyvind, and Jan Bruusgaard. 2021. PxWebApiData: PX-Web Data by API. https://github.com/statisticsnorway/PxWebApiData.\n\n\nLeSage, James P. 2014. “What Regional Scientists Need to Know About Spatial Econometrics.” SSRN scholarly paper ID 2420725. Rochester, NY: Social Science Research Network. https://doi.org/10.2139/ssrn.2420725.\n\n\nNordvik, Viggo, Liv Aileen Osland, and Arnstein Gjestland. 2014a. “Putting a Price on Your Neighbour.” In.\n\n\n———. 2014b. “Putting a Price on Your Neighbour.” In.\n\n\nOoi, Hong, and Vries, Andrie de. n.d. 0.1 The Reproducible R Toolkit (RRT). Accessed September 12, 2022. https://cran.r-project.org/web/packages/checkpoint/vignettes/checkpoint.html.\n\n\nOsland, Liv. 2010. “An Application of Spatial Econometrics in Relation to Hedonic House Price Modeling.” Journal of Real Estate Research 32 (July): 289–320.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\nPebesma, Edzer J., and Roger S. Bivand. 2005. “Classes and Methods for Spatial Data in R.” R News 5 (2): 9–13. https://CRAN.R-project.org/doc/Rnews/.\n\n\nPebesma, Edzer, and Roger Bivand. 2022. Sp: Classes and Methods for Spatial Data. https://CRAN.R-project.org/package=sp.\n\n\n“Quarto - About Quarto.” n.d. Accessed September 26, 2022. https://quarto.org/about.html.\n\n\nRobinson, David, Alex Hayes, and Simon Couch. 2022. Broom: Convert Statistical Objects into Tidy Tibbles. https://CRAN.R-project.org/package=broom.\n\n\nSciences, National Academies of, Engineering, and Medicine. 2019. Reproducibility and Replicability in Science. Washington, DC: The National Academies Press. https://doi.org/10.17226/25303.\n\n\nSirisilla, Shrutika. 2022. “Top 5 Factors Affecting Reproducibility in Research.” Enago Academy. March 31, 2022. https://www.enago.com/academy/top-5-factors-affecting-reproducibility-in-scientific-research/.\n\n\nTennekes, Martijn. 2018. “tmap: Thematic Maps in R.” Journal of Statistical Software 84 (6): 1–39. https://doi.org/10.18637/jss.v084.i06.\n\n\n———. 2022. Tmap: Thematic Maps. https://github.com/r-tmap/tmap.\n\n\nThorsen, Inge, Jan Ub�e, and Arnstein Gjestland. 2006. “Some Aspects of the Intraregional Spatial Distribution of Local Sector Activities.” The Annals of Regional Science 40 (3): 559–82. http://www.springerlink.com/?MUD=MP.\n\n\n“Welcome | R for Data Science.” n.d. Accessed July 22, 2022. https://r4ds.had.co.nz/.\n\n\nWickham, Hadley. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019b. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\n———, et al. 2019a. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, and Jennifer Bryan. 2022. Readxl: Read Excel Files. https://CRAN.R-project.org/package=readxl.\n\n\nXie, Yihui. 2014. “Knitr: A Comprehensive Tool for Reproducible Research in R.” In Implementing Reproducible Computational Research, edited by Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman and Hall/CRC. http://www.crcpress.com/product/isbn/9781466561595.\n\n\n———. 2015. Dynamic Documents with R and Knitr. 2nd ed. Boca Raton, Florida: Chapman and Hall/CRC. https://yihui.org/knitr/.\n\n\n———. 2022. Knitr: A General-Purpose Package for Dynamic Report Generation in R. Manual. https://yihui.org/knitr/.\n\n\nXie, Yihui, J. J. Allaire, and Garrett Grolemund. 2018. R Markdown: The Definitive Guide. Boca Raton, Florida: Chapman and Hall/CRC. https://bookdown.org/yihui/rmarkdown.\n\n\nXie, Yihui, Christophe Dervieux, and Emily Riederer. 2020. R Markdown Cookbook. Boca Raton, Florida: Chapman and Hall/CRC. https://bookdown.org/yihui/rmarkdown-cookbook."
  },
  {
    "objectID": "spatmetrics/data/index.html#read-in-map-2017-unedited",
    "href": "spatmetrics/data/index.html#read-in-map-2017-unedited",
    "title": "Get ssb data",
    "section": "Read in map 2017 (unedited)",
    "text": "Read in map 2017 (unedited)\nThe map is converted from 432 to 426 multipolygons.\n\n\nCode\nmap_2017 <- st_read(\"map_2017_uned.gpkg\") %>% \n  rename(\"knr\" = KOMMUNENUM) %>% \n  group_by(knr) %>% \n  summarise() %>% \n  st_transform(\"EPSG:5973\")\n\n\nReading layer `map_2017_uned' from data source \n  `/Users/ag/Dev/QQ_MSB205/spatmetrics/data/map_2017_uned.gpkg' \n  using driver `GPKG'\nSimple feature collection with 432 features and 1 field\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744\nProjected CRS: ETRS89 / UTM zone 33N"
  },
  {
    "objectID": "spatmetrics/data/index.html#get-knr-and-knavn-from-local-file",
    "href": "spatmetrics/data/index.html#get-knr-and-knavn-from-local-file",
    "title": "Get ssb data",
    "section": "Get knr and kNavn from local file",
    "text": "Get knr and kNavn from local file\nWe want the Norwegian names, hence we have to adjust the municipality names for Vetsfold 2017.\n\n\nCode\nload(\"bld06_19.Rdata\")\n\nknr_and_knavn <- bld90_19 %>% \n  select(knrNavn) %>% \n  unique() %>%\n  # separate at the space after last digit\n  separate(col = knrNavn, into = c(\"knr\", \"kNavn\"), sep=\"\\\\s\", extra = \"merge\") %>% \n  filter(!knr %in% c(\"0712\", \"0715\", \"0729\")) %>% \n  bind_rows(\n    c(knr = \"0702\", kNavn = \"Holmestrand\"),\n    c(knr = \"0709\", kNavn = \"Larvik\"),\n    c(knr = \"0714\", kNavn = \"Hof\"),\n    c(knr = \"0722\", kNavn = \"Nøtterøy\"),\n    c(knr = \"0723\", kNavn = \"Tjøme\"),\n    c(knr = \"0728\", kNavn = \"Lardal\")\n  )\n\n\n\n\nCode\n# View(knr_and_knavn)"
  },
  {
    "objectID": "spatmetrics/data/index.html#get-ssb-data-via-api",
    "href": "spatmetrics/data/index.html#get-ssb-data-via-api",
    "title": "Get ssb data",
    "section": "Get SSB data via api",
    "text": "Get SSB data via api\n\nGet data registered on the municipality level from SSB\n\none trick to get a list of all these municipality tables is to search at SSB for (K) and then click on Statistikkbanken in the left column.\n\nWe will use the SSB api exposed through the PxWebApiData R package.\n\nThis API can also be used against most Nordic SSB sister organisations.\n\nSince we have a list of the relevant municipalities for 2017 (map_2017$knr) we can restrict our api request to just these.\nWe are just going to use some of these variables in the following example\n\nThe other variables serves as examples and some might be used in further analysis.\n\nThere is still plenty of relevant data at SSB\n\nQuite trivial to get access to these using the techniques shown below.\n\nOur new dataset use pm2 for 2017 to avoid the big changes in Trøndelag 1.1 2018."
  },
  {
    "objectID": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd",
    "href": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd",
    "title": "Get ssb data",
    "section": "Mean price per sqr. meter for SFD",
    "text": "Mean price per sqr. meter for SFD\n\nmean price per square meter in single family dwellings in each municipality (426)\n\n\n\n\nCode\npm2_2017 <- ApiData(\n    urlToData = \"06035\",\n    Region = map_2017$knr,\n    Boligtype = \"01\",\n    Tid = \"2017\"\n)\n\n\n\nPick element 2, dataset, in list returned\n\n\n\n\n\nCode\npm2_2017 <- pm2_2017$dataset"
  },
  {
    "objectID": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.",
    "href": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.",
    "title": "Get ssb data",
    "section": "Mean price per sqr. meter for SFD cont.",
    "text": "Mean price per sqr. meter for SFD cont.\n\nMake it tidy\n\n\n\n\nCode\n# Work on it to get it tidy\npm2_2017 <- pm2_2017 %>% \n  select(-Boligtype, -Tid) %>% \n  rename(\n    knr = Region\n  ) %>% \n  pivot_wider(\n    id_cols = knr, \n    names_from = \"ContentsCode\", \n    values_from = \"value\"\n    ) %>% \n  rename(\n    pm2 = KvPris,\n    num_dwelling_sales = Omsetninger \n  )\n\n\n\nWe are tidy!\n\n\n\n\n\nCode\ndim(pm2_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.-1",
    "href": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.-1",
    "title": "Get ssb data",
    "section": "Mean price per sqr. meter for SFD cont.",
    "text": "Mean price per sqr. meter for SFD cont.\n\nFill in for missing 2017\nGet average price per sqr. meter for single family dwellings (SFD) in each municipality (426)\n\n\n\n\nCode\n# 139 missing values. \n# Try other years for these\npm2_missing <- pm2_2017 %>% \n  filter(is.na(pm2)) %>% \n  select(knr)\n\n# Get data for the years 2010:2016 and 2018\npm2_15to18 <- ApiData(\n    urlToData = \"06035\",\n    Region = pm2_missing$knr,\n    Boligtype = \"01\",\n    Tid = c(as.character(2010:2016), \"2018\")\n)"
  },
  {
    "objectID": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.-2",
    "href": "spatmetrics/data/index.html#mean-price-per-sqr.-meter-for-sfd-cont.-2",
    "title": "Get ssb data",
    "section": "Mean price per sqr. meter for SFD cont.",
    "text": "Mean price per sqr. meter for SFD cont.\n\n\n\n\nCode\n# Bad name, pm2_15to18 has data fram 2010 to 2016 and 2018\n# Note tmp is not tidy, 8 obs. per row\ntmp <- pm2_15to18$dataset %>% \n  select(-Boligtype) %>% \n  rename(knr = Region) %>% \n  pivot_wider(\n    id_cols = knr,\n    names_from = c(\"ContentsCode\", \"Tid\"),\n    values_from = \"value\"\n    ) %>% \n  mutate(\n    pm2 = rowMeans(\n      select(\n        .data = .,\n        KvPris_2010:KvPris_2018\n        ), \n# calculate mean of existing values\n      na.rm = TRUE\n      ),\n    num_dwelling_sales = rowMeans(\n      select(\n        .data = .,\n        Omsetninger_2010:Omsetninger_2018\n        ),\n      na.rm = TRUE\n      )\n    ) %>%\n  select(knr, pm2, num_dwelling_sales)\n\n\n\n\n\nCode\n    # Very crude, we just take the mean of existing values\n    pm2_2017 <- pm2_2017 %>% \n    # add new values from tmp to pm2_2017  \n      left_join(tmp, by = \"knr\") %>% \n      mutate(\n        pm2 = if_else(\n          is.na(pm2.x), \n          as.integer(pm2.y), \n          pm2.x),\n        num_dwelling_sales =  if_else(\n          is.na(pm2.x), \n          as.integer(num_dwelling_sales.y), \n          num_dwelling_sales.x\n          )\n        ) %>% \n      select(knr, pm2, num_dwelling_sales)\n\n\n\n\nCode\nsummary(pm2_2017$pm2)\n\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n   5317   13213   16731   18177   21300   57525      95"
  },
  {
    "objectID": "spatmetrics/data/index.html#population",
    "href": "spatmetrics/data/index.html#population",
    "title": "Get ssb data",
    "section": "Population",
    "text": "Population\n\nStart by getting metadata for the table 07459\n\n\n\n\n\n\nCode\nmetadata_07459 <- ApiData(\n  \"http://data.ssb.no/api/v0/en/table/07459\",\n  returnMetaFrames = TRUE\n  )\n\n\n\n\n\nCode\nprint(head(str(metadata_07459), n = 20))\n\n\nList of 5\n $ Region      :'data.frame':   856 obs. of  2 variables:\n  ..$ values    : chr [1:856] \"0\" \"30\" \"01\" \"3001\" ...\n  ..$ valueTexts: chr [1:856] \"The whole country\" \"Viken\" \"Østfold (-2019)\" \"Halden\" ...\n $ Kjonn       :'data.frame':   2 obs. of  2 variables:\n  ..$ values    : chr [1:2] \"1\" \"2\"\n  ..$ valueTexts: chr [1:2] \"Males\" \"Females\"\n $ Alder       :'data.frame':   106 obs. of  2 variables:\n  ..$ values    : chr [1:106] \"000\" \"001\" \"002\" \"003\" ...\n  ..$ valueTexts: chr [1:106] \"0 years\" \"1 year\" \"2 years\" \"3 years\" ...\n $ ContentsCode:'data.frame':   1 obs. of  2 variables:\n  ..$ values    : chr \"Personer1\"\n  ..$ valueTexts: chr \"Persons\"\n $ Tid         :'data.frame':   37 obs. of  2 variables:\n  ..$ values    : chr [1:37] \"1986\" \"1987\" \"1988\" \"1989\" ...\n  ..$ valueTexts: chr [1:37] \"1986\" \"1987\" \"1988\" \"1989\" ...\n - attr(*, \"text\")= Named chr [1:5] \"region\" \"sex\" \"age\" \"contents\" ...\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Kjonn\" \"Alder\" \"ContentsCode\" ...\n - attr(*, \"elimination\")= Named logi [1:5] TRUE TRUE TRUE FALSE FALSE\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Kjonn\" \"Alder\" \"ContentsCode\" ...\n - attr(*, \"time\")= Named logi [1:5] FALSE FALSE FALSE FALSE TRUE\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Kjonn\" \"Alder\" \"ContentsCode\" ...\nNULL"
  },
  {
    "objectID": "spatmetrics/data/index.html#population-cont.",
    "href": "spatmetrics/data/index.html#population-cont.",
    "title": "Get ssb data",
    "section": "Population cont.",
    "text": "Population cont.\n\nAPI query\n\n\n\n\n\n\nCode\n#Get more info about table\napi_query <- ApiData(\n\"http://data.ssb.no/api/v0/en/table/07459\",\nreturnApiQuery = TRUE\n) \n\n\n\n\n\nCode\nprint(api_query)\n\n\n{\n  \"query\": [\n    {\n      \"code\": \"Region\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"0\", \"99\", \"9999\"]\n      }\n    },\n    {\n      \"code\": \"Kjonn\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"1\", \"2\"]\n      }\n    },\n    {\n      \"code\": \"Alder\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"000\", \"104\", \"105+\"]\n      }\n    },\n    {\n      \"code\": \"ContentsCode\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"Personer1\"]\n      }\n    },\n    {\n      \"code\": \"Tid\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"1986\", \"2021\", \"2022\"]\n      }\n    }\n  ],\n  \"response\": {\n    \"format\": \"json-stat\"\n  }\n}"
  },
  {
    "objectID": "spatmetrics/data/index.html#population-cont.-1",
    "href": "spatmetrics/data/index.html#population-cont.-1",
    "title": "Get ssb data",
    "section": "Population cont.",
    "text": "Population cont.\n\nPopulation, three categories 0-19, 20-64 and 65+\n\n\n\n\n\n\nCode\n# Kjonn = FALSE, aggregate F+M\n# The F in \"F0-19\" DOES NOT indicate Female\nbef_2017 <- ApiData(\n    urlToData = \"07459\",\n# Pick data for the municipallities we have in our map \n    Region = map_2017$knr,\n    Alder = list(\"agg:TredeltGrupperingB2\", \n                 c(\"F0-19\", \"F20-64\", \"F65+\")),\n    Kjonn = FALSE,\n    Tid = \"2017\"\n)\n\n\n\n\nCode\n# list with 2 elements, we want dataset\nbef_2017 <- bef_2017$dataset\n\n\n\n\n\nCode\n# print function used to get console \n# output in slides\nprint(head(bef_2017, n = 4))\n\n\n  Region  Alder ContentsCode  Tid value\n1   0101  F0-19    Personer1 2017  7033\n2   0101 F20-64    Personer1 2017 17828\n3   0101   F65+    Personer1 2017  5929\n4   0104  F0-19    Personer1 2017  7453\n\n\n\n\nCode\nbef_2017 <- bef_2017 %>% \n  select(Region, Alder, value) %>% \n  rename(\n    alder = Alder,\n    knr = Region,\n    bef = value,\n  )"
  },
  {
    "objectID": "spatmetrics/data/index.html#population-cont.-2",
    "href": "spatmetrics/data/index.html#population-cont.-2",
    "title": "Get ssb data",
    "section": "Population cont.",
    "text": "Population cont.\n\n\n\n\nCode\nbef_2017 <- bef_2017 %>% \n  pivot_wider(id_cols = knr, names_from = \"alder\", values_from = \"bef\") %>% \n  # rename variables\n  rename(\n    pop_0_19 = `F0-19`,\n    pop_20_64 = `F20-64`,\n    pop_65p = `F65+`\n    ) %>% \n  # Calculate tot. pop.\n  mutate(tot_pop = pop_0_19 + pop_20_64 + pop_65p)\n\n\n\n\n\nCode\n# we are tidy\nprint(head(bef_2017, n = 5))\n\n\n# A tibble: 5 × 5\n  knr   pop_0_19 pop_20_64 pop_65p tot_pop\n  <chr>    <int>     <int>   <int>   <int>\n1 0101      7033     17828    5929   30790\n2 0104      7453     18688    6266   32407\n3 0105     13227     31829   10071   55127\n4 0106     18728     46969   14424   80121\n5 0111       882      2533    1102    4517\n\n\n\n\nCode\n# we are tidy\ndim(bef_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#education-level-percentage-each-level",
    "href": "spatmetrics/data/index.html#education-level-percentage-each-level",
    "title": "Get ssb data",
    "section": "Education level (percentage each level)",
    "text": "Education level (percentage each level)\n\nMetadata\n\n\n\n\n\n\nCode\n#Get metadata\nmetadata_09429 <- ApiData(\n  urlToData = \"http://data.ssb.no/api/v0/no/table/09429\",  \n  returnMetaFrames = TRUE\n  )\nstr(metadata_09429)\n\n\n\n\n\nList of 5\n $ Region      :'data.frame':   857 obs. of  2 variables:\n  ..$ values    : chr [1:857] \"0\" \"30\" \"01\" \"3001\" ...\n  ..$ valueTexts: chr [1:857] \"Hele landet\" \"Viken\" \"Østfold (-2019)\" \"Halden\" ...\n $ Nivaa       :'data.frame':   7 obs. of  2 variables:\n  ..$ values    : chr [1:7] \"00\" \"01\" \"02a\" \"11\" ...\n  ..$ valueTexts: chr [1:7] \"Utdanningsnivå i alt\" \"Grunnskolenivå\" \"Videregående skolenivå\" \"Fagskolenivå\" ...\n $ Kjonn       :'data.frame':   3 obs. of  2 variables:\n  ..$ values    : chr [1:3] \"0\" \"1\" \"2\"\n  ..$ valueTexts: chr [1:3] \"Begge kjønn\" \"Menn\" \"Kvinner\"\n $ ContentsCode:'data.frame':   2 obs. of  2 variables:\n  ..$ values    : chr [1:2] \"Personer\" \"PersonerProsent\"\n  ..$ valueTexts: chr [1:2] \"Personer 16 år og over\" \"Personer 16 år og over (prosent)\"\n $ Tid         :'data.frame':   43 obs. of  2 variables:\n  ..$ values    : chr [1:43] \"1970\" \"1980\" \"1981\" \"1982\" ...\n  ..$ valueTexts: chr [1:43] \"1970\" \"1980\" \"1981\" \"1982\" ...\n - attr(*, \"text\")= Named chr [1:5] \"region\" \"nivå\" \"kjønn\" \"statistikkvariabel\" ...\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Nivaa\" \"Kjonn\" \"ContentsCode\" ...\n - attr(*, \"elimination\")= Named logi [1:5] TRUE TRUE TRUE FALSE FALSE\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Nivaa\" \"Kjonn\" \"ContentsCode\" ...\n - attr(*, \"time\")= Named logi [1:5] FALSE FALSE FALSE FALSE TRUE\n  ..- attr(*, \"names\")= chr [1:5] \"Region\" \"Nivaa\" \"Kjonn\" \"ContentsCode\" ..."
  },
  {
    "objectID": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.",
    "href": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.",
    "title": "Get ssb data",
    "section": "Education level (percentage each level) cont.",
    "text": "Education level (percentage each level) cont.\n\nApi Query\n\n\n\n\n\n\nCode\n#Get more info about table\napi_query_09429 <- ApiData(\n\"http://data.ssb.no/api/v0/en/table/09429\",\nreturnApiQuery = TRUE)\n\nprint(api_query_09429)\n\n\n\n\n\n{\n  \"query\": [\n    {\n      \"code\": \"Region\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"0\", \"99\", \"9999\"]\n      }\n    },\n    {\n      \"code\": \"Nivaa\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"00\", \"04a\", \"09a\"]\n      }\n    },\n    {\n      \"code\": \"Kjonn\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"0\", \"1\", \"2\"]\n      }\n    },\n    {\n      \"code\": \"ContentsCode\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"Personer\", \"PersonerProsent\"]\n      }\n    },\n    {\n      \"code\": \"Tid\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"1970\", \"2020\", \"2021\"]\n      }\n    }\n  ],\n  \"response\": {\n    \"format\": \"json-stat\"\n  }\n}"
  },
  {
    "objectID": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.-1",
    "href": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.-1",
    "title": "Get ssb data",
    "section": "Education level (percentage each level) cont.",
    "text": "Education level (percentage each level) cont.\n\n\n\n\nCode\n# Get data from SSB\nedu_2017 <- ApiData(\n    urlToData = \"09429\",\n    # we want in percent\n    ContentsCode = \"PersonerProsent\",\n    Region = map_2017$knr,\n    # Drop \"00\" since total, \n    # 100%, also drop \"09a\" Uoppgit\n    Nivaa = c(\"01\", \"02a\", \n              \"11\", \"03a\", \"04a\"),\n    Kjonn = FALSE,\n    Tid = \"2017\"\n)\n\n\n\n\nCode\n# Pick the needed variables\nedu_2017 <- tibble(\n  # want knr\n  knr = edu_2017$dataset$Region , \n  # want level descriptions, not code\n  nivaa = edu_2017$`09429: Personer 16 år og over, etter region, nivå, statistikkvariabel og år`$nivå,\n  edu_lev_percent = edu_2017$dataset$value\n  )\n\n\n\n\n\nCode\n# Have a look at it\nprint(head(edu_2017, n=7))\n\n\n# A tibble: 7 × 3\n  knr   nivaa                               edu_lev_percent\n  <chr> <chr>                                         <dbl>\n1 0101  Grunnskolenivå                                 30.7\n2 0101  Videregående skolenivå                         39.8\n3 0101  Fagskolenivå                                    2.3\n4 0101  Universitets- og høgskolenivå, kort            21.6\n5 0101  Universitets- og høgskolenivå, lang             5.6\n6 0104  Grunnskolenivå                                 29.8\n7 0104  Videregående skolenivå                         37.6"
  },
  {
    "objectID": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.-2",
    "href": "spatmetrics/data/index.html#education-level-percentage-each-level-cont.-2",
    "title": "Get ssb data",
    "section": "Education level (percentage each level) cont.",
    "text": "Education level (percentage each level) cont.\n\n\n\n\nCode\n#make tidy\nedu_2017 <- edu_2017 %>% \n   pivot_wider(\n     id_cols = knr, \n     names_from = \"nivaa\", \n     values_from = \"edu_lev_percent\"\n     ) %>% \n  rename(\n    edu_prim = `Grunnskolenivå`,\n    edu_sec = `Videregående skolenivå`,\n    edu_voc = `Fagskolenivå`,\n    edu_uni_short = `Universitets- og høgskolenivå, kort`,\n    edu_uni_long = `Universitets- og høgskolenivå, lang`\n  )\n\n\n\n\n\nCode\n# Tidy OK\nprint(head(edu_2017, n = 5))\n\n\n# A tibble: 5 × 6\n  knr   edu_prim edu_sec edu_voc edu_uni_short edu_uni_long\n  <chr>    <dbl>   <dbl>   <dbl>         <dbl>        <dbl>\n1 0101      30.7    39.8     2.3          21.6          5.6\n2 0104      29.8    37.6     2.5          21.8          8.3\n3 0105      33.2    40.2     2.5          19.9          4.2\n4 0106      29.8    38.6     2.6          22.6          6.3\n5 0111      25.7    42       3.3          21.9          7.1\n\n\n\n\nCode\ndim(edu_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income",
    "href": "spatmetrics/data/index.html#household-income",
    "title": "Get ssb data",
    "section": "Household income",
    "text": "Household income\n\n\n\n\nCode\n# Get metadata \nmetadata_07183 <- ApiData(\n  urlToData = \"http://data.ssb.no/api/v0/no/table/07183\",\n  returnMetaFrames = TRUE\n  )\n\nprint(str(metadata_07183))\n\n\n\n\n\nList of 3\n $ Region      :'data.frame':   822 obs. of  2 variables:\n  ..$ values    : chr [1:822] \"3001\" \"3002\" \"3003\" \"3004\" ...\n  ..$ valueTexts: chr [1:822] \"Halden\" \"Moss\" \"Sarpsborg\" \"Fredrikstad\" ...\n $ ContentsCode:'data.frame':   8 obs. of  2 variables:\n  ..$ values    : chr [1:8] \"Hushold\" \"Inntekt1\" \"Inntekt2\" \"Inntekt3\" ...\n  ..$ valueTexts: chr [1:8] \"Antall husholdninger\" \"Samlet inntekt under 150 000 kr, prosent\" \"Samlet inntekt 150 000 - 249 999 kr, prosent\" \"Samlet inntekt  250 000 - 349 999 kr, prosent\" ...\n $ Tid         :'data.frame':   15 obs. of  2 variables:\n  ..$ values    : chr [1:15] \"2006\" \"2007\" \"2008\" \"2009\" ...\n  ..$ valueTexts: chr [1:15] \"2006\" \"2007\" \"2008\" \"2009\" ...\n - attr(*, \"text\")= Named chr [1:3] \"region\" \"statistikkvariabel\" \"år\"\n  ..- attr(*, \"names\")= chr [1:3] \"Region\" \"ContentsCode\" \"Tid\"\n - attr(*, \"elimination\")= Named logi [1:3] FALSE FALSE FALSE\n  ..- attr(*, \"names\")= chr [1:3] \"Region\" \"ContentsCode\" \"Tid\"\n - attr(*, \"time\")= Named logi [1:3] FALSE FALSE TRUE\n  ..- attr(*, \"names\")= chr [1:3] \"Region\" \"ContentsCode\" \"Tid\"\nNULL"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-cont.",
    "href": "spatmetrics/data/index.html#household-income-cont.",
    "title": "Get ssb data",
    "section": "Household income cont.",
    "text": "Household income cont.\n\n\n\n\nCode\n#Get more info about table\napi_query_07183 <- ApiData(\n\"http://data.ssb.no/api/v0/en/table/07183\",\nreturnApiQuery = TRUE)\n\nprint(api_query_07183)\n\n\n\n\n\n{\n  \"query\": [\n    {\n      \"code\": \"Region\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"3001\", \"2599\", \"9999\"]\n      }\n    },\n    {\n      \"code\": \"ContentsCode\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"Hushold\", \"Inntekt6\", \"Inntekt7\"]\n      }\n    },\n    {\n      \"code\": \"Tid\",\n      \"selection\": {\n        \"filter\": \"item\",\n        \"values\": [\"2006\", \"2019\", \"2020\"]\n      }\n    }\n  ],\n  \"response\": {\n    \"format\": \"json-stat\"\n  }\n}"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-cont.-1",
    "href": "spatmetrics/data/index.html#household-income-cont.-1",
    "title": "Get ssb data",
    "section": "Household income cont.",
    "text": "Household income cont.\n\n\n\n\nCode\ninc_2017 <- ApiData(\n    urlToData = \"07183\",\n    # \"Hushold\" would \n    # also get us \n    # total number of\n    # households in muni\n    ContentsCode = c(\n      paste(\n        \"Inntekt\", \n        seq(\n          from = 1, \n          to = 7), \n        sep = \"\"\n        )\n      ),\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\n\n\n\n\nCode\nprint(head(\n  inc_2017$`07183: Husholdninger, etter region, statistikkvariabel og år`, \n  n=9\n  ))\n\n\n          region                            statistikkvariabel   år value\n1 Halden (-2019)      Samlet inntekt under 150 000 kr, prosent 2017     3\n2 Halden (-2019)  Samlet inntekt 150 000 - 249 999 kr, prosent 2017     9\n3 Halden (-2019) Samlet inntekt  250 000 - 349 999 kr, prosent 2017    13\n4 Halden (-2019) Samlet inntekt  350 000 - 449 999 kr, prosent 2017    12\n5 Halden (-2019) Samlet inntekt  450 000 - 549 999 kr, prosent 2017    11\n6 Halden (-2019) Samlet inntekt  550 000 - 749 999 kr, prosent 2017    17\n7 Halden (-2019)    Samlet inntekt 750 000 kr og over, prosent 2017    37\n8   Moss (-2019)      Samlet inntekt under 150 000 kr, prosent 2017     3\n9   Moss (-2019)  Samlet inntekt 150 000 - 249 999 kr, prosent 2017     8\n  NAstatus\n1     <NA>\n2     <NA>\n3     <NA>\n4     <NA>\n5     <NA>\n6     <NA>\n7     <NA>\n8     <NA>\n9     <NA>"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-cont.-2",
    "href": "spatmetrics/data/index.html#household-income-cont.-2",
    "title": "Get ssb data",
    "section": "Household income cont.",
    "text": "Household income cont.\n\n\n\n\nCode\ninc_2017 <- tibble(\n  # want knr\n  knr = inc_2017$dataset$Region , \n  # want level descriptions, not code\n  inc_cat = inc_2017$`07183: Husholdninger, etter region, statistikkvariabel og år`$statistikkvariabel,\n  inc_lev_percent = inc_2017$dataset$value\n)\n\n\n\n\n\nCode\ninc_2017 <- inc_2017 %>% \n  pivot_wider(\n     id_cols = knr, \n     names_from = \"inc_cat\", \n     values_from = \"inc_lev_percent\"\n     ) %>% \n  rename(\n    # Some problem with names here, had to do names(inc_2017) above and \n    # then copy the text strings\n    inc_0_150 = `Samlet inntekt under 150 000 kr, prosent`,\n    inc_150_250 = `Samlet inntekt 150 000 - 249 999 kr, prosent`,\n    inc_250_350 = `Samlet inntekt  250 000 - 349 999 kr, prosent`,\n    inc_350_450 = `Samlet inntekt  350 000 - 449 999 kr, prosent`,\n    inc_450_550 = `Samlet inntekt  450 000 - 549 999 kr, prosent`,\n    inc_550_750 = `Samlet inntekt  550 000 - 749 999 kr, prosent`,\n    inc_750k_p = `Samlet inntekt 750 000 kr og over, prosent`\n  )\n\n\n\n\nCode\ndim(inc_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-cont.-3",
    "href": "spatmetrics/data/index.html#household-income-cont.-3",
    "title": "Get ssb data",
    "section": "Household income cont.",
    "text": "Household income cont.\n\n\nCode\n# we are tidy\nprint(head(inc_2017, n = 7))\n\n\n# A tibble: 7 × 8\n  knr   inc_0_150 inc_150_250 inc_250_350 inc_350_450 inc_450_…¹ inc_5…² inc_7…³\n  <chr>     <int>       <int>       <int>       <int>      <int>   <int>   <int>\n1 0101          3           9          13          12         11      17      37\n2 0104          3           8          13          12         11      17      36\n3 0105          2           9          13          11         11      17      37\n4 0106          2           9          12          10         11      16      39\n5 0111          1           6           9           9         10      18      46\n6 0118          3           7          13           9         11      17      40\n7 0119          2           9          14          12         10      17      36\n# … with abbreviated variable names ¹​inc_450_550, ²​inc_550_750, ³​inc_750k_p"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-net-capital-wealth",
    "href": "spatmetrics/data/index.html#household-net-capital-wealth",
    "title": "Get ssb data",
    "section": "Household net capital (wealth)",
    "text": "Household net capital (wealth)\n\n\n\n\nCode\nwealth_2017_ssb <- ApiData(\n    urlToData = \"10320\",\n    # \"Hushold\" would also get us \n    # total number of households in muni\n    ContentsCode = c(\"Hushald (prosent)\"),\n    Nettoform = c(\"12\", \"13\", \"10\", \n                  \"25\", \"31\", \"11\", \"32\"\n                  ),\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\n\n\n\n\nCode\nwealth_2017 <- wealth_2017_ssb$dataset %>% \n  tibble() %>% \n  select(-ContentsCode, -Tid) %>% \n  rename(\n    knr = Region,\n    net_cap = Nettoform,\n    cap_lev_percent = value) %>% \n  pivot_wider(\n     id_cols = knr, \n     names_from = \"net_cap\", \n     values_from = \"cap_lev_percent\"\n     ) %>% \n  rename(\n    net_cap_0_250k = `12`,\n    net_cap_250k_500k = `13`,\n    net_cap_500k_1000k = `10`,\n    net_cap_1000k_2000k = `25`,\n    net_cap_2000k_3000k = `31`,\n    net_cap_3000k_4000k = `11`,\n    net_cap_4000k_p = `32`,\n  )"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-net-capital-wealth-1",
    "href": "spatmetrics/data/index.html#household-net-capital-wealth-1",
    "title": "Get ssb data",
    "section": "Household net capital (wealth)",
    "text": "Household net capital (wealth)\n\n\nCode\n# we are tidy\nprint(head(wealth_2017, n = 6))\n\n\n# A tibble: 6 × 8\n  knr   net_cap_0_250k net_cap_250k_500k net_c…¹ net_c…² net_c…³ net_c…⁴ net_c…⁵\n  <chr>          <dbl>             <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>\n1 0101            31.6               5.1    10.1    19.6    13.4     8.6    11.5\n2 0104            28.7               4.1     8      17.5    15       9.7    16.9\n3 0105            27.7               4.5     9.5    19.2    15.6    10.1    13.4\n4 0106            28.8               4.3     8.1    17.6    15.7    10.4    15  \n5 0111            18.4               3.1     5.3    12.7    14      14.7    31.9\n6 0118            30.7               5.6    12.2    19.1    14.3     7.4    10.6\n# … with abbreviated variable names ¹​net_cap_500k_1000k, ²​net_cap_1000k_2000k,\n#   ³​net_cap_2000k_3000k, ⁴​net_cap_3000k_4000k, ⁵​net_cap_4000k_p\n\n\n\n\nCode\ndim(wealth_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#employed-by-government",
    "href": "spatmetrics/data/index.html#employed-by-government",
    "title": "Get ssb data",
    "section": "Employed by government",
    "text": "Employed by government\n\n\n\n\nCode\n# Get vdata from SSB\ngov_emp_2017 <- ApiData(\n    urlToData = \"12628\",\n    # total num.of gov. emp. \n    # in each muni\n    StatligEnhet = \"0\",\n    # in yearly eq.\n    ContentsCode = \"AvtalteArsverk\",\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\n\n\n\n\nCode\n# Select wanted variables\ngov_emp_2017 <- gov_emp_2017$dataset %>% \n  select(Region, value) %>% \n  rename(\n    knr = Region,\n    gov_emp = value\n  )"
  },
  {
    "objectID": "spatmetrics/data/index.html#employed-by-government-1",
    "href": "spatmetrics/data/index.html#employed-by-government-1",
    "title": "Get ssb data",
    "section": "Employed by government",
    "text": "Employed by government\n\n\nCode\n#we are tidy\nprint(head(gov_emp_2017, n = 15))\n\n\n    knr gov_emp\n1  0101     997\n2  0104     615\n3  0105    1096\n4  0106     742\n5  0111      18\n6  0118       3\n7  0119      67\n8  0121       1\n9  0122     142\n10 0123      12\n11 0124     101\n12 0125      48\n13 0127       4\n14 0128      17\n15 0135      58\n\n\n\n\nCode\ndim(gov_emp_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#wholesale-and-retail-trade-sales",
    "href": "spatmetrics/data/index.html#wholesale-and-retail-trade-sales",
    "title": "Get ssb data",
    "section": "Wholesale and retail trade sales",
    "text": "Wholesale and retail trade sales\n\n\n\n\nCode\nsales_per_capita_2017  <- ApiData(\n    urlToData = \"04776\",\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\nsales_per_capita_2017  <- \n  sales_per_capita_2017$dataset %>%  \n  select(Region, value) %>% \n  # spc sales per capita\n  rename(\n    knr = Region,\n    spc = value\n  )\n\n\n\n\n\nCode\n# we are tidy\nprint(head(sales_per_capita_2017))\n\n\n   knr   spc\n1 0101 65919\n2 0104 77498\n3 0105 69540\n4 0106 80019\n5 0111 96079\n6 0118 19794\n\n\n\n\nCode\ndim(sales_per_capita_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-before-and-after-tax-in-decile-percent",
    "href": "spatmetrics/data/index.html#household-income-before-and-after-tax-in-decile-percent",
    "title": "Get ssb data",
    "section": "Household income before and after tax in decile (percent)",
    "text": "Household income before and after tax in decile (percent)\n\nPercent relative to national decile.\n\n\n\n\n\n\nCode\ninc_dec_2017 <- ApiData(\n    urlToData = \"12558\",\n    ContentsCode = \"AndelHush\",\n    Desiler = c(paste(0, 1:9, sep = \"\"), \"10\"),\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\ninc_dec_2017 <- tibble(\n  # want knr\n  knr = inc_dec_2017$dataset$Region , \n  # want level descriptions, not code\n  tax = inc_dec_2017$`12558: Husholdninger, etter region, inntekt før/etter skatt, desil, statistikkvariabel og år`$`inntekt før/etter skatt`,\n  decile = inc_dec_2017$dataset$Desiler,\n  percent = inc_dec_2017$dataset$value\n  )\n\n\n\n\n\nCode\ninc_dec_2017 <- inc_dec_2017 %>% \n  mutate(\n    tax = case_when(\n      # income before and after tax\n      tax == \"Samlet inntekt\" ~ \"inc_bt\",\n      tax == \"Inntekt etter skatt\" ~ \"inc_at\",\n      TRUE ~ as.character(tax)\n    )\n  ) %>%\n  pivot_wider(\n     id_cols = knr, \n     names_from = c(\"tax\", \"decile\"), \n     values_from = \"percent\"\n     )"
  },
  {
    "objectID": "spatmetrics/data/index.html#household-income-before-and-after-tax-in-decile-percent-cont.",
    "href": "spatmetrics/data/index.html#household-income-before-and-after-tax-in-decile-percent-cont.",
    "title": "Get ssb data",
    "section": "Household income before and after tax in decile (percent) cont.",
    "text": "Household income before and after tax in decile (percent) cont.\n\n\nCode\n# we are tidy\nprint(head(inc_dec_2017))\n\n\n# A tibble: 6 × 21\n  knr   inc_bt…¹ inc_b…² inc_b…³ inc_b…⁴ inc_b…⁵ inc_b…⁶ inc_b…⁷ inc_b…⁸ inc_b…⁹\n  <chr>    <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>   <dbl>\n1 0101      11.7    12      11.3    10.4    10.5    10.5    10       9.7     8.3\n2 0104      10.7    12.2    11.5    11.3    10.4    10.3     9.1     8.6     8.4\n3 0105      10.8    12      10.5    11      10.6    10.6    10.5    10.1     7.9\n4 0106      10.7    11.4    10.2    10.8    10.3    10.2    10.1     9.7     9.1\n5 0111       7.5     8.3     9.4     9.2    10.8    11.6    10.6    11.5    10.3\n6 0118       9.6    11.9     9      10.1    11.3    11.3    11.9    10.6     7.9\n# … with 11 more variables: inc_bt_10 <dbl>, inc_at_01 <dbl>, inc_at_02 <dbl>,\n#   inc_at_03 <dbl>, inc_at_04 <dbl>, inc_at_05 <dbl>, inc_at_06 <dbl>,\n#   inc_at_07 <dbl>, inc_at_08 <dbl>, inc_at_09 <dbl>, inc_at_10 <dbl>, and\n#   abbreviated variable names ¹​inc_bt_01, ²​inc_bt_02, ³​inc_bt_03, ⁴​inc_bt_04,\n#   ⁵​inc_bt_05, ⁶​inc_bt_06, ⁷​inc_bt_07, ⁸​inc_bt_08, ⁹​inc_bt_09\n\n\n\n\nCode\ndim(inc_dec_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#industries",
    "href": "spatmetrics/data/index.html#industries",
    "title": "Get ssb data",
    "section": "Industries",
    "text": "Industries\n\n\n\n\nCode\nnum_emp_2017_ssb <- ApiData(\n    urlToData = \"07196\",\n    OrgFormer = c(\"99\",\"02\",\"03\",\"04\",\"10\",\"24\"),\n    AntAnsatte = c(\"99\", \"00\", \"01\",\"02\",\"03\",\"04\",\"05\",\"15\",\"16\"),\n    NACE2007 = c(\"01-99\"),\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n#so that we keep the ssb data\nnum_emp_2017 <- num_emp_2017_ssb$`07196: Foretak (1.1.) unntatt offentlig forvaltning og primærnæringene, etter region, organisasjonsform, næring (SN2007), antall ansatte, statistikkvariabel og år`\nnum_emp_2017$knr <- num_emp_2017_ssb$dataset$Region\n\n\n\n\n\nCode\nnum_emp_2017 <- num_emp_2017 %>% \n  # drop two variables\n  select(-region, -statistikkvariabel, -år, -`næring (SN2007)`) %>% \n  # want knr to the left, really not necessary \n  select(knr,everything()) %>% \n  # rename before pivot to names liked by R\n  rename(\n    org_form = organisasjonsform,\n    num_emp_group = `antall ansatte`,\n    firms = value\n  )\n\nnum_emp_2017 <-  num_emp_2017 %>% \n  pivot_wider(\n     id_cols = knr, \n     names_from = c(\"org_form\", \"num_emp_group\"), \n     values_from = \"firms\"\n     )"
  },
  {
    "objectID": "spatmetrics/data/index.html#industries-cont.",
    "href": "spatmetrics/data/index.html#industries-cont.",
    "title": "Get ssb data",
    "section": "Industries cont.",
    "text": "Industries cont.\n\n\nCode\n# we are tidy\nprint(head(num_emp_2017))\n\n\n# A tibble: 6 × 55\n  knr   I alt_…¹ I alt…² I alt…³ I alt…⁴ I alt…⁵ I alt…⁶ I alt…⁷ I alt…⁸ I alt…⁹\n  <chr>    <int>   <int>   <int>   <int>   <int>   <int>   <int>   <int>   <int>\n1 0101      2098    1407     414     142      82      40       8       3       2\n2 0104      2550    1698     534     153      87      55      11      11       1\n3 0105      3564    2255     782     261     161      69      19      14       3\n4 0106      6035    3994    1251     384     231     119      32      19       5\n5 0111       429     306      87      25       8       3       0       0       0\n6 0118       114      88      18       5       3       0       0       0       0\n# … with 45 more variables: `Ansvarlig selskap_Alle størrelsesgrupper` <int>,\n#   `Ansvarlig selskap_Ingen ansatte` <int>,\n#   `Ansvarlig selskap_1-4 ansatte` <int>,\n#   `Ansvarlig selskap_5-9 ansatte` <int>,\n#   `Ansvarlig selskap_10-19 ansatte` <int>,\n#   `Ansvarlig selskap_20-49 ansatte` <int>,\n#   `Ansvarlig selskap_50-99 ansatte` <int>, …\n\n\n\n\nCode\ndim(num_emp_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#supply-of-single-family-dwellings-sfd",
    "href": "spatmetrics/data/index.html#supply-of-single-family-dwellings-sfd",
    "title": "Get ssb data",
    "section": "Supply of single family dwellings (SFD)",
    "text": "Supply of single family dwellings (SFD)\n\n\nCode\nsup_sfd_2017 <- ApiData(\n    urlToData = \"05940\",\n    Byggeareal = c(\"111\", \"112\"),\n    Region = map_2017$knr,\n    Tid = \"2017\"\n)\n\nsup_sfd_2017 <- sup_sfd_2017$`05940: Boligbygg, etter region, bygningstype, statistikkvariabel og år` %>% \n  as_tibble() %>% \n  mutate(region = sup_sfd_2017$dataset$Region) %>% \n  rename(knr = region) %>% \n  select(-år) %>% \n  unite(tmp, bygningstype, statistikkvariabel, sep = \"_\") %>% \n    pivot_wider(\n     id_cols = knr, \n     names_from = \"tmp\", \n     values_from = \"value\"\n     ) %>% \n  # sfd Single Family Dwelling\n  # We have to escape the old variable names because of the spaces \n  rename(\n    sfd_started = `Enebolig_Igangsatte boliger`,\n    sfd_ba_started = `Enebolig_Bruksareal igangsatte boliger (m²)`,\n    sfd_ba_completed = `Enebolig_Bruksareal fullførte boliger (m²)`,\n    # w2u with 2 units\n    sfd_w2u_started = `Enebolig med hybelleilighet, sokkelleilighet o.l._Igangsatte boliger`,\n    sfd_w2u_ba_started = `Enebolig med hybelleilighet, sokkelleilighet o.l._Bruksareal igangsatte boliger (m²)`,\n    sfd_w2u_ba_completed = `Enebolig med hybelleilighet, sokkelleilighet o.l._Bruksareal fullførte boliger (m²)`  \n    )"
  },
  {
    "objectID": "spatmetrics/data/index.html#supply-of-single-family-dwellings-sfd-cont.",
    "href": "spatmetrics/data/index.html#supply-of-single-family-dwellings-sfd-cont.",
    "title": "Get ssb data",
    "section": "Supply of single family dwellings (SFD) cont.",
    "text": "Supply of single family dwellings (SFD) cont.\n\n\nCode\n# we are tidy\nprint(head(sup_sfd_2017, n = 8))\n\n\n# A tibble: 8 × 7\n  knr   sfd_started sfd_ba_started sfd_ba_completed sfd_w2u_st…¹ sfd_w…² sfd_w…³\n  <chr>       <int>          <int>            <int>        <int>   <int>   <int>\n1 0101           69          11933             9014           20    1998    1907\n2 0104           20           4401             2879            2     325     291\n3 0105           27           7744            10480           14    1740    2139\n4 0106           80          15658            15084           20    2500    2236\n5 0111           18           3223             4013            0       0     303\n6 0118            0              0              338            0       0       0\n7 0119           10           1942             1526            0       0       0\n8 0121            1            156              156            0       0       0\n# … with abbreviated variable names ¹​sfd_w2u_started, ²​sfd_w2u_ba_started,\n#   ³​sfd_w2u_ba_completed\n\n\n\n\nCode\ndim(sup_sfd_2017)[1]\n\n\n[1] 426"
  },
  {
    "objectID": "spatmetrics/data/index.html#centrality-index",
    "href": "spatmetrics/data/index.html#centrality-index",
    "title": "Get ssb data",
    "section": "Centrality index",
    "text": "Centrality index\n\nFrom SSB, for the year 2018, but we use it for 2017. Probably very small changes from 2017 to 2018. Changed knr for Trøndelag to the old numbers. Split 5054 Indre Fosen into 1624 Rissa and 1718 Leksvik. The last two was given the same centrality as the combined entity.\n\n\n\n\nCode\ncentrality_2018_ed <- read_excel(\"Sentralitet 2018_ed.xlsx\")"
  },
  {
    "objectID": "spatmetrics/data/index.html#centrality-index-cont.",
    "href": "spatmetrics/data/index.html#centrality-index-cont.",
    "title": "Get ssb data",
    "section": "Centrality index cont.",
    "text": "Centrality index cont.\n\n\nCode\nprint(head(centrality_2018_ed))\n\n\n# A tibble: 6 × 3\n  knr   sen_ind sen_kl\n  <chr>   <dbl>  <dbl>\n1 0101      843      3\n2 0104      932      1\n3 0105      887      2\n4 0106      884      2\n5 0111      725      4\n6 0118      660      4"
  },
  {
    "objectID": "spatmetrics/data/index.html#put-it-all-together",
    "href": "spatmetrics/data/index.html#put-it-all-together",
    "title": "Get ssb data",
    "section": "Put it all together",
    "text": "Put it all together\n\n\nCode\nnames(pm2_2017)\n\n\n[1] \"knr\"                \"pm2\"                \"num_dwelling_sales\"\n\n\nCode\ndata_2017 <- knr_and_knavn %>% \n  left_join(pm2_2017) %>% \n  left_join(bef_2017) %>% \n  left_join(edu_2017) %>% \n  left_join(inc_2017) %>% \n  left_join(gov_emp_2017) %>%\n  left_join(sales_per_capita_2017) %>%\n  left_join(inc_dec_2017) %>%\n  left_join(wealth_2017) %>% \n  left_join(num_emp_2017) %>%\n  left_join(sup_sfd_2017) %>% \n  left_join(centrality_2018_ed ) %>% \n  mutate(\n    log_pm2 = log(pm2),\n    spc_100k = spc/100000,\n    gov_emp_1k = gov_emp/1000,\n    sen_ind_1k = sen_ind/1000\n  ) %>% \n  # rearrange \n  select(knr, kNavn, pm2, log_pm2, everything())"
  },
  {
    "objectID": "spatmetrics/data/index.html#put-it-all-together-cont.",
    "href": "spatmetrics/data/index.html#put-it-all-together-cont.",
    "title": "Get ssb data",
    "section": "Put it all together cont.",
    "text": "Put it all together cont.\n\n\nCode\ndim(data_2017)\n\n\n[1] 426 115\n\n\n\nWe have 115 variables and 426 observations."
  },
  {
    "objectID": "spatmetrics/data/index.html#add-data-to-our-map",
    "href": "spatmetrics/data/index.html#add-data-to-our-map",
    "title": "Get ssb data",
    "section": "Add data to our map",
    "text": "Add data to our map\n\n\nCode\n# join map and data\nmap_data_2017 <- map_2017 %>% \n  left_join(data_2017)\n# write out new map with data\n# if one add new variables it might \n# be necessary to delete the file \n# before writing new version\nst_write(\n  obj = map_data_2017, \n  dsn = \"map_data_2017.gpkg\", \n  driver = \"GPKG\", \n  append = FALSE\n  )\n\n\nDeleting layer `map_data_2017' using driver `GPKG'\nWriting layer `map_data_2017' to data source `map_data_2017.gpkg' using driver `GPKG'\nWriting 426 features with 115 fields and geometry type Multi Polygon."
  },
  {
    "objectID": "spatmetrics/data/index.html#references",
    "href": "spatmetrics/data/index.html#references",
    "title": "Get ssb data",
    "section": "References",
    "text": "References\n\n\nMSB205\n\n\n\nBivand, Roger. 2022a. “R Packages for Analyzing Spatial Data: A Comparative Case Study with Areal Data.” Geographical Analysis 54 (3): 488–518. https://doi.org/10.1111/gean.12319.\n\n\n———. 2022b. Spdep: Spatial Dependence: Weighting Schemes, Statistics. https://CRAN.R-project.org/package=spdep.\n\n\nBivand, Roger S., Edzer Pebesma, and Virgilio Gomez-Rubio. 2013a. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013b. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013c. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\nBivand, Roger, Jan Hauke, and Tomasz Kossowski. 2013. “Computing the Jacobian in Gaussian Spatial Autoregressive Models: An Illustrated Comparison of Available Methods.” Geographical Analysis 45 (2): 150–79. https://doi.org/10.1111/gean.12008.\n\n\nBivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. “A Review of Software for Spatial Econometrics in R.” Mathematics 9 (11). https://doi.org/10.3390/math9111276.\n\n\nBivand, Roger, and Gianfranco Piras. 2015. “Comparing Implementations of Estimation Methods for Spatial Econometrics.” Journal of Statistical Software 63 (18): 1–36. https://doi.org/10.18637/jss.v063.i18.\n\n\n———. 2022. Spatialreg: Spatial Regression Analysis. https://CRAN.R-project.org/package=spatialreg.\n\n\nBivand, Roger, and David W. S. Wong. 2018. “Comparing Implementations of Global and Local Indicators of Spatial Association.” TEST 27 (3): 716–48. https://doi.org/10.1007/s11749-018-0599-x.\n\n\nHugh-Jones, David. 2022. Huxtable: Easily Create and Style Tables for LaTeX, HTML and Other Formats. https://hughjonesd.github.io/huxtable/.\n\n\nImdad, M. U., M. Aslam, S. Altaf, and A. Munir. 2019. “Some New Diagnostics of Multicollinearity in Linear Regression Model.” Sains Malaysiana 48(9): 2051–60. http://dx.doi.org/10.17576/jsm-2019-4809-26.\n\n\nImdadullah, M., M. Aslam, and S. Altaf. 2016. “Mctest: An r Package for Deteection of Collinearity Among Regressors.” The R Journal 8(2): 499–509. https://journal.r-project.org/archive/2016/RJ-2016-062/index.html.\n\n\nLangsrud, Øyvind, and Jan Bruusgaard. 2021. PxWebApiData: PX-Web Data by API. https://github.com/statisticsnorway/PxWebApiData.\n\n\nMuhammad, Imdad Ullah, and Aslam Muhammad. 2020. Mctest: Multicollinearity Diagnostic Measures. https://CRAN.R-project.org/package=mctest.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\nPebesma, Edzer J., and Roger S. Bivand. 2005. “Classes and Methods for Spatial Data in R.” R News 5 (2): 9–13. https://CRAN.R-project.org/doc/Rnews/.\n\n\nPebesma, Edzer, and Roger Bivand. 2022. Sp: Classes and Methods for Spatial Data. https://CRAN.R-project.org/package=sp.\n\n\nRobinson, David, Alex Hayes, and Simon Couch. 2022. Broom: Convert Statistical Objects into Tidy Tibbles. https://CRAN.R-project.org/package=broom.\n\n\nTennekes, Martijn. 2018. “tmap: Thematic Maps in R.” Journal of Statistical Software 84 (6): 1–39. https://doi.org/10.18637/jss.v084.i06.\n\n\n———. 2022. Tmap: Thematic Maps. https://github.com/r-tmap/tmap.\n\n\nWickham, Hadley. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, and Jennifer Bryan. 2022. Readxl: Read Excel Files. https://CRAN.R-project.org/package=readxl."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#example",
    "href": "maps/qgismaps/maps_example.html#example",
    "title": "We have to talk more about maps",
    "section": "Example",
    "text": "Example\n\nwe want to study the price per square meter for single family dwellings in Norwegian muncipalities.\nwe have some data originally from SSB in the file bld06_19.Rdata.\nwe start by loading the data"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#import-data",
    "href": "maps/qgismaps/maps_example.html#import-data",
    "title": "We have to talk more about maps",
    "section": "Import data",
    "text": "Import data\n\n\nCode\nload(file = \"bld06_19.Rdata\")\nbld90_19\n\n\n# A tibble: 2,538 × 16\n   knrNavn     btype y2006 y2007 y2008 y2009 y2010 y2011 y2012 y2013 y2014 y2015\n   <chr>       <chr> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n 1 0101 Halden Andr…   629   630   600   596   629   639   648   660   663   661\n 2 0101 Halden Boli…  2108  2088  2135  2164  2168  2168  2174  2171  2177  2202\n 3 0101 Halden Bygn…   181   181   181   173   173   173   173   173   236   459\n 4 0101 Halden Eneb…  7134  7168  7258  7323  7381  7425  7453  7528  7628  7680\n 5 0101 Halden Rekk…  1768  1812  1874  1935  1973  1995  2012  2049  2078  2109\n 6 0101 Halden Toma…  2101  2140  2155  2171  2159  2159  2181  2204  2212  2254\n 7 0104 Moss   Andr…   612   526   555   572   569   590   583   589   615   603\n 8 0104 Moss   Boli…  3640  3763  3981  4155  4176  4216  4244  4264  4460  4560\n 9 0104 Moss   Bygn…    89   150   179   181   181   181   194   194   250   259\n10 0104 Moss   Eneb…  4907  4936  4936  4982  5010  5046  4998  5018  5029  5041\n# … with 2,528 more rows, and 4 more variables: y2016 <dbl>, y2017 <dbl>,\n#   y2018 <dbl>, y2019 <dbl>\n\n\n\nwe have 2538 observations and 16 variables\nis the data Tidy? No!"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#making-the-data-tidy",
    "href": "maps/qgismaps/maps_example.html#making-the-data-tidy",
    "title": "We have to talk more about maps",
    "section": "Making the data tidy",
    "text": "Making the data tidy\n\nwe are only interested in single family dwellings, so we start by picking those observation\nmake a new variable with municipality number\n‘pivot_longer’ to make a ‘year’ variable\ncontains data for the period 2006 to 2019\n\n\n\n\nCode\nsfd_06_19 <- bld90_19 %>% \n  #pick 'Enebolig'\n  filter(btype == 'Enebolig') %>% \n  #make new variable with municipality number\n  mutate(knr = substr(knrNavn, start = 1, stop = 4)) %>% \n  #put our new variable at the far left\n  select(knr, everything()) %>% \n  #pivot_longer the variables y2006 to y2019\n  pivot_longer(cols = y2006:y2019, names_to = \"year\", names_prefix = \"y\", values_to = \"pm2\") %>% \n  #drop btype, all obs. are 'Enebolig'\n  select(-btype)\n\n\n\nAre the data tidy now?"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#tidy-data",
    "href": "maps/qgismaps/maps_example.html#tidy-data",
    "title": "We have to talk more about maps",
    "section": "Tidy data?",
    "text": "Tidy data?\n\n\nCode\nsfd_06_19 %>% \n  head(n = 10)\n\n\n# A tibble: 10 × 4\n   knr   knrNavn     year    pm2\n   <chr> <chr>       <chr> <dbl>\n 1 0101  0101 Halden 2006   7134\n 2 0101  0101 Halden 2007   7168\n 3 0101  0101 Halden 2008   7258\n 4 0101  0101 Halden 2009   7323\n 5 0101  0101 Halden 2010   7381\n 6 0101  0101 Halden 2011   7425\n 7 0101  0101 Halden 2012   7453\n 8 0101  0101 Halden 2013   7528\n 9 0101  0101 Halden 2014   7628\n10 0101  0101 Halden 2015   7680\n\n\n\nlooks OK"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#pick-the-year-2018",
    "href": "maps/qgismaps/maps_example.html#pick-the-year-2018",
    "title": "We have to talk more about maps",
    "section": "Pick the year 2018",
    "text": "Pick the year 2018\n\n\nCode\nsfd_18 <- sfd_06_19 %>% \n  filter(year == '2018')\n\nsummary(sfd_18)\n\n\n     knr              knrNavn              year                pm2         \n Length:423         Length:423         Length:423         Min.   :   99.0  \n Class :character   Class :character   Class :character   1st Qu.:  980.5  \n Mode  :character   Mode  :character   Mode  :character   Median : 1843.0  \n                                                          Mean   : 3005.1  \n                                                          3rd Qu.: 3469.0  \n                                                          Max.   :35733.0  \n\n\n\nwe have 423 observations (municipalities) and no NAs (missing values)\nnow our data should be tidy"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#we-need-a-map",
    "href": "maps/qgismaps/maps_example.html#we-need-a-map",
    "title": "We have to talk more about maps",
    "section": "We need a map",
    "text": "We need a map\n\n\n\nSource: geonorge (Norge digitalt) “https://kartkatalog.geonorge.no”\nMunicipality borders 2020, we need 2018\nAdministrative enheter - historiske versjoner\n2018, sosi format?\nwikipedia: “SOSI-formatet er et filformat for utveksling av digitale geodata. Utviklingen av SOSI-formatet startet på 1970-tallet. [1] I dag[når?] utvikles SOSI-formatet lite, siden det er ventet at GML vil overta som utvekslingsformat.”\nRecent maps are made available in other formats, but older ones only in .sosi\ngdal has a plugin for sosi (but not part of standard installation), gdal must be compiled with the plugin enabled (multiple versions of the gdal library is asking for trouble, “been there, done that”)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#alternatives",
    "href": "maps/qgismaps/maps_example.html#alternatives",
    "title": "We have to talk more about maps",
    "section": "Alternatives",
    "text": "Alternatives\n\nan online alternative is mygeodata.cloud/converter/sosi-to-shp to convert from sosi to .shp (did not work late May 2021, still not working oct. 2022)\nanother alternative is https://sosicon.espenandersen.no/download/"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#sosi-file-converter",
    "href": "maps/qgismaps/maps_example.html#sosi-file-converter",
    "title": "We have to talk more about maps",
    "section": "SOSI File Converter",
    "text": "SOSI File Converter\n\n\n\nNote, shape format selected\nSelect “Create subfolder”, use one subfolder per map when you have it in shape format"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#municipality-map",
    "href": "maps/qgismaps/maps_example.html#municipality-map",
    "title": "We have to talk more about maps",
    "section": "Municipality map",
    "text": "Municipality map\n\n\n\nQgis\nwe have got a whole collection of maps, Kommune_FLATE.shp is probably the one we want\nthe map has 428 features (here “Kommune”)\nA “feature” will be a polygon, line or point with associated data\nThe projection of the map is “EPSG:25833” or UTM zone 33N (the recommended projection when we plot the whole of Norway)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#export-list-of-features",
    "href": "maps/qgismaps/maps_example.html#export-list-of-features",
    "title": "We have to talk more about maps",
    "section": "Export list of features",
    "text": "Export list of features\n\n\n\nWe export the features as a .csv file\nThis gives us the the data associated with each feature (municipality number, name etc.)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#read-feature-data-into-r",
    "href": "maps/qgismaps/maps_example.html#read-feature-data-into-r",
    "title": "We have to talk more about maps",
    "section": "Read feature data into R",
    "text": "Read feature data into R\n\n\nCode\nlibrary(readr)\nkom_2018_map <- read_csv(\"kom_2018_map.csv\")\n\n\n\npick what we need\n\n\n\n\nCode\nkom_2018_map <- kom_2018_map %>% \n  select(KOMMUNENUM,NAVN)\n\nmap_knr_2018 <- kom_2018_map$KOMMUNENUM\ndata_knr_2018 <- sfd_18$knr\n# knr in map, but not in data file\nsetdiff(map_knr_2018,data_knr_2018)\n\n\n [1] \"5020\" \"5033\" \"5038\" \"5031\" \"5016\" \"5053\" \"5013\" \"5036\" \"5051\" \"5048\"\n[11] \"5005\" \"5042\" \"5024\" \"5034\" \"5029\" \"5015\" \"5017\" \"5032\" \"5025\" \"5054\"\n[21] \"5021\" \"5037\" \"5027\" \"5047\" \"5044\" \"5046\" \"5012\" \"5026\" \"5050\" \"5045\"\n[31] \"5030\" \"5019\" \"5018\" \"5040\" \"5011\" \"5001\" \"5035\" \"5039\" \"5004\" \"5028\"\n[41] \"5052\" \"5049\" \"5014\" \"5043\" \"5041\" \"5023\" \"5022\"\n\n\n\nwe got “new Trøndelag”. Our data uses municipality structure before 2018 to be consistent over time."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#map",
    "href": "maps/qgismaps/maps_example.html#map",
    "title": "We have to talk more about maps",
    "section": "2017 map",
    "text": "2017 map\n\n\n\nDo to 2017 what we did with 2018\npick the variables we need\n\nThe problematic municipalities\nTaken from: https://no.wikipedia.org/wiki/Norske_kommunenummer"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#fix-the-problem",
    "href": "maps/qgismaps/maps_example.html#fix-the-problem",
    "title": "We have to talk more about maps",
    "section": "Fix the problem",
    "text": "Fix the problem\n\nIn the map we must join 0709 and 0728 into 0712 Larvik\nIn the map we must join 0702 + 0714 into 0715 Holmestrand\nIn the map we must join 0722 + 0723 into 0729 Færder\nThis can be done in R, but we do it first in Qgis."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#qgis-dissolve-løs-opp",
    "href": "maps/qgismaps/maps_example.html#qgis-dissolve-løs-opp",
    "title": "We have to talk more about maps",
    "section": "Qgis dissolve (“Løs opp …”)",
    "text": "Qgis dissolve (“Løs opp …”)\n\n\n\nEasiest way:\n\nFirst name the polygons\nright click/crtl click on the map layer\nSelect “Egenskaper” and then “Påskrifter” (4. in the list on the left)\nThen select “Enkle påskrifter” from the drop-down menu at the top, and select KOMMUNENUM as the variable to be used for “påskrift”\nWe know that “07” is “Vestfold” county, so we zoom in on the lower right corner"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#select-0709-and-0728",
    "href": "maps/qgismaps/maps_example.html#select-0709-and-0728",
    "title": "We have to talk more about maps",
    "section": "Select 0709 and 0728",
    "text": "Select 0709 and 0728\n\n\n\nChoose the select tool\nShift-click on 0728 and 0709"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#dissolve-union-0709-and-0728-into-0712-larvik",
    "href": "maps/qgismaps/maps_example.html#dissolve-union-0709-and-0728-into-0712-larvik",
    "title": "We have to talk more about maps",
    "section": "Dissolve (union) 0709 and 0728 into 0712 Larvik",
    "text": "Dissolve (union) 0709 and 0728 into 0712 Larvik\n\n\n\nDissolve"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#dissolve",
    "href": "maps/qgismaps/maps_example.html#dissolve",
    "title": "We have to talk more about maps",
    "section": "Dissolve",
    "text": "Dissolve\n\n\n\nImportant!\n\nSelect “Kun valgte objekter”\nLet “Oppløst” be “midlertidig lag”\nClick “Kjør”, and then “Close”"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.",
    "href": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.",
    "title": "We have to talk more about maps",
    "section": "Qgis dissolve cont.",
    "text": "Qgis dissolve cont.\n\n\n\ndeselect the “Oppløst” layer"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-1",
    "href": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-1",
    "title": "We have to talk more about maps",
    "section": "Qgis dissolve cont.",
    "text": "Qgis dissolve cont.\n\n\n\nClick on the map layer and enable editing"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-2",
    "href": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-2",
    "title": "We have to talk more about maps",
    "section": "Qgis dissolve cont.",
    "text": "Qgis dissolve cont.\n\n\n\nDelete selection\nChange to “Oppløst”,\nselect the object"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-3",
    "href": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-3",
    "title": "We have to talk more about maps",
    "section": "Qgis dissolve cont.",
    "text": "Qgis dissolve cont.\n\n\n\nCopy the object (Rediger > Kopier objekter)\nChange to the other layer and paste the object (Rediger > Lim inn objekter)\nDisable editing, save the map"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-4",
    "href": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-4",
    "title": "We have to talk more about maps",
    "section": "Qgis dissolve cont.",
    "text": "Qgis dissolve cont."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#change-name-of-new-object",
    "href": "maps/qgismaps/maps_example.html#change-name-of-new-object",
    "title": "We have to talk more about maps",
    "section": "Change name of new object",
    "text": "Change name of new object\n\n\n\nEnable editing (Click on the pencil)\nClick on “Identifiser objekter”\n\n\n\n\n\nPlot title."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#change-name-of-new-object-cont.",
    "href": "maps/qgismaps/maps_example.html#change-name-of-new-object-cont.",
    "title": "We have to talk more about maps",
    "section": "Change name of new object cont.",
    "text": "Change name of new object cont.\n\n\n\nClick on the new object\nClick on the icon above “Objekt” heading\n\n\n\n\n\nPlot title."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#change-name-of-new-object-cont.-1",
    "href": "maps/qgismaps/maps_example.html#change-name-of-new-object-cont.-1",
    "title": "We have to talk more about maps",
    "section": "Change name of new object cont.",
    "text": "Change name of new object cont.\n\n\n\nChange “KOMMUNENUM to 0712\nName is already”Larvik”, so OK\nClick OK\nDisable editing (click the pencil again) and save the map"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#do-the-same-for-0715-holmestrand-and-0729-færder",
    "href": "maps/qgismaps/maps_example.html#do-the-same-for-0715-holmestrand-and-0729-færder",
    "title": "We have to talk more about maps",
    "section": "Do the same for 0715 Holmestrand and 0729 Færder",
    "text": "Do the same for 0715 Holmestrand and 0729 Færder\n\nJoin 0702 + 0714 into 0715 Holmestrand\nJoin 07232 + 0723 into 0729 Færder\nRemember to save the map\nExport the finished map as .csv format"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-5",
    "href": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-5",
    "title": "We have to talk more about maps",
    "section": "Qgis dissolve cont.",
    "text": "Qgis dissolve cont.\n\n\nCode\nkom_2017_mapB <- read_csv(\"kom_2017_mapB.csv\")\nkom_2017_mapB <- kom_2017_mapB %>% \n  select(KOMMUNENUM,NAVN)\n\nmap_knr_2017B <- kom_2017_mapB$KOMMUNENUM\n# in map_knr_2017, but not in data_knr_2018\nsetdiff(map_knr_2017B, data_knr_2018)\n\n\ncharacter(0)\n\n\n\n\nCode\n# in data_knr_2018, but not in map_knr_2017\nsetdiff(data_knr_2018, map_knr_2017B)\n\n\ncharacter(0)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-6",
    "href": "maps/qgismaps/maps_example.html#qgis-dissolve-cont.-6",
    "title": "We have to talk more about maps",
    "section": "Qgis dissolve cont.",
    "text": "Qgis dissolve cont.\n\nSomething wrong?\n\n\n\n\nCode\nlength(data_knr_2018)\n\n\n[1] 423\n\n\nCode\nlength(map_knr_2017B)\n\n\n[1] 429\n\n\n\nNo, in the map some municipalities are split on two, or more, polygons\n\n\n\n\n\nCode\nlength(unique(data_knr_2018))\n\n\n[1] 423\n\n\n\n\nCode\nlength(unique(map_knr_2017B))\n\n\n[1] 423"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#how-to-do-it-in-r",
    "href": "maps/qgismaps/maps_example.html#how-to-do-it-in-r",
    "title": "We have to talk more about maps",
    "section": "How to do it in R",
    "text": "How to do it in R\n\nStart with a fresh map (run sosicon again)\nTry with sf::st_read()\n\n\n\n\nCode\nlibrary(sf)\n#Sys.setenv(\"SHAPE_ENCODING\"= \"UTF-8\")\n#kom_map <- st_read(dsn = 'kom_2017_R', layer = 'kom_2017_R_Kommune_FLATE')\n\n\n\nGives: “Reading layer kom_2017_R_Kommune_FLATE from data source /Users/agwd/Dev/met2/kom_2017_R using driver ESRI Shapefile Error in make.names(vnames, unique = TRUE) : invalid multibyte string 8 Error during wrapup: invalid multibyte string at LGE Error: no more error handlers available (recursive errors?); invoking abort restart”\nseems to be some problem with sosiconv, different character set in variables (Norvegian characters in .dbf) and in the values."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#using-sp-and-rgdal",
    "href": "maps/qgismaps/maps_example.html#using-sp-and-rgdal",
    "title": "We have to talk more about maps",
    "section": "Using sp and rgdal",
    "text": "Using sp and rgdal\n\n\nCode\nlibrary(rgdal)\nkf <- readOGR(dsn = 'kom_2017_R', \n              layer = 'kom_2017_R_Kommune_FLATE', \n              verbose = TRUE, \n              p4s = NULL,  \n              drop_unsupported_fields = TRUE, \n              use_iconv = TRUE, \n              encoding = \"UTF-8\")\n\n\nOGR data source with driver: ESRI Shapefile \nSource: \"/Users/ag/Dev/QQ_MSB205/maps/qgismaps/kom_2017_R\", layer: \"kom_2017_R_Kommune_FLATE\"\nwith 432 features\nIt has 12 fields"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#using-sp-and-rgdal-cont.",
    "href": "maps/qgismaps/maps_example.html#using-sp-and-rgdal-cont.",
    "title": "We have to talk more about maps",
    "section": "Using sp and rgdal cont.",
    "text": "Using sp and rgdal cont.\n\n\nCode\n# Drop some of the variables of no interest to us\nhead(kf[, c(1:3, length(names(kf)))], n = 1)\n\n\nclass       : SpatialPolygonsDataFrame \nfeatures    : 1 \nextent      : 1019225, 1101314, 7833981, 7881130  (xmin, xmax, ymin, ymax)\ncrs         : +proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs \nvariables   : 4\nnames       : KOMMUNENUM, LOKALID..., NAVN......, TYPE...... \nvalue       :       2003,     172718,      Vadsø,      FLATE \n\n\nuses NA and NA..1 as names for the two problematic variables REKKEFØLGE og SPRÅK we do not need them, so OK. What`s important for us is to get the map read into R and also preserve the right encoding for the municipality names (which might contain Norwegian characters)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#working-with-the-rgdal-map",
    "href": "maps/qgismaps/maps_example.html#working-with-the-rgdal-map",
    "title": "We have to talk more about maps",
    "section": "Working with the rgdal map",
    "text": "Working with the rgdal map\n\nPick the two variables we want, KOMMUNENUM and NAVN……\nChange the names\nPlot the map\n\n\n\n\nCode\n# variable 1 and 3\nkf <- kf[,c(1,3)]\nnames(kf) <- c(\"knr\", \"kNavn\")\n# Too time consuming for the slides\n#plot(kf)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#more-work-on-kf",
    "href": "maps/qgismaps/maps_example.html#more-work-on-kf",
    "title": "We have to talk more about maps",
    "section": "More work on kf",
    "text": "More work on kf\n\nCheck class\n\n\n\n\nCode\nclass(kf)\n\n\n[1] \"SpatialPolygonsDataFrame\"\nattr(,\"package\")\n[1] \"sp\"\n\n\n\nConvert to sf object\n\n\n\n\n\nCode\n# Tools to convert from sp to sf, and from sf to sp\nkf_sf <- st_as_sf(kf)\nclass(kf_sf)\n\n\n[1] \"sf\"         \"data.frame\""
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#more-work-on-kf-cont.",
    "href": "maps/qgismaps/maps_example.html#more-work-on-kf-cont.",
    "title": "We have to talk more about maps",
    "section": "More work on kf cont.",
    "text": "More work on kf cont.\n\n\nCode\ndim(kf_sf)\n\n\n[1] 432   3\n\n\nCode\nhead(kf_sf, n = 2)\n\n\nSimple feature collection with 2 features and 2 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 228157.8 ymin: 7122683 xmax: 1101314 ymax: 7881130\nProjected CRS: ETRS89 / UTM zone 33N\n   knr kNavn                       geometry\n0 2003 Vadsø POLYGON ((1032759 7861936, ...\n1 1633  Osen POLYGON ((244675.8 7151794,..."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#merging-municipalities",
    "href": "maps/qgismaps/maps_example.html#merging-municipalities",
    "title": "We have to talk more about maps",
    "section": "Merging municipalities",
    "text": "Merging municipalities\n\nSelect the municipalities that are not merged\nMerge municipalities, for instance 0709 + 0728 to 0712 Larvik\nPut the map together again\n\n\n\n\nCode\n# not merged\n# remember kf_sf works well with the Tidyverse\nkf_sf_nm <- kf_sf %>% \n  # not in c()\n  filter(!knr %in% c(\"0709\", \"0728\", \"0702\", \"0714\", \"0722\", \"0723\"))\ndim(kf_sf_nm)\n\n\n[1] 426   3"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#merging-municipalities-cont.",
    "href": "maps/qgismaps/maps_example.html#merging-municipalities-cont.",
    "title": "We have to talk more about maps",
    "section": "Merging municipalities cont.",
    "text": "Merging municipalities cont.\n\n\nCode\nLarvik_0712 <- kf_sf %>% \n  filter(knr %in% c(\"0709\", \"0728\")) %>% \n  st_union() %>%\n  # we have a sfc object (polygon), ned sf data.frame\n  st_sf(knr = \"0712\", kNavn = \"Larvik\")  %>% \n  # The geometry clumn has ended up with the name \".\",\n  # change it back to geometry\n  rename(\"geometry\" = \".\")\n\nHolmestrand_0715 <- kf_sf %>% \n  filter(knr %in% c(\"0702\", \"0714\")) %>% \n  st_union() %>%\n  st_sf(knr = \"0715\", kNavn = \"Holmestrand\") %>% \n  rename(\"geometry\" = \".\")\n\nFaerder_0729 <- kf_sf %>% \n  filter(knr %in% c(\"0722\", \"0723\")) %>% \n  st_union() %>%\n  st_sf(knr = \"0729\", kNavn = \"Færder\") %>% \n  rename(\"geometry\" = \".\")"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#bind-the-parts-together",
    "href": "maps/qgismaps/maps_example.html#bind-the-parts-together",
    "title": "We have to talk more about maps",
    "section": "Bind the parts together",
    "text": "Bind the parts together\n\nwe use rbind() to assemble the parts\n\n\n\n\nCode\nkf_sf_new <- rbind(kf_sf_nm, \n                   Larvik_0712, \n                   Holmestrand_0715, \n                   Faerder_0729)\nclass(kf_sf_new)\n\n\n[1] \"sf\"         \"data.frame\"\n\n\nCode\nhead(kf_sf_new)\n\n\nSimple feature collection with 6 features and 2 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: -79642.38 ymin: 6432782 xmax: 1101314 ymax: 7881130\nProjected CRS: ETRS89 / UTM zone 33N\n   knr        kNavn                       geometry\n1 2003        Vadsø POLYGON ((1032759 7861936, ...\n2 1633         Osen POLYGON ((244675.8 7151794,...\n3 1438    Bremanger POLYGON ((-66423.89 6897184...\n4 1244    Austevoll POLYGON ((-79575.13 6709024...\n5 1001 Kristiansand POLYGON ((81925.32 6466723,...\n6 0914  Tvedestrand POLYGON ((136145.2 6512556,..."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#plot-new-vestfold",
    "href": "maps/qgismaps/maps_example.html#plot-new-vestfold",
    "title": "We have to talk more about maps",
    "section": "Plot new Vestfold",
    "text": "Plot new Vestfold\n\n\nCode\nkf_sf_new %>% \n  filter(as.numeric(knr) > 700 & as.numeric(knr) < 800) %>% \n  select(knr) %>% \n  plot(key.pos = 3)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#merge-map-and-data",
    "href": "maps/qgismaps/maps_example.html#merge-map-and-data",
    "title": "We have to talk more about maps",
    "section": "Merge map and data",
    "text": "Merge map and data\n\nWe can do the merge of data and map in Qgis\nHere we do it in R, using sf our new toy\n\n\n\n\nCode\ndim(kf_sf_new)\n\n\n[1] 429   3\n\n\n\n\nCode\ndim(sfd_18)\n\n\n[1] 423   4\n\n\n\nWhat’s wrong"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#merge-map-and-data-cont.",
    "href": "maps/qgismaps/maps_example.html#merge-map-and-data-cont.",
    "title": "We have to talk more about maps",
    "section": "Merge map and data cont.",
    "text": "Merge map and data cont.\n\nNothing, but som municipalities have multiple polygons\n\n\n\n\nCode\nkf_sf_new %>% \n  filter(knr == \"0710\")\n\n\nSimple feature collection with 2 features and 2 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 214716 ymin: 6523881 xmax: 236648.8 ymax: 6593351\nProjected CRS: ETRS89 / UTM zone 33N\n   knr      kNavn                       geometry\n1 0710 Sandefjord POLYGON ((220354.2 6572257,...\n2 0710 Sandefjord POLYGON ((220485 6561491, 2..."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#merge-map-and-data-cont.-1",
    "href": "maps/qgismaps/maps_example.html#merge-map-and-data-cont.-1",
    "title": "We have to talk more about maps",
    "section": "Merge map and data cont.",
    "text": "Merge map and data cont.\n\n0710 Sandefjord has an enclave inside 0712 Larvik\nFind duplicates (more than one polygon)\n\n\n\n\nCode\nkf_sf_new %>% \n  filter(duplicated(knr))\n\n\nSimple feature collection with 6 features and 2 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 148155.3 ymin: 6561053 xmax: 298002.9 ymax: 7048475\nProjected CRS: ETRS89 / UTM zone 33N\n   knr      kNavn                       geometry\n1 1663     Malvik POLYGON ((292666.4 7030893,...\n2 0819       Nome POLYGON ((148567.8 6586721,...\n3 1663     Malvik POLYGON ((280936.1 7037994,...\n4 0215      Frogn POLYGON ((249548 6626601, 2...\n5 0701     Horten POLYGON ((238010.9 6591209,...\n6 0710 Sandefjord POLYGON ((220485 6561491, 2..."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#plot-malvik",
    "href": "maps/qgismaps/maps_example.html#plot-malvik",
    "title": "We have to talk more about maps",
    "section": "Plot Malvik",
    "text": "Plot Malvik\n\n\nCode\nkf_sf_new %>% \n  filter(knr %in% c(\"1663\")) %>% \n  select(kNavn) %>% \n  plot(key.pos = 4)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#make-multipolygons",
    "href": "maps/qgismaps/maps_example.html#make-multipolygons",
    "title": "We have to talk more about maps",
    "section": "Make multipolygons",
    "text": "Make multipolygons\n\n\nCode\nkf_sf_423 <- kf_sf_new %>%\n  # kNavn unnecessary, but nice trick to carry along the variable\n  group_by(knr, kNavn) %>%\n  summarise(geometry = st_combine(geometry)) %>% \n  ungroup()\n\ndim(kf_sf_423)\n\n\n[1] 423   3"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#make-multipolygons-cont.",
    "href": "maps/qgismaps/maps_example.html#make-multipolygons-cont.",
    "title": "We have to talk more about maps",
    "section": "Make multipolygons cont.",
    "text": "Make multipolygons cont.\n\n\nCode\nhead(kf_sf_423, n = 3)\n\n\nSimple feature collection with 3 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 246920.8 ymin: 6531541 xmax: 311244.9 ymax: 6607757\nProjected CRS: ETRS89 / UTM zone 33N\n# A tibble: 3 × 3\n  knr   kNavn                                                           geometry\n  <chr> <chr>                                                 <MULTIPOLYGON [m]>\n1 0101  Halden    (((279596.3 6555228, 280474 6556668, 280474 6556668, 281380.5…\n2 0104  Moss      (((247465.5 6599443, 248497.9 6601261, 248497.9 6601261, 2501…\n3 0105  Sarpsborg (((273359.1 6577360, 273356.2 6577381, 273356.2 6577381, 2733…"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#plot-1663-malvik",
    "href": "maps/qgismaps/maps_example.html#plot-1663-malvik",
    "title": "We have to talk more about maps",
    "section": "Plot 1663 Malvik",
    "text": "Plot 1663 Malvik\n\n\nCode\n# Now as MULTIPOLYGON\nkf_sf_423 %>% \n  filter(knr %in% c(\"1663\")) %>% \n  select(kNavn) %>% \n  plot(key.pos = 4)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#færder",
    "href": "maps/qgismaps/maps_example.html#færder",
    "title": "We have to talk more about maps",
    "section": "Færder",
    "text": "Færder\n\n\nCode\nkf_sf_423 %>% \n  filter(knr %in% c(\"0729\")) %>% \n  select(kNavn) %>% \n  plot(key.pos = 1)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#finally-ready-to-join",
    "href": "maps/qgismaps/maps_example.html#finally-ready-to-join",
    "title": "We have to talk more about maps",
    "section": "Finally ready to join",
    "text": "Finally ready to join\n\n\nCode\nkf_sf_423_2018_pm2 <- left_join(x = kf_sf_423, y =  sfd_18, by = \"knr\")\n# Next take a long time\n#View(tmp)\nhead(kf_sf_423_2018_pm2, n = 5)\n\n\nSimple feature collection with 5 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 245176.8 ymin: 6521821 xmax: 311244.9 ymax: 6607757\nProjected CRS: ETRS89 / UTM zone 33N\n# A tibble: 5 × 6\n  knr   kNavn                                       geometry knrNavn year    pm2\n  <chr> <chr>                             <MULTIPOLYGON [m]> <chr>   <chr> <dbl>\n1 0101  Halden      (((279596.3 6555228, 280474 6556668, 28… 0101 H… 2018   7864\n2 0104  Moss        (((247465.5 6599443, 248497.9 6601261, … 0104 M… 2018   5084\n3 0105  Sarpsborg   (((273359.1 6577360, 273356.2 6577381, … 0105 S… 2018  13028\n4 0106  Fredrikstad (((249999.8 6574664, 249814.3 6575270, … 0106 F… 2018  18700\n5 0111  Hvaler      (((251957.3 6553129, 256847.8 6552769, … 0111 H… 2018   1923"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#finally-ready-to-join-cont.",
    "href": "maps/qgismaps/maps_example.html#finally-ready-to-join-cont.",
    "title": "We have to talk more about maps",
    "section": "Finally ready to join cont.",
    "text": "Finally ready to join cont.\n\n\nCode\nkf_sf_423_2018_pm2 <- kf_sf_423_2018_pm2 %>% \n  # split knrNavn from sfd_18 into sfd_knr and sfd_kNavn\n  separate(knrNavn, into = c(\"sfd_knr\", \"sfd_kNavn\"), sep = \"\\\\d\\\\s\") %>% \n  # we do not have to specify geometry it`s taken automatically\n  select(knr, kNavn, sfd_kNavn, pm2)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#finally-ready-to-join-cont.-1",
    "href": "maps/qgismaps/maps_example.html#finally-ready-to-join-cont.-1",
    "title": "We have to talk more about maps",
    "section": "Finally ready to join cont.",
    "text": "Finally ready to join cont.\n\n\nCode\nhead(kf_sf_423_2018_pm2, n = 5)\n\n\nSimple feature collection with 5 features and 4 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 245176.8 ymin: 6521821 xmax: 311244.9 ymax: 6607757\nProjected CRS: ETRS89 / UTM zone 33N\n# A tibble: 5 × 5\n  knr   kNavn       sfd_kNavn     pm2                                   geometry\n  <chr> <chr>       <chr>       <dbl>                         <MULTIPOLYGON [m]>\n1 0101  Halden      Halden       7864 (((279596.3 6555228, 280474 6556668, 2804…\n2 0104  Moss        Moss         5084 (((247465.5 6599443, 248497.9 6601261, 24…\n3 0105  Sarpsborg   Sarpsborg   13028 (((273359.1 6577360, 273356.2 6577381, 27…\n4 0106  Fredrikstad Fredrikstad 18700 (((249999.8 6574664, 249814.3 6575270, 24…\n5 0111  Hvaler      Hvaler       1923 (((251957.3 6553129, 256847.8 6552769, 25…"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#check-that-the-names-are-equal",
    "href": "maps/qgismaps/maps_example.html#check-that-the-names-are-equal",
    "title": "We have to talk more about maps",
    "section": "Check that the names are equal",
    "text": "Check that the names are equal\n\n\nCode\nkf_sf_423_2018_pm2 %>% \n  filter(!identical(kNavn, sfd_kNavn)) %>% \n  print(n = 5)\n\n\nSimple feature collection with 423 features and 4 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -99551.21 ymin: 6426048 xmax: 1121941 ymax: 7962744\nProjected CRS: ETRS89 / UTM zone 33N\n# A tibble: 423 × 5\n  knr   kNavn       sfd_kNavn     pm2                                   geometry\n* <chr> <chr>       <chr>       <dbl>                         <MULTIPOLYGON [m]>\n1 0101  Halden      Halden       7864 (((279596.3 6555228, 280474 6556668, 2804…\n2 0104  Moss        Moss         5084 (((247465.5 6599443, 248497.9 6601261, 24…\n3 0105  Sarpsborg   Sarpsborg   13028 (((273359.1 6577360, 273356.2 6577381, 27…\n4 0106  Fredrikstad Fredrikstad 18700 (((249999.8 6574664, 249814.3 6575270, 24…\n5 0111  Hvaler      Hvaler       1923 (((251957.3 6553129, 256847.8 6552769, 25…\n# … with 418 more rows"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#choose-norvegian-names-not-official-names",
    "href": "maps/qgismaps/maps_example.html#choose-norvegian-names-not-official-names",
    "title": "We have to talk more about maps",
    "section": "Choose Norvegian names, not official names",
    "text": "Choose Norvegian names, not official names\n\nWe choose Norvegian names\n\n\n\n\nCode\nkf_sf_423_2018_pm2 <- kf_sf_423_2018_pm2 %>% \n  # slect Norwegian names, not offical names\n  select(knr, sfd_kNavn, pm2) %>% \n  rename(kNavn = sfd_kNavn)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#histogram-of-price-per-square-meter",
    "href": "maps/qgismaps/maps_example.html#histogram-of-price-per-square-meter",
    "title": "We have to talk more about maps",
    "section": "Histogram of price per square meter",
    "text": "Histogram of price per square meter\n\nHistogram of price per square meter for single family dwellings in Norwegian municipalities in 2018\n\n\n\n\nCode\nkf_sf_423_2018_pm2 %>% \n  # Remember + not %>% \n  ggplot(aes(pm2)) +\n  geom_histogram()"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#histogram-of-price-per-square-meter-1",
    "href": "maps/qgismaps/maps_example.html#histogram-of-price-per-square-meter-1",
    "title": "We have to talk more about maps",
    "section": "Histogram of price per square meter",
    "text": "Histogram of price per square meter\n\nHistogram of price per square meter for single family dwellings in Norwegian municipalities in 2018"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#log-transform-pm2",
    "href": "maps/qgismaps/maps_example.html#log-transform-pm2",
    "title": "We have to talk more about maps",
    "section": "Log-transform pm2",
    "text": "Log-transform pm2\n\nSeems like a log-transformation might be appropriate\n\n\n\n\nCode\nkf_sf_423_2018_pm2 <- kf_sf_423_2018_pm2 %>% \n  # log default 'natural logarithms, i.e. ln()\n  mutate(log_pm2 = log(pm2))"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#log-transform-pm2-cont.",
    "href": "maps/qgismaps/maps_example.html#log-transform-pm2-cont.",
    "title": "We have to talk more about maps",
    "section": "Log-transform pm2 cont.",
    "text": "Log-transform pm2 cont.\n\n\nCode\nkf_sf_423_2018_pm2 %>% \n  # Remember + not %>% \n  ggplot(aes(log_pm2)) +\n  geom_histogram()"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#log_pm2-eastern-norway",
    "href": "maps/qgismaps/maps_example.html#log_pm2-eastern-norway",
    "title": "We have to talk more about maps",
    "section": "log_pm2 Eastern Norway",
    "text": "log_pm2 Eastern Norway\n\n\nCode\n# Take to long to plot, cache it \nkf_sf_423_2018_pm2 %>%\n  filter(substr(knr, start = 1, stop = 2) %in% c(\"01\", \"02\", \"03\", \"06\", \"07\")) %>%\n  select(log_pm2) %>%\n  plot(key.pos = 1)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#log_pm2-rogaland",
    "href": "maps/qgismaps/maps_example.html#log_pm2-rogaland",
    "title": "We have to talk more about maps",
    "section": "log_pm2 Rogaland",
    "text": "log_pm2 Rogaland\n\n\nCode\nkf_sf_423_2018_pm2 %>% \n  filter(\n    substr(\n      knr, \n      start = 1, \n      stop = 2\n      ) %in% c(\"11\")\n    ) %>% \n  select(log_pm2) %>% \n  plot(key.pos = 1)"
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#write-out-map",
    "href": "maps/qgismaps/maps_example.html#write-out-map",
    "title": "We have to talk more about maps",
    "section": "Write out map",
    "text": "Write out map\n\nTime to write out our map\nBy default we are not allowed to overwrite, hence append=FALSE\n\n\n\n\nCode\n# Do not use unless you are forced\nst_write(\n  obj = kf_sf_423,\n  dsn = \"kf_sf_423\",\n  driver = \"ESRI Shapefile\",\n  append = FALSE\n  )\n\n\nDeleting layer `kf_sf_423' using driver `ESRI Shapefile'\nWriting layer `kf_sf_423' to data source `kf_sf_423' using driver `ESRI Shapefile'\nWriting 423 features with 2 fields and geometry type Multi Polygon.\n\n\nCode\n# use\nst_write(\n  obj = kf_sf_423, \n  dsn = \"kf_sf_423.gpkg\", \n  driver = \"GPKG\", \n  append = FALSE\n  )\n\n\nDeleting layer `kf_sf_423' using driver `GPKG'\nWriting layer `kf_sf_423' to data source `kf_sf_423.gpkg' using driver `GPKG'\nWriting 423 features with 2 fields and geometry type Multi Polygon."
  },
  {
    "objectID": "maps/qgismaps/maps_example.html#write-out-map-cont.",
    "href": "maps/qgismaps/maps_example.html#write-out-map-cont.",
    "title": "We have to talk more about maps",
    "section": "Write out map cont.",
    "text": "Write out map cont.\n\nFor use with Geoda\n\n\n\n\nCode\nst_write(\n  obj = kf_sf_423_2018_pm2,\n  dsn = \"kf_sf_423_2018_pm2.gpkg\",\n  driver = \"GPKG\", \n  append = FALSE\n  )\n\n\nDeleting layer `kf_sf_423_2018_pm2' using driver `GPKG'\nWriting layer `kf_sf_423_2018_pm2' to data source \n  `kf_sf_423_2018_pm2.gpkg' using driver `GPKG'\nWriting 423 features with 4 fields and geometry type Multi Polygon.\n\n\n\n\nMSB205"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "MSB205",
    "section": "",
    "text": "To learn more about Quarto websites visit https://quarto.org/docs/websites."
  },
  {
    "objectID": "spatmetrics/index.html",
    "href": "spatmetrics/index.html",
    "title": "Spatial Econometrics",
    "section": "",
    "text": "Getting Data\nLucas County Houseing Data\nSpatial regressions polygons"
  },
  {
    "objectID": "assignment/index.html",
    "href": "assignment/index.html",
    "title": "Assignment msb205",
    "section": "",
    "text": "Assignment msb205 (html)\nAssignment msb205 (pdf)"
  },
  {
    "objectID": "assignment/assignment_text.html",
    "href": "assignment/assignment_text.html",
    "title": "Oppgavetekst termpaper MSB205; oppdatert 2022",
    "section": "",
    "text": "Det som mangler i datasettet er imidlertid variabler som beskriver området hvor husene ligger. Heldigvis har vi rik tilgang til data om dette også. Dette er data som bruker «census tracts» fra census-en i 2010, men er fra American Community Survey fra perioden 2010 til 2020. ACS er utvalgsundersøkelser som blir gjort kontinuerlig mellom de store «census-ene» som bare skjer hvert tiår. Undersøkelser kan strekke seg over flere år, men de variablene vi skal bruke samsvarer nokså godt med perioden 2014-15. Vi skal både bruke ACS data direkte og bearbeidet i form av en Environmental Health Disparities Index utarbeidet av Washington State Department of Health for hele staten Washington. Vi skal imidlertid benytte et subset tilbudt av King County her. Trykk på nedlastingsikonet vist i bildet under for å laste ned datasettet. Dere kan på neste side velge format. Der velger dere shape-fil formatet.\n\n\n\nPlot title.\n\n\nDenne shape-filen inneholder EHD indeksen, men også variablene indeksen er utarbeidet fra. I tillegg er det mange variabler som vi ikke trenger. For å lette arbeidet får dere følgende tidyverse funksjon som vil velge ut de variablene vi potensielt skal bruke.\n\n# Foreslår at dere kaller kartet som inneholder dataene for kc_wadoh_map\nkc_wadoh_map <- kc_wadoh_map %>% \n  select(\n  GEO_ID_TRT,\n  EHD_percen,#Environmental Health Index, weighted score many vars\n  linguist_2,#Pop. age 5+ speaking English less than \"very well\"\n  poverty_pe,#Percentage people living in poverty\n  POC_percen,#People of Color in percentage of pop. in tract\n  transporta,#% of income spent on transportation median family in tract\n  unemploy_2,#percentage unemployed\n  housing_pe,#% of households in group \"Unaffordable Housing\" (>30% inc.)\n  traffic_pe,#% of pop. near heavy traffic roadways\n  diesel,# nox consentration\n  ozone,# ozone consentration\n  PM25, # consentration of Particulate Matter in air\n  toxic_rele, # Toxic release from factories\n  hazardous_, # Hazardous Waste Treatment Storage and disposal Facilities\n  lead_perce, # measure of Lead paint in houses\n  superfund, # Proximity to contaminated sites on national list\n  facilities, # Proximity to Risk Management Plan Facilities\n  wastewater, # Proximity to wastewater facilities\n  sen_pop_pe, # % pop. over 65\n  socio_perc # score social economic determants, low best\n  )\n\nEn nærmere forklaring av variablene får dere ved å gå inn på siden og klikke på ikonet for stolpediagram. Se bildet under.\n\n\n\nPlot title.\n\n\nI tillegg til disse dataene skal vi også lage en variabel for samlet familie inntekt i de ulike områdene. Dette er mer «rå» data og angir for hvert av 398 «tracts» hvor mange familier det totalt er i området og hvor mange som er i hvert av totalt 16 inntektsintervaller (pluss en for totalt antall familier i en «tract»). Vi skal slå disse sammen til tre grupper, lav-inntekt, middels-inntekt og høy-inntekt.\nFilen er en liten del av en stor pakke med data som også inneholder «census tract map» for 2010 cencus som vi trenger i analysene. Dataene kan lastes ned fra denne siden. Trykk Open oppe i høyre hjørne for å laste ned et zip-arkiv. Les dokumentet «Term of Use», spesielt punkt 7, og pass på å legge det de ber om inn i en fotnote i termpaperet. Når dere har pakket ut arkivet vil dere finne en CatalogReports mappe. Åpner dere OpenDataCatalog.htm filen i en nettleser vil dere finne en oversikt over dataene som er tilgjengelig. Vi vil benytte datafilen acs_b19101_familyincome.dbf. Formatet .dbf er et PC database format fra 1990 tallet (dbase4). Filen kan åpnes i R med funksjonen read.dbf() fra pakken foreign. Tabellen er dokumentert her. Definer 0-35000 som low, 35000-100000 som mid, 100000 - som high. Variabler som begynner med E er estimerte verdier, mens M angir «margin of error» som vi ikke bryr oss om her.\nI mappen vil dere finne flere kart i shape-file format. Vi trenger kartene tracts10.* og tracts10_shore.*. Pass på at dere laster de riktige kartene. Alle område (census-tract) variablene må legges inn i disse to kartene før vi gjør en «spatial join» med hus-dataene fra Kaggle. Merk at King County benytter en Arcgis løsning fra ESRI, så census kartene benytter en spesiell ESRI projeksjon. Jeg anbefaler sterkt at dere endrer alle kartene dere bruker til projeksjonen EPSG:2926. Vi skal beregne avstander ut fra kartene så vi kan ikke jobbe med geografiske koordinater.\nNår dere har regnet ut de tre variablene må disse legges til i tracts10 og tracts10_shore kartene. Dette er to versjoner av census-tracts kart. Vi skal senere avgjøre hvilket som er best å bruke.\nVi skal også lage en variabel som benytter opplysningene fra husdatasettet. Før vi gjør det bør vi ordne litt i datasettet. Datasettet inneholder enkelte multiple salg i perioden (dvs. enkelte hus har blitt solgt flere ganger i perioden 2014-2015). Vi vil bare benytte det siste salget. Lag nye variabler year, month og day ut fra date og sorter salgene «descending» vha. arrange(). Brukt så funksjonen distinct() fra Tidyverse for å plukke det siste salget, i tilfelle det er flere salg.\nVi skal også lage en variabel som angir avstand til CBD (Central Business District) i Seattle. Gå til wikipedia siden for Seattle og klikk på koordinatene oppe i venstre hjørne. Du får da tilgang til koordinater (longitude, latitude) i desimal. Vi bruker dette punktet som koordinater for CBD. Regn ut avstanden fra hver observasjon til dette punktet i luftlinje (se st_distance()) og konverter avstanden til kilometer vha. units::set_units(). Kall variabelen for dist_cbd.\nNår alle variablene er på plass i de to typene kart, punkt for husene, polygon (eller tracts) for acs data må vi binde områdevariablene til de respektive husene (bruk sf:st_join()). Før dette gjøres dobbelsjekk at projeksjonen er EPSG:2926 og lagre alle kartene i geopackage format.\nUtfør spatial join både for tracts10 og tracts10_shore. Sjekk områdevariablene vha. summary(). Har dere gjort ting riktig (dvs. som meg ;-)) vil dere se at for tracts10 er det 1 hus som har NA for samtlige områdevariabler. For tracts10_shore er det derimot 26 hus med NA for disse variablene. Ta geopackage kartene inn i QGIS og prøv å finne ut hva som har gått galt med tracts10_shore. Hint! Zoom inn på hus som ligger langs strandlinjen.\nBruk data fra tracts10, men slett den ene observasjonen som har NA verdier (alternativet er å redigere koordinater).\nTa kartet med hus-observasjonene, inklusive census-tract variablene, inn i GeoDa og utfør en EDA for dataene. Er det noe mønster som utpeker seg når det gjelder priser eller de andre variablene? Bruk f.eks. Bivariate Local Morans I for å finne ut hvor vi finner små og dyre boliger, store og dyre boliger osv.\nEtter EDA skal dere utvikle minst tre hedonske modeller, en med bare hus-karakteristika, en der dere benytter relevante hus-karakteristika og flere områdevariabler og til slutt en modell der dere benytter bare EHD indeksen for å beskrive området huset ligger i. Sammenlign de tre modellen og undersøk vha. Morans I hvor mye «spatial effects» det er i residualene fra de tre modellene.\nHusk at:\n\nman ofte benytter loglog modeller for hedonske modeller\nat log transformasjon av variabler kan gjøres direkte i formula uttrykket i R\nat log(0) ikke er definert. Dette løses ofte med å legge til 1 til variabler som inneholder 0 verdier.\noperasjonene +, * osv. har en spesiell betydning i R formulas og må «beskyttes» med I() funksjonen hvis de skal benyttes i et formula-uttrykk, f.eks. I(log(var1 +1)).\n\nFunksjonen huxtable::huxreg() er glimrende for å vise resultatet for ulike regresjonsmodeller ved siden av hverandre i en tabell. Rapporter estimatene med tilhørende t-verdier som er det vanligste innen økonometri.\nHusk videre at innen økonometri er man opptatt av heteroskedastisitet, så benytt coeftest() fra lmtest for å få robuste «standard error» estimat. (sett type argumentet til “HC4” eller “HC3”. “HC1” gir default Stata korreksjon)\nDatasettet vårt spenner over en tidsperiode så benytt dummy-variabler for månedene i datasettet (gjøres effektivt vha. factor() i R). Bruk linearHypothesis() fra car pakken for å teste om vi trenger tids-dummier, dvs. utfør en simultan test på om alle tids-dummiene kan settes lik 0. Også her bør vi benytte robuste standardfeil, så sett opsjonen white.adjust = “hc3” eller “hc4” eller “hc1”.\nBishop et al. (2020) er en god kilde for vurderinger rundt hvordan bygge en god hedonske modell.\n\nSpatial regressions\nLeSage (n.d.) er i tillegg til Anselin (1988) kildene vi bygger på for å utføre «spatial regressions» på et subset av disse dataene.\nEtter å ha bygget hedonske modeller for hele datasettet og fastslått at vi har «spatial effects» i residualene vil vi fortsette med såkalte «spatial regressions». Et viktig spørsmål her er hvilken romlig regresjonsmodell som best fanger disse romlige effektene. Vi skal se på valg av modell både vha. Anselin (1988) metode og LeSage (n.d.); .\nVåre data er punkt-observasjoner. Vi kan da definere naboer ut fra et avstandskriterium, men vi vil heller benytte «k-nearest» som ofte blir anbefalt som et bedre kriterium (se f.eks. Bivand, Pebesma, and Gómez-Rubio (2013) s. 247--248 for en diskusjon av problemene med et avstandskriterium). Vil vil studere modellene med hhv. 3 nærmeste naboer og 10 nærmeste naboer.\nFor at analysen skal bli håndterbar vil vi bruke bare et utvalg. Et forskjellig utvalg for hver gruppe, hentet fra det totale datasettet. For 9 soner som har mindre enn seks observasjoner vil samtlige observasjoner i disse sone inngå i alle tre datasettene. For de resterende sonene vil det bli valgt tilfeldig 5 observasjoner fra hver sone (ulik «seed» for de tre gruppene) slik at hver gruppe får et datasett med knapt 2000 observasjoner. Disse datasettene vil bli gjort tilgjengelig for hver gruppe i form av en geopackage fil (jeg vet, jeg er alt for snill ;-)).\n\nSend en epost med navn på de som deltar i gruppen. Vi benytter to studenter per gruppe og eventuelt en med tre hvis oddetall.\n\n\n\n\nVi vil betrakte prisdannelsen for hus som et lokalt fenomen jmf. LeSage (n.d.) og vil estimere og teste de nestede modellene SDEM, SEM, SLX og standard lm (ols) for hhv. 3 og 10 naboer vha. en likelihood ratio test (LR.Sarlm() fra pakken spatialreg). Vi vil også benytte Anselin (1988) angrepsmåte (SAR, SEM og lm (OLS))) med Lagrange Multiplier Tests (gjøres enkelt vha. lm.LMtests(vår_lm, listw = vår_w, test=\"all\") fra pakken spdep.\nHusk at moran.plot(residuals(vår_mod), listw = vår_w, pch = \".\") er et flott verktøy for å sjekke hvor mye «spatial interactions» som er igjen i residualene våre.\nTil slutt vil vi trekke nye 2000 observasjoner tilfeldig fra det fulle datasettet for å sjekke om resultatene våre er robuste mht. teknikken vi brukte for å få et utvalg med observasjoner fra samtlige soner (som har observasjoner, noen få «census tracts» er helt uten observasjoner). Vi genererer nye vektmatriser for dette datasettet med 3 og 10 naboer. Bruk samme «seed» som ovenfor for å trekke de 2000 observasjonene.\n\n\nHva som må gjøres\n\nStudy the paper by Bishop et al. (2020) . Give a short summary (around 2-3 pages) of this paper focusing on the what is presented on pages 1-13 (until Difference-in-difference research design). In your summary you should carefully answer the following questions: \n\nExplain what is meant by Rosen’s first and second stage.\nExplain shortly how marginal willingness to pay for an environmental attribute can be revealed via Rosen’s first step. \nWhy could it be important to define a housing market as a single metropolitan (or travel to work) area and studying a relatively short period of time, when estimating\n\nhedonic price function?\nExplain intuitively, by using an example, why it is important to avoid omitted variable bias when estimating a hedonic price model.\n\n\nLast ned House Sales King County, USA fra Kaggle\n\nSjekk definisjonen på de ulike variablene\nLes .csv filen med House Sales King County inn i R\nSorter salgene «descending» etter dato, siste først (dvs. mai 2015, april 2015 osv.)\nBruk dplyr::distinct() til å velge siste salg der vi har multiple salg av samme eiendom.\nBruk st_as_sf() til å konvertere house data til et sf objekt vha. long lat og sett til geografisk projeksjon, dvs EPSG:4326.\nKonverter dette sf objektet så til projeksjonen EPSG:2926.\nBruk koordinatene fra Seattles wikipedia-side (øvre høyre hjørne, klikk linken så får dere koordinatene i desimal form) og sett dette punktet som CBD for Seattle.\nKonverter dette punktet til EPSG:2926. Finn avstanden mellom dette punktet og samtlige hus i datasettet i luftlinje. Konverter avstandene til km og legg dem i variabelen dest_CBD i kartet med husdata.\n\nLast ned WADOH Environmental Health Disparities Index Calculated for King County\n\nLes inn .shp filen WADOH King County.\nPlukk ut variablene angitt tidligere i oppgaven.\nTransponer kartet til projeksjonen EPSG:2926\nLag inntektsvariabelen som beskrevet ovenfor. Legg disse til som nye variabler i WADOH King County.\nLast ned\nLast shape filene tracts10 og tracts10_shore fra censusSHP mappen (vær nøye med at dere velger 10 varianten)\nBruk en left_join() for å få dataene fra WADOH King County inn i begge disse kartene\nTransponer begge kartene til EPSG:2926\n\nGjør en «spatial join» av husdata med både tracts10 og så tracts10_shore\n\nSjekk områdevariablene fra WADOH vha. summary for tracts10 og tracts10_shore\nForklar hvorfor vi har mange flere NA (25 flere) i tracts10_shore enn i tracts10. En hjelp kan være å lagre både husdataene, tracts10, og tracts10_shore som geopackage filer og så ta dem inn i Qgis. Legg punktene for husene øverst, tracts10 og tracts10_shore under. Ser dere nå hva som går galt med tracts10_shore?\nObservasjonen med id 3518000180 fra tracts10 har bare NA for områdevariablene. Dropp denne, eller eventuelt editer koordinatene og kjør spatial join på ny.\nLag en faktor-variabel av år og måned ut fra Date, kall den year_month.\nSlett .gpkg filen for husdataene og lagre den på ny. (Får ikke overskrive filen derfor sletter vi den før vi oppdaterer. Alternativt kan vi sette opsjonen append til FALSE.)\n\nUtfør EDA i GeoDA\n\nLag et nytt prosjekt i GeoDA\nLast inn husdataene via .gpkg filen lagret ovenfor\nGenerer en vekt fil utfra 3 og 10 nærmeste naboer\nPrøv å finne ut hvor de små og dyre, de store og dyre, de billige og store og de små og billige boligene ligger (prøv Bivariate Morans I)\nDere kan eventuelt også eksperimentere med innledene SAR, SEM og lm modeller i GeoDa\n\nReturner så til Quarto dokumentet.\n\nGi en kort sammenfatning av funnene fra EDA.\nDefiner mint tre hedonske modeller. Ta utgangspunkt i Bishop et al. (2020) og diskuter valgte modeller utfra denne.\n\nEn null modell med bare huskarakteristika og tids-dummier (year_month)\nEn modell med huskarakteristika, dist_CBD, relevante tract-variabler og tids-dummier.\nEn modell med huskarakteristika, dist_CBD, EHD indeks (eventuelt inntektsvariabel) og tids-dummier.\n\nRapporter de tre modellen i en regresjonstabell (huxtable::huxreg()). Bruk robuste standard errors. Rapporter t-verdien som er det vanlig innen økonometri.\nTest og diskuter hvilken modell som er best. (Ta også en titt på plot(lm_navnet))\n\nBruk en simultan test på tids-dummiene for å avgjøre om vi trenger disse i modellen (car::linearHypothesis()) med opsjonen white_adjust = “hc3” eller “hc4” eller også eventuelt “hc1” hvis dere ønsker å bruke Stata sin default.\nSpatial Regressions\n\nLast gruppens utvalg fra relevant .gpkg fil (tallene er seed verdiene som er brukt for å genererer utvalgene)\n\n\n\nFormuler modellen dere vil bruke. Kjør den som lm (OLS) modell og bruk lm.morantest() og moran.plot() på residualene for å avgjøre om vi har uforklarte spatial effects i residualene.\nGenerer vektmatrise ut fra k=3 og k=10 nærmeste naboer\nBruk Anselin (1988) sin teknikk med Lagrange Multiplikator test vha. lm.LMtests() og diskuter hvilken modell (SAR, SEM eller lm (OLS)) som synes å være den beste.\nBruk så teknikken med nestede modeller anbefalt av LeSage (n.d.). Diskuter først om vi står overfor et lokalt eller globalt fenomen. Bruk opsjonen durban = as.formula(~ variabelnavnene du vil ha impacts for). Dette for å slippe impacts for tidsdummiene. Test så de nestede modellne vha. likelihood ratio test. Hvilken modell synes å være den beste?\nFor alternativet k=10 (10 nærmeste naboer). Bruk moran.plot() på residualene fra de ulike modellene for å illustrere hvor godt hver modell fjerner «spatial effects» fra residualene.\n\nTil slutt skal vi sjekke om utvalgsteknikken beskrevet ovenfor (5 hus fra hver trakt) har betydning for resultatene. (Sjekk på robusthet).\n\nVelg et utvalg på 2000 fra det store hus-datasettet.\nLag vektmatriser for k=3 og k=10\nSynes samme modell fremdeles å være den beste?\nDiskuter om resultatene er kvalitativt like.\n\nOppsummering/konklusjon\nHusk å sette en passende tittel på arbeidet.\n\nLykke til!\n\n\nR pakker dere kan ha bruk for\nJeg brukte følgende pakker når jeg «løste» oppgaven.\n\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(sf)\nlibrary(here)\nlibrary(tmap)\nlibrary(sp)\nlibrary(spdep)\nlibrary(spatialreg)\nlibrary(lmtest)\nlibrary(sandwich)\nlibrary(units)\nlibrary(car)\nlibrary(foreign)\n\n\n\n\n\n\n\n\n\nReferanser\n\nAnselin, Luc. 1988. Spatial Econometrics: Methods and Models. Springer Netherlands. https://doi.org/10.1007/978-94-015-7799-1.\n\n\nBishop, Kelly C., Nicolai V. Kuminoff, H. Spencer Banzhaf, Kevin J. Boyle, Kathrine von Gravenitz, Jaren C. Pope, V. Kerry Smith, and Christopher D. Timmins. 2020. “Best Practices for Using Hedonic Property Value Models to Measure Willingness to Pay for Environmental Quality.” Review of Environmental Economics and Policy 14 (2): 260–81. https://doi.org/10.1093/reep/reaa001.\n\n\nBivand, Roger S., Edzer Pebesma, and Virgilio Gómez-Rubio. 2013. Applied Spatial Data Analysis with r. Springer New York. https://doi.org/10.1007/978-1-4614-7618-4.\n\n\nLeSage, James P. n.d. “What Regional Scientists Need to Know about Spatial Econometrics,” 31."
  },
  {
    "objectID": "maps/EDA/index.html#we-will-do-eda-in-geoda",
    "href": "maps/EDA/index.html#we-will-do-eda-in-geoda",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "We will do EDA in GeoDa",
    "text": "We will do EDA in GeoDa\n\n\n\nMain Menu\n\n\n\n\n\nSee “GeoDa on Github” (n.d.), or use this link, for GeoDa Documentation\nWe collect what we do in a project\nWe start with a new empty project\nWe can also open a previously saved project\n\n\n\n\n\nNew Project"
  },
  {
    "objectID": "maps/EDA/index.html#add-our-map",
    "href": "maps/EDA/index.html#add-our-map",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Add our map",
    "text": "Add our map\n\n\n\n\n\nAdd Our Map\n\n\n\n\n\n\nMap of Norway (423 municipalities)"
  },
  {
    "objectID": "maps/EDA/index.html#generate-weights-matrix",
    "href": "maps/EDA/index.html#generate-weights-matrix",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Generate weights matrix",
    "text": "Generate weights matrix\n\n\n\nwe have to find our neighbours\nWe have our weights\nMake symmetric\nImportant that min neighbours > 0, else problems\n\n\n\n\n\nNew Weight Matrix"
  },
  {
    "objectID": "maps/EDA/index.html#weights-manager-cont.",
    "href": "maps/EDA/index.html#weights-manager-cont.",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Weights manager cont.",
    "text": "Weights manager cont.\n\n\n\nDo we have spatial autocorrelation in our data?\n\n\n\nUnivariate Moran's I\n\n\n\n\n\nSelect Variable and Weights\n\n\n\n\n\nSelect variable and weights\n\nDocumentation is to be found at geodacenter.github.io. Most of the following is taken from this source,\nWe select log_pm2 as variable and the queen based contiguity weights\n\nMoran’s I"
  },
  {
    "objectID": "maps/EDA/index.html#options-for-global-morans-i",
    "href": "maps/EDA/index.html#options-for-global-morans-i",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Options for Global Morans I",
    "text": "Options for Global Morans I\n\n\n\n\n\nMoran’s I\n\n\n\n\nRight click/ctrl click on plot\nClick Randomisation\nChoose 999 Permutations"
  },
  {
    "objectID": "maps/EDA/index.html#other-options",
    "href": "maps/EDA/index.html#other-options",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Other options",
    "text": "Other options\n\n\n\n\n\nPlot Moran’s I\n\n\n\n\nLOWESS smoother\nRegimes regression + Morans I for selected/not selected"
  },
  {
    "objectID": "maps/EDA/index.html#the-killer-feature-in-geoda-linked-plots",
    "href": "maps/EDA/index.html#the-killer-feature-in-geoda-linked-plots",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "The “killer” feature in GeoDa; linked plots",
    "text": "The “killer” feature in GeoDa; linked plots"
  },
  {
    "objectID": "maps/EDA/index.html#spatial-correlogram",
    "href": "maps/EDA/index.html#spatial-correlogram",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Spatial Correlogram",
    "text": "Spatial Correlogram\n\n\n\n\n\nSpatial Correlogram\n\n\n\n\nStandardised variables (\\(\\mu = 0, \\sigma = 1\\))\n\\(z_i · z_j = f(d_{ij}) + u\\) - \\(d_{ij}\\), distance between “center” of \\(i\\) polygon and \\(j\\) polygon\nThe smoothed line on the top shows how auto-correlation depends upon distance between to places.\nThe bar shows how many obs. we have for each distance\nDistance in meter, so max. dist. in figure is 70 km (ca. 1,5 hours of commute time)"
  },
  {
    "objectID": "maps/EDA/index.html#local-spatial-autocorrelation",
    "href": "maps/EDA/index.html#local-spatial-autocorrelation",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Local Spatial Autocorrelation",
    "text": "Local Spatial Autocorrelation\n\n\nLets hunt clusters\n\nLISA, Local Indicator of Spatial Association (Anselin 1995)\nLocal Morans I\nGlobal analysis: “Do we have spatial autocorrelation?”\nLocal analysis: “Where is the spatial autocorrelation located?”\nWhere should we expect clusters in our data?"
  },
  {
    "objectID": "maps/EDA/index.html#lisa-cluster-map",
    "href": "maps/EDA/index.html#lisa-cluster-map",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "LISA Cluster Map",
    "text": "LISA Cluster Map\n\n\n\n\n\nLISA cluster map\n\n\n\nLISA\n\nHigh-High: this muni is high and its neighbouring munis are high\nLow-Low: this muni is low and its neighbouring munis are low\nLow-High; this muni is low, but its neighbours are high\nHigh-Low; this muni is high, but its munis are low\nCan this be connected with infrastructure?\nNote when High-High is clicked in the top map. The High-High munis are selected in both figures"
  },
  {
    "objectID": "maps/EDA/index.html#significance",
    "href": "maps/EDA/index.html#significance",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Significance",
    "text": "Significance\n\n\n\n\n\nSignificance\n\n\n\n\nGlobal Morans I:\n\n\\(I = \\frac{\\sum_i\\sum_j w_{ij}·z_i·z_j}{\\sum_i z_i^2}\\)\n\nLocal Morans I:\n\n\\(I_i = \\frac{\\sum_j w_{ij}·z_i·z_j}{\\sum_i z_i^2}\\)\n\nThe global Morans I corresponds with the average of the local Morans I (details Anselin 1995)\nSignificance: analytic or conditional permutations\n\nAnalytical not very reliable in practice (Anselin 1995)\nConditional permutations: For each obs. (here muni) the local value is kept constant (log_pm2 for this muni) while the remaining n-1"
  },
  {
    "objectID": "maps/EDA/index.html#significance-cont.",
    "href": "maps/EDA/index.html#significance-cont.",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "Significance cont.",
    "text": "Significance cont.\n\n\n\n\n\nSignificance\n\n\n\n\nvalues are randomly permuted.\nIn this way we build a reference distribution\nThe real value is then compared to this distribution\nGenerate a “pseudo p-value” that can be used to assess significance"
  },
  {
    "objectID": "maps/EDA/index.html#references",
    "href": "maps/EDA/index.html#references",
    "title": "Exploratory Data Analysis (EDA)",
    "section": "References",
    "text": "References\n\n\nMSB205\n\n\n\nAppelhans, Tim, Florian Detsch, Christoph Reudenbach, and Stefan Woellauer. 2022. Mapview: Interactive Viewing of Spatial Data in r. https://github.com/r-spatial/mapview.\n\n\nBivand, Edzer Pebesma, Roger. n.d. Spatial Data Science. Accessed May 12, 2021. https://keen-swartz-3146c4.netlify.app/index.html.\n\n\nBivand, Roger. 2011a. “After ’Raising the Bar’: Applied Maximum Likelihood Estimation of Families of Models in Spatial Econometrics.” SSRN Electronic Journal. https://doi.org/10.2139/ssrn.1972278.\n\n\n———. 2011b. “After ’Raising the Bar’: Applied Maximum Likelihood Estimation of Families of Models in Spatial Econometrics.” SSRN Electronic Journal. https://doi.org/10.2139/ssrn.1972278.\n\n\nBivand, Roger S. 2021. “Progress in the R Ecosystem for Representing and Handling Spatial Data.” Journal of Geographical Systems 23 (4): 515–46. https://doi.org/10.1007/s10109-020-00336-0.\n\n\nBivand, Roger, Tim Keitt, and Barry Rowlingson. 2022. Rgdal: Bindings for the Geospatial Data Abstraction Library. https://CRAN.R-project.org/package=rgdal.\n\n\nBivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. “A Review of Software for Spatial Econometrics in R.” Mathematics 9 (11, 11): 1276. https://doi.org/10.3390/math9111276.\n\n\nBivand, Roger, Jakub Nowosad, and Robin Lovelace. 2021. spData: Datasets for Spatial Analysis. https://nowosad.github.io/spData/.\n\n\nBivand, Roger, and Colin Rundel. 2021. Rgeos: Interface to Geometry Engine - Open Source (GEOS). https://CRAN.R-project.org/package=rgeos.\n\n\nBrownrigg, Ray. 2021. Maps: Draw Geographical Maps. https://CRAN.R-project.org/package=maps.\n\n\n“GeoDa on Github.” n.d. Accessed August 30, 2022. http://geodacenter.github.io/.\n\n\nHalleck Vega, Solmaria, and J. Paul Elhorst. 2015. “THE SLX MODEL.” Journal of Regional Science 55 (3): 339–63. https://doi.org/10.1111/jors.12188.\n\n\nHealy, Kieran. 2019. Data Visualization (A Practical Introduction). 1. ed. Princeton University Press. https://socviz.co/index.html.\n\n\nJuhl, Sebastian. 2021. “The Wald Test of Common Factors in Spatial Model Specification Search Strategies.” Political Analysis 29 (2): 193–211. https://doi.org/10.1017/pan.2020.23.\n\n\nKnuth, Donald E. 1992. Literate Programming. 1st edition. Stanford, Calif.: Center for the Study of Language and Inf.\n\n\nLacombe, Donald J., and James P. LeSage. 2015a. “Using Bayesian posterior model probabilities to identify omitted variables in spatial regression models.” Papers in Regional Science 94 (2): 365–83. https://doi.org/10.1111/pirs.12070.\n\n\n———. 2015b. “Using Bayesian posterior model probabilities to identify omitted variables in spatial regression models.” Papers in Regional Science 94 (2): 365–83. https://doi.org/10.1111/pirs.12070.\n\n\nLeSage, James P. 2014. “What Regional Scientists Need to Know About Spatial Econometrics.” SSRN scholarly paper ID 2420725. Rochester, NY: Social Science Research Network. https://doi.org/10.2139/ssrn.2420725.\n\n\n“Map Projections and Distortion.” n.d. Accessed April 5, 2021. http://www.geography.hunter.cuny.edu/~jochen/GTECH361/lectures/lecture04/concepts/Map%20coordinate%20systems/Map%20projections%20and%20distortion.htm.\n\n\nMcIlroy, Doug, Ray Brownrigg, Thomas P Minka, and Roger Bivand. 2022. Mapproj: Map Projections. https://CRAN.R-project.org/package=mapproj.\n\n\nMcLean, Mathew W. 2020. RefManageR: Straightforward BibTeX and BibLaTeX Bibliography Management. https://github.com/ropensci/RefManageR/.\n\n\nMcLean, Mathew William. 2014. Straightforward Bibliography Management in r Using the RefManager Package. https://arxiv.org/abs/1403.2036.\n\n\n———. 2017. “RefManageR: Import and Manage BibTeX and BibLaTeX References in r.” The Journal of Open Source Software. https://doi.org/10.21105/joss.00338.\n\n\nMuenchow, Jannes, Jakub Nowosad. n.d. Geocomputation with R. Accessed May 12, 2021. https://geocompr.robinlovelace.net/.\n\n\nNowosad, Jakub, and Robin Lovelace. 2022. spDataLarge: Large Datasets for Spatial Analysis. https://github.com/Nowosad/spData.\n\n\nOetiker, Tobias, Hubert Partl, Irene Hyna, and Elisabeth Schlegl. n.d. “The Not So Short Introduction to LATEX 2ε,” 153.\n\n\n“One-Step Estimation of Spatial Dependence Parameters: Properties and Extensions of the APLE Statistic | Elsevier Enhanced Reader.” n.d. Accessed June 25, 2021. https://doi.org/10.1016/j.jmva.2011.08.006.\n\n\nOsland, Liv. 2010. “An Application of Spatial Econometrics in Relation to Hedonic House Price Modeling.” Journal of Real Estate Research 32 (July): 289–320.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022a. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\n———. 2022b. Stars: Spatiotemporal Arrays, Raster and Vector Data Cubes. https://CRAN.R-project.org/package=stars.\n\n\n———. n.d. “2. Reading, Writing and Converting Simple Features.” Sf documentasjon. 2. Reading, Writing and Converting Simple Features. Accessed March 30, 2021. https://r-spatial.github.io/sf/articles/sf2.html.\n\n\n“Shapefile Must Die!” n.d. Accessed August 29, 2022. http://switchfromshapefile.org/.\n\n\nSievert, Carson. 2020. Interactive Web-Based Data Visualization with r, Plotly, and Shiny. Chapman; Hall/CRC. https://plotly-r.com.\n\n\nSievert, Carson, Chris Parmer, Toby Hocking, Scott Chamberlain, Karthik Ram, Marianne Corvellec, and Pedro Despouy. 2021. Plotly: Create Interactive Web Graphics via Plotly.js. https://CRAN.R-project.org/package=plotly.\n\n\nSouth, Andy. 2017. Rnaturalearth: World Map Data from Natural Earth. https://github.com/ropenscilabs/rnaturalearth.\n\n\n———. 2022. Rnaturalearthhires: High Resolution World Vector Map Data from Natural Earth Used in Rnaturalearth.\n\n\nTennekes, Martijn. 2018. “tmap: Thematic Maps in R.” Journal of Statistical Software 84 (6): 1–39. https://doi.org/10.18637/jss.v084.i06.\n\n\n———. 2022. Tmap: Thematic Maps. https://github.com/r-tmap/tmap.\n\n\nTeucher, Andy, and Kenton Russell. 2022. Rmapshaper: Client for Mapshaper for Geospatial Operations. https://github.com/ateucher/rmapshaper.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\n———. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2022. Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics. https://CRAN.R-project.org/package=ggplot2.\n\n\nWilke, Claus O. n.d. Fundamentals of Data Visualization. Accessed May 12, 2021. https://clauswilke.com/dataviz/."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#summary-point-data",
    "href": "spatmetrics/LucasCounty/index.html#summary-point-data",
    "title": "Spatial Hedonic Model",
    "section": "Summary point data",
    "text": "Summary point data\n\nk nearest, neighbour structure generated from map data\n\n\n\n\nCode\nk_3_nearest <- knearneigh(my_point_data, k = 3)\n\n\n\nMake neighbour structure\n\n\n\n\n\nCode\nnb <- knn2nb(k_3_nearest)\n\n\n\nMake weights object from neighbour structure\n\n\n\n\n\nCode\nw <- nb2listw(nb, style = \"W\")\n\n\n\nIs there spatial effects present in dependent variable (y, house price etc.)?\n\n\n\n\n\nCode\nmoran.test(y, listw = w)\nmoran.plot(y, listw = w)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.",
    "href": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.",
    "title": "Spatial Hedonic Model",
    "section": "Summary point data cont.",
    "text": "Summary point data cont.\n\nFormulate linear model (lm_1).\n\n\n\n\nCode\nmod_1 = \"y ~ x1 + x2\"\n\n\n\nHas lm_1 removed spatial effects?\n\n\n\n\n\nCode\nlm.morantest(lm_1, listw = w)\n\n\n\nYes: we can stop, lm_1 will do.\nNo: Information left on the table. Still information (spatial effects) in the data that we have not used."
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-1",
    "href": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-1",
    "title": "Spatial Hedonic Model",
    "section": "Summary point data cont.",
    "text": "Summary point data cont.\n\nAnselin 1988:\n\nSpatial regressions in Geoda\n\nSpatial lag\nSpatial error\n\nIn R, Lagrange multiplier diagnostics for spatial dependence.\n\nBoth normal and robust version.\n\n\n\n\n\n\nCode\nlm.LMtests(lm_1, listw = w, test = \"all\")"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-2",
    "href": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-2",
    "title": "Spatial Hedonic Model",
    "section": "Summary point data cont.",
    "text": "Summary point data cont.\n\nLeSage 2014:\nThree paths of nested models under Manski Model\n\n“Theoretical econometrics”: SARAR; SEM; Spatial Lag; OLS\nGlobal: SDM; SLX; SAR; SEM theta = - rho * beta; OLS\nLocal: SDEM; SEM; SLX; OLS\n\nUse local path unless very good arguments for one of the other paths.\nTest models against each other with likelihood ratio test\n\n\n\n\nCode\nSDEM <- errorsarlm(\n  mod_1, \n  data = my_point_data, \n  listw = w, \n  Durbin = TRUE\n  )\n\n\n\nInterpret impacts; summary(impacts(SDEM), zstats = TRUE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-3",
    "href": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-3",
    "title": "Spatial Hedonic Model",
    "section": "Summary point data cont.",
    "text": "Summary point data cont.\n\n\nCode\nSEM <- errorsarlm(\n  mod_1, \n  data = my_point_data, \n  listw = w, \n  Durbin = FALSE\n  )\n\n\n\nInterpret coefficients; summary(SEM)\n\n\n\n\nCode\nSLX <- lmSLX(\n  mod_1, \n  data = my_point_data, \n  listw = w, \n  Durbin = TRUE\n  )\n\n\n\nInterpret impacts; summary(impacts(SLX), zstats = TRUE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-4",
    "href": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-4",
    "title": "Spatial Hedonic Model",
    "section": "Summary point data cont.",
    "text": "Summary point data cont.\n\n\nCode\nOLS <- lm(mod_1, data = my_point_data)\n\n\n\nChoose model with Likelihood ratio test\nTest the nested models against each other likelihood ratio test\n\n\n\n\nCode\nLR.Sarlm(SEM, SDEM)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-5",
    "href": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-5",
    "title": "Spatial Hedonic Model",
    "section": "Summary point data cont.",
    "text": "Summary point data cont.\n\nH0: restrict theta to 0 (theta = 0)\nH1: Do not restrict\n\np < 0.05; Reject H0, do not restrict, keep SDEM\np > 0.05; Do not reject H0, restrict to theta = 0, select SEM\n\nDo the same with SLX and finally OLS\nFor the selected model do (here SDEM selected model):\nCheck how much of spatial effects are left in selected models residuals.\n\n\n\n\nCode\nmoran.test(SDEM$residuals, listw = w)\nmoran.plot(SDEM$residuals, listw = w)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-6",
    "href": "spatmetrics/LucasCounty/index.html#summary-point-data-cont.-6",
    "title": "Spatial Hedonic Model",
    "section": "Summary point data cont.",
    "text": "Summary point data cont.\n\nTest residuals for heteroskedasticity and normality\nNormality:\n\n\n\n\nCode\nDescTools::JarqueBeraTest(residual(SDEM), robust = TRUE)\n\n\n\nHeteroskedasticity:\n\n\n\n\n\nCode\nspdep::bptest.Sarlm(SDEM, studentize = TRUE)"
  },
  {
    "objectID": "spatmetrics/LucasCounty/index.html#references",
    "href": "spatmetrics/LucasCounty/index.html#references",
    "title": "Spatial Hedonic Model",
    "section": "References",
    "text": "References\n\n\n\n\n\n\n\n\nMSB205\n\n\n\n“0.1 The Reproducible R Toolkit (RRT).” n.d. https://cran.r-project.org/web/packages/checkpoint/vignettes/checkpoint.html.\n\n\n“16 Product Fails That Defined The Decade.” n.d. BuzzFeed News. https://www.buzzfeednews.com/article/nicolenguyen/notable-tech-fails-of-2010s.\n\n\nBechhofer, Sean, Iain Buchan, David De Roure, Paolo Missier, John Ainsworth, Jiten Bhagat, Philip Couch, et al. 2013. “Why Linked Data Is Not Enough for Scientists.” Future Generation Computer Systems 29 (2): 599611. https://doi.org/10.1016/j.future.2011.08.004.\n\n\nBivand, Roger. 2022a. “R Packages for Analyzing Spatial Data: A Comparative Case Study with Areal Data.” Geographical Analysis 54 (3): 488–518. https://doi.org/10.1111/gean.12319.\n\n\n———. 2022b. Spdep: Spatial Dependence: Weighting Schemes, Statistics. https://CRAN.R-project.org/package=spdep.\n\n\nBivand, Roger S., Edzer Pebesma, and Virgilio Gomez-Rubio. 2013a. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013b. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\n———. 2013c. Applied Spatial Data Analysis with R, Second Edition. Springer, NY. https://asdar-book.org/.\n\n\nBivand, Roger, Jan Hauke, and Tomasz Kossowski. 2013. “Computing the Jacobian in Gaussian Spatial Autoregressive Models: An Illustrated Comparison of Available Methods.” Geographical Analysis 45 (2): 150–79. https://doi.org/10.1111/gean.12008.\n\n\nBivand, Roger, Giovanni Millo, and Gianfranco Piras. 2021. “A Review of Software for Spatial Econometrics in R.” Mathematics 9 (11). https://doi.org/10.3390/math9111276.\n\n\nBivand, Roger, Jakub Nowosad, and Robin Lovelace. 2021. spData: Datasets for Spatial Analysis. https://nowosad.github.io/spData/.\n\n\nBivand, Roger, and Gianfranco Piras. 2015. “Comparing Implementations of Estimation Methods for Spatial Econometrics.” Journal of Statistical Software 63 (18): 1–36. https://doi.org/10.18637/jss.v063.i18.\n\n\n———. 2022. Spatialreg: Spatial Regression Analysis. https://CRAN.R-project.org/package=spatialreg.\n\n\nBivand, Roger, and David W. S. Wong. 2018. “Comparing Implementations of Global and Local Indicators of Spatial Association.” TEST 27 (3): 716–48. https://doi.org/10.1007/s11749-018-0599-x.\n\n\nChan, TszKin Julian. 2022. Jmisc: Julian Miscellaneous Function. https://CRAN.R-project.org/package=Jmisc.\n\n\nGrossenbacher, Timo. n.d. “A (Truly) Reproducible R Workflow.” https://timogrossenbacher.ch/2017/07/a-truly-reproducible-r-workflow/.\n\n\nHugh-Jones, David. 2022. Huxtable: Easily Create and Style Tables for LaTeX, HTML and Other Formats. https://hughjonesd.github.io/huxtable/.\n\n\nPebesma, Edzer. 2018. “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal 10 (1): 439–46. https://doi.org/10.32614/RJ-2018-009.\n\n\n———. 2022. Sf: Simple Features for r. https://CRAN.R-project.org/package=sf.\n\n\nPebesma, Edzer J., and Roger S. Bivand. 2005. “Classes and Methods for Spatial Data in R.” R News 5 (2): 9–13. https://CRAN.R-project.org/doc/Rnews/.\n\n\nPebesma, Edzer, and Roger Bivand. 2022. Sp: Classes and Methods for Spatial Data. https://CRAN.R-project.org/package=sp.\n\n\nWickham, Hadley. 2016. Ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York. https://ggplot2.tidyverse.org.\n\n\n———. 2022. Tidyverse: Easily Install and Load the Tidyverse. https://CRAN.R-project.org/package=tidyverse.\n\n\nWickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. “Welcome to the tidyverse.” Journal of Open Source Software 4 (43): 1686. https://doi.org/10.21105/joss.01686.\n\n\nWickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2022. Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics. https://CRAN.R-project.org/package=ggplot2.\n\n\nXie, Yihui. 2014. “Knitr: A Comprehensive Tool for Reproducible Research in R.” In Implementing Reproducible Computational Research, edited by Victoria Stodden, Friedrich Leisch, and Roger D. Peng. Chapman; Hall/CRC. http://www.crcpress.com/product/isbn/9781466561595.\n\n\n———. 2015. Dynamic Documents with R and Knitr. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. https://yihui.org/knitr/.\n\n\n———. 2022. Knitr: A General-Purpose Package for Dynamic Report Generation in r. https://yihui.org/knitr/.\n\n\nXie, Yihui, Christophe Dervieux, and Emily Riederer. 2020. R Markdown Cookbook. Chapman; Hall/CRC. https://doi.org/10.1201/9781003097471."
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#moran-plot-sdem-residuals",
    "href": "spatmetrics/spatreg/index.html#moran-plot-sdem-residuals",
    "title": "Spatial regressions area data",
    "section": "Moran plot SDEM residuals",
    "text": "Moran plot SDEM residuals\n\n\nCode\nmoran.plot(residuals(SDEM), listw = md_2017_w)"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#spatial-lag-only-prct_20_64-and-sen_ind",
    "href": "spatmetrics/spatreg/index.html#spatial-lag-only-prct_20_64-and-sen_ind",
    "title": "Spatial regressions area data",
    "section": "Spatial lag only prct_20_64 and sen_ind?",
    "text": "Spatial lag only prct_20_64 and sen_ind?\nPerhaps spatial lag just for prct_20_64 and sen_ind is more appropriate?\n\n\nCode\nSLXred <- lmSLX(\n  mod2, \n  data = md_2017, \n  listw = md_2017_w, \n  Durbin =~prct_20_64 + sen_ind\n  )\n\n\n\n\nCode\nsummary(SLXred)\n\n\n\nCall:\nlm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1], collapse = \"+\"))), \n    data = as.data.frame(x), weights = weights)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-0.42200 -0.08543  0.00297  0.09024  0.48073 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(>|t|)    \n(Intercept)     4.5543075  0.5672570   8.029 1.87e-14 ***\nprct_20_64      0.0299614  0.0059617   5.026 8.34e-07 ***\ninc_bt_9and10   0.0313854  0.0022985  13.655  < 2e-16 ***\nspc_k           0.0008600  0.0003570   2.409  0.01657 *  \nsen_ind         0.0016553  0.0001726   9.590  < 2e-16 ***\nlag.prct_20_64  0.0346104  0.0105264   3.288  0.00112 ** \nlag.sen_ind    -0.0003859  0.0002325  -1.659  0.09804 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.1682 on 322 degrees of freedom\nMultiple R-squared:  0.801, Adjusted R-squared:  0.7973 \nF-statistic: 216.1 on 6 and 322 DF,  p-value: < 2.2e-16"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#slxred-residuals",
    "href": "spatmetrics/spatreg/index.html#slxred-residuals",
    "title": "Spatial regressions area data",
    "section": "SLXred residuals?",
    "text": "SLXred residuals?\n\n\nCode\nlm.morantest(\n  SLXred, \n  listw = md_2017_w, \n  alternative = \"greater\", \n  resfun = residuals, \n  naSubset = TRUE\n  )\n\n\n\n    Global Moran I for regression residuals\n\ndata:  \nmodel: lm(formula = formula(paste(\"y ~ \", paste(colnames(x)[-1],\ncollapse = \"+\"))), data = as.data.frame(x), weights = weights)\nweights: md_2017_w\n\nMoran I statistic standard deviate = 6.5606, p-value = 2.68e-11\nalternative hypothesis: greater\nsample estimates:\nObserved Moran I      Expectation         Variance \n     0.238643583     -0.007691829      0.001409845"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#slxred-residuals-plot",
    "href": "spatmetrics/spatreg/index.html#slxred-residuals-plot",
    "title": "Spatial regressions area data",
    "section": "SLXred residuals plot",
    "text": "SLXred residuals plot\n\n\nCode\nmoran.plot(residuals(SLX), listw = md_2017_w)\n\n\n\n\nNot much difference SLX and SLXred"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#should-we-restrict-sem-to-slx",
    "href": "spatmetrics/spatreg/index.html#should-we-restrict-sem-to-slx",
    "title": "Spatial regressions area data",
    "section": "Should we restrict SEM to SLX?",
    "text": "Should we restrict SEM to SLX?\n\n\nCode\n# p <0,05. Do not restrict. Keep SEM\nLR.Sarlm(SEM, SLX)\n\n\n\n    Likelihood ratio for spatial linear models\n\ndata:  \nLikelihood ratio = 29.961, df = 3, p-value = 0.000001406\nsample estimates:\nLog likelihood of SEM Log likelihood of SLX \n             139.8287              124.8482 \n\n\nCode\n# or broom::tidy(lmtest::lrtest(SLX, SEM))\n\n\nH0: restrict model to SLX, p < 0,05 and we discard H0. We chose SEM over SLX.\nHence we end up with SEM as the best (given that DGP is local) spatial model for this dataset.\n\\[ \\rho = 0, \\theta = 0: \\quad y = {\\bf X \\beta  + u\\quad u = \\lambda Wu + \\epsilon} \\]"
  },
  {
    "objectID": "spatmetrics/spatreg/index.html#whats-the-big-problem-with-this-model",
    "href": "spatmetrics/spatreg/index.html#whats-the-big-problem-with-this-model",
    "title": "Spatial regressions area data",
    "section": "What´s the big problem with this model?",
    "text": "What´s the big problem with this model?\n\n\n\nCode\nplot(log(md_2017$log_pm2), log(md_2017$net_cap_3000k_p))\n\n\n\n\n\n\n\nCode\ncor(log(md_2017$log_pm2), log(md_2017$net_cap_3000k_p))\n\n\n[1] 0.8528894"
  }
]